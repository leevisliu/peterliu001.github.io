!function(L,D,P){function n(P,N){var F=D[P];if(!F){var B=L[P];if(!B)return;var k={};F=D[P]={exports:k},B[0]((function(L){return n(B[1][L]||L)}),F,k)}return F.exports}for(var N=0;N<P.length;N++)n(P[N])}({1:[function(L,D,P){"use strict";L("../core/platform/CCClass");var N=L("../core/utils/misc");cc.Action=cc.Class({name:"cc.Action",ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var L=new cc.Action;return L.originalTarget=null,L.target=null,L.tag=this.tag,L},isDone:function(){return!0},startWithTarget:function(L){this.originalTarget=L,this.target=L},stop:function(){this.target=null},step:function(L){cc.logID(1006)},update:function(L){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(L){this.target=L},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(L){this.originalTarget=L},getTag:function(){return this.tag},setTag:function(L){this.tag=L},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Class({name:"cc.FiniteTimeAction",extends:cc.Action,ctor:function(){this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(L){this._duration=L},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Class({name:"cc.Speed",extends:cc.Action,ctor:function(L,D){this._speed=0,this._innerAction=null,L&&this.initWithAction(L,D)},getSpeed:function(){return this._speed},setSpeed:function(L){this._speed=L},initWithAction:function(L,D){return L?(this._innerAction=L,this._speed=D,!0):(cc.errorID(1021),!1)},clone:function(){var L=new cc.Speed;return L.initWithAction(this._innerAction.clone(),this._speed),L},startWithTarget:function(L){cc.Action.prototype.startWithTarget.call(this,L),this._innerAction.startWithTarget(L)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(L){this._innerAction.step(L*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(L){this._innerAction!==L&&(this._innerAction=L)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(L,D){return new cc.Speed(L,D)},cc.Follow=cc.Class({name:"cc.Follow",extends:cc.Action,ctor:function(L,D){this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),L&&(D?this.initWithTarget(L,D):this.initWithTarget(L))},clone:function(){var L=new cc.Follow,D=this._worldRect,P=new cc.Rect(D.x,D.y,D.width,D.height);return L.initWithTarget(this._followedNode,P),L},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(L){this._boundarySet=L},initWithTarget:function(L,D){if(!L)return cc.errorID(1022),!1;D=D||cc.rect(0,0,0,0),this._followedNode=L,this._worldRect=D,this._boundarySet=!(0===D.width&&0===D.height),this._boundaryFullyCovered=!1;var P=cc.winSize;return this._fullScreenSize=cc.v2(P.width,P.height),this._halfScreenSize=this._fullScreenSize.mul(.5),this._boundarySet&&(this.leftBoundary=-(D.x+D.width-this._fullScreenSize.x),this.rightBoundary=-D.x,this.topBoundary=-D.y,this.bottomBoundary=-(D.y+D.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(L){var D=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),P=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),F=D.sub(P),B=this.target.parent.convertToNodeSpaceAR(F.add(this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(N.clampf(B.x,this.leftBoundary,this.rightBoundary),N.clampf(B.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(B.x,B.y)},isDone:function(){return!this._followedNode.activeInHierarchy},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(L,D){return new cc.Follow(L,D)}},{"../core/platform/CCClass":137,"../core/utils/misc":210}],2:[function(L,D,P){"use strict";function r(L,D){return L[Math.min(L.length-1,Math.max(D,0))]}function s(L){for(var D=[],P=L.length-1;P>=0;P--)D.push(cc.v2(L[P].x,L[P].y));return D}function a(L){for(var D=[],P=0;P<L.length;P++)D.push(cc.v2(L[P].x,L[P].y));return D}cc.CardinalSplineTo=cc.Class({name:"cc.CardinalSplineTo",extends:cc.ActionInterval,ctor:function(L,D,P){this._points=[],this._deltaT=0,this._tension=0,this._previousPosition=null,this._accumulatedDiff=null,void 0!==P&&cc.CardinalSplineTo.prototype.initWithDuration.call(this,L,D,P)},initWithDuration:function(L,D,P){return D&&0!==D.length?!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this.setPoints(D),this._tension=P,!0):(cc.errorID(1024),!1)},clone:function(){var L=new cc.CardinalSplineTo;return L.initWithDuration(this._duration,a(this._points),this._tension),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.v2(this.target.x,this.target.y),this._accumulatedDiff=cc.v2(0,0)},update:function(L){var D,P;L=this._computeEaseTime(L);var N=this._points;if(1===L)D=N.length-1,P=1;else{var F=this._deltaT;P=(L-F*(D=0|L/F))/F}var B,k,U=function(L,D,P,N,F,B){var k=B*B,U=k*B,V=(1-F)/2,z=V*(2*k-U-B),W=V*(-U+k)+(2*U-3*k+1),H=V*(U-2*k+B)+(-2*U+3*k),G=V*(U-k),X=L.x*z+D.x*W+P.x*H+N.x*G,nt=L.y*z+D.y*W+P.y*H+N.y*G;return cc.v2(X,nt)}(r(N,D-1),r(N,D-0),r(N,D+1),r(N,D+2),this._tension,P);if(cc.macro.ENABLE_STACKABLE_ACTIONS&&(B=this.target.x-this._previousPosition.x,k=this.target.y-this._previousPosition.y,0!==B||0!==k)){var V=this._accumulatedDiff;B=V.x+B,k=V.y+k,V.x=B,V.y=k,U.x+=B,U.y+=k}this.updatePosition(U)},reverse:function(){var L=s(this._points);return cc.cardinalSplineTo(this._duration,L,this._tension)},updatePosition:function(L){this.target.setPosition(L),this._previousPosition=L},getPoints:function(){return this._points},setPoints:function(L){this._points=L}}),cc.cardinalSplineTo=function(L,D,P){return new cc.CardinalSplineTo(L,D,P)},cc.CardinalSplineBy=cc.Class({name:"cc.CardinalSplineBy",extends:cc.CardinalSplineTo,ctor:function(L,D,P){this._startPosition=cc.v2(0,0),void 0!==P&&this.initWithDuration(L,D,P)},startWithTarget:function(L){cc.CardinalSplineTo.prototype.startWithTarget.call(this,L),this._startPosition.x=L.x,this._startPosition.y=L.y},reverse:function(){for(var L,D=this._points.slice(),P=D[0],N=1;N<D.length;++N)L=D[N],D[N]=L.sub(P),P=L;var F=s(D);for(P=F[F.length-1],F.pop(),P.x=-P.x,P.y=-P.y,F.unshift(P),N=1;N<F.length;++N)(L=F[N]).x=-L.x,L.y=-L.y,L.x+=P.x,L.y+=P.y,F[N]=L,P=L;return cc.cardinalSplineBy(this._duration,F,this._tension)},updatePosition:function(L){var D=this._startPosition,P=L.x+D.x,N=L.y+D.y;this._previousPosition.x=P,this._previousPosition.y=N,this.target.setPosition(P,N)},clone:function(){var L=new cc.CardinalSplineBy;return L.initWithDuration(this._duration,a(this._points),this._tension),L}}),cc.cardinalSplineBy=function(L,D,P){return new cc.CardinalSplineBy(L,D,P)},cc.CatmullRomTo=cc.Class({name:"cc.CatmullRomTo",extends:cc.CardinalSplineTo,ctor:function(L,D){D&&this.initWithDuration(L,D)},initWithDuration:function(L,D){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,L,D,.5)},clone:function(){var L=new cc.CatmullRomTo;return L.initWithDuration(this._duration,a(this._points)),L}}),cc.catmullRomTo=function(L,D){return new cc.CatmullRomTo(L,D)},cc.CatmullRomBy=cc.Class({name:"cc.CatmullRomBy",extends:cc.CardinalSplineBy,ctor:function(L,D){D&&this.initWithDuration(L,D)},initWithDuration:function(L,D){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,L,D,.5)},clone:function(){var L=new cc.CatmullRomBy;return L.initWithDuration(this._duration,a(this._points)),L}}),cc.catmullRomBy=function(L,D){return new cc.CatmullRomBy(L,D)}},{}],3:[function(L,D,P){"use strict";cc.easeIn=function(L){return{_rate:L,easing:function(L){return Math.pow(L,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.easeOut=function(L){return{_rate:L,easing:function(L){return Math.pow(L,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.easeInOut=function(L){return{_rate:L,easing:function(L){return(L*=2)<1?.5*Math.pow(L,this._rate):1-.5*Math.pow(2-L,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};var N={easing:function(L){return 0===L?0:Math.pow(2,10*(L-1))},reverse:function(){return F}};cc.easeExponentialIn=function(){return N};var F={easing:function(L){return 1===L?1:1-Math.pow(2,-10*L)},reverse:function(){return N}};cc.easeExponentialOut=function(){return F};var B={easing:function(L){return 1!==L&&0!==L?(L*=2)<1?.5*Math.pow(2,10*(L-1)):.5*(2-Math.pow(2,-10*(L-1))):L},reverse:function(){return B}};cc.easeExponentialInOut=function(){return B};var k={easing:function(L){return 0===L||1===L?L:-1*Math.cos(L*Math.PI/2)+1},reverse:function(){return U}};cc.easeSineIn=function(){return k};var U={easing:function(L){return 0===L||1===L?L:Math.sin(L*Math.PI/2)},reverse:function(){return k}};cc.easeSineOut=function(){return U};var V={easing:function(L){return 0===L||1===L?L:-.5*(Math.cos(Math.PI*L)-1)},reverse:function(){return V}};cc.easeSineInOut=function(){return V};var z={easing:function(L){return 0===L||1===L?L:(L-=1,-Math.pow(2,10*L)*Math.sin((L-.075)*Math.PI*2/.3))},reverse:function(){return W}};cc.easeElasticIn=function(L){return L&&.3!==L?{_period:L,easing:function(L){return 0===L||1===L?L:(L-=1,-Math.pow(2,10*L)*Math.sin((L-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:z};var W={easing:function(L){return 0===L||1===L?L:Math.pow(2,-10*L)*Math.sin((L-.075)*Math.PI*2/.3)+1},reverse:function(){return z}};function u(L){return L<1/2.75?7.5625*L*L:L<2/2.75?7.5625*(L-=1.5/2.75)*L+.75:L<2.5/2.75?7.5625*(L-=2.25/2.75)*L+.9375:7.5625*(L-=2.625/2.75)*L+.984375}cc.easeElasticOut=function(L){return L&&.3!==L?{_period:L,easing:function(L){return 0===L||1===L?L:Math.pow(2,-10*L)*Math.sin((L-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:W},cc.easeElasticInOut=function(L){return{_period:L=L||.3,easing:function(L){var D=0,P=this._period;if(0===L||1===L)D=L;else{L*=2,P||(P=this._period=.3*1.5);var N=P/4;D=(L-=1)<0?-.5*Math.pow(2,10*L)*Math.sin((L-N)*Math.PI*2/P):Math.pow(2,-10*L)*Math.sin((L-N)*Math.PI*2/P)*.5+1}return D},reverse:function(){return cc.easeElasticInOut(this._period)}}};var H={easing:function(L){return 1-u(1-L)},reverse:function(){return G}};cc.easeBounceIn=function(){return H};var G={easing:function(L){return u(L)},reverse:function(){return H}};cc.easeBounceOut=function(){return G};var X={easing:function(L){return L<.5?.5*(1-u(1-(L*=2))):.5*u(2*L-1)+.5},reverse:function(){return X}};cc.easeBounceInOut=function(){return X};var nt={easing:function(L){return 0===L||1===L?L:L*L*(2.70158*L-1.70158)},reverse:function(){return ut}};cc.easeBackIn=function(){return nt};var ut={easing:function(L){return(L-=1)*L*(2.70158*L+1.70158)+1},reverse:function(){return nt}};cc.easeBackOut=function(){return ut};var dt={easing:function(L){return(L*=2)<1?L*L*(3.5949095*L-2.5949095)/2:(L-=2)*L*(3.5949095*L+2.5949095)/2+1},reverse:function(){return dt}};cc.easeBackInOut=function(){return dt},cc.easeBezierAction=function(L,D,P,N){return{easing:function(F){return Math.pow(1-F,3)*L+3*F*Math.pow(1-F,2)*D+3*Math.pow(F,2)*(1-F)*P+Math.pow(F,3)*N},reverse:function(){return cc.easeBezierAction(N,P,D,L)}}};var ft={easing:function(L){return Math.pow(L,2)},reverse:function(){return ft}};cc.easeQuadraticActionIn=function(){return ft};var _t={easing:function(L){return-L*(L-2)},reverse:function(){return _t}};cc.easeQuadraticActionOut=function(){return _t};var pt={easing:function(L){return(L*=2)<1?L*L*.5:-.5*(--L*(L-2)-1)},reverse:function(){return pt}};cc.easeQuadraticActionInOut=function(){return pt};var vt={easing:function(L){return L*L*L*L},reverse:function(){return vt}};cc.easeQuarticActionIn=function(){return vt};var gt={easing:function(L){return-((L-=1)*L*L*L-1)},reverse:function(){return gt}};cc.easeQuarticActionOut=function(){return gt};var mt={easing:function(L){return(L*=2)<1?.5*L*L*L*L:-.5*((L-=2)*L*L*L-2)},reverse:function(){return mt}};cc.easeQuarticActionInOut=function(){return mt};var yt={easing:function(L){return L*L*L*L*L},reverse:function(){return yt}};cc.easeQuinticActionIn=function(){return yt};var Tt={easing:function(L){return(L-=1)*L*L*L*L+1},reverse:function(){return Tt}};cc.easeQuinticActionOut=function(){return Tt};var xt={easing:function(L){return(L*=2)<1?.5*L*L*L*L*L:.5*((L-=2)*L*L*L*L+2)},reverse:function(){return xt}};cc.easeQuinticActionInOut=function(){return xt};var St={easing:function(L){return-1*(Math.sqrt(1-L*L)-1)},reverse:function(){return St}};cc.easeCircleActionIn=function(){return St};var bt={easing:function(L){return L-=1,Math.sqrt(1-L*L)},reverse:function(){return bt}};cc.easeCircleActionOut=function(){return bt};var wt={easing:function(L){return(L*=2)<1?-.5*(Math.sqrt(1-L*L)-1):(L-=2,.5*(Math.sqrt(1-L*L)+1))},reverse:function(){return wt}};cc.easeCircleActionInOut=function(){return wt};var Rt={easing:function(L){return L*L*L},reverse:function(){return Rt}};cc.easeCubicActionIn=function(){return Rt};var It={easing:function(L){return(L-=1)*L*L+1},reverse:function(){return It}};cc.easeCubicActionOut=function(){return It};var Mt={easing:function(L){return(L*=2)<1?.5*L*L*L:.5*((L-=2)*L*L+2)},reverse:function(){return Mt}};cc.easeCubicActionInOut=function(){return Mt}},{}],4:[function(L,D,P){"use strict";cc.ActionInstant=cc.Class({name:"cc.ActionInstant",extends:cc.FiniteTimeAction,isDone:function(){return!0},step:function(L){this.update(1)},update:function(L){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.Class({name:"cc.Show",extends:cc.ActionInstant,update:function(L){for(var D=this.target.getComponentsInChildren(cc.RenderComponent),P=0;P<D.length;++P)D[P].enabled=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.Class({name:"cc.Hide",extends:cc.ActionInstant,update:function(L){for(var D=this.target.getComponentsInChildren(cc.RenderComponent),P=0;P<D.length;++P)D[P].enabled=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.Class({name:"cc.ToggleVisibility",extends:cc.ActionInstant,update:function(L){for(var D=this.target.getComponentsInChildren(cc.RenderComponent),P=0;P<D.length;++P){var N=D[P];N.enabled=!N.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.Class({name:"cc.RemoveSelf",extends:cc.ActionInstant,ctor:function(L){this._isNeedCleanUp=!0,void 0!==L&&this.init(L)},update:function(L){this.target.removeFromParent(this._isNeedCleanUp)},init:function(L){return this._isNeedCleanUp=L,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(L){return new cc.RemoveSelf(L)},cc.FlipX=cc.Class({name:"cc.FlipX",extends:cc.ActionInstant,ctor:function(L){this._flippedX=!1,void 0!==L&&this.initWithFlipX(L)},initWithFlipX:function(L){return this._flippedX=L,!0},update:function(L){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var L=new cc.FlipX;return L.initWithFlipX(this._flippedX),L}}),cc.flipX=function(L){return new cc.FlipX(L)},cc.FlipY=cc.Class({name:"cc.FlipY",extends:cc.ActionInstant,ctor:function(L){this._flippedY=!1,void 0!==L&&this.initWithFlipY(L)},initWithFlipY:function(L){return this._flippedY=L,!0},update:function(L){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var L=new cc.FlipY;return L.initWithFlipY(this._flippedY),L}}),cc.flipY=function(L){return new cc.FlipY(L)},cc.Place=cc.Class({name:"cc.Place",extends:cc.ActionInstant,ctor:function(L,D){this._x=0,this._y=0,void 0!==L&&(void 0!==L.x&&(D=L.y,L=L.x),this.initWithPosition(L,D))},initWithPosition:function(L,D){return this._x=L,this._y=D,!0},update:function(L){this.target.setPosition(this._x,this._y)},clone:function(){var L=new cc.Place;return L.initWithPosition(this._x,this._y),L}}),cc.place=function(L,D){return new cc.Place(L,D)},cc.CallFunc=cc.Class({name:"cc.CallFunc",extends:cc.ActionInstant,ctor:function(L,D,P){this._selectorTarget=null,this._function=null,this._data=null,this.initWithFunction(L,D,P)},initWithFunction:function(L,D,P){return L&&(this._function=L),D&&(this._selectorTarget=D),void 0!==P&&(this._data=P),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(L){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(L){L!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=L)},clone:function(){var L=new cc.CallFunc;return L.initWithFunction(this._function,this._selectorTarget,this._data),L}}),cc.callFunc=function(L,D,P){return new cc.CallFunc(L,D,P)}},{}],5:[function(L,D,P){"use strict";function n(L,D,P,N,F){return Math.pow(1-F,3)*L+3*F*Math.pow(1-F,2)*D+3*Math.pow(F,2)*(1-F)*P+Math.pow(F,3)*N}cc.ActionInterval=cc.Class({name:"cc.ActionInterval",extends:cc.FiniteTimeAction,ctor:function(L){this.MAX_VALUE=2,this._elapsed=0,this._firstTick=!1,this._easeList=null,this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this._repeatMethod=!1,this._speedMethod=!1,void 0!==L&&cc.ActionInterval.prototype.initWithDuration.call(this,L)},getElapsed:function(){return this._elapsed},initWithDuration:function(L){return this._duration=0===L?cc.macro.FLT_EPSILON:L,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(L){L._repeatForever=this._repeatForever,L._speed=this._speed,L._timesForRepeat=this._timesForRepeat,L._easeList=this._easeList,L._speedMethod=this._speedMethod,L._repeatMethod=this._repeatMethod},_reverseEaseList:function(L){if(this._easeList){L._easeList=[];for(var D=0;D<this._easeList.length;D++)L._easeList.push(this._easeList[D].reverse())}},clone:function(){var L=new cc.ActionInterval(this._duration);return this._cloneDecoration(L),L},easing:function(L){this._easeList?this._easeList.length=0:this._easeList=[];for(var D=0;D<arguments.length;D++)this._easeList.push(arguments[D]);return this},_computeEaseTime:function(L){var D=this._easeList;if(!D||0===D.length)return L;for(var P=0,N=D.length;P<N;P++)L=D[P].easing(L);return L},step:function(L){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=L;var D=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);D=1>D?D:1,this.update(D>0?D:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(L){cc.Action.prototype.startWithTarget.call(this,L),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(L){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(L){return L<=0?(cc.logID(1013),this):(this._speedMethod=!0,this._speed*=L,this)},getSpeed:function(){return this._speed},setSpeed:function(L){return this._speed=L,this},repeat:function(L){return L=Math.round(L),isNaN(L)||L<1?(cc.logID(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=L,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(L){return new cc.ActionInterval(L)},cc.Sequence=cc.Class({name:"cc.Sequence",extends:cc.ActionInterval,ctor:function(L){this._actions=[],this._split=null,this._last=0,this._reversed=!1;var D=L instanceof Array?L:arguments;if(1!==D.length){var P=D.length-1;if(P>=0&&null==D[P]&&cc.logID(1015),P>=0){for(var N,F=D[0],B=1;B<P;B++)D[B]&&(N=F,F=cc.Sequence._actionOneTwo(N,D[B]));this.initWithTwoActions(F,D[P])}}else cc.errorID(1019)},initWithTwoActions:function(L,D){if(!L||!D)return cc.errorID(1025),!1;var P=L._duration,N=D._duration,F=(P*=L._repeatMethod?L._timesForRepeat:1)+(N*=D._repeatMethod?D._timesForRepeat:1);return this.initWithDuration(F),this._actions[0]=L,this._actions[1]=D,!0},clone:function(){var L=new cc.Sequence;return this._cloneDecoration(L),L.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(L){var D,P,N=0,F=this._split,B=this._actions,k=this._last;(L=this._computeEaseTime(L))<F?(D=0!==F?L/F:1,0===N&&1===k&&this._reversed&&(B[1].update(0),B[1].stop())):(N=1,D=1===F?1:(L-F)/(1-F),-1===k&&(B[0].startWithTarget(this.target),B[0].update(1),B[0].stop()),0===k&&(B[0].update(1),B[0].stop())),P=B[N],k===N&&P.isDone()||(k!==N&&P.startWithTarget(this.target),D*=P._timesForRepeat,P.update(D>1?D%1:D),this._last=N)},reverse:function(){var L=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(L),this._reverseEaseList(L),L._reversed=!0,L}}),cc.sequence=function(L){var D=L instanceof Array?L:arguments;if(1===D.length)return cc.errorID(1019),null;var P=D.length-1;P>=0&&null==D[P]&&cc.logID(1015);var N=null;if(P>=0){N=D[0];for(var F=1;F<=P;F++)D[F]&&(N=cc.Sequence._actionOneTwo(N,D[F]))}return N},cc.Sequence._actionOneTwo=function(L,D){var P=new cc.Sequence;return P.initWithTwoActions(L,D),P},cc.Repeat=cc.Class({name:"cc.Repeat",extends:cc.ActionInterval,ctor:function(L,D){this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,void 0!==D&&this.initWithAction(L,D)},initWithAction:function(L,D){var P=L._duration*D;return!!this.initWithDuration(P)&&(this._times=D,this._innerAction=L,L instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var L=new cc.Repeat;return this._cloneDecoration(L),L.initWithAction(this._innerAction.clone(),this._times),L},startWithTarget:function(L){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,L),this._innerAction.startWithTarget(L)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(L){L=this._computeEaseTime(L);var D=this._innerAction,P=this._duration,N=this._times,F=this._nextDt;if(L>=F){for(;L>F&&this._total<N;)D.update(1),this._total++,D.stop(),D.startWithTarget(this.target),F+=D._duration/P,this._nextDt=F>1?1:F;L>=1&&this._total<N&&(D.update(1),this._total++),this._actionInstant||(this._total===N?D.stop():D.update(L-(F-D._duration/P)))}else D.update(L*N%1)},isDone:function(){return this._total===this._times},reverse:function(){var L=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(L),this._reverseEaseList(L),L},setInnerAction:function(L){this._innerAction!==L&&(this._innerAction=L)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(L,D){return new cc.Repeat(L,D)},cc.RepeatForever=cc.Class({name:"cc.RepeatForever",extends:cc.ActionInterval,ctor:function(L){this._innerAction=null,L&&this.initWithAction(L)},initWithAction:function(L){return L?(this._innerAction=L,!0):(cc.errorID(1026),!1)},clone:function(){var L=new cc.RepeatForever;return this._cloneDecoration(L),L.initWithAction(this._innerAction.clone()),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._innerAction.startWithTarget(L)},step:function(L){var D=this._innerAction;D.step(L),D.isDone()&&(D.startWithTarget(this.target),D.step(D.getElapsed()-D._duration))},isDone:function(){return!1},reverse:function(){var L=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(L),this._reverseEaseList(L),L},setInnerAction:function(L){this._innerAction!==L&&(this._innerAction=L)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(L){return new cc.RepeatForever(L)},cc.Spawn=cc.Class({name:"cc.Spawn",extends:cc.ActionInterval,ctor:function(L){this._one=null,this._two=null;var D=L instanceof Array?L:arguments;if(1!==D.length){var P=D.length-1;if(P>=0&&null==D[P]&&cc.logID(1015),P>=0){for(var N,F=D[0],B=1;B<P;B++)D[B]&&(N=F,F=cc.Spawn._actionOneTwo(N,D[B]));this.initWithTwoActions(F,D[P])}}else cc.errorID(1020)},initWithTwoActions:function(L,D){if(!L||!D)return cc.errorID(1027),!1;var P=!1,N=L._duration,F=D._duration;return this.initWithDuration(Math.max(N,F))&&(this._one=L,this._two=D,N>F?this._two=cc.Sequence._actionOneTwo(D,cc.delayTime(N-F)):N<F&&(this._one=cc.Sequence._actionOneTwo(L,cc.delayTime(F-N))),P=!0),P},clone:function(){var L=new cc.Spawn;return this._cloneDecoration(L),L.initWithTwoActions(this._one.clone(),this._two.clone()),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._one.startWithTarget(L),this._two.startWithTarget(L)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(L){L=this._computeEaseTime(L),this._one&&this._one.update(L),this._two&&this._two.update(L)},reverse:function(){var L=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.spawn=function(L){var D=L instanceof Array?L:arguments;if(1===D.length)return cc.errorID(1020),null;D.length>0&&null==D[D.length-1]&&cc.logID(1015);for(var P=D[0],N=1;N<D.length;N++)null!=D[N]&&(P=cc.Spawn._actionOneTwo(P,D[N]));return P},cc.Spawn._actionOneTwo=function(L,D){var P=new cc.Spawn;return P.initWithTwoActions(L,D),P},cc.RotateTo=cc.Class({name:"cc.RotateTo",extends:cc.ActionInterval,ctor:function(L,D){this._startAngle=0,this._dstAngle=0,this._angle=0,void 0!==D&&this.initWithDuration(L,D)},initWithDuration:function(L,D){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._dstAngle=D,!0)},clone:function(){var L=new cc.RotateTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._dstAngle),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L);var D=L.angle%360,P=cc.macro.ROTATE_ACTION_CCW?this._dstAngle-D:this._dstAngle+D;P>180&&(P-=360),P<-180&&(P+=360),this._startAngle=D,this._angle=cc.macro.ROTATE_ACTION_CCW?P:-P},reverse:function(){cc.logID(1016)},update:function(L){L=this._computeEaseTime(L),this.target&&(this.target.angle=this._startAngle+this._angle*L)}}),cc.rotateTo=function(L,D){return new cc.RotateTo(L,D)},cc.RotateBy=cc.Class({name:"cc.RotateBy",extends:cc.ActionInterval,ctor:function(L,D){D*=cc.macro.ROTATE_ACTION_CCW?1:-1,this._deltaAngle=0,this._startAngle=0,void 0!==D&&this.initWithDuration(L,D)},initWithDuration:function(L,D){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._deltaAngle=D,!0)},clone:function(){var L=new cc.RotateBy;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._deltaAngle),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._startAngle=L.angle,this._deltaAngle*=-1},update:function(L){L=this._computeEaseTime(L),this.target&&(this.target.angle=this._startAngle+this._deltaAngle*L)},reverse:function(){var L=new cc.RotateBy;return L.initWithDuration(this._duration,-this._deltaAngle),this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.rotateBy=function(L,D){return new cc.RotateBy(L,D)},cc.MoveBy=cc.Class({name:"cc.MoveBy",extends:cc.ActionInterval,ctor:function(L,D,P){this._positionDelta=cc.v2(0,0),this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),void 0!==D&&cc.MoveBy.prototype.initWithDuration.call(this,L,D,P)},initWithDuration:function(L,D,P){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(void 0!==D.x&&(P=D.y,D=D.x),this._positionDelta.x=D,this._positionDelta.y=P,!0)},clone:function(){var L=new cc.MoveBy;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._positionDelta),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L);var D=L.x,P=L.y;this._previousPosition.x=D,this._previousPosition.y=P,this._startPosition.x=D,this._startPosition.y=P},update:function(L){if(L=this._computeEaseTime(L),this.target){var D=this._positionDelta.x*L,P=this._positionDelta.y*L,N=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var F=this.target.x,B=this.target.y,k=this._previousPosition;N.x=N.x+F-k.x,N.y=N.y+B-k.y,D+=N.x,P+=N.y,k.x=D,k.y=P,this.target.setPosition(D,P)}else this.target.setPosition(N.x+D,N.y+P)}},reverse:function(){var L=new cc.MoveBy(this._duration,cc.v2(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.moveBy=function(L,D,P){return new cc.MoveBy(L,D,P)},cc.MoveTo=cc.Class({name:"cc.MoveTo",extends:cc.MoveBy,ctor:function(L,D,P){this._endPosition=cc.v2(0,0),void 0!==D&&this.initWithDuration(L,D,P)},initWithDuration:function(L,D,P){return!!cc.MoveBy.prototype.initWithDuration.call(this,L,D,P)&&(void 0!==D.x&&(P=D.y,D=D.x),this._endPosition.x=D,this._endPosition.y=P,!0)},clone:function(){var L=new cc.MoveTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._endPosition),L},startWithTarget:function(L){cc.MoveBy.prototype.startWithTarget.call(this,L),this._positionDelta.x=this._endPosition.x-L.x,this._positionDelta.y=this._endPosition.y-L.y}}),cc.moveTo=function(L,D,P){return new cc.MoveTo(L,D,P)},cc.SkewTo=cc.Class({name:"cc.SkewTo",extends:cc.ActionInterval,ctor:function(L,D,P){this._skewX=0,this._skewY=0,this._startSkewX=0,this._startSkewY=0,this._endSkewX=0,this._endSkewY=0,this._deltaX=0,this._deltaY=0,void 0!==P&&cc.SkewTo.prototype.initWithDuration.call(this,L,D,P)},initWithDuration:function(L,D,P){var N=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._endSkewX=D,this._endSkewY=P,N=!0),N},clone:function(){var L=new cc.SkewTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._endSkewX,this._endSkewY),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._startSkewX=L.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=L.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(L){L=this._computeEaseTime(L),this.target.skewX=this._startSkewX+this._deltaX*L,this.target.skewY=this._startSkewY+this._deltaY*L}}),cc.skewTo=function(L,D,P){return new cc.SkewTo(L,D,P)},cc.SkewBy=cc.Class({name:"cc.SkewBy",extends:cc.SkewTo,ctor:function(L,D,P){void 0!==P&&this.initWithDuration(L,D,P)},initWithDuration:function(L,D,P){var N=!1;return cc.SkewTo.prototype.initWithDuration.call(this,L,D,P)&&(this._skewX=D,this._skewY=P,N=!0),N},clone:function(){var L=new cc.SkewBy;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._skewX,this._skewY),L},startWithTarget:function(L){cc.SkewTo.prototype.startWithTarget.call(this,L),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var L=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.skewBy=function(L,D,P){return new cc.SkewBy(L,D,P)},cc.JumpBy=cc.Class({name:"cc.JumpBy",extends:cc.ActionInterval,ctor:function(L,D,P,N,F){this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),this._delta=cc.v2(0,0),this._height=0,this._jumps=0,void 0!==N&&cc.JumpBy.prototype.initWithDuration.call(this,L,D,P,N,F)},initWithDuration:function(L,D,P,N,F){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(void 0===F&&(F=N,N=P,P=D.y,D=D.x),this._delta.x=D,this._delta.y=P,this._height=N,this._jumps=F,!0)},clone:function(){var L=new cc.JumpBy;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._delta,this._height,this._jumps),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L);var D=L.x,P=L.y;this._previousPosition.x=D,this._previousPosition.y=P,this._startPosition.x=D,this._startPosition.y=P},update:function(L){if(L=this._computeEaseTime(L),this.target){var D=L*this._jumps%1,P=4*this._height*D*(1-D);P+=this._delta.y*L;var N=this._delta.x*L,F=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var B=this.target.x,k=this.target.y,U=this._previousPosition;F.x=F.x+B-U.x,F.y=F.y+k-U.y,N+=F.x,P+=F.y,U.x=N,U.y=P,this.target.setPosition(N,P)}else this.target.setPosition(F.x+N,F.y+P)}},reverse:function(){var L=new cc.JumpBy(this._duration,cc.v2(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.jumpBy=function(L,D,P,N,F){return new cc.JumpBy(L,D,P,N,F)},cc.JumpTo=cc.Class({name:"cc.JumpTo",extends:cc.JumpBy,ctor:function(L,D,P,N,F){this._endPosition=cc.v2(0,0),void 0!==N&&this.initWithDuration(L,D,P,N,F)},initWithDuration:function(L,D,P,N,F){return!!cc.JumpBy.prototype.initWithDuration.call(this,L,D,P,N,F)&&(void 0===F&&(P=D.y,D=D.x),this._endPosition.x=D,this._endPosition.y=P,!0)},startWithTarget:function(L){cc.JumpBy.prototype.startWithTarget.call(this,L),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var L=new cc.JumpTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),L}}),cc.jumpTo=function(L,D,P,N,F){return new cc.JumpTo(L,D,P,N,F)},cc.BezierBy=cc.Class({name:"cc.BezierBy",extends:cc.ActionInterval,ctor:function(L,D){this._config=[],this._startPosition=cc.v2(0,0),this._previousPosition=cc.v2(0,0),D&&cc.BezierBy.prototype.initWithDuration.call(this,L,D)},initWithDuration:function(L,D){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._config=D,!0)},clone:function(){var L=new cc.BezierBy;this._cloneDecoration(L);for(var D=[],P=0;P<this._config.length;P++){var N=this._config[P];D.push(cc.v2(N.x,N.y))}return L.initWithDuration(this._duration,D),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L);var D=L.x,P=L.y;this._previousPosition.x=D,this._previousPosition.y=P,this._startPosition.x=D,this._startPosition.y=P},update:function(L){if(L=this._computeEaseTime(L),this.target){var D=this._config,P=D[0].x,N=D[1].x,F=D[2].x,B=D[0].y,k=D[1].y,U=D[2].y,V=n(0,P,N,F,L),z=n(0,B,k,U,L),W=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var H=this.target.x,G=this.target.y,X=this._previousPosition;W.x=W.x+H-X.x,W.y=W.y+G-X.y,V+=W.x,z+=W.y,X.x=V,X.y=z,this.target.setPosition(V,z)}else this.target.setPosition(W.x+V,W.y+z)}},reverse:function(){var L=this._config,D=L[0].x,P=L[0].y,N=L[1].x,F=L[1].y,B=L[2].x,k=L[2].y,U=[cc.v2(N-B,F-k),cc.v2(D-B,P-k),cc.v2(-B,-k)],V=new cc.BezierBy(this._duration,U);return this._cloneDecoration(V),this._reverseEaseList(V),V}}),cc.bezierBy=function(L,D){return new cc.BezierBy(L,D)},cc.BezierTo=cc.Class({name:"cc.BezierTo",extends:cc.BezierBy,ctor:function(L,D){this._toConfig=[],D&&this.initWithDuration(L,D)},initWithDuration:function(L,D){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._toConfig=D,!0)},clone:function(){var L=new cc.BezierTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._toConfig),L},startWithTarget:function(L){cc.BezierBy.prototype.startWithTarget.call(this,L);var D=this._startPosition,P=this._toConfig,N=this._config;N[0]=P[0].sub(D),N[1]=P[1].sub(D),N[2]=P[2].sub(D)}}),cc.bezierTo=function(L,D){return new cc.BezierTo(L,D)},cc.ScaleTo=cc.Class({name:"cc.ScaleTo",extends:cc.ActionInterval,ctor:function(L,D,P){this._scaleX=1,this._scaleY=1,this._startScaleX=1,this._startScaleY=1,this._endScaleX=0,this._endScaleY=0,this._deltaX=0,this._deltaY=0,void 0!==D&&cc.ScaleTo.prototype.initWithDuration.call(this,L,D,P)},initWithDuration:function(L,D,P){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._endScaleX=D,this._endScaleY=null!=P?P:D,!0)},clone:function(){var L=new cc.ScaleTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._endScaleX,this._endScaleY),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._startScaleX=L.scaleX,this._startScaleY=L.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(L){L=this._computeEaseTime(L),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*L,this.target.scaleY=this._startScaleY+this._deltaY*L)}}),cc.scaleTo=function(L,D,P){return new cc.ScaleTo(L,D,P)},cc.ScaleBy=cc.Class({name:"cc.ScaleBy",extends:cc.ScaleTo,startWithTarget:function(L){cc.ScaleTo.prototype.startWithTarget.call(this,L),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var L=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(L),this._reverseEaseList(L),L},clone:function(){var L=new cc.ScaleBy;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._endScaleX,this._endScaleY),L}}),cc.scaleBy=function(L,D,P){return new cc.ScaleBy(L,D,P)},cc.Blink=cc.Class({name:"cc.Blink",extends:cc.ActionInterval,ctor:function(L,D){this._times=0,this._originalState=!1,void 0!==D&&this.initWithDuration(L,D)},initWithDuration:function(L,D){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._times=D,!0)},clone:function(){var L=new cc.Blink;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._times),L},update:function(L){if(L=this._computeEaseTime(L),this.target&&!this.isDone()){var D=1/this._times,P=L%D;this.target.opacity=P>D/2?255:0}},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._originalState=L.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var L=new cc.Blink(this._duration,this._times);return this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.blink=function(L,D){return new cc.Blink(L,D)},cc.FadeTo=cc.Class({name:"cc.FadeTo",extends:cc.ActionInterval,ctor:function(L,D){this._toOpacity=0,this._fromOpacity=0,void 0!==D&&cc.FadeTo.prototype.initWithDuration.call(this,L,D)},initWithDuration:function(L,D){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._toOpacity=D,!0)},clone:function(){var L=new cc.FadeTo;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._toOpacity),L},update:function(L){L=this._computeEaseTime(L);var D=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=D+(this._toOpacity-D)*L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._fromOpacity=L.opacity}}),cc.fadeTo=function(L,D){return new cc.FadeTo(L,D)},cc.FadeIn=cc.Class({name:"cc.FadeIn",extends:cc.FadeTo,ctor:function(L){null==L&&(L=0),this._reverseAction=null,this.initWithDuration(L,255)},reverse:function(){var L=new cc.FadeOut;return L.initWithDuration(this._duration,0),this._cloneDecoration(L),this._reverseEaseList(L),L},clone:function(){var L=new cc.FadeIn;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._toOpacity),L},startWithTarget:function(L){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,L)}}),cc.fadeIn=function(L){return new cc.FadeIn(L)},cc.FadeOut=cc.Class({name:"cc.FadeOut",extends:cc.FadeTo,ctor:function(L){null==L&&(L=0),this._reverseAction=null,this.initWithDuration(L,0)},reverse:function(){var L=new cc.FadeIn;return L._reverseAction=this,L.initWithDuration(this._duration,255),this._cloneDecoration(L),this._reverseEaseList(L),L},clone:function(){var L=new cc.FadeOut;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._toOpacity),L}}),cc.fadeOut=function(L){return new cc.FadeOut(L)},cc.TintTo=cc.Class({name:"cc.TintTo",extends:cc.ActionInterval,ctor:function(L,D,P,N){this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),D instanceof cc.Color&&(N=D.b,P=D.g,D=D.r),void 0!==N&&this.initWithDuration(L,D,P,N)},initWithDuration:function(L,D,P,N){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._to=cc.color(D,P,N),!0)},clone:function(){var L=new cc.TintTo;this._cloneDecoration(L);var D=this._to;return L.initWithDuration(this._duration,D.r,D.g,D.b),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._from=this.target.color},update:function(L){L=this._computeEaseTime(L);var D=this._from,P=this._to;D&&(this.target.color=cc.color(D.r+(P.r-D.r)*L,D.g+(P.g-D.g)*L,D.b+(P.b-D.b)*L))}}),cc.tintTo=function(L,D,P,N){return new cc.TintTo(L,D,P,N)},cc.TintBy=cc.Class({name:"cc.TintBy",extends:cc.ActionInterval,ctor:function(L,D,P,N){this._deltaR=0,this._deltaG=0,this._deltaB=0,this._fromR=0,this._fromG=0,this._fromB=0,void 0!==N&&this.initWithDuration(L,D,P,N)},initWithDuration:function(L,D,P,N){return!!cc.ActionInterval.prototype.initWithDuration.call(this,L)&&(this._deltaR=D,this._deltaG=P,this._deltaB=N,!0)},clone:function(){var L=new cc.TintBy;return this._cloneDecoration(L),L.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L);var D=L.color;this._fromR=D.r,this._fromG=D.g,this._fromB=D.b},update:function(L){L=this._computeEaseTime(L),this.target.color=cc.color(this._fromR+this._deltaR*L,this._fromG+this._deltaG*L,this._fromB+this._deltaB*L)},reverse:function(){var L=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(L),this._reverseEaseList(L),L}}),cc.tintBy=function(L,D,P,N){return new cc.TintBy(L,D,P,N)},cc.DelayTime=cc.Class({name:"cc.DelayTime",extends:cc.ActionInterval,update:function(L){},reverse:function(){var L=new cc.DelayTime(this._duration);return this._cloneDecoration(L),this._reverseEaseList(L),L},clone:function(){var L=new cc.DelayTime;return this._cloneDecoration(L),L.initWithDuration(this._duration),L}}),cc.delayTime=function(L){return new cc.DelayTime(L)},cc.ReverseTime=cc.Class({name:"cc.ReverseTime",extends:cc.ActionInterval,ctor:function(L){this._other=null,L&&this.initWithAction(L)},initWithAction:function(L){return L?L===this._other?(cc.errorID(1029),!1):!!cc.ActionInterval.prototype.initWithDuration.call(this,L._duration)&&(this._other=L,!0):(cc.errorID(1028),!1)},clone:function(){var L=new cc.ReverseTime;return this._cloneDecoration(L),L.initWithAction(this._other.clone()),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._other.startWithTarget(L)},update:function(L){L=this._computeEaseTime(L),this._other&&this._other.update(1-L)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(L){return new cc.ReverseTime(L)},cc.TargetedAction=cc.Class({name:"cc.TargetedAction",extends:cc.ActionInterval,ctor:function(L,D){this._action=null,this._forcedTarget=null,D&&this.initWithTarget(L,D)},initWithTarget:function(L,D){return!!this.initWithDuration(D._duration)&&(this._forcedTarget=L,this._action=D,!0)},clone:function(){var L=new cc.TargetedAction;return this._cloneDecoration(L),L.initWithTarget(this._forcedTarget,this._action.clone()),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(L){L=this._computeEaseTime(L),this._action.update(L)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(L){this._forcedTarget!==L&&(this._forcedTarget=L)}}),cc.targetedAction=function(L,D){return new cc.TargetedAction(L,D)}},{}],6:[function(L,D,P){"use strict";L("../core/platform/CCClass");var N=L("../core/platform/js"),r=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1};cc.ActionManager=function(){this._hashTargets=N.createMap(!0),this._arrayTargets=[],this._currentTarget=null,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},cc.ActionManager.prototype={constructor:cc.ActionManager,_elementPool:[],_searchElementByTarget:function(L,D){for(var P=0;P<L.length;P++)if(D===L[P].target)return L[P];return null},_getElement:function(L,D){var P=this._elementPool.pop();return P||(P=new r),P.target=L,P.paused=!!D,P},_putElement:function(L){L.actions.length=0,L.actionIndex=0,L.currentAction=null,L.paused=!1,L.target=null,L.lock=!1,this._elementPool.push(L)},addAction:function(L,D,P){if(L&&D){var N=this._hashTargets[D._id];N?N.actions||(N.actions=[]):(N=this._getElement(D,P),this._hashTargets[D._id]=N,this._arrayTargets.push(N)),N.actions.push(L),L.startWithTarget(D)}else cc.errorID(1e3)},removeAllActions:function(){for(var L=this._arrayTargets,D=0;D<L.length;D++){var P=L[D];P&&this._putElement(P)}this._arrayTargets.length=0,this._hashTargets=N.createMap(!0)},removeAllActionsFromTarget:function(L,D){if(null!=L){var P=this._hashTargets[L._id];P&&(P.actions.length=0,this._deleteHashElement(P))}},removeAction:function(L){if(null!=L){var D=L.getOriginalTarget(),P=this._hashTargets[D._id];if(P){for(var N=0;N<P.actions.length;N++)if(P.actions[N]===L){P.actions.splice(N,1),P.actionIndex>=N&&P.actionIndex--;break}}else cc.logID(1001)}},removeActionByTag:function(L,D){L===cc.Action.TAG_INVALID&&cc.logID(1002),cc.assertID(D,1003);var P=this._hashTargets[D._id];if(P)for(var N=P.actions.length,F=0;F<N;++F){var B=P.actions[F];if(B&&B.getTag()===L&&B.getOriginalTarget()===D){this._removeActionAtIndex(F,P);break}}},getActionByTag:function(L,D){L===cc.Action.TAG_INVALID&&cc.logID(1004);var P=this._hashTargets[D._id];if(P){if(null!=P.actions)for(var N=0;N<P.actions.length;++N){var F=P.actions[N];if(F&&F.getTag()===L)return F}cc.logID(1005,L)}return null},getNumberOfRunningActionsInTarget:function(L){var D=this._hashTargets[L._id];return D&&D.actions?D.actions.length:0},pauseTarget:function(L){var D=this._hashTargets[L._id];D&&(D.paused=!0)},resumeTarget:function(L){var D=this._hashTargets[L._id];D&&(D.paused=!1)},pauseAllRunningActions:function(){for(var L=[],D=this._arrayTargets,P=0;P<D.length;P++){var N=D[P];N&&!N.paused&&(N.paused=!0,L.push(N.target))}return L},resumeTargets:function(L){if(L)for(var D=0;D<L.length;D++)L[D]&&this.resumeTarget(L[D])},pauseTargets:function(L){if(L)for(var D=0;D<L.length;D++)L[D]&&this.pauseTarget(L[D])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(L,D){D.actions[L],D.actions.splice(L,1),D.actionIndex>=L&&D.actionIndex--,0===D.actions.length&&this._deleteHashElement(D)},_deleteHashElement:function(L){var D=!1;if(L&&!L.lock&&this._hashTargets[L.target._id]){delete this._hashTargets[L.target._id];for(var P=this._arrayTargets,N=0,F=P.length;N<F;N++)if(P[N]===L){P.splice(N,1);break}this._putElement(L),D=!0}return D},update:function(L){for(var D,P=this._arrayTargets,N=0;N<P.length;N++){if(this._currentTarget=P[N],!(D=this._currentTarget).paused&&D.actions){for(D.lock=!0,D.actionIndex=0;D.actionIndex<D.actions.length;D.actionIndex++)if(D.currentAction=D.actions[D.actionIndex],D.currentAction){if(D.currentAction.step(L*(D.currentAction._speedMethod?D.currentAction._speed:1)),D.currentAction&&D.currentAction.isDone()){D.currentAction.stop();var F=D.currentAction;D.currentAction=null,this.removeAction(F)}D.currentAction=null}D.lock=!1}0===D.actions.length&&this._deleteHashElement(D)&&N--}}}},{"../core/platform/CCClass":137,"../core/platform/js":157}],7:[function(L,D,P){"use strict";L("./CCActionManager"),L("./CCAction"),L("./CCActionInterval"),L("./CCActionInstant"),L("./CCActionEase"),L("./CCActionCatmullRom"),L("./tween")},{"./CCAction":1,"./CCActionCatmullRom":2,"./CCActionEase":3,"./CCActionInstant":4,"./CCActionInterval":5,"./CCActionManager":6,"./tween":8}],8:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.TweenAction",extends:cc.ActionInterval,ctor:function(L,D,P){if(this._opts=P=P||Object.create(null),this._props=Object.create(null),P.progress=P.progress||this.progress,P.easing&&"string"==typeof P.easing){var N=P.easing;P.easing=cc.easing[N],!P.easing&&cc.warnID(1031,N)}var F=this._opts.relative;for(var B in D){var k=D[B],U=void 0,V=void 0;if(void 0!==k.value&&(k.easing||k.progress)&&("string"==typeof k.easing?!(U=cc.easing[k.easing])&&cc.warnID(1031,k.easing):U=k.easing,V=k.progress,k=k.value),"number"==typeof k||k.lerp&&(!F||k.add||k.mul)&&k.clone){var z=Object.create(null);z.value=k,z.easing=U,z.progress=V,this._props[B]=z}else cc.warn("Can not animate "+B+" property, because it do not have [lerp, (add|mul), clone] function.")}this._originProps=D,this.initWithDuration(L)},clone:function(){var L=new N(this._duration,this._originProps,this._opts);return this._cloneDecoration(L),L},startWithTarget:function(L){cc.ActionInterval.prototype.startWithTarget.call(this,L);var D=!!this._opts.relative,P=this._props;for(var N in P){var F=L[N],B=P[N];"number"==typeof F?(B.start=F,B.current=F,B.end=D?F+B.value:B.value):(B.start=F.clone(),B.current=F.clone(),B.end=D?(F.add||F.mul).call(F,B.value):B.value)}},update:function(L){var D=this._opts,P=L;D.easing&&(P=D.easing(L));var N=this.target;if(N){var F=this._props,B=this._opts.progress;for(var k in F){var U=F[k],V=U.easing?U.easing(L):P,z=U.current=(U.progress||B)(U.start,U.end,U.current,V);N[k]=z}}},progress:function(L,D,P,N){return"number"==typeof L?P=L+(D-L)*N:L.lerp(D,N,P),P}}),F=cc.Class({name:"cc.SetAction",extends:cc.ActionInstant,ctor:function(L){this._props={},void 0!==L&&this.init(L)},init:function(L){for(var D in L)this._props[D]=L[D];return!0},update:function(){var L=this._props,D=this.target;for(var P in L)D[P]=L[P]},clone:function(){var L=new F;return L.init(this._props),L}});function s(L){this._actions=[],this._finalAction=null,this._target=L}s.prototype.then=function(L){return L instanceof cc.Action?this._actions.push(L.clone()):this._actions.push(L._union()),this},s.prototype.target=function(L){return this._target=L,this},s.prototype.start=function(){return this._target?(this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this._finalAction=this._union(),cc.director.getActionManager().addAction(this._finalAction,this._target,!1),this):(cc.warn("Please set target to tween first"),this)},s.prototype.stop=function(){return this._finalAction&&cc.director.getActionManager().removeAction(this._finalAction),this},s.prototype.clone=function(L){var D=this._union();return cc.tween(L).then(D.clone())},s.prototype.union=function(){var L=this._union();return this._actions.length=0,this._actions.push(L),this},s.prototype._union=function(){var L=this._actions;return 1===L.length?L[0]:cc.sequence(L)};var B=[];function o(L){return function(){B.length=0;for(var D=arguments.length,P=0;P<D;P++){var N=B[P]=arguments[P];N instanceof s&&(B[P]=N._union())}return L.apply(this,B)}}for(var k={to:function(L,D,P){return(P=P||Object.create(null)).relative=!1,new N(L,D,P)},by:function(L,D,P){return(P=P||Object.create(null)).relative=!0,new N(L,D,P)},set:function(L){return new F(L)},delay:cc.delayTime,call:cc.callFunc,hide:cc.hide,show:cc.show,removeSelf:cc.removeSelf,sequence:o(cc.sequence),parallel:o(cc.spawn)},U={repeat:cc.repeat,repeatForever:function(L){return cc.repeat(L,1e9)},reverseTime:cc.reverseTime},V=Object.keys(k),u=function(L){var D=V[L];s.prototype[D]=function(){var L=k[D].apply(k,arguments);return this._actions.push(L),this}},z=0;z<V.length;z++)u(z);V=Object.keys(U);for(var f=function(L){var D=V[L];s.prototype[D]=function(){var L=this._actions,P=arguments[arguments.length-1],N=arguments.length-1;P instanceof cc.Tween?P=P._union():P instanceof cc.Action||(P=L[L.length-1],L.length-=1,N+=1);for(var F=[P],B=0;B<N;B++)F.push(arguments[B]);return P=U[D].apply(this,F),L.push(P),this}},W=0;W<V.length;W++)f(W);cc.tween=function(L){return new s(L)},cc.Tween=s},{}],9:[function(L,D,P){"use strict";var N=cc.js,F=L("./playable"),B=L("./animation-curves"),k=B.EventAnimCurve,U=B.EventInfo,V=L("./types").WrapModeMask,z=L("../core/utils/binary-search").binarySearchEpsilon;function h(L,D){F.call(this),this.target=L,this.animation=D,this._anims=new N.array.MutableForwardIterator([])}N.extend(h,F);var W=h.prototype;function d(L,D){var P=D.clip;D.duration=P.duration,D.speed=P.speed,D.wrapMode=P.wrapMode,D.frameRate=P.sample,(D.wrapMode&V.Loop)===V.Loop?D.repeatCount=1/0:D.repeatCount=1;var N=D.curves=P.createCurves(D,L),F=P.events;if(F)for(var B,W=0,H=F.length;W<H;W++){B||((B=new k).target=L,N.push(B));var G=F[W],X=G.frame/D.duration,nt=void 0,ut=z(B.ratios,X);ut>=0?nt=B.events[ut]:(nt=new U,B.ratios.push(X),B.events.push(nt)),nt.add(G.func,G.params)}}W.playState=function(L,D){L.clip&&(L.curveLoaded||d(this.target,L),L.animator=this,L.play(),"number"==typeof D&&L.setTime(D),this.play())},W.stopStatesExcept=function(L){var D=this._anims,P=D.array;for(D.i=0;D.i<P.length;++D.i){var N=P[D.i];N!==L&&this.stopState(N)}},W.addAnimation=function(L){-1===this._anims.array.indexOf(L)&&this._anims.push(L),L._setEventTarget(this.animation)},W.removeAnimation=function(L){var D=this._anims.array.indexOf(L);D>=0?(this._anims.fastRemoveAt(D),0===this._anims.array.length&&this.stop()):cc.errorID(3908),L.animator=null},W.sample=function(){var L=this._anims,D=L.array;for(L.i=0;L.i<D.length;++L.i)D[L.i].sample()},W.stopState=function(L){L&&L.stop()},W.pauseState=function(L){L&&L.pause()},W.resumeState=function(L){L&&L.resume(),this.isPaused&&this.resume()},W.setStateTime=function(L,D){if(void 0!==D)L&&(L.setTime(D),L.sample());else{D=L;for(var P=this._anims.array,N=0;N<P.length;++N){var F=P[N];F.setTime(D),F.sample()}}},W.onStop=function(){var L=this._anims,D=L.array;for(L.i=0;L.i<D.length;++L.i)D[L.i].stop()},W.onPause=function(){for(var L=this._anims.array,D=0;D<L.length;++D){var P=L[D];P.pause(),P.animator=null}},W.onResume=function(){for(var L=this._anims.array,D=0;D<L.length;++D){var P=L[D];P.animator=this,P.resume()}},W._reloadClip=function(L){d(this.target,L)},D.exports=h},{"../core/utils/binary-search":204,"./animation-curves":11,"./playable":18,"./types":19}],10:[function(L,D,P){"use strict";var N=L("./types").WrapMode,F=L("./animation-curves"),B=F.DynamicAnimCurve,k=F.quickFindIndex,U=L("./motion-path-helper").sampleMotionPaths,V=L("../core/utils/binary-search").binarySearchEpsilon,z=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:cc.Float},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:N.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(L,D){if(!Array.isArray(L))return cc.errorID(3905),null;var P=new z;P.sample=D||P.sample,P._duration=L.length/P.sample;for(var N=[],F=1/P.sample,B=0,k=L.length;B<k;B++)N[B]={frame:B*F,value:L[B]};return P.curveData={comps:{"cc.Sprite":{spriteFrame:N}}},P}},onLoad:function(){this._duration=Number.parseFloat(this.duration),this.speed=Number.parseFloat(this.speed),this.wrapMode=Number.parseInt(this.wrapMode),this.frameRate=Number.parseFloat(this.sample)},createPropCurve:function(L,D,P){var N=[],F=L instanceof cc.Node&&"position"===D,z=new B;z.target=L,z.prop=D;for(var W=0,H=P.length;W<H;W++){var G=P[W],X=G.frame/this.duration;z.ratios.push(X),F&&N.push(G.motionPath);var nt=G.value;z.values.push(nt);var ut=G.curve;if(ut){if("string"==typeof ut){z.types.push(ut);continue}if(Array.isArray(ut)){ut[0]===ut[1]&&ut[2]===ut[3]?z.types.push(B.Linear):z.types.push(B.Bezier(ut));continue}}z.types.push(B.Linear)}F&&U(N,z,this.duration,this.sample,L);for(var dt,ft,_t=z.ratios,pt=!0,vt=1,gt=_t.length;vt<gt;vt++)if(dt=_t[vt]-_t[vt-1],1===vt)ft=dt;else if(Math.abs(dt-ft)>1e-6){pt=!1;break}z._findFrameIndex=pt?k:V;var mt=z.values[0];return null==mt||z._lerp||("number"==typeof mt?z._lerp=B.prototype._lerpNumber:mt instanceof cc.Quat?z._lerp=B.prototype._lerpQuat:mt instanceof cc.Vec2||mt instanceof cc.Vec3?z._lerp=B.prototype._lerpVector:mt.lerp&&(z._lerp=B.prototype._lerpObject)),z},createTargetCurves:function(L,D,P){var N=D.props,F=D.comps;if(N)for(var B in N){var k=N[B],U=this.createPropCurve(L,B,k);P.push(U)}if(F)for(var V in F){var z=L.getComponent(V);if(z){var W=F[V];for(var H in W){var G=W[H],X=this.createPropCurve(z,H,G);P.push(X)}}}},createCurves:function(L,D){var P=this.curveData,N=P.paths,F=[];for(var B in this.createTargetCurves(D,P,F),N){var k=cc.find(B,D);if(k){var U=N[B];this.createTargetCurves(k,U,F)}}return F}});cc.AnimationClip=D.exports=z},{"../core/utils/binary-search":204,"./animation-curves":11,"./motion-path-helper":17,"./types":19}],11:[function(L,D,P){"use strict";var N=L("./bezier").bezierByTime,F=L("../core/utils/binary-search").binarySearchEpsilon,B=L("./types").WrapModeMask,k=L("./types").WrappedInfo;function o(L,D){if("string"==typeof D){var P=cc.easing[D];P?L=P(L):cc.errorID(3906,D)}else Array.isArray(D)&&(L=N(D,L));return L}var U=cc.Class({name:"cc.AnimCurve",sample:function(L,D,P){},onTimeChangedManually:void 0});var V=cc.Class({name:"cc.DynamicAnimCurve",extends:U,ctor:function(){this._cachedIndex=0},properties:{target:null,prop:"",values:[],ratios:[],types:[]},_findFrameIndex:F,_lerp:void 0,_lerpNumber:function(L,D,P){return L+(D-L)*P},_lerpObject:function(L,D,P){return L.lerp(D,P)},_lerpQuat:function(){var L=cc.quat();return function(D,P,N){return D.lerp(P,N,L)}}(),_lerpVector:function(){var L=cc.v3();return function(D,P,N){return D.lerp(P,N,L)}}(),sample:function(L,D,P){var N=this.values,F=this.ratios,B=F.length;if(0!==B){var k,U=!0,V=this._cachedIndex;if(V<0&&(V=~V)>0&&V<F.length){var z=F[V-1],W=F[V];D>z&&D<W&&(U=!1)}U&&(this._cachedIndex=this._findFrameIndex(F,D));var H=this._cachedIndex;if(H<0)if((H=~H)<=0)k=N[0];else if(H>=B)k=N[B-1];else{var G=N[H-1];if(this._lerp){var X=F[H-1],nt=F[H],ut=this.types[H-1],dt=(D-X)/(nt-X);ut&&(dt=o(dt,ut));var ft=N[H];k=this._lerp(G,ft,dt)}else k=G}else k=N[H];this.target[this.prop]=k}}});V.Linear=null,V.Bezier=function(L){return L};var u=function(){this.events=[]};u.prototype.add=function(L,D){this.events.push({func:L||"",params:D||[]})};var z=cc.Class({name:"cc.EventAnimCurve",extends:U,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new k}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(L){return L-(0|L)==0&&(L-=1),0|L},sample:function(L,D,P){var N=this.ratios.length,U=P.getWrappedInfo(P.time,this._wrappedInfo),V=U.direction,z=F(this.ratios,U.ratio);if(z<0&&(z=~z-1,V<0&&(z+=1)),this._ignoreIndex!==z&&(this._ignoreIndex=NaN),U.frameIndex=z,!this._lastWrappedInfo)return this._fireEvent(z),void(this._lastWrappedInfo=new k(U));var W=P.wrapMode,H=this._wrapIterations(U.iterations),G=this._lastWrappedInfo,X=this._wrapIterations(G.iterations),nt=G.frameIndex,ut=G.direction,dt=-1!==X&&H!==X;if(nt===z&&dt&&1===N)this._fireEvent(0);else if(nt!==z||dt){V=ut;do{if(nt!==z){if(-1===V&&0===nt&&z>0?((W&B.PingPong)===B.PingPong?V*=-1:nt=N,X++):1===V&&nt===N-1&&z<N-1&&((W&B.PingPong)===B.PingPong?V*=-1:nt=-1,X++),nt===z)break;if(X>H)break}nt+=V,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[nt])}while(nt!==z&&nt>-1&&nt<N)}this._lastWrappedInfo.set(U)},_fireEvent:function(L){if(!(L<0||L>=this.events.length||this._ignoreIndex===L)){var D=this.events[L].events;if(this.target.isValid)for(var P=this.target._components,N=0;N<D.length;N++)for(var F=D[N],B=F.func,k=0;k<P.length;k++){var U=P[k],V=U[B];V&&V.apply(U,F.params)}}},onTimeChangedManually:function(L,D){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var P=D.getWrappedInfo(L,this._wrappedInfo),N=P.direction,B=F(this.ratios,P.ratio);B<0&&(B=~B-1,N<0&&(B+=1),this._ignoreIndex=B)}});D.exports={AnimCurve:U,DynamicAnimCurve:V,EventAnimCurve:z,EventInfo:u,computeRatioByType:o,quickFindIndex:function(L,D){var P=L.length-1;if(0===P)return 0;var N=L[0];if(D<N)return 0;var F=L[P];if(D>F)return~L.length;var B=(D=(D-N)/(F-N))/(1/P),k=0|B;return B-k<1e-6?k:k+1-B<1e-6?k+1:~(k+1)}}},{"../core/utils/binary-search":204,"./bezier":14,"./types":19}],12:[function(L,D,P){"use strict";var N=cc.js,F=cc.Class({ctor:function(){this._anims=new N.array.MutableForwardIterator([]),this._delayEvents=[],cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(L){var D=this._anims,P=D.array;for(D.i=0;D.i<P.length;++D.i){var N=P[D.i];N._isPlaying&&!N._isPaused&&N.update(L)}for(var F=this._delayEvents,B=0;B<F.length;B++){var k=F[B];k.target[k.func].apply(k.target,k.args)}F.length=0},destruct:function(){},addAnimation:function(L){-1===this._anims.array.indexOf(L)&&this._anims.push(L)},removeAnimation:function(L){var D=this._anims.array.indexOf(L);D>=0?this._anims.fastRemoveAt(D):cc.errorID(3907)},pushDelayEvent:function(L,D,P){this._delayEvents.push({target:L,func:D,args:P})}});cc.AnimationManager=D.exports=F},{}],13:[function(L,D,P){"use strict";var N=cc.js,F=L("./playable"),B=L("./types"),k=B.WrappedInfo,U=B.WrapMode,V=B.WrapModeMask;function l(L,D){F.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new k,this._lastWrappedInfo=null,this._process=u,this._clip=L,this._name=D||L&&L.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=U.Normal,this.time=0,this._target=null,this._lastframeEventOn=!1,this.emit=function(){for(var L=new Array(arguments.length),D=0,P=L.length;D<P;D++)L[D]=arguments[D];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",L)}}N.extend(l,F);var z=l.prototype;function u(){var L,D=this.sample();this._lastframeEventOn&&(L=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new k(D),this.repeatCount>1&&(0|D.iterations)>(0|L.iterations)&&this.emit("lastframe",this),L.set(D)),D.stopped&&(this.stop(),this.emit("finished",this))}function d(){var L=this.time,D=this.duration;L>D?0==(L%=D)&&(L=D):L<0&&0!=(L%=D)&&(L+=D);for(var P=L/D,N=this.curves,F=0,B=N.length;F<B;F++)N[F].sample(L,P,this);this._lastframeEventOn&&(void 0===this._lastIterations&&(this._lastIterations=P),(this.time>0&&this._lastIterations>P||this.time<0&&this._lastIterations<P)&&this.emit("lastframe",this),this._lastIterations=P)}z._emit=function(L,D){this._target&&this._target.isValid&&this._target.emit(L,L,D)},z.on=function(L,D,P){return this._target&&this._target.isValid?("lastframe"===L&&(this._lastframeEventOn=!0),this._target.on(L,D,P)):null},z.once=function(L,D,P){if(this._target&&this._target.isValid){"lastframe"===L&&(this._lastframeEventOn=!0);var N=this;return this._target.once(L,(function(L){D.call(P,L),N._lastframeEventOn=!1}))}return null},z.off=function(L,D,P){this._target&&this._target.isValid&&("lastframe"===L&&(this._target.hasEventListener(L)||(this._lastframeEventOn=!1)),this._target.off(L,D,P))},z._setEventTarget=function(L){this._target=L},z.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},z.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},z.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},z.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},z.setTime=function(L){this._currentFramePlayed=!1,this.time=L||0;for(var D=this.curves,P=0,N=D.length;P<N;P++){var F=D[P];F.onTimeChangedManually&&F.onTimeChangedManually(L,this)}},z.update=function(L){this._delayTime>0&&(this._delayTime-=L,this._delayTime>0)||(this._currentFramePlayed?this.time+=L*this.speed:this._currentFramePlayed=!0,this._process())},z._needRevers=function(L){var D=this.wrapMode,P=!1;return(D&V.PingPong)===V.PingPong&&(L-(0|L)==0&&L>0&&(L-=1),1&L&&(P=!P)),(D&V.Reverse)===V.Reverse&&(P=!P),P},z.getWrappedInfo=function(L,D){D=D||new k;var P=!1,N=this.duration,F=this.repeatCount,B=L>0?L/N:-L/N;if(B>=F){B=F,P=!0;var U=F-(0|F);0===U&&(U=1),L=U*N*(L>0?1:-1)}if(L>N){var z=L%N;L=0===z?N:z}else L<0&&0!=(L%=N)&&(L+=N);var W=!1,H=this._wrapMode&V.ShouldWrap;H&&(W=this._needRevers(B));var G=W?-1:1;return this.speed<0&&(G*=-1),H&&W&&(L=N-L),D.ratio=L/N,D.time=L,D.direction=G,D.stopped=P,D.iterations=B,D},z.sample=function(){for(var L=this.getWrappedInfo(this.time,this._wrappedInfo),D=this.curves,P=0,N=D.length;P<N;P++)D[P].sample(L.time,L.ratio,this);return L},N.get(z,"clip",(function(){return this._clip})),N.get(z,"name",(function(){return this._name})),N.obsolete(z,"AnimationState.length","duration"),N.getset(z,"curveLoaded",(function(){return this.curves.length>0}),(function(){this.curves.length=0})),N.getset(z,"wrapMode",(function(){return this._wrapMode}),(function(L){this._wrapMode=L,this.time=0,L&V.Loop?this.repeatCount=1/0:this.repeatCount=1})),N.getset(z,"repeatCount",(function(){return this._repeatCount}),(function(L){this._repeatCount=L;var D=this._wrapMode&V.ShouldWrap,P=(this.wrapMode&V.Reverse)===V.Reverse;this._process=L!==1/0||D||P?u:d})),N.getset(z,"delay",(function(){return this._delay}),(function(L){this._delayTime=this._delay=L})),cc.AnimationState=D.exports=l},{"./playable":18,"./types":19}],14:[function(L,D,P){"use strict";var N=Math.cos,F=Math.acos,B=Math.max,k=2*Math.PI,U=Math.sqrt;function l(L){return L<0?-Math.pow(-L,1/3):Math.pow(L,1/3)}D.exports={bezier:function(L,D,P,N,F){var B=1-F;return B*(B*(L+(3*D-L)*F)+3*P*F*F)+N*F*F*F},bezierByTime:function(L,D){var P=function(L,D){var P,V,z,W,H=D-0,G=D-L[0],X=3*H,nt=3*G,ut=3*(D-L[2]),dt=1/(-H+nt-ut+(D-1)),ft=(X-6*G+ut)*dt,_t=ft*(1/3),pt=(-X+nt)*dt,vt=1/3*(3*pt-ft*ft),gt=vt*(1/3),mt=(2*ft*ft*ft-9*ft*pt+H*dt*27)/27,yt=mt/2,Tt=yt*yt+gt*gt*gt;if(Tt<0){var xt=1/3*-vt,St=U(xt*xt*xt),bt=-mt/(2*St),wt=F(bt<-1?-1:bt>1?1:bt),Rt=2*l(St);return V=Rt*N(wt*(1/3))-_t,z=Rt*N((wt+k)*(1/3))-_t,W=Rt*N((wt+2*k)*(1/3))-_t,0<=V&&V<=1?0<=z&&z<=1?0<=W&&W<=1?B(V,z,W):B(V,z):0<=W&&W<=1?B(V,W):V:0<=z&&z<=1?0<=W&&W<=1?B(z,W):z:W}if(0===Tt)return z=-(P=yt<0?l(-yt):-l(yt))-_t,0<=(V=2*P-_t)&&V<=1?0<=z&&z<=1?B(V,z):V:z;var It=U(Tt);return(P=l(-yt+It))-l(yt+It)-_t}(L,D),V=L[1];return((1-P)*(V+(L[3]-V)*P)*3+P*P)*P}}},{}],15:[function(L,D,P){"use strict";var N={constant:function(){return 0},linear:function(L){return L},quadIn:function(L){return L*L},quadOut:function(L){return L*(2-L)},quadInOut:function(L){return(L*=2)<1?.5*L*L:-.5*(--L*(L-2)-1)},cubicIn:function(L){return L*L*L},cubicOut:function(L){return--L*L*L+1},cubicInOut:function(L){return(L*=2)<1?.5*L*L*L:.5*((L-=2)*L*L+2)},quartIn:function(L){return L*L*L*L},quartOut:function(L){return 1- --L*L*L*L},quartInOut:function(L){return(L*=2)<1?.5*L*L*L*L:-.5*((L-=2)*L*L*L-2)},quintIn:function(L){return L*L*L*L*L},quintOut:function(L){return--L*L*L*L*L+1},quintInOut:function(L){return(L*=2)<1?.5*L*L*L*L*L:.5*((L-=2)*L*L*L*L+2)},sineIn:function(L){return 1-Math.cos(L*Math.PI/2)},sineOut:function(L){return Math.sin(L*Math.PI/2)},sineInOut:function(L){return.5*(1-Math.cos(Math.PI*L))},expoIn:function(L){return 0===L?0:Math.pow(1024,L-1)},expoOut:function(L){return 1===L?1:1-Math.pow(2,-10*L)},expoInOut:function(L){return 0===L?0:1===L?1:(L*=2)<1?.5*Math.pow(1024,L-1):.5*(2-Math.pow(2,-10*(L-1)))},circIn:function(L){return 1-Math.sqrt(1-L*L)},circOut:function(L){return Math.sqrt(1- --L*L)},circInOut:function(L){return(L*=2)<1?-.5*(Math.sqrt(1-L*L)-1):.5*(Math.sqrt(1-(L-=2)*L)+1)},elasticIn:function(L){var D,P=.1;return 0===L?0:1===L?1:(!P||P<1?(P=1,D=.1):D=.4*Math.asin(1/P)/(2*Math.PI),-P*Math.pow(2,10*(L-=1))*Math.sin((L-D)*(2*Math.PI)/.4))},elasticOut:function(L){var D,P=.1;return 0===L?0:1===L?1:(!P||P<1?(P=1,D=.1):D=.4*Math.asin(1/P)/(2*Math.PI),P*Math.pow(2,-10*L)*Math.sin((L-D)*(2*Math.PI)/.4)+1)},elasticInOut:function(L){var D,P=.1;return 0===L?0:1===L?1:(!P||P<1?(P=1,D=.1):D=.4*Math.asin(1/P)/(2*Math.PI),(L*=2)<1?P*Math.pow(2,10*(L-=1))*Math.sin((L-D)*(2*Math.PI)/.4)*-.5:P*Math.pow(2,-10*(L-=1))*Math.sin((L-D)*(2*Math.PI)/.4)*.5+1)},backIn:function(L){var D=1.70158;return L*L*((D+1)*L-D)},backOut:function(L){var D=1.70158;return--L*L*((D+1)*L+D)+1},backInOut:function(L){var D=2.5949095;return(L*=2)<1?L*L*((D+1)*L-D)*.5:.5*((L-=2)*L*((D+1)*L+D)+2)},bounceIn:function(L){return 1-N.bounceOut(1-L)},bounceOut:function(L){return L<1/2.75?7.5625*L*L:L<2/2.75?7.5625*(L-=1.5/2.75)*L+.75:L<2.5/2.75?7.5625*(L-=2.25/2.75)*L+.9375:7.5625*(L-=2.625/2.75)*L+.984375},bounceInOut:function(L){return L<.5?.5*N.bounceIn(2*L):.5*N.bounceOut(2*L-1)+.5},smooth:function(L){return L<=0?0:L>=1?1:L*L*(3-2*L)},fade:function(L){return L<=0?0:L>=1?1:L*L*L*(L*(6*L-15)+10)}};function r(L,D){return function(P){return P<.5?D(2*P)/2:L(2*P-1)/2+.5}}N.quadOutIn=r(N.quadIn,N.quadOut),N.cubicOutIn=r(N.cubicIn,N.cubicOut),N.quartOutIn=r(N.quartIn,N.quartOut),N.quintOutIn=r(N.quintIn,N.quintOut),N.sineOutIn=r(N.sineIn,N.sineOut),N.expoOutIn=r(N.expoIn,N.expoOut),N.circOutIn=r(N.circIn,N.circOut),N.backOutIn=r(N.backIn,N.backOut),N.bounceIn=function(L){return 1-N.bounceOut(1-L)},N.bounceInOut=function(L){return L<.5?.5*N.bounceIn(2*L):.5*N.bounceOut(2*L-1)+.5},N.bounceOutIn=r(N.bounceIn,N.bounceOut),cc.easing=D.exports=N},{}],16:[function(L,D,P){"use strict";L("./bezier"),L("./easing"),L("./types"),L("./motion-path-helper"),L("./animation-curves"),L("./animation-clip"),L("./animation-manager"),L("./animation-state"),L("./animation-animator")},{"./animation-animator":9,"./animation-clip":10,"./animation-curves":11,"./animation-manager":12,"./animation-state":13,"./bezier":14,"./easing":15,"./motion-path-helper":17,"./types":19}],17:[function(L,D,P){"use strict";var N=L("./animation-curves").DynamicAnimCurve,F=L("./animation-curves").computeRatioByType,B=L("./bezier").bezier,k=L("../core/utils/binary-search").binarySearchEpsilon,U=cc.v2;function c(L){this.points=L||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function l(){this.start=U(),this.end=U(),this.startCtrlPoint=U(),this.endCtrlPoint=U()}function h(L){if(!Array.isArray(L))return!1;for(var D=0,P=L.length;D<P;D++){var N=L[D];if(!Array.isArray(N)||6!==N.length)return!1}return!0}c.prototype.computeBeziers=function(){var L;this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var D=1;D<this.points.length;D++){var P=this.points[D-1],N=this.points[D];(L=new l).start=P.pos,L.startCtrlPoint=P.out,L.end=N.pos,L.endCtrlPoint=N.in,this.beziers.push(L),this.length+=L.getLength()}var F=0;for(D=0;D<this.beziers.length;D++)L=this.beziers[D],this.ratios[D]=L.getLength()/this.length,this.progresses[D]=F+=this.ratios[D];return this.beziers},l.prototype.getPointAt=function(L){var D=this.getUtoTmapping(L);return this.getPoint(D)},l.prototype.getPoint=function(L){var D=B(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,L),P=B(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,L);return new U(D,P)},l.prototype.getLength=function(){var L=this.getLengths();return L[L.length-1]},l.prototype.getLengths=function(L){if(L||(L=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===L+1)return this.cacheArcLengths;var D,P,N=[],F=this.getPoint(0),B=U(),k=0;for(N.push(0),P=1;P<=L;P++)D=this.getPoint(P/L),B.x=F.x-D.x,B.y=F.y-D.y,k+=B.mag(),N.push(k),F=D;return this.cacheArcLengths=N,N},l.prototype.getUtoTmapping=function(L,D){var P,N=this.getLengths(),F=0,B=N.length;P=D||L*N[B-1];for(var k,U=0,V=B-1;U<=V;)if((k=N[F=Math.floor(U+(V-U)/2)]-P)<0)U=F+1;else{if(!(k>0)){V=F;break}V=F-1}if(N[F=V]===P)return F/(B-1);var z=N[F];return(F+(P-z)/(N[F+1]-z))/(B-1)},D.exports={sampleMotionPaths:function(L,D,P,B,V){function u(L){return L instanceof cc.Vec2?{in:L,pos:L,out:L}:Array.isArray(L)&&6===L.length?{in:U(L[2],L[3]),pos:U(L[0],L[1]),out:U(L[4],L[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}var z=D.values=D.values.map((function(L){return Array.isArray(L)&&(L=2===L.length?cc.v2(L[0],L[1]):cc.v3(L[0],L[1],L[2])),L}));if(0!==L.length&&0!==z.length){for(var W=!1,H=0;H<L.length;H++){var G=L[H];if(G&&!h(G)&&(cc.errorID(3904,V?V.name:"","position",H),G=null),G&&G.length>0){W=!0;break}}if(W&&1!==z.length){for(var X=D.types,nt=D.ratios,ut=D.values=[],dt=D.types=[],ft=D.ratios=[],_t=0,pt=N.Linear,vt=0,gt=L.length;vt<gt-1;vt++){var mt,yt=L[vt],Tt=nt[vt],xt=nt[vt+1]-Tt,St=z[vt],bt=z[vt+1],wt=X[vt],Rt=[],It=_t/xt,Mt=1/(xt*P*B);if(yt&&yt.length>0){var Ot=[];Ot.push(u(St));for(var Lt=0,Dt=yt.length;Lt<Dt;Lt++){var Pt=u(yt[Lt]);Ot.push(Pt)}Ot.push(u(bt));var Nt=new c(Ot);Nt.computeBeziers();for(var Ft=Nt.progresses;1-It>1e-6;){var Bt,kt,Ut,Vt;if((mt=F(mt=It,wt))<0)Vt=(0-mt)*(kt=Nt.beziers[0]).getLength(),Ut=kt.start.sub(kt.endCtrlPoint).normalize(),Bt=kt.start.add(Ut.mul(Vt));else if(mt>1)Vt=(mt-1)*(kt=Nt.beziers[Nt.beziers.length-1]).getLength(),Ut=kt.end.sub(kt.startCtrlPoint).normalize(),Bt=kt.end.add(Ut.mul(Vt));else{var zt=k(Ft,mt);zt<0&&(zt=~zt),mt-=zt>0?Ft[zt-1]:0,mt/=Nt.ratios[zt],Bt=Nt.beziers[zt].getPointAt(mt)}Rt.push(Bt),It+=Mt}}else for(;1-It>1e-6;)mt=F(mt=It,wt),Rt.push(St.lerp(bt,mt)),It+=Mt;for(pt="constant"===wt?wt:N.Linear,Lt=0,Dt=Rt.length;Lt<Dt;Lt++){var Wt=Tt+_t+Mt*Lt*xt;j(Rt[Lt],pt,Wt)}_t=Math.abs(It-1)>1e-6?(It-1)*xt:0}nt[nt.length-1]!==ft[ft.length-1]&&j(z[z.length-1],pt,nt[nt.length-1])}}function j(L,D,P){ut.push(L),dt.push(D),ft.push(P)}},Curve:c,Bezier:l}},{"../core/utils/binary-search":204,"./animation-curves":11,"./bezier":14}],18:[function(L,D,P){"use strict";var N=cc.js,F=L("../core/CCDebug");function s(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var B=s.prototype;N.get(B,"isPlaying",(function(){return this._isPlaying}),!0),N.get(B,"isPaused",(function(){return this._isPaused}),!0);var o=function(){};B.onPlay=o,B.onPause=o,B.onResume=o,B.onStop=o,B.onError=o,B.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(F.getError(3912)):(this._isPlaying=!0,this.onPlay())},B.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},B.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},B.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},B.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},D.exports=s},{"../core/CCDebug":22}],19:[function(L,D,P){"use strict";var N={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},F=cc.Enum({Default:0,Normal:1,Reverse:N.Reverse,Loop:N.Loop,LoopReverse:N.Loop|N.Reverse,PingPong:N.PingPong,PingPongReverse:N.PingPong|N.Reverse});function s(L){L?this.set(L):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.WrapMode=F,s.prototype.set=function(L){this.ratio=L.ratio,this.time=L.time,this.direction=L.direction,this.stopped=L.stopped,this.iterations=L.iterations,this.frameIndex=L.frameIndex},D.exports={WrapModeMask:N,WrapMode:F,WrappedInfo:s}},{}],20:[function(L,D,P){"use strict";var N,F=L("../core/event/event-target"),B=L("../core/platform/CCSys"),k=L("../core/assets/CCAudioClip").LoadMode,U=!1,V=[],z=function t(L){F.call(this),this._src=L,this._element=null,this.id=0,this._volume=1,this._loop=!1,this._nextTime=0,this._state=t.State.INITIALZING,this._onended=function(){this._state=t.State.STOPPED,this.emit("ended")}.bind(this)};cc.js.extend(z,F),z.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2,STOPPED:3},function(L){L._bindEnded=function(L){L=L||this._onended;var D=this._element;this._src&&D instanceof HTMLAudioElement?D.addEventListener("ended",L):D.onended=L},L._unbindEnded=function(){var L=this._element;L instanceof HTMLAudioElement?L.removeEventListener("ended",this._onended):L&&(L.onended=null)},L._onLoaded=function(){this._createElement(),this.setVolume(this._volume),this.setLoop(this._loop),0!==this._nextTime&&this.setCurrentTime(this._nextTime),this.getState()===z.State.PLAYING?this.play():this._state=z.State.INITIALZING},L._createElement=function(){var L=this._src._nativeAsset;L instanceof HTMLAudioElement?(this._element||(this._element=document.createElement("audio")),this._element.src=L.src):this._element=new h(L,this)},L.play=function(){this._state=z.State.PLAYING,this._element&&(this._bindEnded(),this._element.play(),this._touchToPlay())},L._touchToPlay=function(){if(this._src&&this._src.loadMode===k.DOM_AUDIO&&this._element.paused&&V.push({instance:this,offset:0,audio:this._element}),!U){U=!0;var L="ontouchend"in window?"touchend":"mousedown";cc.game.canvas.addEventListener(L,(function(){for(var L;L=V.pop();)L.audio.play(L.offset)}))}},L.destroy=function(){this._element=null},L.pause=function(){this._element&&this.getState()===z.State.PLAYING&&(this._unbindEnded(),this._element.pause(),this._state=z.State.PAUSED)},L.resume=function(){this._element&&this.getState()===z.State.PAUSED&&(this._bindEnded(),this._element.play(),this._state=z.State.PLAYING)},L.stop=function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(L){}for(var L=0;L<V.length;L++)if(V[L].instance===this){V.splice(L,1);break}this._unbindEnded(),this.emit("stop"),this._state=z.State.STOPPED}},L.setLoop=function(L){this._loop=L,this._element&&(this._element.loop=L)},L.getLoop=function(){return this._loop},L.setVolume=function(L){this._volume=L,this._element&&(this._element.volume=L)},L.getVolume=function(){return this._volume},L.setCurrentTime=function(L){if(this._element){this._nextTime=0,this._unbindEnded(),this._bindEnded(function(){this._bindEnded()}.bind(this));try{this._element.currentTime=L}catch(P){var D=this._element;D.addEventListener&&D.addEventListener("loadedmetadata",(function i(){D.removeEventListener("loadedmetadata",i),D.currentTime=L}))}}else this._nextTime=L},L.getCurrentTime=function(){return this._element?this._element.currentTime:0},L.getDuration=function(){return this._element?this._element.duration:0},L.getState=function(){return this._forceUpdatingState(),this._state},L._forceUpdatingState=function(){var L=this._element;L&&(z.State.PLAYING===this._state&&L.paused?this._state=z.State.STOPPED:z.State.STOPPED!==this._state||L.paused||(this._state=z.State.PLAYING))},Object.defineProperty(L,"src",{get:function(){return this._src},set:function(L){if(this._unbindEnded(),L)if(this._src=L,L.loaded)this._onLoaded();else{var D=this;L.once("load",(function(){L===D._src&&D._onLoaded()})),cc.loader.load({url:L.nativeUrl,skips:["Loader"]},(function(D,P){D?cc.error(D):L.loaded||(L._nativeAsset=P)}))}else this._src=null,this._element instanceof h?this._element=null:this._element.src="",this._state=z.State.INITIALZING;return L},enumerable:!0,configurable:!0}),Object.defineProperty(L,"paused",{get:function(){return!this._element||this._element.paused},enumerable:!0,configurable:!0})}(z.prototype),N=cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE||cc.sys.browserType===cc.sys.BROWSER_TYPE_BAIDU||cc.sys.browserType===cc.sys.BROWSER_TYPE_UC?.01:0;var h=function(L,D){this._audio=D,this._context=B.__audioSupport.context,this._buffer=L,this._gainObj=this._context.createGain(),this.volume=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currentTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)};(function(L){L.play=function(L){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var D=this._context.createBufferSource();D.buffer=this._buffer,D.connect(this._gainObj),D.loop=this._loop,this._startTime=this._context.currentTime,(L=L||this.playedLength)&&(this._startTime-=L);var P,N=this._buffer.duration,F=L;if(this._loop?D.start?D.start(0,F):D.notoGrainOn?D.noteGrainOn(0,F):D.noteOn(0,F):(P=N-L,D.start?D.start(0,F,P):D.noteGrainOn?D.noteGrainOn(0,F,P):D.noteOn(0,F,P)),this._currentSource=D,D.onended=this._endCallback,(!D.context.state||"suspended"===D.context.state)&&0===this._context.currentTime){var B=this;clearTimeout(this._currentTimer),this._currentTimer=setTimeout((function(){0===B._context.currentTime&&V.push({instance:B._audio,offset:L,audio:B})}),10)}cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&"interrupted"===D.context.state&&D.context.resume()},L.pause=function(){if(clearTimeout(this._currentTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var L=this._currentSource;this._currentSource=null,this._startTime=-1,L&&L.stop(0)}},Object.defineProperty(L,"paused",{get:function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)},enumerable:!0,configurable:!0}),Object.defineProperty(L,"loop",{get:function(){return this._loop},set:function(L){return this._currentSource&&(this._currentSource.loop=L),this._loop=L},enumerable:!0,configurable:!0}),Object.defineProperty(L,"volume",{get:function(){return this._volume},set:function(L){if(this._volume=L,this._gainObj.gain.setTargetAtTime)try{this._gainObj.gain.setTargetAtTime(L,this._context.currentTime,N)}catch(D){this._gainObj.gain.setTargetAtTime(L,this._context.currentTime,.01)}else this._gainObj.gain.value=L;B.os===B.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play())},enumerable:!0,configurable:!0}),Object.defineProperty(L,"currentTime",{get:function(){return this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration),this.playedLength},set:function(L){return this.paused?this.playedLength=L:(this.pause(),this.playedLength=L,this.play()),L},enumerable:!0,configurable:!0}),Object.defineProperty(L,"duration",{get:function(){return this._buffer.duration},enumerable:!0,configurable:!0})})(h.prototype),D.exports=cc.Audio=z},{"../core/assets/CCAudioClip":30,"../core/event/event-target":106,"../core/platform/CCSys":146}],21:[function(L,D,P){"use strict";var N=L("./CCAudio"),F=L("../core/assets/CCAudioClip"),B=cc.js,k=0,U=B.createMap(!0),V={},z=[],u=function(L){var D=k++,P=V[L];if(P||(P=V[L]=[]),W._maxAudioInstance<=P.length){var F=P.shift();d(F).stop()}var B=z.pop()||new N,u=function(){if(d(this.id)){delete U[this.id];var L=P.indexOf(this.id);cc.js.array.fastRemoveAt(P,L)}!function(L){L._finishCallback=null,L.off("ended"),L.off("stop"),L.src=null,z.includes(L)||(z.length<32?z.push(L):L.destroy())}(this)};return B.on("ended",(function(){this._finishCallback&&this._finishCallback(),u.call(this)}),B),B.on("stop",u,B),B.id=D,U[D]=B,P.push(D),B},d=function(L){return U[L]},f=function(L){return void 0===L?L=1:"string"==typeof L&&(L=Number.parseFloat(L)),L},W={AudioState:N.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:U,play:function(L,D,P){var N,B=L;if("string"==typeof L)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),N=u(B=L),F._loadByUrl(B,(function(L,D){D&&(N.src=D)}));else{if(!L)return;B=L.nativeUrl,(N=u(B)).src=L}return N.setLoop(D||!1),P=f(P),N.setVolume(P),N.play(),N.id},setLoop:function(L,D){var P=d(L);P&&P.setLoop&&P.setLoop(D)},isLoop:function(L){var D=d(L);return!(!D||!D.getLoop)&&D.getLoop()},setVolume:function(L,D){var P=d(L);P&&P.setVolume(D)},getVolume:function(L){var D=d(L);return D?D.getVolume():1},setCurrentTime:function(L,D){var P=d(L);return!!P&&(P.setCurrentTime(D),!0)},getCurrentTime:function(L){var D=d(L);return D?D.getCurrentTime():0},getDuration:function(L){var D=d(L);return D?D.getDuration():0},getState:function(L){var D=d(L);return D?D.getState():this.AudioState.ERROR},setFinishCallback:function(L,D){var P=d(L);P&&(P._finishCallback=D)},pause:function(L){var D=d(L);return!!D&&(D.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var L in U){var D=U[L];D.getState()===N.State.PLAYING&&(this._pauseIDCache.push(L),D.pause())}},resume:function(L){var D=d(L);D&&D.resume()},resumeAll:function(){for(var L=0;L<this._pauseIDCache.length;++L){var D=this._pauseIDCache[L],P=d(D);P&&P.resume()}this._pauseIDCache.length=0},stop:function(L){var D=d(L);return!!D&&(D.stop(),!0)},stopAll:function(){for(var L in U){var D=U[L];D&&D.stop()}},setMaxAudioInstance:function(L){this._maxAudioInstance=L},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(L){var D=L;if("string"==typeof L)cc.warnID(8401,"cc.audioEngine","cc.AudioClip","AudioClip","cc.AudioClip","audio"),D=L;else{if(!L)return;D=L.nativeUrl}var P=V[D];if(P)for(;P.length>0;){var N=P.pop(),F=U[N];F&&(F.stop(),delete U[N])}},uncacheAll:function(){var L;for(var D in this.stopAll(),U)(L=U[D])&&L.destroy();for(;L=z.pop();)L.destroy();U=B.createMap(!0),V={}},getProfile:function(L){},preload:function(L,D){cc.loader.load(L,D&&function(L){L||D()})},setMaxWebAudioSize:function(L){this._maxWebAudioSize=1024*L},_breakCache:null,_break:function(){for(var L in this._breakCache=[],U){var D=U[L];D.getState()===N.State.PLAYING&&(this._breakCache.push(L),D.pause())}},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var L=this._breakCache.pop(),D=d(L);D&&D.resume&&D.resume()}this._breakCache=null}},_music:{id:-1,loop:!1,volume:1},_effect:{volume:1,pauseCache:[]},playMusic:function(L,D){var P=this._music;return this.stop(P.id),P.id=this.play(L,D,P.volume),P.loop=D,P.id},stopMusic:function(){this.stop(this._music.id)},pauseMusic:function(){return this.pause(this._music.id),this._music.id},resumeMusic:function(){return this.resume(this._music.id),this._music.id},getMusicVolume:function(){return this._music.volume},setMusicVolume:function(L){L=f(L);var D=this._music;return D.volume=L,this.setVolume(D.id,D.volume),D.volume},isMusicPlaying:function(){return this.getState(this._music.id)===this.AudioState.PLAYING},playEffect:function(L,D){return this.play(L,D||!1,this._effect.volume)},setEffectsVolume:function(L){L=f(L);var D=this._music.id;for(var P in this._effect.volume=L,U){var N=U[P];N&&N.id!==D&&W.setVolume(P,L)}},getEffectsVolume:function(){return this._effect.volume},pauseEffect:function(L){return this.pause(L)},pauseAllEffects:function(){var L=this._music.id,D=this._effect;for(var P in D.pauseCache.length=0,U){var N=U[P];N&&N.id!==L&&N.getState()===this.AudioState.PLAYING&&(D.pauseCache.push(P),N.pause())}},resumeEffect:function(L){this.resume(L)},resumeAllEffects:function(){for(var L=this._effect.pauseCache,D=0;D<L.length;++D){var P=L[D],N=U[P];N&&N.resume()}},stopEffect:function(L){return this.stop(L)},stopAllEffects:function(){var L=this._music.id;for(var D in U){var P=U[D];P&&P.id!==L&&P.getState()===W.AudioState.PLAYING&&P.stop()}}};D.exports=cc.audioEngine=W},{"../core/assets/CCAudioClip":30,"./CCAudio":20}],22:[function(L,D,P){"use strict";var N,F=L("./platform/utils"),B=(L("../../DebugInfos"),"https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md");function a(L){return function(){var D=arguments[0],P=L+" "+D+", please go to "+B+"#"+D+" to see details.";if(1===arguments.length)return P;if(2===arguments.length)return P+" Arguments: "+arguments[1];var N=cc.js.shiftArguments.apply(null,arguments);return P+" Arguments: "+N.join(", ")}}cc.log=cc.warn=cc.error=cc.assert=console.log.bind?console.log.bind(console):console.log,cc._throw=function(L){F.callInNextTick((function(){throw L}))};var k=a("Log");cc.logID=function(){cc.log(k.apply(null,arguments))};var U=a("Warning");cc.warnID=function(){cc.warn(U.apply(null,arguments))};var V=a("Error");cc.errorID=function(){cc.error(V.apply(null,arguments))};var z=a("Assert");cc.assertID=function(L){L||cc.assert(!1,z.apply(null,cc.js.shiftArguments.apply(null,arguments)))};var W=cc.Enum({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});D.exports=cc.debug={DebugMode:W,_resetDebugSetting:function(L){if(cc.log=cc.warn=cc.error=cc.assert=function(){},L!==W.NONE){if(L>W.ERROR){var e=function(L){if(cc.game.canvas){if(!N){var D=document.createElement("Div");D.setAttribute("id","logInfoDiv"),D.setAttribute("width","200"),D.setAttribute("height",cc.game.canvas.height);var P=D.style;P.zIndex="99999",P.position="absolute",P.top=P.left="0",(N=document.createElement("textarea")).setAttribute("rows","20"),N.setAttribute("cols","30"),N.setAttribute("disabled","true");var F=N.style;F.backgroundColor="transparent",F.borderBottom="1px solid #cccccc",F.borderTopWidth=F.borderLeftWidth=F.borderRightWidth="0px",F.borderTopStyle=F.borderLeftStyle=F.borderRightStyle="none",F.padding="0px",F.margin=0,D.appendChild(N),cc.game.canvas.parentNode.appendChild(D)}N.value=N.value+L+"\r\n",N.scrollTop=N.scrollHeight}};cc.error=function(){e("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(L,D){!L&&D&&(D=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments)),e("ASSERT: "+D))},L!==W.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.js.formatStr.apply(null,arguments))}),L===W.INFO_FOR_WEB_PAGE&&(cc.log=function(){e(cc.js.formatStr.apply(null,arguments))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(L,D){if(!L)throw D&&(D=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(D)});L!==W.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),L===W.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)})}},getError:a("ERROR"),isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(L){cc.profiler&&cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(L?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config.showFPS=!!L)}}},{"../../DebugInfos":void 0,"./platform/utils":161}],23:[function(L,D,P){"use strict";var N=L("./event/event-target"),F=L("./load-pipeline/auto-release-utils"),B=L("./component-scheduler"),k=L("./node-activator"),U=L("./platform/CCObject"),V=L("./CCGame"),z=L("./renderer"),W=L("./event-manager"),H=L("./CCScheduler");cc.Director=function(){N.call(this),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._lastUpdate=0,this._deltaTime=0,this._startTime=0,this._maxParticleDeltaTime=0,this._scheduler=null,this._compScheduler=null,this._nodeActivator=null,this._actionManager=null;var L=this;V.on(V.EVENT_SHOW,(function(){L._lastUpdate=performance.now()})),V.once(V.EVENT_ENGINE_INITED,this.init,this)},cc.Director.prototype={constructor:cc.Director,init:function(){return this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._scheduler=new H,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,H.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new B,this._nodeActivator=new k,W&&W.setEnabled(!0),cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,H.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,H.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,H.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc.Physics3DManager?(this._physics3DManager=new cc.Physics3DManager,this._scheduler.scheduleUpdate(this._physics3DManager,H.PRIORITY_SYSTEM,!1)):this._physics3DManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this)},calculateDeltaTime:function(L){L||(L=performance.now()),this._deltaTime=L>this._lastUpdate?(L-this._lastUpdate)/1e3:0,this._lastUpdate=L},convertToGL:function(L){var D=V.container,P=cc.view,N=D.getBoundingClientRect(),F=N.left+window.pageXOffset-D.clientLeft,B=N.top+window.pageYOffset-D.clientTop,k=P._devicePixelRatio*(L.x-F),U=P._devicePixelRatio*(B+N.height-L.y);return P._isRotated?cc.v2(P._viewportRect.width-U,k):cc.v2(k,U)},convertToUI:function(L){var D=V.container,P=cc.view,N=D.getBoundingClientRect(),F=N.left+window.pageXOffset-D.clientLeft,B=N.top+window.pageYOffset-D.clientTop,k=cc.v2(0,0);return P._isRotated?(k.x=F+L.y/P._devicePixelRatio,k.y=B+N.height-(P._viewportRect.width-L.x)/P._devicePixelRatio):(k.x=F+L.x*P._devicePixelRatio,k.y=B+N.height-L.y*P._devicePixelRatio),k},end:function(){this._purgeDirectorInNextLoop=!0},getWinSize:function(){return cc.size(cc.winSize)},getWinSizeInPixels:function(){return cc.size(cc.winSize)},pause:function(){this._paused||(this._paused=!0)},purgeCachedData:function(){cc.loader.releaseAll()},purgeDirector:function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),W&&W.setEnabled(!1),cc.isValid(this._scene)&&this._scene.destroy(),this._scene=null,cc.renderer.clear(),cc.AssetLibrary.resetBuiltins(),cc.game.pause(),cc.loader.releaseAll()},reset:function(){this.purgeDirector(),W&&W.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),cc.game.resume()},runSceneImmediate:function(L,D,P){cc.assertID(L instanceof cc.Scene,1216),L._load();for(var N=Object.keys(V._persistRootNodes).map((function(L){return V._persistRootNodes[L]})),B=0;B<N.length;B++){var k=N[B],z=L.getChildByUuid(k.uuid);if(z){var W=z.getSiblingIndex();z._destroyImmediate(),L.insertChild(k,W)}else k.parent=L}var H=this._scene,G=H&&H.autoReleaseAssets&&H.dependAssets;F.autoRelease(G,L.dependAssets,N),cc.isValid(H)&&H.destroy(),this._scene=null,U._deferredDestroy(),D&&D(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,L),this._scene=L,L._activate(),cc.game.resume(),P&&P(null,L),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,L)},runScene:function(L,D,P){cc.assertID(L,1205),cc.assertID(L instanceof cc.Scene,1216),L._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,(function(){this.runSceneImmediate(L,D,P)}),this)},_getSceneUuid:function(L){var D=V._sceneInfos;if("string"==typeof L){L.endsWith(".fire")||(L+=".fire"),"/"===L[0]||L.startsWith("db://")||(L="/"+L);for(var P=0;P<D.length;P++){var N=D[P];if(N.url.endsWith(L))return N}}else if("number"==typeof L){if(0<=L&&L<D.length)return D[L];cc.errorID(1206,L)}else cc.errorID(1207,L);return null},loadScene:function(L,D,P){if(this._loadingScene)return cc.warnID(1208,L,this._loadingScene),!1;var N=this._getSceneUuid(L);if(N){var F=N.uuid;return this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,L),this._loadingScene=L,this._loadSceneByUuid(F,D,P),!0}return cc.errorID(1209,L),!1},preloadScene:function(L,D,P){void 0===P&&(P=D,D=null);var N=this._getSceneUuid(L);if(N)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,L),cc.loader.load({uuid:N.uuid,type:"uuid"},D,(function(D,N){D&&cc.errorID(1210,L,D.message),P&&P(D,N)}));else{var F='Can not preload the scene "'+L+'" because it is not in the build settings.';P(new Error(F)),cc.error("preloadScene: "+F)}},_loadSceneByUuid:function(L,D,P,N){console.time("LoadScene "+L),cc.AssetLibrary.loadAsset(L,(function(N,F){console.timeEnd("LoadScene "+L);var B=cc.director;if(B._loadingScene="",N)N="Failed to load scene: "+N,cc.error(N);else{if(F instanceof cc.SceneAsset){var k=F.scene;return k._id=F._uuid,k._name=F._name,void B.runSceneImmediate(k,P,D)}N="The asset "+L+" is not a scene",cc.error(N)}D&&D(N)}))},resume:function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setDepthTest:function(L){cc.Camera.main&&(cc.Camera.main.depth=!!L)},setClearColor:function(L){cc.Camera.main&&(cc.Camera.main.backgroundColor=L)},getRunningScene:function(){return this._scene},getScene:function(){return this._scene},getAnimationInterval:function(){return 1e3/V.getFrameRate()},setAnimationInterval:function(L){V.setFrameRate(Math.round(1e3/L))},getDeltaTime:function(){return this._deltaTime},getTotalTime:function(){return performance.now()-this._startTime},getTotalFrames:function(){return this._totalFrames},isPaused:function(){return this._paused},getScheduler:function(){return this._scheduler},setScheduler:function(L){this._scheduler!==L&&(this._scheduler=L)},getActionManager:function(){return this._actionManager},setActionManager:function(L){this._actionManager!==L&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=L,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getPhysics3DManager:function(){return this._physics3DManager},startAnimation:function(){cc.game.resume()},stopAnimation:function(){cc.game.pause()},_resetDeltaTime:function(){this._lastUpdate=performance.now(),this._deltaTime=0},mainLoop:function(L){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):(this.calculateDeltaTime(L),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this._compScheduler.clearup(),this.emit(cc.Director.EVENT_AFTER_UPDATE),U._deferredDestroy()),this.emit(cc.Director.EVENT_BEFORE_DRAW),z.render(this._scene,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_DRAW),W.frameUpdateListeners(),this._totalFrames++)},__fastOn:function(L,D,P){this.on(L,D,P)},__fastOff:function(L,D,P){this.off(L,D,P)}},cc.js.addon(cc.Director.prototype,N.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_draw",cc.Director.EVENT_AFTER_VISIT="director_before_draw",cc.Director.EVENT_BEFORE_DRAW="director_before_draw",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.Director.EVENT_BEFORE_PHYSICS="director_before_physics",cc.Director.EVENT_AFTER_PHYSICS="director_after_physics",cc.director=new cc.Director,D.exports=cc.director},{"./CCGame":24,"./CCScheduler":28,"./component-scheduler":67,"./event-manager":104,"./event/event-target":106,"./load-pipeline/auto-release-utils":119,"./node-activator":135,"./platform/CCObject":143,"./renderer":168}],24:[function(L,D,P){"use strict";var N=L("./event/event-target");L("../audio/CCAudioEngine");var F=L("./CCDebug"),B=L("./renderer/index.js"),k=L("../core/renderer/utils/dynamic-atlas/manager"),U={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESTART:"game_on_restart",EVENT_GAME_INITED:"game_inited",EVENT_ENGINE_INITED:"engine_inited",EVENT_RENDERER_INITED:"engine_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,renderType:-1,config:null,onStart:null,setFrameRate:function(L){this.config.frameRate=L,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},getFrameRate:function(){return this.config.frameRate},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),cc.director._resetDeltaTime(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,(function(){for(var L in U._persistRootNodes)U.removePersistRootNode(U._persistRootNodes[L]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),U.pause(),cc.AssetLibrary._loadBuiltins((function(){U.onStart(),U.emit(U.EVENT_RESTART)}))}))},end:function(){close()},_initEngine:function(){this._rendererInitialized||(this._initRenderer(),this._initEvents(),this.emit(this.EVENT_ENGINE_INITED))},_loadPreviewScript:function(L){L()},_prepareFinished:function(L){var D=this;this._initEngine(),this._setAnimFrame(),cc.AssetLibrary._loadBuiltins((function(){console.log("Cocos Creator v"+cc.ENGINE_VERSION),D._prepared=!0,D._runMainLoop(),D.emit(D.EVENT_GAME_INITED),L&&L()}))},eventTargetOn:N.prototype.on,eventTargetOnce:N.prototype.once,on:function(L,D,P,N){this._prepared&&L===this.EVENT_ENGINE_INITED||!this._paused&&L===this.EVENT_GAME_INITED?D.call(P):this.eventTargetOn(L,D,P,N)},once:function(L,D,P){this._prepared&&L===this.EVENT_ENGINE_INITED||!this._paused&&L===this.EVENT_GAME_INITED?D.call(P):this.eventTargetOnce(L,D,P)},prepare:function(L){var D=this;if(this._prepared)L&&L();else{var P=this.config.jsList;P&&P.length>0?cc.loader.load(P,(function(P){if(P)throw new Error(JSON.stringify(P));D._loadPreviewScript((function(){D._prepareFinished(L)}))})):this._loadPreviewScript((function(){D._prepareFinished(L)}))}},run:function(L,D){this._initConfig(L),this.onStart=D,this.prepare(U.onStart&&U.onStart.bind(U))},addPersistRootNode:function(L){if(cc.Node.isNode(L)&&L.uuid){var D=L.uuid;if(!this._persistRootNodes[D]){var P=cc.director._scene;if(cc.isValid(P))if(L.parent){if(!(L.parent instanceof cc.Scene))return void cc.warnID(3801);if(L.parent!==P)return void cc.warnID(3802)}else L.parent=P;this._persistRootNodes[D]=L,L._persistNode=!0}}else cc.warnID(3800)},removePersistRootNode:function(L){var D=L.uuid||"";L===this._persistRootNodes[D]&&(delete this._persistRootNodes[D],L._persistNode=!1)},isPersistRootNode:function(L){return L._persistNode},_setAnimFrame:function(){this._lastTime=performance.now();var L=U.config.frameRate;this._frameTime=1e3/L,cc.director._maxParticleDeltaTime=this._frameTime/1e3*2,60!==L&&30!==L?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(L){var D=performance.now(),P=Math.max(0,U._frameTime-(D-U._lastTime)),N=window.setTimeout((function(){L()}),P);return U._lastTime=D+P,N},_ctTime:function(L){window.clearTimeout(L)},_runMainLoop:function(){if(this._prepared){var L,D=this,P=D.config,N=cc.director,B=!0,k=P.frameRate;F.setDisplayStats(P.showFPS),L=function(P){if(!D._paused){if(D._intervalId=window.requestAnimFrame(L),30===k&&(B=!B))return;N.mainLoop(P)}},D._intervalId=window.requestAnimFrame(L),D._paused=!1}},_initConfig:function(L){"number"!=typeof L.debugMode&&(L.debugMode=0),L.exposeClassName=!!L.exposeClassName,"number"!=typeof L.frameRate&&(L.frameRate=60);var D=L.renderMode;("number"!=typeof D||D>2||D<0)&&(L.renderMode=0),"boolean"!=typeof L.registerSystemEvent&&(L.registerSystemEvent=!0),L.showFPS=1!==D&&!!L.showFPS,this._sceneInfos=L.scenes||[],this.collisionMatrix=L.collisionMatrix||[],this.groupList=L.groupList||[],F._resetDebugSetting(L.debugMode),this.config=L,this._configLoaded=!0},_determineRenderType:function(){var L=this.config,D=parseInt(L.renderMode)||0;this.renderType=this.RENDER_TYPE_CANVAS;var P=!1;if(0===D?cc.sys.capabilities.opengl?(this.renderType=this.RENDER_TYPE_WEBGL,P=!0):cc.sys.capabilities.canvas&&(this.renderType=this.RENDER_TYPE_CANVAS,P=!0):1===D&&cc.sys.capabilities.canvas?(this.renderType=this.RENDER_TYPE_CANVAS,P=!0):2===D&&cc.sys.capabilities.opengl&&(this.renderType=this.RENDER_TYPE_WEBGL,P=!0),!P)throw new Error(F.getError(3820,D))},_initRenderer:function(){if(!this._rendererInitialized){var L,D,P,N,F=this.config.id,U=F instanceof HTMLElement?F:document.querySelector(F)||document.querySelector("#"+F);if("CANVAS"===U.tagName?(L=U.width,D=U.height,this.canvas=P=U,this.container=N=document.createElement("DIV"),P.parentNode&&P.parentNode.insertBefore(N,P)):("DIV"!==U.tagName&&cc.warnID(3819),L=U.clientWidth,D=U.clientHeight,this.canvas=P=document.createElement("CANVAS"),this.container=N=document.createElement("DIV"),U.appendChild(N)),N.setAttribute("id","Cocos2dGameContainer"),N.appendChild(P),this.frame=N.parentNode===document.body?document.documentElement:N.parentNode,function(L,D){(" "+L.className+" ").indexOf(" "+D+" ")>-1||(L.className&&(L.className+=" "),L.className+=D)}(P,"gameCanvas"),P.setAttribute("width",L||480),P.setAttribute("height",D||320),P.setAttribute("tabindex",99),this._determineRenderType(),this.renderType===this.RENDER_TYPE_WEBGL){var V={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS};B.initWebGL(P,V),this._renderContext=B.device._gl,!cc.macro.CLEANUP_IMAGE_CACHE&&k&&(k.enabled=!0)}this._renderContext||(this.renderType=this.RENDER_TYPE_CANVAS,B.initCanvas(P),this._renderContext=B.device._ctx),this.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this._rendererInitialized=!0}},_initEvents:function(){var L,D=window;this.config.registerSystemEvent&&cc.internal.inputManager.registerSystemEvent(this.canvas),void 0!==document.hidden?L="hidden":void 0!==document.mozHidden?L="mozHidden":void 0!==document.msHidden?L="msHidden":void 0!==document.webkitHidden&&(L="webkitHidden");var P=!1;function n(){P||(P=!0,U.emit(U.EVENT_HIDE))}function r(L,D,N,F,B){P&&(P=!1,U.emit(U.EVENT_SHOW,L,D,N,F,B))}if(L)for(var N=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],F=0;F<N.length;F++)document.addEventListener(N[F],(function(D){var P=document[L];(P=P||D.hidden)?n():r()}));else D.addEventListener("blur",n),D.addEventListener("focus",r);navigator.userAgent.indexOf("MicroMessenger")>-1&&(D.onfocus=r),"onpageshow"in window&&"onpagehide"in window&&(D.addEventListener("pagehide",n),D.addEventListener("pageshow",r),document.addEventListener("pagehide",n),document.addEventListener("pageshow",r)),this.on(U.EVENT_HIDE,(function(){U.pause()})),this.on(U.EVENT_SHOW,(function(){U.resume()}))}};N.call(U),cc.js.addon(U,N.prototype),cc.game=D.exports=U},{"../audio/CCAudioEngine":21,"../core/renderer/utils/dynamic-atlas/manager":171,"./CCDebug":22,"./event/event-target":106,"./renderer/index.js":168}],25:[function(L,D,P){"use strict";var N=L("./value-types"),F=L("./utils/base-node"),B=L("./utils/prefab-helper"),k=L("./utils/trans-pool").NodeMemPool,U=L("./utils/affine-transform"),V=L("./event-manager"),z=L("./platform/CCMacro"),W=L("./platform/js"),H=(L("./event/event"),L("./event/event-target")),G=L("./renderer/render-flow"),X=cc.Object.Flags.Destroying,nt=Math.PI/180,ut=!!cc.ActionManager,v=function(){},dt=new N.Vec3,ft=new N.Quat,_t=new N.Vec3,pt=new N.Vec3,vt=new N.Quat,gt=new N.Quat,mt=new N.Vec3,yt=new N.Vec3,Tt=new N.Vec3,xt=new N.Vec3,St=new N.Vec3,bt=new N.Quat,wt=new N.Quat,Rt=new N.Vec3,It=new N.Quat,Mt=new N.Vec3,Ot=new N.Vec3,Lt=new N.Quat,Dt=new N.Quat,Pt=(new N.Quat,cc.mat4()),Nt=new N.Vec3,Ft=new Array(16);Ft.length=0;var Bt=cc.Enum({DEBUG:31}),kt=cc.Enum({POSITION:1,SCALE:2,ROTATION:4,SKEW:8,TRS:7,RS:6,TRSS:15,PHYSICS_POSITION:16,PHYSICS_SCALE:32,PHYSICS_ROTATION:64,PHYSICS_TRS:112,PHYSICS_RS:96,ALL_POSITION:17,ALL_SCALE:34,ALL_ROTATION:68,ALL_TRS:119,ALL:65535}),Ut=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel",POSITION_CHANGED:"position-changed",ROTATION_CHANGED:"rotation-changed",SCALE_CHANGED:"scale-changed",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",CHILD_REORDER:"child-reorder",GROUP_CHANGED:"group-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"}),Vt=[Ut.TOUCH_START,Ut.TOUCH_MOVE,Ut.TOUCH_END,Ut.TOUCH_CANCEL],zt=[Ut.MOUSE_DOWN,Ut.MOUSE_ENTER,Ut.MOUSE_MOVE,Ut.MOUSE_LEAVE,Ut.MOUSE_UP,Ut.MOUSE_WHEEL],Wt=!0,Y=function(L,D){if(0!==L){Wt&&cc.warn("`cc.Node.skewX/Y` is deprecated since v2.2.1, please use 3D node instead.",""),Wt=!1}},Ht=null,j=function(L,D){var P=L.getLocation(),N=this.owner;return!!N._hitTest(P,this)&&(D.type=Ut.TOUCH_START,D.touch=L,D.bubbles=!0,N.dispatchEvent(D),!0)},q=function(L,D){var P=this.owner;D.type=Ut.TOUCH_MOVE,D.touch=L,D.bubbles=!0,P.dispatchEvent(D)},Z=function(L,D){var P=L.getLocation(),N=this.owner;N._hitTest(P,this)?D.type=Ut.TOUCH_END:D.type=Ut.TOUCH_CANCEL,D.touch=L,D.bubbles=!0,N.dispatchEvent(D)},K=function(L,D){L.getLocation();var P=this.owner;D.type=Ut.TOUCH_CANCEL,D.touch=L,D.bubbles=!0,P.dispatchEvent(D)},Q=function(L){var D=L.getLocation(),P=this.owner;P._hitTest(D,this)&&(L.type=Ut.MOUSE_DOWN,L.bubbles=!0,P.dispatchEvent(L))},$=function(L){var D=L.getLocation(),P=this.owner;if(P._hitTest(D,this))this._previousIn||(Ht&&Ht._mouseListener&&(L.type=Ut.MOUSE_LEAVE,Ht.dispatchEvent(L),Ht._mouseListener._previousIn=!1),Ht=this.owner,L.type=Ut.MOUSE_ENTER,P.dispatchEvent(L),this._previousIn=!0),L.type=Ut.MOUSE_MOVE,L.bubbles=!0,P.dispatchEvent(L);else{if(!this._previousIn)return;L.type=Ut.MOUSE_LEAVE,P.dispatchEvent(L),this._previousIn=!1,Ht=null}L.stopPropagation()},J=function(L){var D=L.getLocation(),P=this.owner;P._hitTest(D,this)&&(L.type=Ut.MOUSE_UP,L.bubbles=!0,P.dispatchEvent(L),L.stopPropagation())},tt=function(L){var D=L.getLocation(),P=this.owner;P._hitTest(D,this)&&(L.type=Ut.MOUSE_WHEEL,L.bubbles=!0,P.dispatchEvent(L),L.stopPropagation())};function et(L,D){if(D){for(var P=0,N=null,F=L;F&&cc.Node.isNode(F);F=F._parent,++P)if(F.getComponent(D)){var B={index:P,node:F};N?N.push(B):N=[B]}return N}return null}function it(L,D){if(!(L._objFlags&X)){var P=0;if(L._bubblingListeners)for(;P<D.length;++P)if(L._bubblingListeners.hasEventListener(D[P]))return!0;if(L._capturingListeners)for(;P<D.length;++P)if(L._capturingListeners.hasEventListener(D[P]))return!0;return!1}return!0}function rt(L){var D=L.groupIndex;return 0===D&&L.parent&&(D=rt(L.parent)),D}function st(L){var D=rt(L);L._cullingMask=1<<D;for(var P=0;P<L._children.length;P++)st(L._children[P])}function at(){if(this._localMatDirty&kt.TRSS){var L=this._matrix,D=L.m;if(N.Trs.toMat4(L,this._trs),this._skewX||this._skewY){var P=D[0],F=D[1],B=D[4],k=D[5],U=Math.tan(this._skewX*nt),V=Math.tan(this._skewY*nt);U===1/0&&(U=99999999),V===1/0&&(V=99999999),D[0]=P+B*V,D[1]=F+k*V,D[4]=B+P*U,D[5]=k+F*U}this._localMatDirty&=~kt.TRSS,this._worldMatDirty=!0}}function ot(){var L=this._localMatDirty;if(L&kt.TRSS){var D=this._matrix.m,P=this._trs;if(L&(kt.RS|kt.SKEW)){var N=-this._eulerAngles.z,F=this._skewX||this._skewY,B=P[7],k=P[8];if(N||F){var U=1,V=0,z=0,W=1;if(N){var H=N*nt;z=Math.sin(H),U=W=Math.cos(H),V=-z}if(D[0]=U*=B,D[1]=V*=B,D[4]=z*=k,D[5]=W*=k,F){var G=D[0],X=D[1],ut=D[4],dt=D[5],ft=Math.tan(this._skewX*nt),_t=Math.tan(this._skewY*nt);ft===1/0&&(ft=99999999),_t===1/0&&(_t=99999999),D[0]=G+ut*_t,D[1]=X+dt*_t,D[4]=ut+G*ft,D[5]=dt+X*ft}}else D[0]=B,D[1]=0,D[4]=0,D[5]=k}D[12]=P[0],D[13]=P[1],this._localMatDirty&=~kt.TRSS,this._worldMatDirty=!0}}function ct(){if(this._localMatDirty&kt.TRSS&&this._updateLocalMatrix(),this._parent){var L=this._parent._worldMatrix;N.Mat4.mul(this._worldMatrix,L,this._matrix)}else N.Mat4.copy(this._worldMatrix,this._matrix);this._worldMatDirty=!1}function lt(){this._localMatDirty&kt.TRSS&&this._updateLocalMatrix();var L=this._parent;L?this._mulMat(this._worldMatrix,L._worldMatrix,this._matrix):N.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1}function ht(L,D,P){var N=D.m,F=P.m,B=L.m,k=N[0],U=N[1],V=N[4],z=N[5],W=N[12],H=N[13],G=F[0],X=F[1],nt=F[4],ut=F[5],dt=F[12],ft=F[13];0!==U||0!==V?(B[0]=G*k+X*V,B[1]=G*U+X*z,B[4]=nt*k+ut*V,B[5]=nt*U+ut*z,B[12]=k*dt+V*ft+W,B[13]=U*dt+z*ft+H):(B[0]=G*k,B[1]=X*z,B[4]=nt*k,B[5]=ut*z,B[12]=k*dt+W,B[13]=z*ft+H)}var Gt=N.Mat4.mul,Yt={name:"cc.Node",extends:F,properties:{_opacity:255,_color:cc.Color.WHITE,_contentSize:cc.Size,_anchorPoint:cc.v2(.5,.5),_position:void 0,_scale:void 0,_trs:null,_eulerAngles:cc.Vec3,_skewX:0,_skewY:0,_zIndex:{default:void 0,type:cc.Integer},_localZOrder:{default:0,serializable:!1},_is3DNode:!1,_groupIndex:{default:0,formerlySerializedAs:"groupIndex"},groupIndex:{get:function(){return this._groupIndex},set:function(L){this._groupIndex=L,st(this),this.emit(Ut.GROUP_CHANGED,this)}},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(L){this.groupIndex=cc.game.groupList.indexOf(L)}},x:{get:function(){return this._trs[0]},set:function(L){var D=this._trs;L!==D[0]&&(D[0]=L,this.setLocalDirty(kt.ALL_POSITION),1&this._eventMask&&this.emit(Ut.POSITION_CHANGED))}},y:{get:function(){return this._trs[1]},set:function(L){var D=this._trs;L!==D[1]&&(D[1]=L,this.setLocalDirty(kt.ALL_POSITION),1&this._eventMask&&this.emit(Ut.POSITION_CHANGED))}},z:{get:function(){return this._trs[2]},set:function(L){var D=this._trs;L!==D[2]&&(D[2]=L,this.setLocalDirty(kt.ALL_POSITION),this._renderFlag|=G.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(Ut.POSITION_CHANGED))}},rotation:{get:function(){return-this.angle},set:function(L){this.angle=-L}},angle:{get:function(){return this._eulerAngles.z},set:function(L){N.Vec3.set(this._eulerAngles,0,0,L),N.Trs.fromAngleZ(this._trs,L),this.setLocalDirty(kt.ALL_ROTATION),4&this._eventMask&&this.emit(Ut.ROTATION_CHANGED)}},rotationX:{get:function(){return this._eulerAngles.x},set:function(L){this._eulerAngles.x!==L&&(this._eulerAngles.x=L,this._eulerAngles.x===this._eulerAngles.y?N.Trs.fromAngleZ(this._trs,-L):N.Trs.fromEulerNumber(this._trs,L,this._eulerAngles.y,0),this.setLocalDirty(kt.ALL_ROTATION),4&this._eventMask&&this.emit(Ut.ROTATION_CHANGED))}},rotationY:{get:function(){return this._eulerAngles.y},set:function(L){this._eulerAngles.y!==L&&(this._eulerAngles.y=L,this._eulerAngles.x===this._eulerAngles.y?N.Trs.fromAngleZ(this._trs,-L):N.Trs.fromEulerNumber(this._trs,this._eulerAngles.x,L,0),this.setLocalDirty(kt.ALL_ROTATION),4&this._eventMask&&this.emit(Ut.ROTATION_CHANGED))}},eulerAngles:{get:function(){return N.Trs.toEuler(this._eulerAngles,this._trs)},set:function(L){N.Trs.fromEuler(this._trs,L),this.setLocalDirty(kt.ALL_ROTATION),this._renderFlag|=G.FLAG_TRANSFORM}},quat:{get:function(){var L=this._trs;return new N.Quat(L[3],L[4],L[5],L[6])},set:function(L){this.setRotation(L)}},scale:{get:function(){return this._trs[7]},set:function(L){this.setScale(L)}},scaleX:{get:function(){return this._trs[7]},set:function(L){this._trs[7]!==L&&(this._trs[7]=L,this.setLocalDirty(kt.ALL_SCALE),2&this._eventMask&&this.emit(Ut.SCALE_CHANGED))}},scaleY:{get:function(){return this._trs[8]},set:function(L){this._trs[8]!==L&&(this._trs[8]=L,this.setLocalDirty(kt.ALL_SCALE),2&this._eventMask&&this.emit(Ut.SCALE_CHANGED))}},scaleZ:{get:function(){return this._trs[9]},set:function(L){this._trs[9]!==L&&(this._trs[9]=L,this.setLocalDirty(kt.ALL_SCALE),this._renderFlag|=G.FLAG_TRANSFORM,2&this._eventMask&&this.emit(Ut.SCALE_CHANGED))}},skewX:{get:function(){return this._skewX},set:function(L){Y(L),this._skewX=L,this.setLocalDirty(kt.SKEW)}},skewY:{get:function(){return this._skewY},set:function(L){Y(L),this._skewY=L,this.setLocalDirty(kt.SKEW)}},opacity:{get:function(){return this._opacity},set:function(L){L=cc.misc.clampf(L,0,255),this._opacity!==L&&(this._opacity=L,this._renderFlag|=G.FLAG_OPACITY_COLOR)},range:[0,255]},color:{get:function(){return this._color.clone()},set:function(L){this._color.equals(L)||(this._color.set(L),this._renderFlag|=G.FLAG_COLOR,32&this._eventMask&&this.emit(Ut.COLOR_CHANGED,L))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(L){var D=this._anchorPoint;D.x!==L&&(D.x=L,16&this._eventMask&&this.emit(Ut.ANCHOR_CHANGED))}},anchorY:{get:function(){return this._anchorPoint.y},set:function(L){var D=this._anchorPoint;D.y!==L&&(D.y=L,16&this._eventMask&&this.emit(Ut.ANCHOR_CHANGED))}},width:{get:function(){return this._contentSize.width},set:function(L){L!==this._contentSize.width&&(this._contentSize.width=L,8&this._eventMask&&this.emit(Ut.SIZE_CHANGED))}},height:{get:function(){return this._contentSize.height},set:function(L){L!==this._contentSize.height&&(this._contentSize.height=L,8&this._eventMask&&this.emit(Ut.SIZE_CHANGED))}},zIndex:{get:function(){return this._localZOrder>>16},set:function(L){L>z.MAX_ZINDEX?(cc.warnID(1636),L=z.MAX_ZINDEX):L<z.MIN_ZINDEX&&(cc.warnID(1637),L=z.MIN_ZINDEX),this.zIndex!==L&&(this._localZOrder=65535&this._localZOrder|L<<16,this.emit(Ut.SIBLING_ORDER_CHANGED),this._onSiblingIndexChanged())}},is3DNode:{get:function(){return this._is3DNode},set:function(L){this._is3DNode=L,this._update3DFunction()}}},ctor:function(){this._reorderChildDirty=!1,this._widget=null,this._renderComponent=null,this._capturingListeners=null,this._bubblingListeners=null,this._touchListener=null,this._mouseListener=null,this._initDataFromPool(),this._eventMask=0,this._cullingMask=1,this._childArrivalOrder=1,this._renderFlag=G.FLAG_TRANSFORM|G.FLAG_OPACITY_COLOR},statics:{EventType:Ut,_LocalDirtyFlag:kt,isNode:function(L){return L instanceof Xt&&(L.constructor===Xt||!(L instanceof cc.Scene))},BuiltinGroupIndex:Bt},_onSiblingIndexChanged:function(){this._parent&&this._parent._delaySort()},_onPreDestroy:function(){this._onPreDestroyBase(),ut&&cc.director.getActionManager().removeAllActionsFromTarget(this),Ht===this&&(Ht=null),(this._touchListener||this._mouseListener)&&(V.removeListeners(this),this._touchListener&&(this._touchListener.owner=null,this._touchListener.mask=null,this._touchListener=null),this._mouseListener&&(this._mouseListener.owner=null,this._mouseListener.mask=null,this._mouseListener=null)),this._backDataIntoPool(),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_onPostActivated:function(L){var D=ut?cc.director.getActionManager():null;L?(this._renderFlag|=G.FLAG_WORLD_TRANSFORM,D&&D.resumeTarget(this),V.resumeTarget(this),this._checkListenerMask()):(D&&D.pauseTarget(this),V.pauseTarget(this))},_onHierarchyChanged:function(L){this._updateOrderOfArrival(),st(this),this._parent&&this._parent._delaySort(),this._renderFlag|=G.FLAG_WORLD_TRANSFORM,this._onHierarchyChangedBase(L),cc._widgetManager&&(cc._widgetManager._nodesOrderDirty=!0),L&&this._activeInHierarchy&&this._checkListenerMask()},_update3DFunction:function(){this._is3DNode?(this._updateLocalMatrix=at,this._calculWorldMatrix=ct,this._mulMat=Gt):(this._updateLocalMatrix=ot,this._calculWorldMatrix=lt,this._mulMat=ht),this._renderComponent&&this._renderComponent._on3DNodeChanged&&this._renderComponent._on3DNodeChanged(),this._renderFlag|=G.FLAG_TRANSFORM,this._localMatDirty=kt.ALL},_initDataFromPool:function(){this._spaceInfo||(this._spaceInfo=k.pop());var L=this._spaceInfo;this._matrix=cc.mat4(L.localMat),N.Mat4.identity(this._matrix),this._worldMatrix=cc.mat4(L.worldMat),N.Mat4.identity(this._worldMatrix),this._localMatDirty=kt.ALL,this._worldMatDirty=!0;var D=this._trs=this._spaceInfo.trs;D[0]=0,D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[5]=0,D[6]=1,D[7]=1,D[8]=1,D[9]=1},_backDataIntoPool:function(){k.push(this._spaceInfo),this._matrix=null,this._worldMatrix=null,this._trs=null,this._spaceInfo=null},_toEuler:function(){if(this.is3DNode)N.Trs.toEuler(this._eulerAngles,this._trs);else{var L=Math.asin(this._trs[5])/nt*2;N.Vec3.set(this._eulerAngles,0,0,L)}},_fromEuler:function(){this.is3DNode?N.Trs.fromEuler(this._trs,this._eulerAngles):N.Trs.fromAngleZ(this._trs,this._eulerAngles.z)},_upgrade_1x_to_2x:function(){this._is3DNode&&this._update3DFunction();var L=this._trs;if(L){var D=L;L=this._trs=this._spaceInfo.trs,11===D.length?L.set(D.subarray(1)):L.set(D)}else L=this._trs=this._spaceInfo.trs;void 0!==this._zIndex&&(this._localZOrder=this._zIndex<<16,this._zIndex=void 0),this._fromEuler(),0!==this._localZOrder&&(this._zIndex=(4294901760&this._localZOrder)>>16),this._color.a<255&&255===this._opacity&&(this._opacity=this._color.a,this._color.a=255)},_onBatchCreated:function(){var L=this._prefab;L&&L.sync&&L.root===this&&B.syncWithPrefab(this),this._upgrade_1x_to_2x(),this._updateOrderOfArrival(),this._cullingMask=1<<rt(this),this._activeInHierarchy||(ut&&cc.director.getActionManager().pauseTarget(this),V.pauseTarget(this));for(var D=this._children,P=0,N=D.length;P<N;P++)D[P]._onBatchCreated();D.length>0&&(this._renderFlag|=G.FLAG_CHILDREN)},_onBatchRestored:function(){if(this._upgrade_1x_to_2x(),this._cullingMask=1<<rt(this),!this._activeInHierarchy){var L=cc.director.getActionManager();L&&L.pauseTarget(this),V.pauseTarget(this)}for(var D=this._children,P=0,N=D.length;P<N;P++)D[P]._onBatchRestored();D.length>0&&(this._renderFlag|=G.FLAG_CHILDREN)},_checkListenerMask:function(){if(this._touchListener){var L=this._touchListener.mask=et(this,cc.Mask);this._mouseListener&&(this._mouseListener.mask=L)}else this._mouseListener&&(this._mouseListener.mask=et(this,cc.Mask))},_checknSetupSysEvent:function(L){var D=!1,P=!1;return-1!==Vt.indexOf(L)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:et(this,cc.Mask),onTouchBegan:j,onTouchMoved:q,onTouchEnded:Z,onTouchCancelled:K}),V.addListener(this._touchListener,this),D=!0),P=!0):-1!==zt.indexOf(L)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:et(this,cc.Mask),onMouseDown:Q,onMouseMove:$,onMouseUp:J,onMouseScroll:tt}),V.addListener(this._mouseListener,this),D=!0),P=!0),D&&!this._activeInHierarchy&&cc.director.getScheduler().schedule((function(){this._activeInHierarchy||V.pauseTarget(this)}),this,0,0,0,!1),P},on:function(L,D,P,N){if(this._checknSetupSysEvent(L))return this._onDispatch(L,D,P,N);switch(L){case Ut.POSITION_CHANGED:this._eventMask|=1;break;case Ut.SCALE_CHANGED:this._eventMask|=2;break;case Ut.ROTATION_CHANGED:this._eventMask|=4;break;case Ut.SIZE_CHANGED:this._eventMask|=8;break;case Ut.ANCHOR_CHANGED:this._eventMask|=16;break;case Ut.COLOR_CHANGED:this._eventMask|=32}return this._bubblingListeners||(this._bubblingListeners=new H),this._bubblingListeners.on(L,D,P)},once:function(L,D,P,N){(this._checknSetupSysEvent(L)&&N?this._capturingListeners=this._capturingListeners||new H:this._bubblingListeners=this._bubblingListeners||new H).once(L,D,P)},_onDispatch:function(L,D,P,N){if("boolean"==typeof P?(N=P,P=void 0):N=!!N,D){var F=null;return(F=N?this._capturingListeners=this._capturingListeners||new H:this._bubblingListeners=this._bubblingListeners||new H).hasEventListener(L,D,P)||(F.on(L,D,P),P&&P.__eventTargets&&P.__eventTargets.push(this)),D}cc.errorID(6800)},off:function(L,D,P,N){var F=-1!==Vt.indexOf(L),B=!F&&-1!==zt.indexOf(L);if(F||B)this._offDispatch(L,D,P,N),F?this._touchListener&&!it(this,Vt)&&(V.removeListener(this._touchListener),this._touchListener=null):B&&this._mouseListener&&!it(this,zt)&&(V.removeListener(this._mouseListener),this._mouseListener=null);else if(this._bubblingListeners&&(this._bubblingListeners.off(L,D,P),!this._bubblingListeners.hasEventListener(L)))switch(L){case Ut.POSITION_CHANGED:this._eventMask&=-2;break;case Ut.SCALE_CHANGED:this._eventMask&=-3;break;case Ut.ROTATION_CHANGED:this._eventMask&=-5;break;case Ut.SIZE_CHANGED:this._eventMask&=-9;break;case Ut.ANCHOR_CHANGED:this._eventMask&=-17;break;case Ut.COLOR_CHANGED:this._eventMask&=-33}},_offDispatch:function(L,D,P,N){if("boolean"==typeof P?(N=P,P=void 0):N=!!N,D){var F=N?this._capturingListeners:this._bubblingListeners;F&&(F.off(L,D,P),P&&P.__eventTargets&&W.array.fastRemove(P.__eventTargets,this))}else this._capturingListeners&&this._capturingListeners.removeAll(L),this._bubblingListeners&&this._bubblingListeners.removeAll(L)},targetOff:function(L){var D=this._bubblingListeners;D&&(D.targetOff(L),1&this._eventMask&&!D.hasEventListener(Ut.POSITION_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!D.hasEventListener(Ut.SCALE_CHANGED)&&(this._eventMask&=-3),4&this._eventMask&&!D.hasEventListener(Ut.ROTATION_CHANGED)&&(this._eventMask&=-5),8&this._eventMask&&!D.hasEventListener(Ut.SIZE_CHANGED)&&(this._eventMask&=-9),16&this._eventMask&&!D.hasEventListener(Ut.ANCHOR_CHANGED)&&(this._eventMask&=-17),32&this._eventMask&&!D.hasEventListener(Ut.COLOR_CHANGED)&&(this._eventMask&=-33)),this._capturingListeners&&this._capturingListeners.targetOff(L),L&&L.__eventTargets&&W.array.fastRemove(L.__eventTargets,this),this._touchListener&&!it(this,Vt)&&(V.removeListener(this._touchListener),this._touchListener=null),this._mouseListener&&!it(this,zt)&&(V.removeListener(this._mouseListener),this._mouseListener=null)},hasEventListener:function(L){var D=!1;return this._bubblingListeners&&(D=this._bubblingListeners.hasEventListener(L)),!D&&this._capturingListeners&&(D=this._capturingListeners.hasEventListener(L)),D},emit:function(L,D,P,N,F,B){this._bubblingListeners&&this._bubblingListeners.emit(L,D,P,N,F,B)},dispatchEvent:function(L){(function(L,D){var P,N;for(D.target=L,Ft.length=0,L._getCapturingTargets(D.type,Ft),D.eventPhase=1,N=Ft.length-1;N>=0;--N)if((P=Ft[N])._capturingListeners&&(D.currentTarget=P,P._capturingListeners.emit(D.type,D,Ft),D._propagationStopped))return void(Ft.length=0);if(Ft.length=0,D.eventPhase=2,D.currentTarget=L,L._capturingListeners&&L._capturingListeners.emit(D.type,D),!D._propagationImmediateStopped&&L._bubblingListeners&&L._bubblingListeners.emit(D.type,D),!D._propagationStopped&&D.bubbles)for(L._getBubblingTargets(D.type,Ft),D.eventPhase=3,N=0;N<Ft.length;++N)if((P=Ft[N])._bubblingListeners&&(D.currentTarget=P,P._bubblingListeners.emit(D.type,D),D._propagationStopped))return void(Ft.length=0);Ft.length=0})(this,L),Ft.length=0},pauseSystemEvents:function(L){V.pauseTarget(this,L)},resumeSystemEvents:function(L){V.resumeTarget(this,L)},_hitTest:function(L,D){var P=this._contentSize.width,F=this._contentSize.height,B=Mt,k=Ot,U=cc.Camera.findCamera(this);if(U?U.getScreenToWorldPoint(L,B):B.set(L),this._updateWorldMatrix(),!N.Mat4.invert(Pt,this._worldMatrix))return!1;N.Vec2.transformMat4(k,B,Pt),k.x+=this._anchorPoint.x*P,k.y+=this._anchorPoint.y*F;var V=!1;if(k.x>=0&&k.y>=0&&k.x<=P&&k.y<=F&&(V=!0,D&&D.mask))for(var z=D.mask,W=this,H=z?z.length:0,G=0,X=0;W&&X<H;++G,W=W.parent){var nt=z[X];if(G===nt.index){if(W!==nt.node){z.length=X;break}var ut=W.getComponent(cc.Mask);if(ut&&ut._enabled&&!ut._hitTest(B)){V=!1;break}X++}else if(G>nt.index){z.length=X;break}}return V},_getCapturingTargets:function(L,D){for(var P=this.parent;P;)P._capturingListeners&&P._capturingListeners.hasEventListener(L)&&D.push(P),P=P.parent},_getBubblingTargets:function(L,D){for(var P=this.parent;P;)P._bubblingListeners&&P._bubblingListeners.hasEventListener(L)&&D.push(P),P=P.parent},runAction:ut?function(L){if(this.active){cc.assertID(L,1618);var D=cc.director.getActionManager();return D._suppressDeprecation||(D._suppressDeprecation=!0,cc.warnID(1639)),D.addAction(L,this,!1),L}}:v,pauseAllActions:ut?function(){cc.director.getActionManager().pauseTarget(this)}:v,resumeAllActions:ut?function(){cc.director.getActionManager().resumeTarget(this)}:v,stopAllActions:ut?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:v,stopAction:ut?function(L){cc.director.getActionManager().removeAction(L)}:v,stopActionByTag:ut?function(L){L!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(L,this):cc.logID(1612)}:v,getActionByTag:ut?function(L){return L===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(L,this)}:function(){return null},getNumberOfRunningActions:ut?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},getPosition:function(L){return L=L||new N.Vec3,N.Trs.toPosition(L,this._trs)},setPosition:function(L,D,P){var N;void 0===D?(N=L.x,D=L.y,P=L.z||0):(N=L,P=P||0);var F=this._trs;F[0]===N&&F[1]===D&&F[2]===P||(F[0]=N,F[1]=D,F[2]=P,this.setLocalDirty(kt.ALL_POSITION),this._renderFlag|=G.FLAG_WORLD_TRANSFORM,1&this._eventMask&&this.emit(Ut.POSITION_CHANGED))},getScale:function(L){return void 0!==L?N.Trs.toScale(L,this._trs):(cc.warnID(1400,"cc.Node.getScale","cc.Node.scale or cc.Node.getScale(cc.Vec3)"),this._trs[7])},setScale:function(L,D,P){L&&"number"!=typeof L?(D=L.y,P=void 0===L.z?1:L.z,L=L.x):void 0!==L&&void 0===D?(D=L,P=L):void 0===P&&(P=1);var N=this._trs;N[7]===L&&N[8]===D&&N[9]===P||(N[7]=L,N[8]=D,N[9]=P,this.setLocalDirty(kt.ALL_SCALE),this._renderFlag|=G.FLAG_TRANSFORM,2&this._eventMask&&this.emit(Ut.SCALE_CHANGED))},getRotation:function(L){return L instanceof N.Quat?N.Trs.toRotation(L,this._trs):-this.angle},setRotation:function(L,D,P,N){if("number"==typeof L&&void 0===D)this.angle=-L;else{var F=L;void 0===D&&(F=L.x,D=L.y,P=L.z,N=L.w);var B=this._trs;B[3]===F&&B[4]===D&&B[5]===P&&B[6]===N||(B[3]=F,B[4]=D,B[5]=P,B[6]=N,this.setLocalDirty(kt.ALL_ROTATION),4&this._eventMask&&this.emit(Ut.ROTATION_CHANGED))}},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},setContentSize:function(L,D){var P=this._contentSize;if(void 0===D){if(L.width===P.width&&L.height===P.height)return;P.width=L.width,P.height=L.height}else{if(L===P.width&&D===P.height)return;P.width=L,P.height=D}8&this._eventMask&&this.emit(Ut.SIZE_CHANGED)},getAnchorPoint:function(){return cc.v2(this._anchorPoint)},setAnchorPoint:function(L,D){var P=this._anchorPoint;if(void 0===D){if(L.x===P.x&&L.y===P.y)return;P.x=L.x,P.y=L.y}else{if(L===P.x&&D===P.y)return;P.x=L,P.y=D}this.setLocalDirty(kt.ALL_POSITION),16&this._eventMask&&this.emit(Ut.ANCHOR_CHANGED)},_invTransformPoint:function(L,D){this._parent?this._parent._invTransformPoint(L,D):N.Vec3.copy(L,D);var P=this._trs;return N.Trs.toPosition(_t,P),N.Vec3.sub(L,L,_t),N.Trs.toRotation(vt,P),N.Quat.conjugate(gt,vt),N.Vec3.transformQuat(L,L,gt),N.Trs.toScale(_t,P),N.Vec3.inverseSafe(pt,_t),N.Vec3.mul(L,L,pt),L},getWorldPosition:function(L){N.Trs.toPosition(L,this._trs);for(var D,P=this._parent;P;)D=P._trs,N.Trs.toScale(dt,D),N.Vec3.mul(L,L,dt),N.Trs.toRotation(ft,D),N.Vec3.transformQuat(L,L,ft),N.Trs.toPosition(dt,D),N.Vec3.add(L,L,dt),P=P._parent;return L},setWorldPosition:function(L){var D=this._trs;this._parent?this._parent._invTransformPoint(mt,L):N.Vec3.copy(mt,L),N.Trs.fromPosition(D,mt),this.setLocalDirty(kt.ALL_POSITION),1&this._eventMask&&this.emit(Ut.POSITION_CHANGED)},getWorldRotation:function(L){N.Trs.toRotation(Lt,this._trs),N.Quat.copy(L,Lt);for(var D=this._parent;D;)N.Trs.toRotation(Lt,D._trs),N.Quat.mul(L,Lt,L),D=D._parent;return L},setWorldRotation:function(L){this._parent?(this._parent.getWorldRotation(Dt),N.Quat.conjugate(Dt,Dt),N.Quat.mul(Dt,Dt,L)):N.Quat.copy(Dt,L),N.Trs.fromRotation(this._trs,Dt),this.setLocalDirty(kt.ALL_ROTATION)},getWorldScale:function(L){N.Trs.toScale(yt,this._trs),N.Vec3.copy(L,yt);for(var D=this._parent;D;)N.Trs.toScale(yt,D._trs),N.Vec3.mul(L,L,yt),D=D._parent;return L},setWorldScale:function(L){this._parent?(this._parent.getWorldScale(Tt),N.Vec3.div(Tt,L,Tt)):N.Vec3.copy(Tt,L),N.Trs.fromScale(this._trs,Tt),this.setLocalDirty(kt.ALL_SCALE)},getWorldRT:function(L){var D=xt,P=bt,F=this._trs;N.Trs.toPosition(D,F),N.Trs.toRotation(P,F);for(var B=this._parent;B;)F=B._trs,N.Trs.toScale(St,F),N.Vec3.mul(D,D,St),N.Trs.toRotation(wt,F),N.Vec3.transformQuat(D,D,wt),N.Trs.toPosition(St,F),N.Vec3.add(D,D,St),N.Quat.mul(P,wt,P),B=B._parent;return N.Mat4.fromRT(L,P,D),L},lookAt:function(L,D){this.getWorldPosition(Rt),N.Vec3.sub(Rt,Rt,L),N.Vec3.normalize(Rt,Rt),N.Quat.fromViewUp(It,Rt,D),this.setWorldRotation(It)},_updateLocalMatrix:ot,_calculWorldMatrix:function(){this._localMatDirty&kt.TRSS&&this._updateLocalMatrix();var L=this._parent;L?this._mulMat(this._worldMatrix,L._worldMatrix,this._matrix):N.Mat4.copy(this._worldMatrix,this._matrix),this._worldMatDirty=!1},_mulMat:ht,_updateWorldMatrix:function(){if(this._parent&&this._parent._updateWorldMatrix(),this._worldMatDirty){this._calculWorldMatrix();for(var L=this._children,D=0,P=L.length;D<P;D++)L[D]._worldMatDirty=!0}},setLocalDirty:function(L){this._localMatDirty|=L,this._worldMatDirty=!0,L===kt.ALL_POSITION||L===kt.POSITION?this._renderFlag|=G.FLAG_WORLD_TRANSFORM:this._renderFlag|=G.FLAG_TRANSFORM},setWorldDirty:function(){this._worldMatDirty=!0},getLocalMatrix:function(L){return this._updateLocalMatrix(),N.Mat4.copy(L,this._matrix)},getWorldMatrix:function(L){return this._updateWorldMatrix(),N.Mat4.copy(L,this._worldMatrix)},convertToNodeSpaceAR:function(L,D){return this._updateWorldMatrix(),N.Mat4.invert(Pt,this._worldMatrix),L instanceof cc.Vec2?(D=D||new cc.Vec2,N.Vec2.transformMat4(D,L,Pt)):(D=D||new cc.Vec3,N.Vec3.transformMat4(D,L,Pt))},convertToWorldSpaceAR:function(L,D){return this._updateWorldMatrix(),L instanceof cc.Vec2?(D=D||new cc.Vec2,N.Vec2.transformMat4(D,L,this._worldMatrix)):(D=D||new cc.Vec3,N.Vec3.transformMat4(D,L,this._worldMatrix))},convertToNodeSpace:function(L){this._updateWorldMatrix(),N.Mat4.invert(Pt,this._worldMatrix);var D=new cc.Vec2;return N.Vec2.transformMat4(D,L,Pt),D.x+=this._anchorPoint.x*this._contentSize.width,D.y+=this._anchorPoint.y*this._contentSize.height,D},convertToWorldSpace:function(L){this._updateWorldMatrix();var D=new cc.Vec2(L.x-this._anchorPoint.x*this._contentSize.width,L.y-this._anchorPoint.y*this._contentSize.height);return N.Vec2.transformMat4(D,D,this._worldMatrix)},getNodeToParentTransform:function(L){L||(L=U.identity()),this._updateLocalMatrix();var D=this._contentSize;return Nt.x=-this._anchorPoint.x*D.width,Nt.y=-this._anchorPoint.y*D.height,N.Mat4.copy(Pt,this._matrix),N.Mat4.transform(Pt,Pt,Nt),U.fromMat4(L,Pt)},getNodeToParentTransformAR:function(L){return L||(L=U.identity()),this._updateLocalMatrix(),U.fromMat4(L,this._matrix)},getNodeToWorldTransform:function(L){L||(L=U.identity()),this._updateWorldMatrix();var D=this._contentSize;return Nt.x=-this._anchorPoint.x*D.width,Nt.y=-this._anchorPoint.y*D.height,N.Mat4.copy(Pt,this._worldMatrix),N.Mat4.transform(Pt,Pt,Nt),U.fromMat4(L,Pt)},getNodeToWorldTransformAR:function(L){return L||(L=U.identity()),this._updateWorldMatrix(),U.fromMat4(L,this._worldMatrix)},getParentToNodeTransform:function(L){return L||(L=U.identity()),this._updateLocalMatrix(),N.Mat4.invert(Pt,this._matrix),U.fromMat4(L,Pt)},getWorldToNodeTransform:function(L){return L||(L=U.identity()),this._updateWorldMatrix(),N.Mat4.invert(Pt,this._worldMatrix),U.fromMat4(L,Pt)},convertTouchToNodeSpace:function(L){return this.convertToNodeSpace(L.getLocation())},convertTouchToNodeSpaceAR:function(L){return this.convertToNodeSpaceAR(L.getLocation())},getBoundingBox:function(){this._updateLocalMatrix();var L=this._contentSize.width,D=this._contentSize.height,P=cc.rect(-this._anchorPoint.x*L,-this._anchorPoint.y*D,L,D);return P.transformMat4(P,this._matrix)},getBoundingBoxToWorld:function(){return this._parent?(this._parent._updateWorldMatrix(),this._getBoundingBoxTo()):this.getBoundingBox()},_getBoundingBoxTo:function(){var L=this._contentSize.width,D=this._contentSize.height,P=cc.rect(-this._anchorPoint.x*L,-this._anchorPoint.y*D,L,D);if(this._calculWorldMatrix(),P.transformMat4(P,this._worldMatrix),!this._children)return P;for(var N=this._children,F=0;F<N.length;F++){var B=N[F];if(B&&B.active){var k=B._getBoundingBoxTo();k&&P.union(P,k)}}return P},_updateOrderOfArrival:function(){var L=this._parent?++this._parent._childArrivalOrder:0;this._localZOrder=4294901760&this._localZOrder|L,this.emit(Ut.SIBLING_ORDER_CHANGED)},addChild:function(L,D,P){cc.assertID(L,1606),cc.assertID(null===L._parent,1605),L.parent=this,void 0!==D&&(L.zIndex=D),void 0!==P&&(L.name=P)},cleanup:function(){ut&&cc.director.getActionManager().removeAllActionsFromTarget(this),V.removeListeners(this);var L,D,P=this._children.length;for(L=0;L<P;++L)(D=this._children[L])&&D.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var L=this._children;this._childArrivalOrder=1;for(var D=0,P=L.length;D<P;D++)(F=L[D])._updateOrderOfArrival();if(V._setDirtyForNode(this),L.length>1){for(var N,F,B=1,k=L.length;B<k;B++){for(F=L[B],N=B-1;N>=0&&F._localZOrder<L[N]._localZOrder;)L[N+1]=L[N],N--;L[N+1]=F}this.emit(Ut.CHILD_REORDER,this)}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_restoreProperties:!1,onRestore:!1},Xt=cc.Class(Yt),jt=Xt.prototype;W.getset(jt,"position",jt.getPosition,jt.setPosition,!1,!0),cc.Node=D.exports=Xt},{"./event-manager":104,"./event/event":107,"./event/event-target":106,"./platform/CCMacro":142,"./platform/js":157,"./renderer/render-flow":169,"./utils/affine-transform":202,"./utils/base-node":203,"./utils/prefab-helper":213,"./utils/trans-pool":219,"./value-types":225}],26:[function(L,D,P){"use strict";var N=L("./CCNode"),F=L("./renderer/render-flow"),B=(cc.Object.Flags.HideInHierarchy,N._LocalDirtyFlag),k=cc.Class({name:"cc.PrivateNode",extends:N,properties:{x:{get:function(){return this._originPos.x},set:function(L){var D=this._originPos;L!==D.x&&(D.x=L,this._posDirty(!0))},override:!0},y:{get:function(){return this._originPos.y},set:function(L){var D=this._originPos;L!==D.y&&(D.y=L,this._posDirty(!0))},override:!0},zIndex:{get:function(){return cc.macro.MIN_ZINDEX},set:function(){cc.warnID(1638)},override:!0},showInEditor:{default:!1,editorOnly:!0,override:!0}},ctor:function(L){this._localZOrder=cc.macro.MIN_ZINDEX<<16,this._originPos=cc.v2()},_posDirty:function(L){this.setLocalDirty(B.POSITION),this._renderFlag|=F.FLAG_TRANSFORM,!0===L&&1&this._eventMask&&this.emit(N.EventType.POSITION_CHANGED)},_updateLocalMatrix:function(){if(this._localMatDirty){var L=this.parent;L&&(this._trs[0]=this._originPos.x-(L._anchorPoint.x-.5)*L._contentSize.width,this._trs[1]=this._originPos.y-(L._anchorPoint.y-.5)*L._contentSize.height),this._super()}},getPosition:function(){return new cc.Vec2(this._originPos)},setPosition:function(L,D){void 0===D&&(D=(L=L.x).y);var P=this._originPos;P.x===L&&P.y===D||(P.x=L,P.y=D,this._posDirty(!0))},setParent:function(L){var D=this._parent;this._super(L),D!==L&&(D&&D.off(N.EventType.ANCHOR_CHANGED,this._posDirty,this),L&&L.on(N.EventType.ANCHOR_CHANGED,this._posDirty,this))},_updateOrderOfArrival:function(){}});cc.js.getset(k.prototype,"parent",k.prototype.getParent,k.prototype.setParent),cc.js.getset(k.prototype,"position",k.prototype.getPosition,k.prototype.setPosition),cc.PrivateNode=D.exports=k},{"./CCNode":25,"./renderer/render-flow":169}],27:[function(L,D,P){"use strict";cc.Scene=cc.Class({name:"cc.Scene",extends:L("./CCNode"),properties:{_is3DNode:{default:!0,override:!0},autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){if(cc.Object.prototype.destroy.call(this))for(var L=this._children,D=0;D<L.length;++D)L[D].active=!1;this._active=!1,this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(L){L=!1!==L,cc.director._nodeActivator.activateNode(this,L)}}),D.exports=cc.Scene},{"./CCNode":25}],28:[function(L,D,P){"use strict";var N=L("./platform/js"),F=new(L("./platform/id-generater"))("Scheduler"),s=function(L,D,P,N){this.target=L,this.priority=D,this.paused=P,this.markedForDeletion=N},B=[];s.get=function(L,D,P,N){var F=B.pop();return F?(F.target=L,F.priority=D,F.paused=P,F.markedForDeletion=N):F=new s(L,D,P,N),F},s.put=function(L){B.length<20&&(L.target=null,B.push(L))};var o=function(L,D,P,N){this.list=L,this.entry=D,this.target=P,this.callback=N},k=[];o.get=function(L,D,P,N){var F=k.pop();return F?(F.list=L,F.entry=D,F.target=P,F.callback=N):F=new o(L,D,P,N),F},o.put=function(L){k.length<20&&(L.list=L.entry=L.target=L.callback=null,k.push(L))};var l=function(L,D,P,N,F,B){var k=this;k.timers=L,k.target=D,k.timerIndex=P,k.currentTimer=N,k.currentTimerSalvaged=F,k.paused=B},U=[];function u(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}l.get=function(L,D,P,N,F,B){var k=U.pop();return k?(k.timers=L,k.target=D,k.timerIndex=P,k.currentTimer=N,k.currentTimerSalvaged=F,k.paused=B):k=new l(L,D,P,N,F,B),k},l.put=function(L){U.length<20&&(L.timers=L.target=L.currentTimer=null,U.push(L))};var V=u.prototype;V.initWithCallback=function(L,D,P,N,F,B){return this._lock=!1,this._scheduler=L,this._target=P,this._callback=D,this._elapsed=-1,this._interval=N,this._delay=B,this._useDelay=this._delay>0,this._repeat=F,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},V.getInterval=function(){return this._interval},V.setInterval=function(L){this._interval=L},V.update=function(L){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=L,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},V.getCallback=function(){return this._callback},V.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},V.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var z=[];u.get=function(){return z.pop()||new u},u.put=function(L){z.length<20&&!L._lock&&(L._scheduler=L._target=L._callback=null,z.push(L))},cc.Scheduler=function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=N.createMap(!0),this._hashForTimers=N.createMap(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},cc.Scheduler.prototype={constructor:cc.Scheduler,_removeHashElement:function(L){delete this._hashForTimers[L.target._id];for(var D=this._arrayForTimers,P=0,N=D.length;P<N;P++)if(D[P]===L){D.splice(P,1);break}l.put(L)},_removeUpdateFromHash:function(L){var D=L.target._id,P=this._hashForUpdates[D];if(P){for(var N=P.list,F=P.entry,B=0,k=N.length;B<k;B++)if(N[B]===F){N.splice(B,1);break}delete this._hashForUpdates[D],s.put(F),o.put(P)}},_priorityIn:function(L,D,P){for(var N=0;N<L.length;N++)if(P<L[N].priority)return void L.splice(N,0,D);L.push(D)},_appendIn:function(L,D){L.push(D)},enableForTarget:function(L){L._id||(L.__instanceId?cc.warnID(1513):L._id=F.getNewId())},setTimeScale:function(L){this._timeScale=L},getTimeScale:function(){return this._timeScale},update:function(L){var D,P,N,F;for(this._updateHashLocked=!0,1!==this._timeScale&&(L*=this._timeScale),D=0,N=(P=this._updatesNegList).length;D<N;D++)(F=P[D]).paused||F.markedForDeletion||F.target.update(L);for(D=0,N=(P=this._updates0List).length;D<N;D++)(F=P[D]).paused||F.markedForDeletion||F.target.update(L);for(D=0,N=(P=this._updatesPosList).length;D<N;D++)(F=P[D]).paused||F.markedForDeletion||F.target.update(L);var B,k=this._arrayForTimers;for(D=0;D<k.length;D++){if(B=k[D],this._currentTarget=B,this._currentTargetSalvaged=!1,!B.paused)for(B.timerIndex=0;B.timerIndex<B.timers.length;++B.timerIndex)B.currentTimer=B.timers[B.timerIndex],B.currentTimerSalvaged=!1,B.currentTimer.update(L),B.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--D)}for(D=0,P=this._updatesNegList;D<P.length;)(F=P[D]).markedForDeletion?this._removeUpdateFromHash(F):D++;for(D=0,P=this._updates0List;D<P.length;)(F=P[D]).markedForDeletion?this._removeUpdateFromHash(F):D++;for(D=0,P=this._updatesPosList;D<P.length;)(F=P[D]).markedForDeletion?this._removeUpdateFromHash(F):D++;this._updateHashLocked=!1,this._currentTarget=null},schedule:function(L,D,P,N,F,B){if("function"!=typeof L){var k=L;L=D,D=k}4!==arguments.length&&5!==arguments.length||(B=!!N,N=cc.macro.REPEAT_FOREVER,F=0),cc.assertID(D,1502);var U=D._id;U||(D.__instanceId?(cc.warnID(1513),U=D._id=D.__instanceId):cc.errorID(1510));var V,z,W=this._hashForTimers[U];if(W?W.paused!==B&&cc.warnID(1511):(W=l.get(null,D,0,null,null,B),this._arrayForTimers.push(W),this._hashForTimers[U]=W),null==W.timers)W.timers=[];else for(z=0;z<W.timers.length;++z)if((V=W.timers[z])&&L===V._callback)return cc.logID(1507,V.getInterval(),P),void(V._interval=P);(V=u.get()).initWithCallback(this,L,D,P,N,F),W.timers.push(V),this._currentTarget===W&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(L,D,P){var N=L._id;N||(L.__instanceId?(cc.warnID(1513),N=L._id=L.__instanceId):cc.errorID(1510));var F=this._hashForUpdates[N];if(F&&F.entry){if(F.entry.priority===D)return F.entry.markedForDeletion=!1,void(F.entry.paused=P);if(this._updateHashLocked)return cc.logID(1506),F.entry.markedForDeletion=!1,void(F.entry.paused=P);this.unscheduleUpdate(L)}var B,k=s.get(L,D,P,!1);0===D?(B=this._updates0List,this._appendIn(B,k)):(B=D<0?this._updatesNegList:this._updatesPosList,this._priorityIn(B,k,D)),this._hashForUpdates[N]=o.get(B,k,L,null)},unschedule:function(L,D){if(D&&L){var P=D._id;P||(D.__instanceId?(cc.warnID(1513),P=D._id=D.__instanceId):cc.errorID(1510));var N=this._hashForTimers[P];if(N)for(var F=N.timers,B=0,k=F.length;B<k;B++){var U=F[B];if(L===U._callback)return U!==N.currentTimer||N.currentTimerSalvaged||(N.currentTimerSalvaged=!0),F.splice(B,1),u.put(U),N.timerIndex>=B&&N.timerIndex--,void(0===F.length&&(this._currentTarget===N?this._currentTargetSalvaged=!0:this._removeHashElement(N)))}}},unscheduleUpdate:function(L){if(L){var D=L._id;D||(L.__instanceId?(cc.warnID(1513),D=L._id=L.__instanceId):cc.errorID(1510));var P=this._hashForUpdates[D];P&&(this._updateHashLocked?P.entry.markedForDeletion=!0:this._removeUpdateFromHash(P.entry))}},unscheduleAllForTarget:function(L){if(L){var D=L._id;D||(L.__instanceId?(cc.warnID(1513),D=L._id=L.__instanceId):cc.errorID(1510));var P=this._hashForTimers[D];if(P){var N=P.timers;N.indexOf(P.currentTimer)>-1&&!P.currentTimerSalvaged&&(P.currentTimerSalvaged=!0);for(var F=0,B=N.length;F<B;F++)u.put(N[F]);N.length=0,this._currentTarget===P?this._currentTargetSalvaged=!0:this._removeHashElement(P)}this.unscheduleUpdate(L)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(L){var D,P,N,F=this._arrayForTimers;for(D=F.length-1;D>=0;D--)P=F[D],this.unscheduleAllForTarget(P.target);var B=0;if(L<0)for(D=0;D<this._updatesNegList.length;)B=this._updatesNegList.length,(N=this._updatesNegList[D])&&N.priority>=L&&this.unscheduleUpdate(N.target),B==this._updatesNegList.length&&D++;if(L<=0)for(D=0;D<this._updates0List.length;)B=this._updates0List.length,(N=this._updates0List[D])&&this.unscheduleUpdate(N.target),B==this._updates0List.length&&D++;for(D=0;D<this._updatesPosList.length;)B=this._updatesPosList.length,(N=this._updatesPosList[D])&&N.priority>=L&&this.unscheduleUpdate(N.target),B==this._updatesPosList.length&&D++},isScheduled:function(L,D){cc.assertID(L,1508),cc.assertID(D,1509);var P=D._id;P||(D.__instanceId?(cc.warnID(1513),P=D._id=D.__instanceId):cc.errorID(1510));var N=this._hashForTimers[P];if(!N)return!1;if(null==N.timers)return!1;for(var F=N.timers,B=0;B<F.length;++B)if(L===F[B]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(L){var D,P,N,F,B=[],k=this._arrayForTimers;for(P=0,N=k.length;P<N;P++)(D=k[P])&&(D.paused=!0,B.push(D.target));if(L<0)for(P=0;P<this._updatesNegList.length;P++)(F=this._updatesNegList[P])&&F.priority>=L&&(F.paused=!0,B.push(F.target));if(L<=0)for(P=0;P<this._updates0List.length;P++)(F=this._updates0List[P])&&(F.paused=!0,B.push(F.target));for(P=0;P<this._updatesPosList.length;P++)(F=this._updatesPosList[P])&&F.priority>=L&&(F.paused=!0,B.push(F.target));return B},resumeTargets:function(L){if(L)for(var D=0;D<L.length;D++)this.resumeTarget(L[D])},pauseTarget:function(L){cc.assertID(L,1503);var D=L._id;D||(L.__instanceId?(cc.warnID(1513),D=L._id=L.__instanceId):cc.errorID(1510));var P=this._hashForTimers[D];P&&(P.paused=!0);var N=this._hashForUpdates[D];N&&(N.entry.paused=!0)},resumeTarget:function(L){cc.assertID(L,1504);var D=L._id;D||(L.__instanceId?(cc.warnID(1513),D=L._id=L.__instanceId):cc.errorID(1510));var P=this._hashForTimers[D];P&&(P.paused=!1);var N=this._hashForUpdates[D];N&&(N.entry.paused=!1)},isTargetPaused:function(L){cc.assertID(L,1505);var D=L._id;D||(L.__instanceId?(cc.warnID(1513),D=L._id=L.__instanceId):cc.errorID(1510));var P=this._hashForTimers[D];if(P)return P.paused;var N=this._hashForUpdates[D];return!!N&&N.entry.paused}},cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1,D.exports=cc.Scheduler},{"./platform/id-generater":153,"./platform/js":157}],29:[function(L,D,P){"use strict";var N=L("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:N,ctor:function(){this.loaded=!0,this.url=""},properties:{nativeUrl:{get:function(){if(this._native){var L=this._native;if(47===L.charCodeAt(0))return L.slice(1);if(cc.AssetLibrary){var D=cc.AssetLibrary.getLibUrlNoExt(this._uuid,!0);return 46===L.charCodeAt(0)?D+L:D+"/"+L}cc.errorID(6400)}return""},visible:!1},_native:"",_nativeAsset:{get:function(){return this._$nativeAsset},set:function(L){this._$nativeAsset=L}}},statics:{deserialize:!1,preventDeferredLoadDependents:!1,preventPreloadNativeObject:!1},toString:function(){return this.nativeUrl},serialize:!1,createNode:null,_setRawAsset:function(L,D){this._native=!1!==D?L||void 0:"/"+L}}),D.exports=cc.Asset},{"./CCRawAsset":37}],30:[function(L,D,P){"use strict";var N=L("./CCAsset"),F=L("../event/event-target"),B=cc.Enum({WEB_AUDIO:0,DOM_AUDIO:1}),k=cc.Class({name:"cc.AudioClip",extends:N,mixins:[F],ctor:function(){this.loaded=!1,this._audio=null},properties:{loadMode:{default:B.WEB_AUDIO,type:B},_nativeAsset:{get:function(){return this._audio},set:function(L){L instanceof cc.AudioClip?this._audio=L._nativeAsset:this._audio=L,this._audio&&(this.loaded=!0,this.emit("load"))},override:!0}},statics:{LoadMode:B,_loadByUrl:function(L,D){var P=cc.loader.getItem(L)||cc.loader.getItem(L+"?useDom=1");P&&P.complete?P._owner instanceof k?D(null,P._owner):D(null,P.content):cc.loader.load(L,(function(N,F){if(N)return D(N);P=cc.loader.getItem(L)||cc.loader.getItem(L+"?useDom=1"),D(null,P.content)}))}},destroy:function(){cc.audioEngine.uncache(this),this._super()}});cc.AudioClip=k,D.exports=k},{"../event/event-target":106,"./CCAsset":29}],31:[function(L,D,P){"use strict";var n=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},r=function(L){this._letterDefinitions={},this._texture=L};r.prototype={constructor:r,addLetterDefinitions:function(L,D){this._letterDefinitions[L]=D},cloneLetterDefinition:function(){var L={};for(var D in this._letterDefinitions){var P=new n;cc.js.mixin(P,this._letterDefinitions[D]),L[D]=P}return L},getTexture:function(){return this._texture},getLetter:function(L){return this._letterDefinitions[L]},getLetterDefinitionForChar:function(L){var D=L.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(D)?this._letterDefinitions[D]:null},clear:function(){this._letterDefinitions={}}};var N=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null,_fontDefDictionary:null},onLoad:function(){var L=this.spriteFrame;!this._fontDefDictionary&&L&&(this._fontDefDictionary=new r(L._texture));var D=this._fntConfig;if(D){var P=D.fontDefDictionary;for(var N in P){var F=new n,B=P[N].rect;F.offsetX=P[N].xOffset,F.offsetY=P[N].yOffset,F.w=B.width,F.h=B.height,F.u=B.x,F.v=B.y,F.textureID=0,F.valid=!0,F.xAdvance=P[N].xAdvance,this._fontDefDictionary.addLetterDefinitions(N,F)}}}});cc.BitmapFont=N,cc.BitmapFont.FontLetterDefinition=n,cc.BitmapFont.FontAtlas=r,D.exports=N},{}],32:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.BufferAsset",extends:cc.Asset,ctor:function(){this._buffer=null},properties:{_nativeAsset:{get:function(){return this._buffer},set:function(L){this._buffer=L.buffer||L},override:!0},buffer:function(){return this._buffer}}});cc.BufferAsset=D.exports=N},{}],33:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=D.exports=N},{}],34:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.JsonAsset",extends:cc.Asset,properties:{json:null}});D.exports=cc.JsonAsset=N},{}],35:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont,onLoad:function(){this.spriteFrame?this._fntConfig?this._super():cc.warnID(9101,this.name):cc.warnID(9100,this.name)}});cc.LabelAtlas=N,D.exports=N},{}],36:[function(L,D,P){"use strict";var N=cc.Enum({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),F=cc.Class({name:"cc.Prefab",extends:cc.Asset,ctor:function(){this._createFunction=null,this._instantiatedTimes=0},properties:{data:null,optimizationPolicy:N.AUTO,asyncLoadAssets:!1,readonly:{default:!1,editorOnly:!0}},statics:{OptimizationPolicy:N,OptimizationPolicyThreshold:3},createNode:!1,compileCreateFunction:function(){var D=L("../platform/instantiate-jit");this._createFunction=D.compile(this.data)},_doInstantiate:function(L){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(L)},_instantiate:function(){var L;return this.optimizationPolicy!==N.SINGLE_INSTANCE&&(this.optimizationPolicy===N.MULTI_INSTANCE||this._instantiatedTimes+1>=F.OptimizationPolicyThreshold)?(L=this._doInstantiate(),this.data._instantiate(L)):(this.data._prefab._synced=!0,L=this.data._instantiate()),++this._instantiatedTimes,L},destroy:function(){this.data&&this.data.destroy(),this._super()}});cc.Prefab=D.exports=F,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":155}],37:[function(L,D,P){"use strict";var N=L("../platform/CCObject"),F=L("../platform/js");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:N,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})}}),F.value(cc.RawAsset,"isRawAssetType",(function(L){return F.isChildClassOf(L,cc.RawAsset)&&!F.isChildClassOf(L,cc.Asset)})),F.value(cc.RawAsset,"wasRawAssetType",(function(L){return L===cc.Texture2D||L===cc.AudioClip||L===cc.ParticleAsset||L===cc.Asset})),D.exports=cc.RawAsset},{"../platform/CCObject":143,"../platform/js":157}],38:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../renderer/gfx")),F=L("../renderer"),B=L("./CCTexture2D"),k=cc.Class({name:"cc.RenderTexture",extends:B,ctor:function(){this._framebuffer=null},initWithSize:function(L,D,P){this.width=Math.floor(L||cc.visibleRect.width),this.height=Math.floor(D||cc.visibleRect.height),this._resetUnderlyingMipmaps();var B,k={colors:[this._texture]};this._depthStencilBuffer&&this._depthStencilBuffer.destroy(),P&&(B=new N.default.RenderBuffer(F.device,P,L,D),P===N.default.RB_FMT_D24S8?k.depthStencil=B:P===N.default.RB_FMT_S8?k.stencil=B:P===N.default.RB_FMT_D16&&(k.depth=B)),this._depthStencilBuffer=B,this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=new N.default.FrameBuffer(F.device,L,D,k),this._packable=!1,this.loaded=!0,this.emit("load")},updateSize:function(L,D){this.width=Math.floor(L||cc.visibleRect.width),this.height=Math.floor(D||cc.visibleRect.height),this._resetUnderlyingMipmaps();var P=this._depthStencilBuffer;P&&P.update(this.width,this.height),this._framebuffer._width=L,this._framebuffer._height=D},drawTextureAt:function(L,D,P){L._image&&this._texture.updateSubImage({x:D,y:P,image:L._image,width:L.width,height:L.height,level:0,flipY:!1,premultiplyAlpha:L._premultiplyAlpha})},readPixels:function(L,D,P,N,F){if(!this._framebuffer||!this._texture)return L;D=D||0,P=P||0;var B=N||this.width,k=F||this.height;L=L||new Uint8Array(B*k*4);var U=cc.game._renderContext,V=U.getParameter(U.FRAMEBUFFER_BINDING);return U.bindFramebuffer(U.FRAMEBUFFER,this._framebuffer.getHandle()),U.readPixels(D,P,B,k,U.RGBA,U.UNSIGNED_BYTE,L),U.bindFramebuffer(U.FRAMEBUFFER,V),L},destroy:function(){this._super(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null)}});cc.RenderTexture=D.exports=k},{"../../renderer/gfx":252,"../renderer":168,"./CCTexture2D":45}],39:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=N,D.exports=N},{}],40:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=N;var F=cc.Class({name:"cc.JavaScript",extends:N});cc._JavaScript=F;var B=cc.Class({name:"cc.CoffeeScript",extends:N});cc._CoffeeScript=B;var k=cc.Class({name:"cc.TypeScript",extends:N});cc._TypeScript=k},{}],41:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var L=Object.keys(this._spriteFrames);if(L.length>0){var D=this._spriteFrames[L[0]];return D?D.getTexture():null}return null},getSpriteFrame:function(L){var D=this._spriteFrames[L];return D?(D.name||(D.name=L),D):null},getSpriteFrames:function(){var L=[],D=this._spriteFrames;for(var P in D)L.push(this.getSpriteFrame(P));return L}});cc.SpriteAtlas=N,D.exports=N},{}],42:[function(L,D,P){"use strict";var N=L("../event/event-target"),F=L("../utils/texture-util"),B=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],k=cc.Class({name:"cc.SpriteFrame",extends:L("../assets/CCAsset"),mixins:[N],properties:{_textureSetter:{set:function(L){L&&(this._texture!==L&&this._refreshTexture(L),this._textureFilename=L.url)}},insetTop:{get:function(){return this._capInsets[1]},set:function(L){this._capInsets[1]=L,this._texture&&this._calculateSlicedUV()}},insetBottom:{get:function(){return this._capInsets[3]},set:function(L){this._capInsets[3]=L,this._texture&&this._calculateSlicedUV()}},insetLeft:{get:function(){return this._capInsets[0]},set:function(L){this._capInsets[0]=L,this._texture&&this._calculateSlicedUV()}},insetRight:{get:function(){return this._capInsets[2]},set:function(L){this._capInsets[2]=L,this._texture&&this._calculateSlicedUV()}}},ctor:function(){N.call(this);var L=arguments[0],D=arguments[1],P=arguments[2],F=arguments[3],B=arguments[4];this._rect=null,this.uv=[],this._texture=null,this._original=null,this._offset=null,this._originalSize=null,this._rotated=!1,this._flipX=!1,this._flipY=!1,this.vertices=null,this._capInsets=[0,0,0,0],this.uvSliced=[],this._textureFilename="",void 0!==L&&this.setTexture(L,D,P,F,B)},textureLoaded:function(){return this._texture&&this._texture.loaded},onTextureLoaded:function(L,D){return this.textureLoaded()?(L.call(D),!0):(this.once("load",L,D),this.ensureLoadTexture(),!1)},isRotated:function(){return this._rotated},setRotated:function(L){this._rotated=L,this._texture&&this._calculateUV()},isFlipX:function(){return this._flipX},isFlipY:function(){return this._flipY},setFlipX:function(L){this._flipX=L,this._texture&&this._calculateUV()},setFlipY:function(L){this._flipY=L,this._texture&&this._calculateUV()},getRect:function(){return cc.rect(this._rect)},setRect:function(L){this._rect=L,this._texture&&this._calculateUV()},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(L){this._originalSize?(this._originalSize.width=L.width,this._originalSize.height=L.height):this._originalSize=cc.size(L)},getTexture:function(){return this._texture},_textureLoadedCallback:function(){var L=this._texture;if(L){var D=L.width,P=L.height;this._rect?this._checkRect(this._texture):this._rect=cc.rect(0,0,D,P),this._originalSize||this.setOriginalSize(cc.size(D,P)),this._offset||this.setOffset(cc.v2(0,0)),this._calculateUV(),this.emit("load")}},_refreshTexture:function(L){this._texture=L,L.loaded?this._textureLoadedCallback():L.once("load",this._textureLoadedCallback,this)},getOffset:function(){return cc.v2(this._offset)},setOffset:function(L){this._offset=cc.v2(L)},clone:function(){return new k(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(L,D,P,N,F){this._rect=D||null,N?this.setOffset(N):this._offset=null,F?this.setOriginalSize(F):this._originalSize=null,this._rotated=P||!1;var B=L;return"string"==typeof B&&B&&(this._textureFilename=B,this._loadTexture()),B instanceof cc.Texture2D&&this._texture!==B&&this._refreshTexture(B),!0},_loadTexture:function(){if(this._textureFilename){var L=F.loadImage(this._textureFilename);this._refreshTexture(L)}},ensureLoadTexture:function(){this._texture?this._texture.loaded||(this._refreshTexture(this._texture),F.postLoadTexture(this._texture)):this._textureFilename&&this._loadTexture()},_checkRect:function(L){var D=this._rect,P=D.x,N=D.y;this._rotated?(P+=D.height,N+=D.width):(P+=D.width,N+=D.height),P>L.width&&cc.errorID(3300,L.url+"/"+this.name,P,L.width),N>L.height&&cc.errorID(3400,L.url+"/"+this.name,N,L.height)},_flipXY:function(L){if(this._flipX){var D=L[0];L[0]=L[1],L[1]=D,D=L[2],L[2]=L[3],L[3]=D}if(this._flipY){var P=L[0];L[0]=L[2],L[2]=P,P=L[1],L[1]=L[3],L[3]=P}},_calculateSlicedUV:function(){var L=this._rect,D=this._texture.width,P=this._texture.height,N=this._capInsets[0],F=this._capInsets[2],k=L.width-N-F,U=this._capInsets[1],V=this._capInsets[3],z=L.height-U-V,W=this.uvSliced;if(W.length=0,this._rotated){B[0].u=L.x/D,B[1].u=(L.x+V)/D,B[2].u=(L.x+V+z)/D,B[3].u=(L.x+L.height)/D,B[3].v=L.y/P,B[2].v=(L.y+N)/P,B[1].v=(L.y+N+k)/P,B[0].v=(L.y+L.width)/P,this._flipXY(B);for(var H=0;H<4;++H)for(var G=B[H],X=0;X<4;++X){var nt=B[3-X];W.push({u:G.u,v:nt.v})}}else{B[0].u=L.x/D,B[1].u=(L.x+N)/D,B[2].u=(L.x+N+k)/D,B[3].u=(L.x+L.width)/D,B[3].v=L.y/P,B[2].v=(L.y+U)/P,B[1].v=(L.y+U+z)/P,B[0].v=(L.y+L.height)/P,this._flipXY(B);for(var ut=0;ut<4;++ut)for(var dt=B[ut],ft=0;ft<4;++ft){var _t=B[ft];W.push({u:_t.u,v:dt.v})}}},_setDynamicAtlasFrame:function(L){L&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=L.texture,this._rect.x=L.x,this._rect.y=L.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_calculateUV:function(){var L=this._rect,D=this._texture,P=this.uv,N=D.width,F=D.height;if(this._rotated){var B=0===N?0:L.x/N,k=0===N?0:(L.x+L.height)/N,U=0===F?0:(L.y+L.width)/F,V=0===F?0:L.y/F;P[0]=B,P[1]=V,P[2]=B,P[3]=U,P[4]=k,P[5]=V,P[6]=k,P[7]=U}else{var z=0===N?0:L.x/N,W=0===N?0:(L.x+L.width)/N,H=0===F?0:(L.y+L.height)/F,G=0===F?0:L.y/F;P[0]=z,P[1]=H,P[2]=W,P[3]=H,P[4]=z,P[5]=G,P[6]=W,P[7]=G}if(this._flipX){var X=P[0];P[0]=P[2],P[2]=X,X=P[1],P[1]=P[3],P[3]=X,X=P[4],P[4]=P[6],P[6]=X,X=P[5],P[5]=P[7],P[7]=X}if(this._flipY){var nt=P[0];P[0]=P[4],P[4]=nt,nt=P[1],P[1]=P[5],P[5]=nt,nt=P[2],P[2]=P[6],P[6]=nt,nt=P[3],P[3]=P[7],P[7]=nt}var ut=this.vertices;if(ut){ut.nu.length=0,ut.nv.length=0;for(var dt=0;dt<ut.u.length;dt++)ut.nu[dt]=ut.u[dt]/N,ut.nv[dt]=ut.v[dt]/F}this._calculateSlicedUV()},_serialize:!1,_deserialize:function(L,D){var P=L.rect;P&&(this._rect=new cc.Rect(P[0],P[1],P[2],P[3])),L.offset&&this.setOffset(new cc.Vec2(L.offset[0],L.offset[1])),L.originalSize&&this.setOriginalSize(new cc.Size(L.originalSize[0],L.originalSize[1])),this._rotated=1===L.rotated,this._name=L.name;var N=L.capInsets;N&&(this._capInsets[0]=N[0],this._capInsets[1]=N[1],this._capInsets[2]=N[2],this._capInsets[3]=N[3]),this.vertices=L.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[]);var F=L.texture;F&&D.result.push(this,"_textureSetter",F)}}),U=k.prototype;U.copyWithZone=U.clone,U.copy=U.clone,U.initWithTexture=U.setTexture,cc.SpriteFrame=k,D.exports=k},{"../assets/CCAsset":29,"../event/event-target":106,"../utils/texture-util":218}],43:[function(L,D,P){"use strict";var N=L("./CCFont"),F=cc.Class({name:"cc.TTFFont",extends:N,properties:{_fontFamily:null,_nativeAsset:{type:cc.String,get:function(){return this._fontFamily},set:function(L){this._fontFamily=L||"Arial"},override:!0}}});cc.TTFFont=D.exports=F},{"./CCFont":33}],44:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.TextAsset",extends:cc.Asset,properties:{text:""},toString:function(){return this.text}});D.exports=cc.TextAsset=N},{}],45:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../renderer/gfx")),F=L("../event/event-target"),B=L("../renderer");L("../platform/CCClass");var k=new(L("../platform/id-generater"))("Tex"),U=1024,V=cc.Enum({RGB565:N.default.TEXTURE_FMT_R5_G6_B5,RGB5A1:N.default.TEXTURE_FMT_R5_G5_B5_A1,RGBA4444:N.default.TEXTURE_FMT_R4_G4_B4_A4,RGB888:N.default.TEXTURE_FMT_RGB8,RGBA8888:N.default.TEXTURE_FMT_RGBA8,RGBA32F:N.default.TEXTURE_FMT_RGBA32F,A8:N.default.TEXTURE_FMT_A8,I8:N.default.TEXTURE_FMT_L8,AI8:N.default.TEXTURE_FMT_L8_A8,RGB_PVRTC_2BPPV1:N.default.TEXTURE_FMT_RGB_PVRTC_2BPPV1,RGBA_PVRTC_2BPPV1:N.default.TEXTURE_FMT_RGBA_PVRTC_2BPPV1,RGB_A_PVRTC_2BPPV1:U++,RGB_PVRTC_4BPPV1:N.default.TEXTURE_FMT_RGB_PVRTC_4BPPV1,RGBA_PVRTC_4BPPV1:N.default.TEXTURE_FMT_RGBA_PVRTC_4BPPV1,RGB_A_PVRTC_4BPPV1:U++,RGB_ETC1:N.default.TEXTURE_FMT_RGB_ETC1,RGBA_ETC1:U++,RGB_ETC2:N.default.TEXTURE_FMT_RGB_ETC2,RGBA_ETC2:N.default.TEXTURE_FMT_RGBA_ETC2}),z=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),W=cc.Enum({LINEAR:9729,NEAREST:9728}),H={9728:0,9729:1},G=[],X={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,genMipmaps:void 0,images:void 0,image:void 0,flipY:void 0,premultiplyAlpha:void 0};function _(){for(var L in X)X[L]=void 0;return G.length=0,X.images=G,X.flipY=!1,X}var nt=cc.Class({name:"cc.Texture2D",extends:L("../assets/CCAsset"),mixins:[F],properties:{_nativeAsset:{get:function(){return this._image},set:function(L){L._compressed&&L._data?this.initWithData(L._data,this._format,L.width,L.height):this.initWithElement(L)},override:!0},_format:V.RGBA8888,_premultiplyAlpha:!1,_flipY:!1,_minFilter:W.LINEAR,_magFilter:W.LINEAR,_mipFilter:W.LINEAR,_wrapS:z.CLAMP_TO_EDGE,_wrapT:z.CLAMP_TO_EDGE,_genMipmaps:!1,genMipmaps:{get:function(){return this._genMipmaps},set:function(L){if(this._genMipmaps!==L){var D=_();D.genMipmaps=L,this.update(D)}}},_packable:!0,packable:{get:function(){return this._packable},set:function(L){this._packable=L}}},statics:{PixelFormat:V,WrapMode:z,Filter:W,_FilterIndex:H,extnames:[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm"]},ctor:function(){this._id=k.getNewId(),this.loaded=!1,this.width=0,this.height=0,this._hashDirty=!0,this._hash=0,this._texture=null},getImpl:function(){return this._texture},getId:function(){return this._id},toString:function(){return this.url||""},update:function(L){if(L){var D=!1;void 0!==L.width&&(this.width=L.width),void 0!==L.height&&(this.height=L.height),void 0!==L.minFilter&&(this._minFilter=L.minFilter,L.minFilter=H[L.minFilter]),void 0!==L.magFilter&&(this._magFilter=L.magFilter,L.magFilter=H[L.magFilter]),void 0!==L.mipFilter&&(this._mipFilter=L.mipFilter,L.mipFilter=H[L.mipFilter]),void 0!==L.wrapS&&(this._wrapS=L.wrapS),void 0!==L.wrapT&&(this._wrapT=L.wrapT),void 0!==L.format&&(this._format=L.format),void 0!==L.flipY&&(this._flipY=L.flipY,D=!0),void 0!==L.premultiplyAlpha&&(this._premultiplyAlpha=L.premultiplyAlpha,D=!0),void 0!==L.genMipmaps&&(this._genMipmaps=L.genMipmaps),D&&this._image&&(L.image=this._image),L.images&&L.images.length>0?this._image=L.images[0]:void 0!==L.image&&(this._image=L.image,L.images||(G.length=0,L.images=G),L.images.push(L.image)),L.images&&L.images.length>0&&this._texture.update(L),this._hashDirty=!0}},initWithElement:function(L){if(L)if(this._image=L,L.complete||L instanceof HTMLCanvasElement)this.handleLoadedTexture();else{var D=this;L.addEventListener("load",(function(){D.handleLoadedTexture()})),L.addEventListener("error",(function(L){cc.warnID(3119,L.message)}))}},initWithData:function(L,D,P,N){var F=_();return F.image=L,F.images=[F.image],F.genMipmaps=this._genMipmaps,F.premultiplyAlpha=this._premultiplyAlpha,F.flipY=this._flipY,F.minFilter=H[this._minFilter],F.magFilter=H[this._magFilter],F.wrapS=this._wrapS,F.wrapT=this._wrapT,F.format=this._getGFXPixelFormat(D),F.width=P,F.height=N,this._texture?this._texture.update(F):this._texture=new B.Texture2D(B.device,F),this.width=P,this.height=N,this._checkPackable(),this.loaded=!0,this.emit("load"),!0},getHtmlElementObj:function(){return this._image},destroy:function(){this._packable&&cc.dynamicAtlasManager&&cc.dynamicAtlasManager.deleteAtlasTexture(this),this._image=null,this._texture&&this._texture.destroy(),this._super()},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},handleLoadedTexture:function(){if(this._image&&this._image.width&&this._image.height){this.width=this._image.width,this.height=this._image.height;var L=_();L.image=this._image,L.images=[L.image],L.width=this.width,L.height=this.height,L.genMipmaps=this._genMipmaps,L.format=this._getGFXPixelFormat(this._format),L.premultiplyAlpha=this._premultiplyAlpha,L.flipY=this._flipY,L.minFilter=H[this._minFilter],L.magFilter=H[this._magFilter],L.wrapS=this._wrapS,L.wrapT=this._wrapT,this._texture?this._texture.update(L):this._texture=new B.Texture2D(B.device,L),this._checkPackable(),this.loaded=!0,this.emit("load"),cc.macro.CLEANUP_IMAGE_CACHE&&this._image instanceof HTMLImageElement&&this._clearImage()}},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._image=null,this._texture&&this._texture.destroy()},setWrapMode:function(L,D){if(this._wrapS!==L||this._wrapT!==D){var P=_();P.wrapS=L,P.wrapT=D,this.update(P)}},setFilters:function(L,D){if(this._minFilter!==L||this._magFilter!==D){var P=_();P.minFilter=L,P.magFilter=D,this.update(P)}},setFlipY:function(L){if(this._flipY!==L){var D=_();D.flipY=L,this.update(D)}},setPremultiplyAlpha:function(L){if(this._premultiplyAlpha!==L){var D=_();D.premultiplyAlpha=L,this.update(D)}},_checkPackable:function(){var L=cc.dynamicAtlasManager;if(L)if(this._isCompressed())this._packable=!1;else{var D=this.width,P=this.height;!this._image||D>L.maxFrameSize||P>L.maxFrameSize||this._getHash()!==L.Atlas.DEFAULT_HASH?this._packable=!1:this._image&&this._image instanceof HTMLCanvasElement&&(this._packable=!0)}},_getOpts:function(){var L=_();return L.width=this.width,L.height=this.height,L.genMipmaps=this._genMipmaps,L.format=this._format,L.premultiplyAlpha=this._premultiplyAlpha,L.anisotropy=this._anisotropy,L.flipY=this._flipY,L.minFilter=H[this._minFilter],L.magFilter=H[this._magFilter],L.mipFilter=H[this._mipFilter],L.wrapS=this._wrapS,L.wrapT=this._wrapT,L},_getGFXPixelFormat:function(L){return L===V.RGBA_ETC1?L=V.RGB_ETC1:L===V.RGB_A_PVRTC_4BPPV1?L=V.RGB_PVRTC_4BPPV1:L===V.RGB_A_PVRTC_2BPPV1&&(L=V.RGB_PVRTC_2BPPV1),L},_resetUnderlyingMipmaps:function(L){var D=this._getOpts();D.images=L||[null],this._texture?this._texture.update(D):this._texture=new B.Texture2D(B.device,D)},_serialize:!1,_deserialize:function(L,D){var P=cc.renderer.device,N=L.split(","),F=N[0];if(F){for(var B=F.split("_"),k="",U="",z=999,W=this._format,H=cc.macro.SUPPORT_TEXTURE_FORMATS,G=0;G<B.length;G++){var X=B[G].split("@"),ut=X[0];ut=nt.extnames[ut.charCodeAt(0)-48]||ut;var dt=H.indexOf(ut);if(-1!==dt&&dt<z){var ft=X[1]?parseInt(X[1]):this._format;if(".pvr"===ut&&!P.ext("WEBGL_compressed_texture_pvrtc"))continue;if(!(ft!==V.RGB_ETC1&&ft!==V.RGBA_ETC1||P.ext("WEBGL_compressed_texture_etc1")))continue;if(!(ft!==V.RGB_ETC2&&ft!==V.RGBA_ETC2||P.ext("WEBGL_compressed_texture_etc")))continue;if(".webp"===ut&&!cc.sys.capabilities.webp)continue;z=dt,U=ut,W=ft}else k||(k=ut)}U?(this._setRawAsset(U),this._format=W):(this._setRawAsset(k),cc.warnID(3120,D.customEnv.url,k,k))}8===N.length&&(this._minFilter=parseInt(N[1]),this._magFilter=parseInt(N[2]),this._wrapS=parseInt(N[3]),this._wrapT=parseInt(N[4]),this._premultiplyAlpha=49===N[5].charCodeAt(0),this._genMipmaps=49===N[6].charCodeAt(0),this._packable=49===N[7].charCodeAt(0))},_getHash:function(){if(!this._hashDirty)return this._hash;var L=this._genMipmaps?1:0,D=this._premultiplyAlpha?1:0,P=this._flipY?1:0,N=this._minFilter===W.LINEAR?1:2,F=this._magFilter===W.LINEAR?1:2,B=this._wrapS===z.REPEAT?1:this._wrapS===z.CLAMP_TO_EDGE?2:3,k=this._wrapT===z.REPEAT?1:this._wrapT===z.CLAMP_TO_EDGE?2:3,U=this._format;return this._image,this._hash=Number(""+N+F+U+B+k+L+D+P),this._hashDirty=!1,this._hash},_isCompressed:function(){return this._format<V.A8||this._format>V.RGBA32F},_clearImage:function(){cc.loader.removeItem(this._image.id||this._image.src),this._image.src=""}});cc.Texture2D=D.exports=nt},{"../../renderer/gfx":252,"../assets/CCAsset":29,"../event/event-target":106,"../platform/CCClass":137,"../platform/id-generater":153,"../renderer":168}],46:[function(L,D,P){"use strict";L("./CCRawAsset"),L("./CCAsset"),L("./CCFont"),L("./CCPrefab"),L("./CCAudioClip"),L("./CCScripts"),L("./CCSceneAsset"),L("./CCSpriteFrame"),L("./CCTexture2D"),L("./CCRenderTexture"),L("./CCTTFFont"),L("./CCSpriteAtlas"),L("./CCBitmapFont"),L("./CCLabelAtlas"),L("./CCTextAsset"),L("./CCJsonAsset"),L("./CCBufferAsset"),L("./material")},{"./CCAsset":29,"./CCAudioClip":30,"./CCBitmapFont":31,"./CCBufferAsset":32,"./CCFont":33,"./CCJsonAsset":34,"./CCLabelAtlas":35,"./CCPrefab":36,"./CCRawAsset":37,"./CCRenderTexture":38,"./CCSceneAsset":39,"./CCScripts":40,"./CCSpriteAtlas":41,"./CCSpriteFrame":42,"./CCTTFFont":43,"./CCTextAsset":44,"./CCTexture2D":45,"./material":53}],47:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../CCAsset")),F=L("./effect-parser"),B=cc.Class({name:"cc.EffectAsset",extends:N.default,ctor:function(){this._effect=null},properties:{properties:Object,techniques:[],shaders:[]},onLoad:function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){for(var L=cc.renderer._forward._programLib,D=0;D<this.shaders.length;D++)L.define(this.shaders[D]);this._initEffect()}},_initEffect:function(){this._effect||(this._effect=(0,F.parseEffect)(this),Object.freeze(this._effect))},getInstantiatedEffect:function(){return this._initEffect(),this._effect.clone()},getEffect:function(){return this._initEffect(),this._effect}});D.exports=cc.EffectAsset=B},{"../CCAsset":29,"./effect-parser":50}],48:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../CCAsset"),F=L("../CCTexture2D"),B=F.PixelFormat,k=L("./CCEffectAsset"),U=L("../../utils/texture-util"),V=cc.gfx,z=cc.Enum({SPRITE:"2d-sprite",GRAY_SPRITE:"2d-gray-sprite",UNLIT:"unlit"}),W=cc.Class({name:"cc.Material",extends:N,ctor:function(){this._manualHash=!1,this._dirty=!0,this._effect=null},properties:{_defines:{default:void 0,type:Object},_props:{default:void 0,type:Object},_effectAsset:{type:k,default:null},_techniqueIndex:0,_techniqueData:Object,effectName:void 0,effectAsset:{get:function(){return this._effectAsset},set:function(L){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&(this._effectAsset=L,L?this._effect=this._effectAsset.getInstantiatedEffect():cc.error("Can not set an empty effect asset."))}},effect:{get:function(){return this._effect}},techniqueIndex:{get:function(){return this._techniqueIndex},set:function(L){this._techniqueIndex=L,this._effect.switchTechnique(L)}}},statics:{getBuiltinMaterial:function(L){return cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Material:cc.AssetLibrary.getBuiltin("material","builtin-"+L)},BUILTIN_NAME:z,createWithBuiltin:function(L,D){void 0===D&&(D=0);var P=cc.AssetLibrary.getBuiltin("effect","builtin-"+L);return W.create(P,D)},create:function(L,D){if(void 0===D&&(D=0),!L)return null;var P=new W;return P.effectAsset=L,P.techniqueIndex=D,P}},setProperty:function(L,D,P,N){if(cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS){if("string"==typeof P&&(P=parseInt(P)),D instanceof F){var k=D.getPixelFormat(),V=k===B.RGBA_ETC1||k===B.RGB_A_PVRTC_4BPPV1||k===B.RGB_A_PVRTC_2BPPV1,z="CC_USE_ALPHA_ATLAS_"+L.toUpperCase(),W=this.getDefine(z,P);if((V||W)&&this.define(z,V),!D.loaded)return D.once("load",(function(){this._effect.setProperty(L,D,P)}),this),void U.postLoadTexture(D)}this._effect.setProperty(L,D,P,N)}},getProperty:function(L,D){return"string"==typeof D&&(D=parseInt(D)),this._effect.getProperty(L,D)},define:function(L,D,P,N){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS&&("string"==typeof P&&(P=parseInt(P)),this._effect.define(L,D,P,N))},getDefine:function(L,D){return"string"==typeof D&&(D=parseInt(D)),this._effect.getDefine(L,D)},setCullMode:function(L,D){void 0===L&&(L=V.CULL_BACK),this._effect.setCullMode(L,D)},setDepth:function(L,D,P,N){void 0===L&&(L=!1),void 0===D&&(D=!1),void 0===P&&(P=V.DS_FUNC_LESS),this._effect.setDepth(L,D,P,N)},setBlend:function(L,D,P,N,F,B,k,U,z){void 0===L&&(L=!1),void 0===D&&(D=V.BLEND_FUNC_ADD),void 0===P&&(P=V.BLEND_SRC_ALPHA),void 0===N&&(N=V.BLEND_ONE_MINUS_SRC_ALPHA),void 0===F&&(F=V.BLEND_FUNC_ADD),void 0===B&&(B=V.BLEND_SRC_ALPHA),void 0===k&&(k=V.BLEND_ONE_MINUS_SRC_ALPHA),void 0===U&&(U=4294967295),this._effect.setBlend(L,D,P,N,F,B,k,U,z)},setStencilEnabled:function(L,D){void 0===L&&(L=V.STENCIL_INHERIT),this._effect.setStencilEnabled(L,D)},setStencil:function(L,D,P,N,F,B,k,U,z){void 0===L&&(L=V.STENCIL_INHERIT),void 0===D&&(D=V.DS_FUNC_ALWAYS),void 0===P&&(P=0),void 0===N&&(N=255),void 0===F&&(F=V.STENCIL_OP_KEEP),void 0===B&&(B=V.STENCIL_OP_KEEP),void 0===k&&(k=V.STENCIL_OP_KEEP),void 0===U&&(U=255),this._effect.setStencil(L,D,P,N,F,B,k,U,z)},updateHash:function(L){this._manualHash=L,this._effect&&this._effect.updateHash(L)},getHash:function(){return this._manualHash||this._effect&&this._effect.getHash()},onLoad:function(){if(this.effectAsset=this._effectAsset,this._effect){this._techniqueIndex&&this._effect.switchTechnique(this._techniqueIndex),this._techniqueData=this._techniqueData||{};var L=this._techniqueData;for(var D in L){var P=L[D=parseInt(D)];if(P){for(var N in P.defines)this.define(N,P.defines[N],D);for(var F in P.props)this.setProperty(F,P.props[F],D)}}}}}),H=W;P.default=H,cc.Material=W,D.exports=P.default},{"../../utils/texture-util":218,"../CCAsset":29,"../CCTexture2D":45,"./CCEffectAsset":47}],49:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../renderer/core/pass"));function r(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var F=cc.gfx,B=function(){function t(){this._dirty=!0,this._name="",this._technique=null}var L=t.prototype;return L._createPassProp=function(L,D){var P=D._properties[L];if(P){var N=Object.create(null);return N.name=L,N.type=P.type,P.value instanceof Float32Array?N.value=new Float32Array(P.value):N.value=P.value,D._properties[L]=N,N}},L._setPassProperty=function(L,D,P,F){var B=P._properties.hasOwnProperty(L);if(B){if(B.value===D)return}else B=this._createPassProp(L,P);return this._dirty=!0,N.default.prototype.setProperty.call(P,L,D,F)},L.setProperty=function(L,D,P,N){var F=!1,B=this.passes,k=0,U=B.length;void 0!==P&&(k=P,U=P+1);for(var V=k;V<U;V++)this._setPassProperty(L,D,B[V],N)&&(F=!0);F||cc.warnID(9103,this.name,L)},L.getProperty=function(L,D){var P=this.passes;if(!(D>=P.length)){var N=0,F=P.length;void 0!==D&&(N=D,F=D+1);for(var B=N;B<F;B++){var k=P[B].getProperty(L);if(void 0!==k)return k}}},L.define=function(L,D,P,N){var F=!1,B=this.passes,k=0,U=B.length;void 0!==P&&(k=P,U=P+1);for(var V=k;V<U;V++)B[V].define(L,D,N)&&(F=!0);F||cc.warnID(9104,this.name,L)},L.getDefine=function(L,D){var P=this.passes;if(!(D>=P.length)){var N=0,F=P.length;void 0!==D&&(N=D,F=D+1);for(var B=N;B<F;B++){var k=P[B].getDefine(L);if(void 0!==k)return k}}},L.setCullMode=function(L,D){void 0===L&&(L=F.CULL_BACK);var P=this.passes,N=0,B=P.length;void 0!==D&&(N=D,B=D+1);for(var k=N;k<B;k++)P[k].setCullMode(L);this._dirty=!0},L.setDepth=function(L,D,P,N){var F=this.passes,B=0,k=F.length;void 0!==N&&(B=N,k=N+1);for(var U=B;U<k;U++)F[U].setDepth(L,D,P);this._dirty=!0},L.setBlend=function(L,D,P,N,F,B,k,U,V){var z=this.passes,W=0,H=z.length;void 0!==V&&(W=V,H=V+1);for(var G=W;G<H;G++)z[G].setBlend(L,D,P,N,F,B,k,U);this._dirty=!0},L.setStencilEnabled=function(L,D){void 0===L&&(L=F.STENCIL_INHERIT);var P=this.passes,N=0,B=P.length;void 0!==D&&(N=D,B=D+1);for(var k=N;k<B;k++)P[k].setStencilEnabled(L);this._dirty=!0},L.setStencil=function(L,D,P,N,F,B,k,U,V){var z=this.passes,W=0,H=z.length;void 0!==V&&(W=V,H=V+1);for(var G=W;G<H;G++){var X=z[G];X.setStencilFront(L,D,P,N,F,B,k,U),X.setStencilBack(L,D,P,N,F,B,k,U)}this._dirty=!0},function(L,D,P){D&&r(L.prototype,D),P&&r(L,P)}(t,[{key:"name",get:function(){return this._name}},{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return[]}}]),t}();P.default=B,cc.EffectBase=B,D.exports=P.default},{"../../../renderer/core/pass":243}],50:[function(L,D,P){"use strict";P.__esModule=!0,P.parseEffect=function(L){var D=function(L){for(var D=L.techniques.length,P=new Array(D),F=0;F<D;++F){for(var B=L.techniques[F],k=B.name||F,V=B.passes.length,z=new Array(V),W=0;W<V;++W){var H=B.passes[W],G=H.name||W,X=L.name+"-"+k+"-"+G,nt=H.stage||"opaque",ut=h(L,H),dt=u(H),ft=z[W]=new N.default(G,X,H.program,nt,ut,dt);H.rasterizerState&&ft.setCullMode(H.rasterizerState.cullMode);var _t=H.blendState&&H.blendState.targets[0];_t&&ft.setBlend(_t.blend,_t.blendEq,_t.blendSrc,_t.blendDst,_t.blendAlphaEq,_t.blendSrcAlpha,_t.blendDstAlpha,_t.blendColor);var pt=H.depthStencilState;pt&&(ft.setDepth(pt.depthTest,pt.depthWrite,pt.depthFunc),ft.setStencilFront(pt.stencilTest,pt.stencilFuncFront,pt.stencilRefFront,pt.stencilMaskFront,pt.stencilFailOpFront,pt.stencilZFailOpFront,pt.stencilZPassOpFront,pt.stencilWriteMaskFront),ft.setStencilBack(pt.stencilTest,pt.stencilFuncBack,pt.stencilRefBack,pt.stencilMaskBack,pt.stencilFailOpBack,pt.stencilZFailOpBack,pt.stencilZPassOpBack,pt.stencilWriteMaskBack))}P[F]=new U.default(k,z)}return P}(L);return new k.default(L.name,D,0,L)};var N=c(L("../../../renderer/core/pass")),F=L("../../../renderer/types"),B=c(L("../../../renderer/enums")),k=c(L("./effect")),U=c(L("../../../renderer/core/technique"));function c(L){return L&&L.__esModule?L:{default:L}}function l(L){return cc.renderer._forward._programLib.getTemplate(L)}function h(L,D){var P=D.properties||{},N=l(D.program),a=function(D){if(!N.uniforms.find((function(L){return L.name===D})))return cc.warnID(9107,L.name,D),"continue"};for(var k in P)a(k);var U={};return N.uniforms.forEach((function(L){var D=L.name,N=U[D]=Object.assign({},L),k=P[D],V=F.enums2default[L.type];V=k?k.type===B.default.PARAM_TEXTURE_2D?null:k.type===B.default.PARAM_INT||k.type===B.default.PARAM_FLOAT?Array.isArray(k.value)?k.value[0]:k.value:new Float32Array(k.value):F.enums2default[L.type],N.value=V})),U}function u(L){var D={};return l(L.program).defines.forEach((function(L){D[L.name]=F.enums2default[L.type]})),D}},{"../../../renderer/core/pass":243,"../../../renderer/core/technique":245,"../../../renderer/enums":247,"../../../renderer/types":275,"./effect":52}],51:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=a(L("../../../renderer/murmurhash2_gc")),F=a(L("./utils")),B=a(L("./effect-base"));function a(L){return L&&L.__esModule?L:{default:L}}function o(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}cc.gfx;var k=function(L){function e(D){var P;return(P=L.call(this)||this)._effect=void 0,P._passes=[],P._stagePasses={},P._hash=0,P.init(D),P}(function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D})(e,L),function(L,D,P){D&&o(L.prototype,D),P&&o(L,P)}(e,[{key:"effect",get:function(){return this._effect}},{key:"name",get:function(){return this._effect&&this._effect.name+" (variant)"}},{key:"passes",get:function(){return this._passes}},{key:"stagePasses",get:function(){return this._stagePasses}}]);var D=e.prototype;return D._onEffectChanged=function(){},D.init=function(L){if(L instanceof e&&(L=L.effect),this._effect=L,this._dirty=!0,L){var D=L.passes,P=this._passes;P.length=0;for(var N=this._stagePasses={},F=0;F<D.length;F++){var B=P[F]=Object.setPrototypeOf({},D[F]);B._properties=Object.setPrototypeOf({},D[F]._properties),B._defines=Object.setPrototypeOf({},D[F]._defines),N[B._stage]||(N[B._stage]=[]),N[B._stage].push(B)}}},D.updateHash=function(L){},D.getHash=function(){if(!this._dirty)return this._hash;this._dirty=!1;var L="";L+=F.default.serializePasses(this._passes);var D=this._effect;return D&&(L+=F.default.serializePasses(D.passes)),this._hash=(0,N.default)(L,666),this.updateHash(this._hash),this._hash},e}(B.default);P.default=k,cc.EffectVariant=k,D.exports=P.default},{"../../../renderer/murmurhash2_gc":270,"./effect-base":49,"./utils":56}],52:[function(L,D,P){"use strict";function n(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}P.__esModule=!0,P.default=void 0;var N=function(L){function e(D,P,N,F){var B;return(B=L.call(this)||this)._techniques=[],B._asset=null,B.init(D,P,N,F,!0),B}(function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D})(e,L),function(L,D,P){D&&n(L.prototype,D),P&&n(L,P)}(e,[{key:"technique",get:function(){return this._technique}},{key:"passes",get:function(){return this._technique.passes}}]);var D=e.prototype;return D.init=function(L,D,P,N,F){this._name=L,this._techniques=D,this._technique=D[P],this._asset=N},D.switchTechnique=function(L){L>=this._techniques.length?cc.warn("Can not switch to technique with index ["+L+"]"):this._technique=this._techniques[L]},D.clear=function(){this._techniques=[]},D.clone=function(){for(var L=[],D=0;D<this._techniques.length;D++)L.push(this._techniques[D].clone());var P=this._techniques.indexOf(this._technique);return new e(this._name,L,P,this._asset)},e}(function(L){return L&&L.__esModule?L:{default:L}}(L("./effect-base")).default);P.default=N,cc.Effect=N,D.exports=P.default},{"./effect-base":49}],53:[function(L,D,P){"use strict";L("./CCEffectAsset"),L("./CCMaterial"),L("./material-variant")},{"./CCEffectAsset":47,"./CCMaterial":48,"./material-variant":55}],54:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=s(L("./utils")),F=s(L("../../utils/pool"));function s(L){return L&&L.__esModule?L:{default:L}}var B=new(function(L){function e(){for(var D,P=arguments.length,N=new Array(P),F=0;F<P;F++)N[F]=arguments[F];return(D=L.call.apply(L,[this].concat(N))||this).enabled=!1,D._pool={},D}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.get=function(L,D){var P,F=this._pool;if(L instanceof cc.MaterialVariant){if(!L._owner)return L._owner=D,L;if(L._owner===D)return L;L=L.material}if(this.enabled){var B=L.effectAsset._uuid;if(F[B]){var k=N.default.serializeDefines(L._effect._defines)+N.default.serializeTechniques(L._effect._techniques);P=F[B][k]&&F[B][k].pop()}}return P?this.count--:((P=new cc.MaterialVariant(L))._name=L._name+" (Instance)",P._uuid=L._uuid),P._owner=D,P},D.put=function(L){if(this.enabled&&L._owner){var D=this._pool,P=L.effectAsset._uuid;D[P]||(D[P]={});var F=N.default.serializeDefines(L._effect._defines)+N.default.serializeTechniques(L._effect._techniques);D[P][F]||(D[P][F]=[]),this.count>this.maxSize||(this._clean(L),D[P][F].push(L),this.count++)}},D.clear=function(){this._pool={},this.count=0},D._clean=function(L){L._owner=null},e}(F.default));F.default.register("material",B);var k=B;P.default=k,D.exports=P.default},{"../../utils/pool":212,"./utils":56}],55:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N,F=o(L("./CCMaterial")),B=o(L("./effect-variant")),k=o(L("./material-pool"));function o(L){return L&&L.__esModule?L:{default:L}}function c(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var U=(0,cc._decorator.ccclass)("cc.MaterialVariant")(N=function(L){function e(D){var P;return(P=L.call(this)||this)._owner=null,P._material=null,P.init(D),P}return function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L),e.createWithBuiltin=function(L,D){return e.create(F.default.getBuiltinMaterial(L),D)},e.create=function(L,D){return L?k.default.get(L,D):null},function(L,D,P){D&&c(L.prototype,D),P&&c(L,P)}(e,[{key:"uuid",get:function(){return this._material.uuid}},{key:"owner",get:function(){return this._owner}},{key:"material",get:function(){return this._material}}]),e.prototype.init=function(L){this._effect=new B.default(L.effect),this._effectAsset=L._effectAsset,this._material=L},e}(F.default))||N;P.default=U,cc.MaterialVariant=U,D.exports=P.default},{"./CCMaterial":48,"./effect-variant":51,"./material-pool":54}],56:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../renderer/enums"));function r(L){var D="";for(var P in L)D+=P+L[P];return D}function s(L,D){var P=L._programName+L._cullMode;return L._blend&&(P+=L._blendEq+L._blendAlphaEq+L._blendSrc+L._blendDst+L._blendSrcAlpha+L._blendDstAlpha+L._blendColor),L._depthTest&&(P+=L._depthWrite+L._depthFunc),L._stencilTest&&(P+=L._stencilFuncFront+L._stencilRefFront+L._stencilMaskFront+L._stencilFailOpFront+L._stencilZFailOpFront+L._stencilZPassOpFront+L._stencilWriteMaskFront+L._stencilFuncBack+L._stencilRefBack+L._stencilMaskBack+L._stencilFailOpBack+L._stencilZFailOpBack+L._stencilZPassOpBack+L._stencilWriteMaskBack),D||(P+=a(L._properties)),P+r(L._defines)}function a(L){var D="";for(var P in L){var F=L[P],B=F.value;B&&(F.type===N.default.PARAM_TEXTURE_2D||F.type===N.default.PARAM_TEXTURE_CUBE?D+=B._id+";":D+=B.toString()+";")}return D}var F={serializeDefines:r,serializePasses:function(L){for(var D="",P=0;P<L.length;P++)D+=s(L[P]);return D},serializeUniforms:a};P.default=F,D.exports=P.default},{"../../../renderer/enums":247}],57:[function(L,D,P){"use strict";L("../CCNode").EventType;var N=cc.Enum({ONCE:0,ON_WINDOW_RESIZE:1,ALWAYS:2});var F=cc.Vec2.ZERO,B=cc.Vec2.ONE;function h(L,D){var P,N,k,U=D._target;U?function(L,D,P,N){for(var F=L._parent.scaleX,B=L._parent.scaleY,k=0,U=0,V=L._parent;;){if(k+=V.x,U+=V.y,!(V=V._parent))return P.x=P.y=0,void(N.x=N.y=1);if(V===D)break;var z=V.scaleX,W=V.scaleY;k*=z,U*=W,F*=z,B*=W}N.x=0!==F?1/F:1,N.y=0!==B?1/B:1,P.x=-k,P.y=-U}(L,P=U,N=F,k=B):P=L._parent;var V=function(L){return L instanceof cc.Scene?cc.visibleRect:L._contentSize}(P),z=P._anchorPoint,W=P instanceof cc.Scene,H=L.x,G=L.y,X=L._anchorPoint;if(56&D._alignFlags){var nt,ut,dt=V.width;W?(nt=cc.visibleRect.left.x,ut=cc.visibleRect.right.x):ut=(nt=-z.x*dt)+dt,nt+=D._isAbsLeft?D._left:D._left*dt,ut-=D._isAbsRight?D._right:D._right*dt,U&&(nt+=N.x,nt*=k.x,ut+=N.x,ut*=k.x);var ft,_t=X.x,pt=L.scaleX;if(pt<0&&(_t=1-_t,pt=-pt),D.isStretchWidth)ft=ut-nt,0!==pt&&(L.width=ft/pt),H=nt+_t*ft;else if(ft=L.width*pt,D.isAlignHorizontalCenter){var vt=D._isAbsHorizontalCenter?D._horizontalCenter:D._horizontalCenter*dt,gt=(.5-z.x)*V.width;U&&(vt*=k.x,gt+=N.x,gt*=k.x),H=gt+(_t-.5)*ft+vt}else H=D.isAlignLeft?nt+_t*ft:ut+(_t-1)*ft}if(7&D._alignFlags){var mt,yt,Tt=V.height;W?(yt=cc.visibleRect.bottom.y,mt=cc.visibleRect.top.y):mt=(yt=-z.y*Tt)+Tt,yt+=D._isAbsBottom?D._bottom:D._bottom*Tt,mt-=D._isAbsTop?D._top:D._top*Tt,U&&(yt+=N.y,yt*=k.y,mt+=N.y,mt*=k.y);var xt,St=X.y,bt=L.scaleY;if(bt<0&&(St=1-St,bt=-bt),D.isStretchHeight)xt=mt-yt,0!==bt&&(L.height=xt/bt),G=yt+St*xt;else if(xt=L.height*bt,D.isAlignVerticalCenter){var wt=D._isAbsVerticalCenter?D._verticalCenter:D._verticalCenter*Tt,Rt=(.5-z.y)*V.height;U&&(wt*=k.y,Rt+=N.y,Rt*=k.y),G=Rt+(St-.5)*xt+wt}else G=D.isAlignBottom?yt+St*xt:mt+(St-1)*xt}L.setPosition(H,G)}function d(){var L=cc.director.getScene();if(L){if(U.isAligning=!0,U._nodesOrderDirty)k.length=0,function u(L){var D=L._widget;D&&(h(L,D),D.alignMode!==N.ALWAYS?D.enabled=!1:k.push(D));for(var P=L._children,F=0;F<P.length;F++){var B=P[F];B._active&&u(B)}}(L),U._nodesOrderDirty=!1;else{var D,P=U._activeWidgetsIterator;for(P.i=0;P.i<k.length;++P.i)h((D=k[P.i]).node,D)}U.isAligning=!1}}var k=[],U=cc._widgetManager=D.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(k),init:function(L){if(L.on(cc.Director.EVENT_AFTER_UPDATE,d),cc.sys.isBrowser&&cc.sys.isMobile){var D=this.onResized.bind(this);window.addEventListener("resize",D),window.addEventListener("orientationchange",D)}else cc.view.on("canvas-resize",this.onResized,this)},add:function(L){L.node._widget=L,this._nodesOrderDirty=!0},remove:function(L){L.node._widget=null,this._activeWidgetsIterator.remove(L)},onResized:function(){var L=cc.director.getScene();L&&this.refreshWidgetOnResized(L)},refreshWidgetOnResized:function(L){var D=cc.Node.isNode(L)&&L.getComponent(cc.Widget);D&&D.alignMode===N.ON_WINDOW_RESIZE&&(D.enabled=!0);for(var P=L._children,F=0;F<P.length;F++){var B=P[F];this.refreshWidgetOnResized(B)}},updateAlignment:function t(L){var D=L._parent;cc.Node.isNode(D)&&t(D);var P=L._widget||L.getComponent(cc.Widget);P&&D&&h(L,P)},AlignMode:N}},{"../CCNode":25}],58:[function(L,D,P){"use strict";var N=L("../value-types"),F=L("../geom-utils"),B=L("../utils/affine-transform"),k=L("../renderer/index"),U=L("../renderer/render-flow"),V=L("../CCGame"),z=null;z=L("../../renderer/scene/camera");var W=cc.mat4(),H=cc.mat4(),G=cc.v3(),X=cc.v3(),nt=cc.v3(),ut=[],dt=null;function g(){if(dt){var L=dt.getNode(),D=cc.game.canvas;L.z=D.height/1.1566,L.x=D.width/2,L.y=D.height/2}}var ft=cc.Enum({COLOR:1,DEPTH:2,STENCIL:4}),_t=cc.Enum({OPAQUE:1,TRANSPARENT:2}),pt=cc.Class({name:"cc.Camera",extends:cc.Component,ctor:function(){if(V.renderType!==V.RENDER_TYPE_CANVAS){var L=new z;L.setStages(["opaque"]),L.dirty=!0,this._inited=!1,this._camera=L}else this._inited=!0},editor:!1,properties:{_cullingMask:4294967295,_clearFlags:ft.DEPTH|ft.STENCIL,_backgroundColor:cc.color(0,0,0,255),_depth:0,_zoomRatio:1,_targetTexture:null,_fov:60,_orthoSize:10,_nearClip:1,_farClip:4096,_ortho:!0,_rect:cc.rect(0,0,1,1),_renderStages:1,_alignWithScreen:!0,zoomRatio:{get:function(){return this._zoomRatio},set:function(L){this._zoomRatio=L},tooltip:!1},fov:{get:function(){return this._fov},set:function(L){this._fov=L},tooltip:!1},orthoSize:{get:function(){return this._orthoSize},set:function(L){this._orthoSize=L},tooltip:!1},nearClip:{get:function(){return this._nearClip},set:function(L){this._nearClip=L,this._updateClippingpPlanes()},tooltip:!1},farClip:{get:function(){return this._farClip},set:function(L){this._farClip=L,this._updateClippingpPlanes()},tooltip:!1},ortho:{get:function(){return this._ortho},set:function(L){this._ortho=L,this._updateProjection()},tooltip:!1},rect:{get:function(){return this._rect},set:function(L){this._rect=L,this._updateRect()},tooltip:!1},cullingMask:{get:function(){return this._cullingMask},set:function(L){this._cullingMask=L,this._updateCameraMask()},tooltip:!1},clearFlags:{get:function(){return this._clearFlags},set:function(L){this._clearFlags=L,this._camera&&this._camera.setClearFlags(L)},tooltip:!1},backgroundColor:{get:function(){return this._backgroundColor},set:function(L){this._backgroundColor=L,this._updateBackgroundColor()},tooltip:!1},depth:{get:function(){return this._depth},set:function(L){this._depth=L,this._camera&&this._camera.setPriority(L)},tooltip:!1},targetTexture:{get:function(){return this._targetTexture},set:function(L){this._targetTexture=L,this._updateTargetTexture()},tooltip:!1},renderStages:{get:function(){return this._renderStages},set:function(L){this._renderStages=L,this._updateStages()},tooltip:!1},alignWithScreen:{get:function(){return this._alignWithScreen},set:function(L){this._alignWithScreen=L}},_is3D:{get:function(){return this.node&&this.node._is3DNode}}},statics:{main:null,cameras:ut,ClearFlags:ft,findCamera:function(L){for(var D=0,P=ut.length;D<P;D++){var N=ut[D];if(N.containsNode(L))return N}return null},_findRendererCamera:function(L){for(var D=k.scene._cameras,P=0;P<D._count;P++)if(D._data[P]._cullingMask&L._cullingMask)return D._data[P];return null},_setupDebugCamera:function(){if(!dt&&V.renderType!==V.RENDER_TYPE_CANVAS){var L=new z;dt=L,L.setStages(["opaque"]),L.setFov(60*Math.PI/180),L.setNear(.1),L.setFar(4096),L.dirty=!0,L.cullingMask=1<<cc.Node.BuiltinGroupIndex.DEBUG,L.setPriority(cc.macro.MAX_ZINDEX),L.setClearFlags(0),L.setColor(0,0,0,0);var D=new cc.Node;L.setNode(D),g(),cc.view.on("design-resolution-changed",g),k.scene.addCamera(L)}}},_updateCameraMask:function(){if(this._camera){var L=this._cullingMask&~(1<<cc.Node.BuiltinGroupIndex.DEBUG);this._camera.cullingMask=L}},_updateBackgroundColor:function(){if(this._camera){var L=this._backgroundColor;this._camera.setColor(L.r/255,L.g/255,L.b/255,L.a/255)}},_updateTargetTexture:function(){if(this._camera){var L=this._targetTexture;this._camera.setFrameBuffer(L?L._framebuffer:null)}},_updateClippingpPlanes:function(){this._camera&&(this._camera.setNear(this._nearClip),this._camera.setFar(this._farClip))},_updateProjection:function(){if(this._camera){var L=this._ortho?1:0;this._camera.setType(L)}},_updateRect:function(){if(this._camera){var L=this._rect;this._camera.setRect(L.x,L.y,L.width,L.height)}},_updateStages:function(){var L=this._renderStages,D=[];L&_t.OPAQUE&&D.push("opaque"),L&_t.TRANSPARENT&&D.push("transparent"),this._camera.setStages(D)},_init:function(){if(!this._inited){this._inited=!0;var L=this._camera;L&&(L.setNode(this.node),L.setClearFlags(this._clearFlags),L.setPriority(this._depth),this._updateBackgroundColor(),this._updateCameraMask(),this._updateTargetTexture(),this._updateClippingpPlanes(),this._updateProjection(),this._updateStages(),this._updateRect(),this.beforeDraw())}},onLoad:function(){this._init()},onEnable:function(){V.renderType!==V.RENDER_TYPE_CANVAS&&(cc.director.on(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),k.scene.addCamera(this._camera)),ut.push(this)},onDisable:function(){V.renderType!==V.RENDER_TYPE_CANVAS&&(cc.director.off(cc.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),k.scene.removeCamera(this._camera)),cc.js.array.remove(ut,this)},getScreenToWorldMatrix2D:function(L){return this.getWorldToScreenMatrix2D(L),N.Mat4.invert(L,L),L},getWorldToScreenMatrix2D:function(L){this.node.getWorldRT(W);var D=this.zoomRatio,P=W.m;P[0]*=D,P[1]*=D,P[4]*=D,P[5]*=D;var F=P[12],B=P[13],k=cc.visibleRect.center;return P[12]=k.x-(P[0]*F+P[4]*B),P[13]=k.y-(P[1]*F+P[5]*B),L!==W&&N.Mat4.copy(L,W),L},getScreenToWorldPoint:function(L,D){return this.node.is3DNode?(D=D||new cc.Vec3,this._camera.screenToWorld(D,L,cc.visibleRect.width,cc.visibleRect.height)):(D=D||new cc.Vec2,this.getScreenToWorldMatrix2D(W),N.Vec2.transformMat4(D,L,W)),D},getWorldToScreenPoint:function(L,D){return this.node.is3DNode?(D=D||new cc.Vec3,this._camera.worldToScreen(D,L,cc.visibleRect.width,cc.visibleRect.height)):(D=D||new cc.Vec2,this.getWorldToScreenMatrix2D(W),N.Vec2.transformMat4(D,L,W)),D},getRay:function(L){return cc.geomUtils?(N.Vec3.set(nt,L.x,L.y,1),this._camera.screenToWorld(X,nt,cc.visibleRect.width,cc.visibleRect.height),this.ortho?(N.Vec3.set(nt,L.x,L.y,-1),this._camera.screenToWorld(G,nt,cc.visibleRect.width,cc.visibleRect.height)):this.node.getWorldPosition(G),F.Ray.fromPoints(new F.Ray,G,X)):L},containsNode:function(L){return L._cullingMask&this.cullingMask},render:function(L){if(!(L=L||cc.director.getScene()))return null;this.node.getWorldMatrix(W),this.beforeDraw(),U.render(L),k._forward.renderCamera(this._camera,k.scene)},_onAlignWithScreen:function(){var L=cc.game.canvas.height/cc.view._scaleY;this._targetTexture&&(L=cc.visibleRect.height);var D=this._fov*cc.macro.RAD;this.node.z=L/(2*Math.tan(D/2)),D=2*Math.atan(Math.tan(D/2)/this.zoomRatio),this._camera.setFov(D),this._camera.setOrthoHeight(L/2/this.zoomRatio),this.node.setRotation(0,0,0,1)},beforeDraw:function(){if(this._camera){if(this._alignWithScreen)this._onAlignWithScreen();else{var L=this._fov*cc.macro.RAD;L=2*Math.atan(Math.tan(L/2)/this.zoomRatio),this._camera.setFov(L),this._camera.setOrthoHeight(this._orthoSize/this.zoomRatio)}this._camera.dirty=!0}}});cc.js.mixin(pt.prototype,{getNodeToCameraTransform:function(L){var D=B.identity();return L.getWorldMatrix(H),this.containsNode(L)&&(this.getWorldToCameraMatrix(W),N.Mat4.mul(H,H,W)),B.fromMat4(D,H),D},getCameraToWorldPoint:function(L,D){return this.getScreenToWorldPoint(L,D)},getWorldToCameraPoint:function(L,D){return this.getWorldToScreenPoint(L,D)},getCameraToWorldMatrix:function(L){return this.getScreenToWorldMatrix2D(L)},getWorldToCameraMatrix:function(L){return this.getWorldToScreenMatrix2D(L)}}),D.exports=cc.Camera=pt},{"../../renderer/scene/camera":272,"../CCGame":24,"../geom-utils":void 0,"../renderer/index":168,"../renderer/render-flow":169,"../utils/affine-transform":202,"../value-types":225}],59:[function(L,D,P){"use strict";cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(L){this._offset=L},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(L){this._size.width=L.width<0?0:L.width,this._size.height=L.height<0?0:L.height},type:cc.Size}},resetInEditor:!1});var N=cc.Class({name:"cc.BoxCollider",extends:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=D.exports=N},{}],60:[function(L,D,P){"use strict";cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset},set:function(L){this._offset=L},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(L){this._radius=L<0?0:L}}},resetInEditor:!1});var N=cc.Class({name:"cc.CircleCollider",extends:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=D.exports=N},{}],61:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.Collider",extends:cc.Component,properties:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=D.exports=N},{}],62:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../value-types/vec2")),F=L("./CCContact"),B=F.CollisionType,k=L("../CCNode").EventType,U=new N.default;var V=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1,cc.director._scheduler&&cc.director._scheduler.enableForTarget(this)},update:function(L){if(this.enabled){var D,P,N=this._colliders;for(D=0,P=N.length;D<P;D++)this.updateCollider(N[D]);var F=this._contacts,k=[];for(D=0,P=F.length;D<P;D++){var U=F[D].updateState();U!==B.None&&k.push([U,F[D]])}for(D=0,P=k.length;D<P;D++){var V=k[D];this._doCollide(V[0],V[1])}this.drawColliders()}},_doCollide:function(L,D){var P;switch(L){case B.CollisionEnter:P="onCollisionEnter";break;case B.CollisionStay:P="onCollisionStay";break;case B.CollisionExit:P="onCollisionExit"}var N,F,k,U=D.collider1,V=D.collider2,z=U.node._components,W=V.node._components;for(N=0,F=z.length;N<F;N++)(k=z[N])[P]&&k[P](V,U);for(N=0,F=W.length;N<F;N++)(k=W[N])[P]&&k[P](U,V)},shouldCollide:function(L,D){var P=L.node,N=D.node,F=cc.game.collisionMatrix;return P!==N&&F[P.groupIndex][N.groupIndex]},initCollider:function(L){if(!L.world){var D=L.world={};D.aabb=cc.rect(),D.preAabb=cc.rect(),D.matrix=cc.mat4(),D.radius=0,L instanceof cc.BoxCollider?(D.position=null,D.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):L instanceof cc.PolygonCollider?(D.position=null,D.points=L.points.map((function(L){return cc.v2(L.x,L.y)}))):L instanceof cc.CircleCollider&&(D.position=cc.v2(),D.points=null)}},updateCollider:function(L){var D=L.offset,P=L.world,F=P.aabb,B=P.matrix;L.node.getWorldMatrix(B);var k=P.preAabb;if(k.x=F.x,k.y=F.y,k.width=F.width,k.height=F.height,L instanceof cc.BoxCollider){var V=L.size;F.x=D.x-V.width/2,F.y=D.y-V.height/2,F.width=V.width,F.height=V.height;var z=P.points,W=z[0],H=z[1],G=z[2],X=z[3];!function(L,D,P,N,F,B){var k=L.x,U=L.y,V=L.width,z=L.height,W=D.m,H=W[0],G=W[1],X=W[4],nt=W[5],ut=H*k+X*U+W[12],dt=G*k+nt*U+W[13],ft=H*V,_t=G*V,pt=X*z,vt=nt*z;N.x=ut,N.y=dt,F.x=ft+ut,F.y=_t+dt,P.x=pt+ut,P.y=vt+dt,B.x=ft+pt+ut,B.y=_t+vt+dt}(F,B,W,H,G,X);var nt=Math.min(W.x,H.x,G.x,X.x),ut=Math.min(W.y,H.y,G.y,X.y),dt=Math.max(W.x,H.x,G.x,X.x),ft=Math.max(W.y,H.y,G.y,X.y);F.x=nt,F.y=ut,F.width=dt-nt,F.height=ft-ut}else if(L instanceof cc.CircleCollider){N.default.transformMat4(U,L.offset,B),P.position.x=U.x,P.position.y=U.y;var _t=B.m,pt=_t[12],vt=_t[13];_t[12]=_t[13]=0,U.x=L.radius,U.y=0,N.default.transformMat4(U,U,B);var gt=Math.sqrt(U.x*U.x+U.y*U.y);P.radius=gt,F.x=P.position.x-gt,F.y=P.position.y-gt,F.width=2*gt,F.height=2*gt,_t[12]=pt,_t[13]=vt}else if(L instanceof cc.PolygonCollider){var mt=L.points,yt=P.points;yt.length=mt.length;for(var Tt=1e6,xt=1e6,St=-1e6,bt=-1e6,wt=0,Rt=mt.length;wt<Rt;wt++){yt[wt]||(yt[wt]=cc.v2()),U.x=mt[wt].x+D.x,U.y=mt[wt].y+D.y,N.default.transformMat4(U,U,B);var It=U.x,Mt=U.y;yt[wt].x=It,yt[wt].y=Mt,It>St&&(St=It),It<Tt&&(Tt=It),Mt>bt&&(bt=Mt),Mt<xt&&(xt=Mt)}F.x=Tt,F.y=xt,F.width=St-Tt,F.height=bt-xt}},addCollider:function(L){var D=this._colliders;if(-1===D.indexOf(L)){for(var P=0,N=D.length;P<N;P++){var B=D[P];if(this.shouldCollide(L,B)){var U=new F(L,B);this._contacts.push(U)}}D.push(L),this.initCollider(L)}L.node.on(k.GROUP_CHANGED,this.onNodeGroupChanged,this)},removeCollider:function(L){var D=this._colliders,P=D.indexOf(L);if(P>=0){D.splice(P,1);for(var N=this._contacts,F=N.length-1;F>=0;F--){var U=N[F];U.collider1!==L&&U.collider2!==L||(U.touching&&this._doCollide(B.CollisionExit,U),N.splice(F,1))}L.node.off(k.GROUP_CHANGED,this.onNodeGroupChanged,this)}else cc.errorID(6600)},onNodeGroupChanged:function(L){for(var D=L.getComponents(cc.Collider),P=0,N=D.length;P<N;P++){var F=D[P];cc.PhysicsCollider&&F instanceof cc.PhysicsCollider||(this.removeCollider(F),this.addCollider(F))}},drawColliders:function(){if(this._enabledDebugDraw){this._checkDebugDrawValid();var L=this._debugDrawer;L.clear();for(var D=this._colliders,P=0,N=D.length;P<N;P++){var F=D[P];if(L.strokeColor=cc.Color.WHITE,F instanceof cc.BoxCollider||F instanceof cc.PolygonCollider){var B=F.world.points;if(B.length>0){L.moveTo(B[0].x,B[0].y);for(var k=1;k<B.length;k++)L.lineTo(B[k].x,B[k].y);L.close(),L.stroke()}}else F instanceof cc.CircleCollider&&(L.circle(F.world.position.x,F.world.position.y,F.world.radius),L.stroke());if(this.enabledDrawBoundingBox){var U=F.world.aabb;L.strokeColor=cc.Color.BLUE,L.moveTo(U.xMin,U.yMin),L.lineTo(U.xMin,U.yMax),L.lineTo(U.xMax,U.yMax),L.lineTo(U.xMax,U.yMin),L.close(),L.stroke()}}}},_checkDebugDrawValid:function(){if(!this._debugDrawer||!this._debugDrawer.isValid){var L=new cc.Node("COLLISION_MANAGER_DEBUG_DRAW");L.zIndex=cc.macro.MAX_ZINDEX,cc.game.addPersistRootNode(L),this._debugDrawer=L.addComponent(cc.Graphics)}}});cc.js.getset(V.prototype,"enabledDebugDraw",(function(){return this._enabledDebugDraw}),(function(L){L&&!this._enabledDebugDraw?(this._checkDebugDrawValid(),this._debugDrawer.node.active=!0):!L&&this._enabledDebugDraw&&(this._debugDrawer.clear(!0),this._debugDrawer.node.active=!1),this._enabledDebugDraw=L})),cc.CollisionManager=D.exports=V},{"../CCNode":25,"../value-types/vec2":234,"./CCContact":63}],63:[function(L,D,P){"use strict";var N=L("./CCIntersection"),F=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});function s(L,D){this.collider1=L,this.collider2=D,this.touching=!1;var P=L instanceof cc.BoxCollider||L instanceof cc.PolygonCollider,F=D instanceof cc.BoxCollider||D instanceof cc.PolygonCollider,B=L instanceof cc.CircleCollider,k=D instanceof cc.CircleCollider;P&&F?this.testFunc=N.polygonPolygon:B&&k?this.testFunc=N.circleCircle:P&&k?this.testFunc=N.polygonCircle:B&&F?(this.testFunc=N.polygonCircle,this.collider1=D,this.collider2=L):cc.errorID(6601,cc.js.getClassName(L),cc.js.getClassName(D))}s.prototype.test=function(){var L=this.collider1.world,D=this.collider2.world;return!!L.aabb.intersects(D.aabb)&&(this.testFunc===N.polygonPolygon?this.testFunc(L.points,D.points):this.testFunc===N.circleCircle?this.testFunc(L,D):this.testFunc===N.polygonCircle&&this.testFunc(L.points,D))},s.prototype.updateState=function(){var L=this.test(),D=F.None;return L&&!this.touching?(this.touching=!0,D=F.CollisionEnter):L&&this.touching?D=F.CollisionStay:!L&&this.touching&&(this.touching=!1,D=F.CollisionExit),D},s.CollisionType=F,D.exports=s},{"./CCIntersection":64}],64:[function(L,D,P){"use strict";var N={};function r(L,D,P,N){var F=(N.x-P.x)*(L.y-P.y)-(N.y-P.y)*(L.x-P.x),B=(D.x-L.x)*(L.y-P.y)-(D.y-L.y)*(L.x-P.x),k=(N.y-P.y)*(D.x-L.x)-(N.x-P.x)*(D.y-L.y);if(0!==k){var U=F/k,V=B/k;if(0<=U&&U<=1&&0<=V&&V<=1)return!0}return!1}function s(L,D,P){for(var N=P.length,F=0;F<N;++F)if(r(L,D,P[F],P[(F+1)%N]))return!0;return!1}function a(L,D){for(var P=!1,N=L.x,F=L.y,B=D.length,k=0,U=B-1;k<B;U=k++){var V=D[k].x,z=D[k].y,W=D[U].x,H=D[U].y;z>F!=H>F&&N<(W-V)*(F-z)/(H-z)+V&&(P=!P)}return P}function o(L,D,P,N){var F,B=P.x-D.x,k=P.y-D.y,U=B*B+k*k,V=((L.x-D.x)*B+(L.y-D.y)*k)/U;return F=N?U?V<0?D:V>1?P:cc.v2(D.x+V*B,D.y+V*k):D:cc.v2(D.x+V*B,D.y+V*k),B=L.x-F.x,k=L.y-F.y,Math.sqrt(B*B+k*k)}N.lineLine=r,N.lineRect=function(L,D,P){var N=new cc.Vec2(P.x,P.y),F=new cc.Vec2(P.x,P.yMax),B=new cc.Vec2(P.xMax,P.yMax),k=new cc.Vec2(P.xMax,P.y);return!!(r(L,D,N,F)||r(L,D,F,B)||r(L,D,B,k)||r(L,D,k,N))},N.linePolygon=s,N.rectRect=function(L,D){var P=L.x,N=L.y,F=L.x+L.width,B=L.y+L.height,k=D.x,U=D.y,V=D.x+D.width,z=D.y+D.height;return P<=V&&F>=k&&N<=z&&B>=U},N.rectPolygon=function(L,D){var P,N,F=new cc.Vec2(L.x,L.y),B=new cc.Vec2(L.x,L.yMax),k=new cc.Vec2(L.xMax,L.yMax),U=new cc.Vec2(L.xMax,L.y);if(s(F,B,D))return!0;if(s(B,k,D))return!0;if(s(k,U,D))return!0;if(s(U,F,D))return!0;for(P=0,N=D.length;P<N;++P)if(a(D[P],L))return!0;return!!(a(F,D)||a(B,D)||a(k,D)||a(U,D))},N.polygonPolygon=function(L,D){var P,N;for(P=0,N=L.length;P<N;++P)if(s(L[P],L[(P+1)%N],D))return!0;for(P=0,N=D.length;P<N;++P)if(a(D[P],L))return!0;for(P=0,N=L.length;P<N;++P)if(a(L[P],D))return!0;return!1},N.circleCircle=function(L,D){return L.position.sub(D.position).mag()<L.radius+D.radius},N.polygonCircle=function(L,D){var P=D.position;if(a(P,L))return!0;for(var N=0,F=L.length;N<F;N++)if(o(P,0===N?L[L.length-1]:L[N-1],L[N],!0)<D.radius)return!0;return!1},N.pointInPolygon=a,N.pointLineDistance=o,cc.Intersection=D.exports=N},{}],65:[function(L,D,P){"use strict";cc.Collider.Polygon=cc.Class({properties:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(L){this._offset=L},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var N=cc.Class({name:"cc.PolygonCollider",extends:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=D.exports=N},{}],66:[function(L,D,P){"use strict";L("./CCCollisionManager"),L("./CCCollider"),L("./CCBoxCollider"),L("./CCCircleCollider"),L("./CCPolygonCollider")},{"./CCBoxCollider":59,"./CCCircleCollider":60,"./CCCollider":61,"./CCCollisionManager":62,"./CCPolygonCollider":65}],67:[function(L,D,P){"use strict";L("./platform/CCClass");var N=L("./platform/CCObject").Flags,F=L("./platform/js").array,B=N.IsStartCalled,k=N.IsOnEnableCalled;function o(L,D){for(var P=D.constructor._executionOrder,N=D._id,F=0,B=L.length-1,k=B>>>1;F<=B;k=F+B>>>1){var U=L[k],V=U.constructor._executionOrder;if(V>P)B=k-1;else if(V<P)F=k+1;else{var z=U._id;if(z>N)B=k-1;else{if(!(z<N))return k;F=k+1}}}return~F}function c(L,D){for(var P=L.array,N=L.i+1;N<P.length;){var F=P[N];F._enabled&&F.node._activeInHierarchy?++N:(L.removeAt(N),D&&(F._objFlags&=~D))}}N.IsEditorOnEnableCalled;var U=cc.Class({__ctor__:function(L){var D=F.MutableForwardIterator;this._zero=new D([]),this._neg=new D([]),this._pos=new D([]),this._invoke=L},statics:{stableRemoveInactive:c},add:null,remove:null,invoke:null});function h(L,D){return L.constructor._executionOrder-D.constructor._executionOrder}var V=cc.Class({extends:U,add:function(L){var D=L.constructor._executionOrder;(0===D?this._zero:D<0?this._neg:this._pos).array.push(L)},remove:function(L){var D=L.constructor._executionOrder;(0===D?this._zero:D<0?this._neg:this._pos).fastRemove(L)},cancelInactive:function(L){c(this._zero,L),c(this._neg,L),c(this._pos,L)},invoke:function(){var L=this._neg;L.array.length>0&&(L.array.sort(h),this._invoke(L),L.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var D=this._pos;D.array.length>0&&(D.array.sort(h),this._invoke(D),D.array.length=0)}}),z=cc.Class({extends:U,add:function(L){var D=L.constructor._executionOrder;if(0===D)this._zero.array.push(L);else{var P=D<0?this._neg.array:this._pos.array,N=o(P,L);N<0&&P.splice(~N,0,L)}},remove:function(L){var D=L.constructor._executionOrder;if(0===D)this._zero.fastRemove(L);else{var P=D<0?this._neg:this._pos,N=o(P.array,L);N>=0&&P.removeAt(N)}},invoke:function(L){this._neg.array.length>0&&this._invoke(this._neg,L),this._invoke(this._zero,L),this._pos.array.length>0&&this._invoke(this._pos,L)}});function f(L,D,P,N){var F="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+L+"}";return N=D?Function("it","dt",F):Function("it",F),L=Function("c","dt",L),function(D,F){try{N(D,F)}catch(N){cc._throw(N);var B=D.array;for(P&&(B[D.i]._objFlags|=P),++D.i;D.i<B.length;++D.i)try{L(B[D.i],F)}catch(L){cc._throw(L),P&&(B[D.i]._objFlags|=P)}}}}var W=f("c.start();c._objFlags|="+B,!1,B),H=f("c.update(dt)",!0),G=f("c.lateUpdate(dt)",!0);function g(){this.startInvoker=new V(W),this.updateInvoker=new z(H),this.lateUpdateInvoker=new z(G),this.scheduleInNextFrame=[],this._updating=!1}var X=cc.Class({ctor:g,unscheduleAll:g,statics:{LifeCycleInvoker:U,OneOffInvoker:V,createInvokeImpl:f,invokeOnEnable:function(L){var D=cc.director._compScheduler,P=L.array;for(L.i=0;L.i<P.length;++L.i){var N=P[L.i];N._enabled&&(N.onEnable(),!N.node._activeInHierarchy||D._onEnabled(N))}}},_onEnabled:function(L){cc.director.getScheduler().resumeTarget(L),L._objFlags|=k,this._updating?this.scheduleInNextFrame.push(L):this._scheduleImmediate(L)},_onDisabled:function(L){cc.director.getScheduler().pauseTarget(L),L._objFlags&=~k;var D=this.scheduleInNextFrame.indexOf(L);D>=0?F.fastRemoveAt(this.scheduleInNextFrame,D):(!L.start||L._objFlags&B||this.startInvoker.remove(L),L.update&&this.updateInvoker.remove(L),L.lateUpdate&&this.lateUpdateInvoker.remove(L))},enableComp:function(L,D){if(!(L._objFlags&k)){if(L.onEnable){if(D)return void D.add(L);if(L.onEnable(),!L.node._activeInHierarchy)return}this._onEnabled(L)}},disableComp:function(L){L._objFlags&k&&(L.onDisable&&L.onDisable(),this._onDisabled(L))},_scheduleImmediate:function(L){!L.start||L._objFlags&B||this.startInvoker.add(L),L.update&&this.updateInvoker.add(L),L.lateUpdate&&this.lateUpdateInvoker.add(L)},_deferredSchedule:function(){for(var L=this.scheduleInNextFrame,D=0,P=L.length;D<P;D++){var N=L[D];this._scheduleImmediate(N)}L.length=0},_earlyStartForNewComps:function(){this.scheduleInNextFrame.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},startPhase:function(){this._updating=!0,this.scheduleInNextFrame.length>0&&this._deferredSchedule(),this.startInvoker.invoke(),this._earlyStartForNewComps()},updatePhase:function(L){this.updateInvoker.invoke(L)},lateUpdatePhase:function(L){this.lateUpdateInvoker.invoke(L),this._updating=!1},clearup:function(){this._earlyStartForNewComps()}});D.exports=X},{"./platform/CCClass":137,"./platform/CCObject":143,"./platform/js":157,"./utils/misc":210}],68:[function(L,D,P){"use strict";var N=L("../../animation/animation-animator"),F=L("../../animation/animation-clip"),B=L("../event/event-target"),k=L("../platform/js"),o=function(L,D){return L===D},U=cc.Enum({PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"}),V=cc.Class({name:"cc.Animation",extends:L("./CCComponent"),mixins:[B],editor:!1,statics:{EventType:U},ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState=k.createMap(!0),this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:F},defaultClip:{type:F,get:function(){return this._defaultClip},set:function(L){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(L){this._currentClip=L},type:F,visible:!1},_writableClips:{get:function(){return this._clips},set:function(L){this._didInit=!1,this._clips=L,this._init()},type:[F]},_clips:{default:[],type:[F],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip&&(!this._animator||!this._animator.isPlaying)){var L=this.getAnimationState(this._defaultClip.name);this._animator.playState(L)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(L,D){var P=this.playAdditive(L,D);return this._animator.stopStatesExcept(P),P},playAdditive:function(L,D){this._init();var P=this.getAnimationState(L||this._defaultClip&&this._defaultClip.name);if(P){this.enabled=!0;var N=this._animator;N.isPlaying&&P.isPlaying?P.isPaused?N.resumeState(P):(N.stopState(P),N.playState(P,D)):N.playState(P,D),this.enabledInHierarchy||N.pause(),this.currentClip=P.clip}return P},stop:function(L){if(this._didInit)if(L){var D=this._nameToState[L];D&&this._animator.stopState(D)}else this._animator.stop()},pause:function(L){if(this._didInit)if(L){var D=this._nameToState[L];D&&this._animator.pauseState(D)}else this.enabled=!1},resume:function(L){if(this._didInit)if(L){var D=this._nameToState[L];D&&this._animator.resumeState(D)}else this.enabled=!0},setCurrentTime:function(L,D){if(this._init(),D){var P=this._nameToState[D];P&&this._animator.setStateTime(P,L)}else this._animator.setStateTime(L)},getAnimationState:function(L){this._init();var D=this._nameToState[L];return D&&!D.curveLoaded&&this._animator._reloadClip(D),D||null},addClip:function(L,D){if(L){this._init(),cc.js.array.contains(this._clips,L)||this._clips.push(L),D=D||L.name;var P=this._nameToState[D];if(P){if(P.clip===L)return P;var N=this._clips.indexOf(P.clip);-1!==N&&this._clips.splice(N,1)}var F=new cc.AnimationState(L,D);return this._nameToState[D]=F,F}cc.warnID(3900)},removeClip:function(L,D){if(L){var P;for(var N in this._init(),this._nameToState)if(P=this._nameToState[N],o(P.clip,L))break;if(L===this._defaultClip){if(!D)return void cc.warnID(3902);this._defaultClip=null}if(P&&P.isPlaying){if(!D)return void cc.warnID(3903);this.stop(P.name)}this._clips=this._clips.filter((function(D){return!o(D,L)})),P&&delete this._nameToState[P.name]}else cc.warnID(3901)},sample:function(L){if(this._init(),L){var D=this._nameToState[L];D&&D.sample()}else this._animator.sample()},on:function(L,D,P,N){this._init();var F=this._EventTargetOn(L,D,P,N);if("lastframe"===L){var B=this._nameToState;for(var k in B)B[k]._lastframeEventOn=!0}return F},off:function(L,D,P,N){if(this._init(),"lastframe"===L){var F=this._nameToState;for(var B in F)F[B]._lastframeEventOn=!1}this._EventTargetOff(L,D,P,N)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new N(this.node,this),this._createStates())},_createStates:function(){this._nameToState=k.createMap(!0);for(var L=null,D=!1,P=0;P<this._clips.length;++P){var N=this._clips[P];N&&(L=new cc.AnimationState(N),this._nameToState[L.name]=L,o(this._defaultClip,N)&&(D=L))}this._defaultClip&&!D&&(L=new cc.AnimationState(this._defaultClip),this._nameToState[L.name]=L)}});V.prototype._EventTargetOn=B.prototype.on,V.prototype._EventTargetOff=B.prototype.off,cc.Animation=D.exports=V},{"../../animation/animation-animator":9,"../../animation/animation-clip":10,"../event/event-target":106,"../platform/js":157,"./CCComponent":73}],69:[function(L,D,P){"use strict";var N=L("../utils/misc"),F=L("./CCComponent"),B=L("../assets/CCAudioClip"),k=cc.Class({name:"cc.AudioSource",extends:F,editor:!1,ctor:function(){this.audio=new cc.Audio},properties:{_clip:{default:null,type:B},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return this.audio.getState()===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(L){if("string"!=typeof L)L!==this._clip&&(this._clip=L,this.audio.stop(),this.preload&&(this.audio.src=this._clip));else{cc.warnID(8401,"cc.AudioSource","cc.AudioClip","AudioClip","cc.AudioClip","audio");var D=this;B._loadByUrl(L,(function(L,P){P&&(D.clip=P)}))}},type:B,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(L){return L=N.clamp01(L),this._volume=L,this._mute||this.audio.setVolume(L),L},tooltip:!1},mute:{get:function(){return this._mute},set:function(L){return this._mute=L,this.audio.setVolume(L?0:this._volume),L},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(L){return this._loop=L,this.audio.setLoop(L),L},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_ensureDataLoaded:function(){this.audio.src!==this._clip&&(this.audio.src=this._clip)},_pausedCallback:function(){this.audio.getState()===cc.Audio.State.PLAYING&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1},onLoad:function(){this.audio.setVolume(this._mute?0:this._volume),this.audio.setLoop(this._loop)},onEnable:function(){this.preload&&(this.audio.src=this._clip),this.playOnLoad&&this.play(),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip)},play:function(){if(this._clip){var L=this.audio;this._clip.loaded&&L.stop(),this._ensureDataLoaded(),L.setCurrentTime(0),L.play()}},stop:function(){this.audio.stop()},pause:function(){this.audio.pause()},resume:function(){this._ensureDataLoaded(),this.audio.resume()},rewind:function(){this.audio.setCurrentTime(0)},getCurrentTime:function(){return this.audio.getCurrentTime()},setCurrentTime:function(L){return this.audio.setCurrentTime(L),L},getDuration:function(){return this.audio.getDuration()}});cc.AudioSource=D.exports=k},{"../assets/CCAudioClip":30,"../utils/misc":210,"./CCComponent":73}],70:[function(L,D,P){"use strict";var N=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function r(L){L.stopPropagation()}var F=cc.Class({name:"cc.BlockInputEvents",extends:L("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block_input_events"},onEnable:function(){for(var L=0;L<N.length;L++)this.node.on(N[L],r,this)},onDisable:function(){for(var L=0;L<N.length;L++)this.node.off(N[L],r,this)}});cc.BlockInputEvents=D.exports=F},{"./CCComponent":73}],71:[function(L,D,P){"use strict";var N=L("./CCComponent"),F=L("../utils/gray-sprite-state"),B=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),k=cc.Enum({NORMAL:0,HOVER:1,PRESSED:2,DISABLED:3}),U=cc.Class({name:"cc.Button",extends:N,mixins:[F],ctor:function(){this._pressed=!1,this._hovered=!1,this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=cc.Vec2.ZERO,this._toScale=cc.Vec2.ZERO,this._originalScale=null,this._graySpriteMaterial=null,this._spriteMaterial=null,this._sprite=null},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(L){L&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:B.NONE,tooltip:!1,type:B,animatable:!1,notify:function(L){this._updateTransition(L)},formerlySerializedAs:"transition"},normalColor:{default:cc.Color.WHITE,displayName:"Normal",tooltip:!1,notify:function(){this.transition===B.Color&&this._getButtonState()===k.NORMAL&&(this._getTarget().opacity=this.normalColor.a),this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1,notify:function(){this.transition===B.Color&&this._getButtonState()===k.PRESSED&&(this._getTarget().opacity=this.pressedColor.a),this._updateState()},formerlySerializedAs:"pressedColor"},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1,notify:function(){this.transition===B.Color&&this._getButtonState()===k.HOVER&&(this._getTarget().opacity=this.hoverColor.a),this._updateState()},formerlySerializedAs:"hoverColor"},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this.transition===B.Color&&this._getButtonState()===k.DISABLED&&(this._getTarget().opacity=this.disabledColor.a),this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(L){this._applyTarget(),L&&this.target!==L&&this._unregisterTargetEvent(L)}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:B},__preload:function(){this._applyTarget(),this._resetState()},_resetState:function(){this._pressed=!1,this._hovered=!1;var L=this._getTarget(),D=this.transition,P=this._originalScale;D===B.COLOR&&this.interactable?this._setTargetColor(this.normalColor):D===B.SCALE&&P&&L.setScale(P.x,P.y),this._transitionFinished=!0},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerNodeEvent()},onDisable:function(){this._resetState(),this._unregisterNodeEvent()},_getTarget:function(){return this.target?this.target:this.node},_onTargetSpriteFrameChanged:function(L){this.transition===B.SPRITE&&this._setCurrentStateSprite(L.spriteFrame)},_onTargetColorChanged:function(L){this.transition===B.COLOR&&this._setCurrentStateColor(L)},_onTargetScaleChanged:function(){var L=this._getTarget();this._originalScale&&(this.transition!==B.SCALE||this._transitionFinished)&&(this._originalScale.x=L.scaleX,this._originalScale.y=L.scaleY)},_setTargetColor:function(L){var D=this._getTarget();D.color=L,D.opacity=L.a},_getStateColor:function(L){switch(L){case k.NORMAL:return this.normalColor;case k.HOVER:return this.hoverColor;case k.PRESSED:return this.pressedColor;case k.DISABLED:return this.disabledColor}},_getStateSprite:function(L){switch(L){case k.NORMAL:return this.normalSprite;case k.HOVER:return this.hoverSprite;case k.PRESSED:return this.pressedSprite;case k.DISABLED:return this.disabledSprite}},_setCurrentStateColor:function(L){switch(this._getButtonState()){case k.NORMAL:this.normalColor=L;break;case k.HOVER:this.hoverColor=L;break;case k.PRESSED:this.pressedColor=L;break;case k.DISABLED:this.disabledColor=L}},_setCurrentStateSprite:function(L){switch(this._getButtonState()){case k.NORMAL:this.normalSprite=L;break;case k.HOVER:this.hoverSprite=L;break;case k.PRESSED:this.pressedSprite=L;break;case k.DISABLED:this.disabledSprite=L}},update:function(L){var D=this._getTarget();if(!this._transitionFinished&&(this.transition===B.COLOR||this.transition===B.SCALE)){this.time+=L;var P=1;if(this.duration>0&&(P=this.time/this.duration),P>=1&&(P=1),this.transition===B.COLOR){var N=this._fromColor.lerp(this._toColor,P);this._setTargetColor(N)}else this.transition===B.SCALE&&this._originalScale&&(D.scale=this._fromScale.lerp(this._toScale,P));1===P&&(this._transitionFinished=!0)}},_registerNodeEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_unregisterNodeEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_registerTargetEvent:function(L){L.on(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_unregisterTargetEvent:function(L){L.off(cc.Node.EventType.SCALE_CHANGED,this._onTargetScaleChanged,this)},_getTargetSprite:function(L){var D=null;return L&&(D=L.getComponent(cc.Sprite)),D},_applyTarget:function(){var L=this._getTarget();this._sprite=this._getTargetSprite(L),this._originalScale||(this._originalScale=cc.Vec2.ZERO),this._originalScale.x=L.scaleX,this._originalScale.y=L.scaleY,this._registerTargetEvent(L)},_onTouchBegan:function(L){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),L.stopPropagation())},_onTouchMove:function(L){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var D,P=L.touch,N=this.node._hitTest(P.getLocation()),F=this._getTarget(),U=this._originalScale;this.transition===B.SCALE&&U?N?(this._fromScale.x=U.x,this._fromScale.y=U.y,this._toScale.x=U.x*this.zoomScale,this._toScale.y=U.y*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,F.setScale(U.x,U.y)):(D=N?k.PRESSED:k.NORMAL,this._applyTransition(D)),L.stopPropagation()}},_onTouchEnded:function(L){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,L),this.node.emit("click",this)),this._pressed=!1,this._updateState(),L.stopPropagation())},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==B.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var L=this._getButtonState();this._applyTransition(L),this._updateDisabledState()},_getButtonState:function(){return this.interactable?this._pressed?k.PRESSED:this._hovered?k.HOVER:k.NORMAL:k.DISABLED},_updateColorTransitionImmediately:function(L){var D=this._getStateColor(L);this._setTargetColor(D),this._fromColor=D.clone(),this._toColor=D},_updateColorTransition:function(L){if(L===k.DISABLED)this._updateColorTransitionImmediately(L);else{var D=this._getTarget(),P=this._getStateColor(L);this._fromColor=D.color.clone(),this._toColor=P,this.time=0,this._transitionFinished=!1}},_updateSpriteTransition:function(L){var D=this._getStateSprite(L);this._sprite&&D&&(this._sprite.spriteFrame=D)},_updateScaleTransition:function(L){L===k.PRESSED?this._zoomUp():this._zoomBack()},_zoomUp:function(){this._originalScale&&(this._fromScale.x=this._originalScale.x,this._fromScale.y=this._originalScale.y,this._toScale.x=this._originalScale.x*this.zoomScale,this._toScale.y=this._originalScale.y*this.zoomScale,this.time=0,this._transitionFinished=!1)},_zoomBack:function(){if(this._originalScale){var L=this._getTarget();this._fromScale.x=L.scaleX,this._fromScale.y=L.scaleY,this._toScale.x=this._originalScale.x,this._toScale.y=this._originalScale.y,this.time=0,this._transitionFinished=!1}},_updateTransition:function(L){L===B.COLOR?this._updateColorTransitionImmediately(k.NORMAL):L===B.SPRITE&&this._updateSpriteTransition(k.NORMAL),this._updateState()},_applyTransition:function(L){var D=this.transition;D===B.COLOR?this._updateColorTransition(L):D===B.SPRITE?this._updateSpriteTransition(L):D===B.SCALE&&this._updateScaleTransition(L)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){if(this._sprite){var L=!1;this.enableAutoGrayEffect&&(this.transition===B.SPRITE&&this.disabledSprite||this.interactable||(L=!0)),this._switchGrayMaterial(L,this._sprite)}}});cc.Button=D.exports=U},{"../utils/gray-sprite-state":208,"./CCComponent":73}],72:[function(L,D,P){"use strict";var N=L("../camera/CCCamera"),F=L("./CCComponent"),B=cc.Class({name:"cc.Canvas",extends:F,editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(L){this._designResolution.width=L.width,this._designResolution.height=L.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(L){this._fitHeight!==L&&(this._fitHeight=L,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(L){this._fitWidth!==L&&(this._fitWidth=L,this.applySettings())},tooltip:!1}},_fitDesignResolution:!1,__preload:function(){if(B.instance)return cc.errorID(6700,this.node.name,B.instance.node.name);B.instance=this,this.applySettings();var L=this.getComponent(cc.Widget);L&&L.updateAlignment();var D=cc.find("Main Camera",this.node);D||((D=new cc.Node("Main Camera")).parent=this.node,D.setSiblingIndex(0));var P=D.getComponent(N);if(!P){P=D.addComponent(N);var F=N.ClearFlags;P.clearFlags=F.COLOR|F.DEPTH|F.STENCIL,P.depth=-1}N.main=P},onDestroy:function(){B.instance===this&&(B.instance=null)},applySettings:function(){var L,D=cc.ResolutionPolicy;L=this.fitHeight&&this.fitWidth?D.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?D.FIXED_WIDTH:D.FIXED_HEIGHT:D.NO_BORDER;var P=this._designResolution;cc.view.setDesignResolutionSize(P.width,P.height,L)}});cc.Canvas=D.exports=B},{"../camera/CCCamera":58,"./CCComponent":73}],73:[function(L,D,P){"use strict";var N=L("../platform/CCObject"),F=L("../platform/js"),B=new(L("../platform/id-generater"))("Comp"),k=(N.Flags.IsOnEnableCalled,N.Flags.IsOnLoadCalled),U=cc.Class({name:"cc.Component",extends:N,ctor:function(){this._id=B.getNewId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var L=cc.js.getClassName(this),D=L.lastIndexOf(".");return D>=0&&(L=L.slice(D+1)),this.node.name+"<"+L+">"},set:function(L){this._name=L},visible:!1},uuid:{get:function(){return this._id},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(L){if(this._enabled!==L&&(this._enabled=L,this.node._activeInHierarchy)){var D=cc.director._compScheduler;L?D.enableComp(this):D.disableComp(this)}},visible:!1,animatable:!0},enabledInHierarchy:{get:function(){return this._enabled&&this.node._activeInHierarchy},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&k}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(L){return this.node.addComponent(L)},getComponent:function(L){return this.node.getComponent(L)},getComponents:function(L){return this.node.getComponents(L)},getComponentInChildren:function(L){return this.node.getComponentInChildren(L)},getComponentsInChildren:function(L){return this.node.getComponentsInChildren(L)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){this.unscheduleAllCallbacks();for(var L=this.__eventTargets,D=L.length-1;D>=0;--D){var P=L[D];P&&P.targetOff(this)}L.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(L){return L||(L=cc.instantiate._clone(this,this)),L.node=null,L},schedule:function(L,D,P,N){cc.assertID(L,1619),D=D||0,cc.assertID(D>=0,1620),P=isNaN(P)?cc.macro.REPEAT_FOREVER:P,N=N||0;var F=cc.director.getScheduler(),B=F.isTargetPaused(this);F.schedule(L,this,D,P,N,B)},scheduleOnce:function(L,D){this.schedule(L,0,0,D)},unschedule:function(L){L&&cc.director.getScheduler().unschedule(L,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});U._requireComponent=null,U._executionOrder=0,F.value(U,"_registerEditorProps",(function(L,D){var P=D.requireComponent;P&&(L._requireComponent=P);var N=D.executionOrder;N&&"number"==typeof N&&(L._executionOrder=N)})),U.prototype.__scriptUuid="",cc.Component=D.exports=U},{"../platform/CCObject":143,"../platform/id-generater":153,"../platform/js":157}],74:[function(L,D,P){"use strict";cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:"",_componentId:"",_componentName:{get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(L){this._componentId=this._compName2Id(L)}},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(L){var D;if(arguments.length>0)for(var P=0,N=(D=new Array(arguments.length-1)).length;P<N;P++)D[P]=arguments[P+1];for(var F=0,B=L.length;F<B;F++){var k=L[F];k instanceof cc.Component.EventHandler&&k.emit(D)}}},emit:function(L){var D=this.target;if(cc.isValid(D)){this._genCompIdIfNeeded();var P=cc.js._getClassById(this._componentId),N=D.getComponent(P);if(cc.isValid(N)){var F=N[this.handler];"function"==typeof F&&(null!=this.customEventData&&""!==this.customEventData&&(L=L.slice()).push(this.customEventData),F.apply(N,L))}}},_compName2Id:function(L){var D=cc.js.getClassByName(L);return cc.js._getClassId(D)},_compId2Name:function(L){var D=cc.js._getClassById(L);return cc.js.getClassName(D)},_genCompIdIfNeeded:function(){this._componentId||(this._componentName=this.component,this.component="")}})},{}],75:[function(L,D,P){"use strict";var N=L("../platform/CCMacro"),F=L("./CCRenderComponent"),B=(L("../assets/material/CCMaterial"),L("../renderer/utils/label/label-frame")),k=N.TextAlignment,U=N.VerticalTextAlignment,V=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3}),z=cc.Enum({NONE:0,BITMAP:1,CHAR:2}),W=cc.Class({name:"cc.Label",extends:F,ctor:function(){this._actualFontSize=0,this._assemblerData=null,this._frame=null,this._ttfTexture=null,this._letterTexture=null,cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?this._updateMaterial=this._updateMaterialCanvas:this._updateMaterial=this._updateMaterialWebgl},editor:!1,properties:{_useOriginalSize:!0,_string:{default:"",formerlySerializedAs:"_N$string"},string:{get:function(){return this._string},set:function(L){var D=this._string;this._string=""+L,this.string!==D&&this.setVertsDirty(),this._checkStringEmpty()},multiline:!0,tooltip:!1},horizontalAlign:{default:k.LEFT,type:k,tooltip:!1,notify:function(L){this.horizontalAlign!==L&&this.setVertsDirty()},animatable:!1},verticalAlign:{default:U.TOP,type:U,tooltip:!1,notify:function(L){this.verticalAlign!==L&&this.setVertsDirty()},animatable:!1},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._actualFontSize},tooltip:!1},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(L){this._fontSize!==L&&(this._fontSize=L,this.setVertsDirty())},range:[0,512],tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(L){this.fontFamily!==L&&this.setVertsDirty()},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._lineHeight},set:function(L){this._lineHeight!==L&&(this._lineHeight=L,this.setVertsDirty())},tooltip:!1},overflow:{default:V.NONE,type:V,tooltip:!1,notify:function(L){this.overflow!==L&&this.setVertsDirty()},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._enableWrapText},set:function(L){this._enableWrapText!==L&&(this._enableWrapText=L,this.setVertsDirty())},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(L){this.font!==L&&(L||(this._isSystemFontUsed=!0),this._N$file=L,L&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),"string"==typeof L&&cc.warnID(4e3),this.enabledInHierarchy&&this._forceUpdateRenderData())},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(L){if(this._isSystemFontUsed!==L){if(this._isSystemFontUsed=!!L,L){if(this.font=null,!this.enabledInHierarchy)return;this._forceUpdateRenderData()}this.markForValidate()}},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",get:function(){return this._N$file instanceof cc.BitmapFont?this._N$file.fontSize:-1},visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(L){this._spacingX=L,this.setVertsDirty()},tooltip:!1},_batchAsBitmap:!1,cacheMode:{default:z.NONE,type:z,tooltip:!1,notify:function(L){this.cacheMode!==L&&(L!==z.BITMAP||this.font instanceof cc.BitmapFont||this._frame&&this._frame._resetDynamicAtlasFrame(),L===z.CHAR&&(this._ttfTexture=null),this.enabledInHierarchy&&this._forceUpdateRenderData())},animatable:!1},_styleFlags:0,enableBold:{get:function(){return!!(1&this._styleFlags)},set:function(L){L?this._styleFlags|=1:this._styleFlags&=-2,this.setVertsDirty()},animatable:!1,tooltip:!1},enableItalic:{get:function(){return!!(2&this._styleFlags)},set:function(L){L?this._styleFlags|=2:this._styleFlags&=-3,this.setVertsDirty()},animatable:!1,tooltip:!1},enableUnderline:{get:function(){return!!(4&this._styleFlags)},set:function(L){L?this._styleFlags|=4:this._styleFlags&=-5,this.setVertsDirty()},animatable:!1,tooltip:!1},_underlineHeight:0,underlineHeight:{get:function(){return this._underlineHeight},set:function(L){this._underlineHeight!==L&&(this._underlineHeight=L,this.setVertsDirty())},tooltip:!1}},statics:{HorizontalAlign:k,VerticalAlign:U,Overflow:V,CacheMode:z,_shareAtlas:null,clearCharCache:function(){W._shareAtlas&&W._shareAtlas.clearAllCache()}},onLoad:function(){this._batchAsBitmap&&this.cacheMode===z.NONE&&(this.cacheMode=z.BITMAP,this._batchAsBitmap=!1),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&(this.cacheMode=z.NONE)},onEnable:function(){this._super(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this._forceUpdateRenderData()},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDestroy:function(){this._assembler&&this._assembler._resetAssemblerData&&this._assembler._resetAssemblerData(this._assemblerData),this._assemblerData=null,this._letterTexture=null,this._ttfTexture&&(this._ttfTexture.destroy(),this._ttfTexture=null),this._super()},_nodeSizeChanged:function(){this.overflow!==V.NONE&&this.setVertsDirty()},_updateColor:function(){this.font instanceof cc.BitmapFont||this.setVertsDirty(),F.prototype._updateColor.call(this)},_validateRender:function(){if(this.string){if(this._materials[0]){var L=this.font;if(!(L instanceof cc.BitmapFont))return;var D=L.spriteFrame;if(D&&D.textureLoaded()&&L._fntConfig)return}this.disableRender()}else this.disableRender()},_resetAssembler:function(){this._frame=null,F.prototype._resetAssembler.call(this)},_checkStringEmpty:function(){this.markForRender(!!this.string)},_on3DNodeChanged:function(){this._resetAssembler(),this._applyFontTexture()},_onBMFontTextureLoaded:function(){this._frame._texture=this.font.spriteFrame._texture,this.markForRender(!0),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this)},_applyFontTexture:function(){var L=this.font;if(L instanceof cc.BitmapFont){var D=L.spriteFrame;this._frame=D,D&&D.onTextureLoaded(this._onBMFontTextureLoaded,this)}else this._frame||(this._frame=new B),this.cacheMode===z.CHAR?(this._letterTexture=this._assembler._getAssemblerData(),this._frame._refreshTexture(this._letterTexture)):this._ttfTexture||(this._ttfTexture=new cc.Texture2D,this._assemblerData=this._assembler._getAssemblerData(),this._ttfTexture.initWithElement(this._assemblerData.canvas)),this.cacheMode!==z.CHAR&&(this._frame._resetDynamicAtlasFrame(),this._frame._refreshTexture(this._ttfTexture)),this._updateMaterial(),this._assembler&&this._assembler.updateRenderData(this);this.markForValidate()},_updateMaterialCanvas:function(){this._frame&&(this._frame._texture.url=this.uuid+"_texture")},_updateMaterialWebgl:function(){if(this._frame){var L=this.getMaterial(0);L&&L.setProperty("texture",this._frame._texture)}},_forceUpdateRenderData:function(){this.setVertsDirty(),this._resetAssembler(),this._applyFontTexture()},_enableBold:function(L){this.enableBold=!!L},_enableItalics:function(L){this.enableItalic=!!L},_enableUnderline:function(L){this.enableUnderline=!!L}});cc.Label=D.exports=W},{"../assets/material/CCMaterial":48,"../platform/CCMacro":142,"../renderer/utils/label/label-frame":173,"./CCRenderComponent":84}],76:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.LabelOutline",extends:L("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_width:1,color:{tooltip:!1,get:function(){return this._color},set:function(L){this._color=L,this._updateRenderData()}},width:{tooltip:!1,get:function(){return this._width},set:function(L){this._width!==L&&(this._width=L,this._updateRenderData())},range:[0,512]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var L=this.node.getComponent(cc.Label);L&&L.setVertsDirty()}});cc.LabelOutline=D.exports=N},{"./CCComponent":73}],77:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.LabelShadow",extends:L("./CCComponent"),editor:!1,properties:{_color:cc.Color.WHITE,_offset:cc.v2(2,2),_blur:2,color:{tooltip:!1,get:function(){return this._color},set:function(L){this._color=L,this._updateRenderData()}},offset:{tooltip:!1,get:function(){return this._offset},set:function(L){this._offset=L,this._updateRenderData()}},blur:{tooltip:!1,get:function(){return this._blur},set:function(L){this._blur=L,this._updateRenderData()},range:[0,1024]}},onEnable:function(){this._updateRenderData()},onDisable:function(){this._updateRenderData()},_updateRenderData:function(){var L=this.node.getComponent(cc.Label);L&&L.markForRender(!0)}});cc.LabelShadow=D.exports=N},{"./CCComponent":73}],78:[function(L,D,P){"use strict";var N=L("../CCNode").EventType,F=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),B=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),k=cc.Enum({HORIZONTAL:0,VERTICAL:1}),U=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),V=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),z=cc.Class({name:"cc.Layout",extends:L("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:B.NONE,_N$layoutType:F.NONE,type:{type:F,get:function(){return this._N$layoutType},set:function(L){this._N$layoutType=L,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:B,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(L){this.type===F.NONE&&L===B.CHILDREN||(this._resize=L,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:k.HORIZONTAL,tooltip:!1,type:k,notify:function(){this._doLayoutDirty()},animatable:!1},_N$padding:{default:0},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:U.TOP_TO_BOTTOM,type:U,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:V.LEFT_TO_RIGHT,type:V,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},affectedByScale:{default:!1,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:!1}},statics:{Type:F,VerticalDirection:U,HorizontalDirection:V,ResizeMode:B,AxisDirection:k},_migratePaddingData:function(){this.paddingLeft=this._N$padding,this.paddingRight=this._N$padding,this.paddingTop=this._N$padding,this.paddingBottom=this._N$padding,this._N$padding=0},onEnable:function(){this._addEventListeners(),this.node.getContentSize().equals(cc.size(0,0))&&this.node.setContentSize(this._layoutSize),0!==this._N$padding&&this._migratePaddingData(),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_doScaleDirty:function(){this._layoutDirty=this._layoutDirty||this.affectedByScale},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(N.SIZE_CHANGED,this._resized,this),this.node.on(N.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(N.CHILD_ADDED,this._childAdded,this),this.node.on(N.CHILD_REMOVED,this._childRemoved,this),this.node.on(N.CHILD_REORDER,this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(N.SIZE_CHANGED,this._resized,this),this.node.off(N.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(N.CHILD_ADDED,this._childAdded,this),this.node.off(N.CHILD_REMOVED,this._childRemoved,this),this.node.off(N.CHILD_REORDER,this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){for(var L=this.node.children,D=0;D<L.length;++D){var P=L[D];P.on(N.SCALE_CHANGED,this._doScaleDirty,this),P.on(N.SIZE_CHANGED,this._doLayoutDirty,this),P.on(N.POSITION_CHANGED,this._doLayoutDirty,this),P.on(N.ANCHOR_CHANGED,this._doLayoutDirty,this),P.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_removeChildrenEventListeners:function(){for(var L=this.node.children,D=0;D<L.length;++D){var P=L[D];P.off(N.SCALE_CHANGED,this._doScaleDirty,this),P.off(N.SIZE_CHANGED,this._doLayoutDirty,this),P.off(N.POSITION_CHANGED,this._doLayoutDirty,this),P.off(N.ANCHOR_CHANGED,this._doLayoutDirty,this),P.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}},_childAdded:function(L){L.on(N.SCALE_CHANGED,this._doScaleDirty,this),L.on(N.SIZE_CHANGED,this._doLayoutDirty,this),L.on(N.POSITION_CHANGED,this._doLayoutDirty,this),L.on(N.ANCHOR_CHANGED,this._doLayoutDirty,this),L.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(L){L.off(N.SCALE_CHANGED,this._doScaleDirty,this),L.off(N.SIZE_CHANGED,this._doLayoutDirty,this),L.off(N.POSITION_CHANGED,this._doLayoutDirty,this),L.off(N.ANCHOR_CHANGED,this._doLayoutDirty,this),L.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(L,D,P,N){var k=this.node.getAnchorPoint(),z=this.node.children,W=1,H=this.paddingLeft,G=-k.x*L;this.horizontalDirection===V.RIGHT_TO_LEFT&&(W=-1,G=(1-k.x)*L,H=this.paddingRight);for(var X=G+W*H-W*this.spacingX,nt=0,ut=0,dt=0,ft=0,_t=0,pt=0,vt=0,gt=0;gt<z.length;++gt)(yt=z[gt]).activeInHierarchy&&vt++;var mt=this.cellSize.width;for(this.type!==F.GRID&&this.resizeMode===B.CHILDREN&&(mt=(L-(this.paddingLeft+this.paddingRight)-(vt-1)*this.spacingX)/vt),gt=0;gt<z.length;++gt){var yt=z[gt],Tt=this._getUsedScaleValue(yt.scaleX),xt=this._getUsedScaleValue(yt.scaleY);if(yt.activeInHierarchy){this._resize===B.CHILDREN&&(yt.width=mt/Tt,this.type===F.GRID&&(yt.height=this.cellSize.height/xt));var St=yt.anchorX,bt=yt.width*Tt,wt=yt.height*xt;dt>ut&&(ut=dt),wt>=ut&&(dt=ut,ut=wt,pt=yt.getAnchorPoint().y),this.horizontalDirection===V.RIGHT_TO_LEFT&&(St=1-yt.anchorX),X=X+W*St*bt+W*this.spacingX;var Rt=W*(1-St)*bt;if(D){var It=X+Rt+W*(W>0?this.paddingRight:this.paddingLeft),Mt=this.horizontalDirection===V.LEFT_TO_RIGHT&&It>(1-k.x)*L,Ot=this.horizontalDirection===V.RIGHT_TO_LEFT&&It<-k.x*L;(Mt||Ot)&&(wt>=ut?(0===dt&&(dt=ut),nt+=dt,dt=ut):(nt+=ut,dt=wt,ut=0),X=G+W*(H+St*bt),ft++)}var Lt=P(yt,nt,ft);L>=bt+this.paddingLeft+this.paddingRight&&N&&yt.setPosition(cc.v2(X,Lt));var Dt,Pt=1,Nt=0===ut?wt:ut;this.verticalDirection===U.TOP_TO_BOTTOM?(_t=_t||this.node._contentSize.height,(Dt=Lt+(Pt=-1)*(Nt*pt+this.paddingBottom))<_t&&(_t=Dt)):(_t=_t||-this.node._contentSize.height,(Dt=Lt+Pt*(Nt*pt+this.paddingTop))>_t&&(_t=Dt)),X+=Rt}}return _t},_getVerticalBaseHeight:function(L){var D=0,P=0;if(this.resizeMode===B.CONTAINER){for(var N=0;N<L.length;++N){var F=L[N];F.activeInHierarchy&&(P++,D+=F.height*this._getUsedScaleValue(F.scaleY))}D+=(P-1)*this.spacingY+this.paddingBottom+this.paddingTop}else D=this.node.getContentSize().height;return D},_doLayoutVertically:function(L,D,P,N){var k=this.node.getAnchorPoint(),z=this.node.children,W=1,H=this.paddingBottom,G=-k.y*L;this.verticalDirection===U.TOP_TO_BOTTOM&&(W=-1,G=(1-k.y)*L,H=this.paddingTop);for(var X=G+W*H-W*this.spacingY,nt=0,ut=0,dt=0,ft=0,_t=0,pt=0,vt=0,gt=0;gt<z.length;++gt)(yt=z[gt]).activeInHierarchy&&vt++;var mt=this.cellSize.height;for(this.type!==F.GRID&&this.resizeMode===B.CHILDREN&&(mt=(L-(this.paddingTop+this.paddingBottom)-(vt-1)*this.spacingY)/vt),gt=0;gt<z.length;++gt){var yt=z[gt],Tt=this._getUsedScaleValue(yt.scaleX),xt=this._getUsedScaleValue(yt.scaleY);if(yt.activeInHierarchy){this.resizeMode===B.CHILDREN&&(yt.height=mt/xt,this.type===F.GRID&&(yt.width=this.cellSize.width/Tt));var St=yt.anchorY,bt=yt.width*Tt,wt=yt.height*xt;dt>ut&&(ut=dt),bt>=ut&&(dt=ut,ut=bt,pt=yt.getAnchorPoint().x),this.verticalDirection===U.TOP_TO_BOTTOM&&(St=1-yt.anchorY),X=X+W*St*wt+W*this.spacingY;var Rt=W*(1-St)*wt;if(D){var It=X+Rt+W*(W>0?this.paddingTop:this.paddingBottom),Mt=this.verticalDirection===U.BOTTOM_TO_TOP&&It>(1-k.y)*L,Ot=this.verticalDirection===U.TOP_TO_BOTTOM&&It<-k.y*L;(Mt||Ot)&&(bt>=ut?(0===dt&&(dt=ut),nt+=dt,dt=ut):(nt+=ut,dt=bt,ut=0),X=G+W*(H+St*wt),ft++)}var Lt=P(yt,nt,ft);L>=wt+(this.paddingTop+this.paddingBottom)&&N&&yt.setPosition(cc.v2(Lt,X));var Dt,Pt=1,Nt=0===ut?bt:ut;this.horizontalDirection===V.RIGHT_TO_LEFT?(Pt=-1,_t=_t||this.node._contentSize.width,(Dt=Lt+Pt*(Nt*pt+this.paddingLeft))<_t&&(_t=Dt)):(_t=_t||-this.node._contentSize.width,(Dt=Lt+Pt*(Nt*pt+this.paddingRight))>_t&&(_t=Dt)),X+=Rt}}return _t},_doLayoutBasic:function(){for(var L=this.node.children,D=null,P=0;P<L.length;++P){var N=L[P];N.activeInHierarchy&&(D?D.union(D,N.getBoundingBoxToWorld()):D=N.getBoundingBoxToWorld())}if(D){var F=this.node.convertToNodeSpaceAR(cc.v2(D.x,D.y));F=cc.v2(F.x-this.paddingLeft,F.y-this.paddingBottom);var B=this.node.convertToNodeSpaceAR(cc.v2(D.xMax,D.yMax)),k=(B=cc.v2(B.x+this.paddingRight,B.y+this.paddingTop)).sub(F);if(0!==(k=cc.size(parseFloat(k.x.toFixed(2)),parseFloat(k.y.toFixed(2)))).width){var U=-F.x/k.width;this.node.anchorX=parseFloat(U.toFixed(2))}if(0!==k.height){var V=-F.y/k.height;this.node.anchorY=parseFloat(V.toFixed(2))}this.node.setContentSize(k)}},_doLayoutGridAxisHorizontal:function(L,D){var P=D.width,N=1,F=-L.y*D.height,k=this.paddingBottom;this.verticalDirection===U.TOP_TO_BOTTOM&&(N=-1,F=(1-L.y)*D.height,k=this.paddingTop);var V=function(L,D,P){return F+N*(D+L.anchorY*L.height*this._getUsedScaleValue(L.scaleY)+k+P*this.spacingY)}.bind(this),z=0;if(this.resizeMode===B.CONTAINER){var W=this._doLayoutHorizontally(P,!0,V,!1);(z=F-W)<0&&(z*=-1),F=-L.y*z,this.verticalDirection===U.TOP_TO_BOTTOM&&(N=-1,F=(1-L.y)*z)}this._doLayoutHorizontally(P,!0,V,!0),this.resizeMode===B.CONTAINER&&this.node.setContentSize(P,z)},_doLayoutGridAxisVertical:function(L,D){var P=D.height,N=1,F=-L.x*D.width,k=this.paddingLeft;this.horizontalDirection===V.RIGHT_TO_LEFT&&(N=-1,F=(1-L.x)*D.width,k=this.paddingRight);var U=function(L,D,P){return F+N*(D+L.anchorX*L.width*this._getUsedScaleValue(L.scaleX)+k+P*this.spacingX)}.bind(this),z=0;if(this.resizeMode===B.CONTAINER){var W=this._doLayoutVertically(P,!0,U,!1);(z=F-W)<0&&(z*=-1),F=-L.x*z,this.horizontalDirection===V.RIGHT_TO_LEFT&&(N=-1,F=(1-L.x)*z)}this._doLayoutVertically(P,!0,U,!0),this.resizeMode===B.CONTAINER&&this.node.setContentSize(z,P)},_doLayoutGrid:function(){var L=this.node.getAnchorPoint(),D=this.node.getContentSize();this.startAxis===k.HORIZONTAL?this._doLayoutGridAxisHorizontal(L,D):this.startAxis===k.VERTICAL&&this._doLayoutGridAxisVertical(L,D)},_getHorizontalBaseWidth:function(L){var D=0,P=0;if(this.resizeMode===B.CONTAINER){for(var N=0;N<L.length;++N){var F=L[N];F.activeInHierarchy&&(P++,D+=F.width*this._getUsedScaleValue(F.scaleX))}D+=(P-1)*this.spacingX+this.paddingLeft+this.paddingRight}else D=this.node.getContentSize().width;return D},_doLayout:function(){if(this.type===F.HORIZONTAL){var L=this._getHorizontalBaseWidth(this.node.children);this._doLayoutHorizontally(L,!1,(function(L){return L.y}),!0),this.node.width=L}else if(this.type===F.VERTICAL){var D=this._getVerticalBaseHeight(this.node.children);this._doLayoutVertically(D,!1,(function(L){return L.x}),!0),this.node.height=D}else this.type===F.NONE?this.resizeMode===B.CONTAINER&&this._doLayoutBasic():this.type===F.GRID&&this._doLayoutGrid()},_getUsedScaleValue:function(L){return this.affectedByScale?Math.abs(L):1},updateLayout:function(){this._layoutDirty&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)}});Object.defineProperty(z.prototype,"padding",{get:function(){return cc.warnID(4100),this.paddingLeft},set:function(L){this._N$padding=L,this._migratePaddingData(),this._doLayoutDirty()}}),cc.Layout=D.exports=z},{"../CCNode":25,"./CCComponent":73}],79:[function(L,D,P){"use strict";var N=o(L("../../renderer/gfx")),F=o(L("../value-types/mat4")),B=o(L("../value-types/vec2")),k=o(L("../assets/material/material-variant"));function o(L){return L&&L.__esModule?L:{default:L}}var U=L("../utils/misc"),V=L("./CCRenderComponent"),z=L("../renderer/render-flow"),W=L("../graphics/graphics"),H=new B.default,G=new F.default,X=[];var nt=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),ut=cc.Class({name:"cc.Mask",extends:V,editor:!1,ctor:function(){this._graphics=null,this._enableMaterial=null,this._exitMaterial=null,this._clearMaterial=null},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:nt.RECT,type:{get:function(){return this._type},set:function(L){this._type!==L&&this._resetAssembler(),this._type=L,this._type!==nt.IMAGE_STENCIL&&(this.spriteFrame=null,this.alphaThreshold=0,this._updateGraphics()),this._activateMaterial()},type:nt,tooltip:!1},spriteFrame:{type:cc.SpriteFrame,tooltip:!1,get:function(){return this._spriteFrame},set:function(L){this._spriteFrame!==L&&(this._spriteFrame=L,this.setVertsDirty(),this._updateMaterial())}},alphaThreshold:{default:.1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc.game.renderType!==cc.game.RENDER_TYPE_CANVAS?this._updateMaterial():cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc.game.renderType===cc.game.RENDER_TYPE_CANVAS&&cc.warnID(4202)}},_segments:64,segements:{get:function(){return this._segments},set:function(L){this._segments=U.clampf(L,3,1e4),this._updateGraphics()},type:cc.Integer,tooltip:!1},_resizeToTarget:{animatable:!1,set:function(L){L&&this._resizeNodeToTargetNode()}}},statics:{Type:nt},onRestore:function(){this._activateMaterial()},onEnable:function(){this._super(),this._type!==nt.IMAGE_STENCIL&&this._updateGraphics(),this.node.on(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.POSITION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ROTATION_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SCALE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateGraphics,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this._updateGraphics,this),this.node._renderFlag&=~z.FLAG_POST_RENDER},onDestroy:function(){this._super(),this._removeGraphics()},_resizeNodeToTargetNode:!1,_validateRender:function(){if(this._type===nt.IMAGE_STENCIL){var L=this._spriteFrame;L&&L.textureLoaded()||this.disableRender()}},_activateMaterial:function(){this._createGraphics();var L=this._materials[0];(L=L?k.default.create(L,this):k.default.createWithBuiltin("2d-sprite",this)).define("USE_ALPHA_TEST",!0),this._type===nt.IMAGE_STENCIL?(L.define("CC_USE_MODEL",!1),L.define("USE_TEXTURE",!0)):(L.define("CC_USE_MODEL",!0),L.define("USE_TEXTURE",!1)),this._enableMaterial||(this._enableMaterial=k.default.createWithBuiltin("2d-sprite",this)),this._exitMaterial||(this._exitMaterial=k.default.createWithBuiltin("2d-sprite",this),this._exitMaterial.setStencilEnabled(N.default.STENCIL_DISABLE)),this._clearMaterial||(this._clearMaterial=k.default.createWithBuiltin("clear-stencil",this)),this.setMaterial(0,L),this._graphics._materials[0]=L,this._updateMaterial()},_updateMaterial:function(){var L=this._materials[0];if(L){if(this._type===nt.IMAGE_STENCIL&&this.spriteFrame){var D=this.spriteFrame.getTexture();L.setProperty("texture",D)}L.setProperty("alphaThreshold",this.alphaThreshold)}},_createGraphics:function(){this._graphics||(this._graphics=new W,cc.Assembler.init(this._graphics),this._graphics.node=this.node,this._graphics.lineWidth=0,this._graphics.strokeColor=cc.color(0,0,0,0))},_updateGraphics:function(){var L=this.node,D=this._graphics;D.clear(!1);var P=L._contentSize.width,N=L._contentSize.height,F=-P*L._anchorPoint.x,B=-N*L._anchorPoint.y;if(this._type===nt.RECT)D.rect(F,B,P,N);else if(this._type===nt.ELLIPSE){for(var k=function(L,D,P){X.length=0;for(var N=2*Math.PI/P,F=0;F<P;++F)X.push(cc.v2(D.x*Math.cos(N*F)+L.x,D.y*Math.sin(N*F)+L.y));return X}(cc.v2(F+P/2,B+N/2),{x:P/2,y:N/2},this._segments),U=0;U<k.length;++U){var V=k[U];0===U?D.moveTo(V.x,V.y):D.lineTo(V.x,V.y)}D.close()}cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?D.stroke():D.fill()},_removeGraphics:function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},_hitTest:function(L){var D=this.node,P=D.getContentSize(),N=P.width,k=P.height,U=H;if(D._updateWorldMatrix(),!F.default.invert(G,D._worldMatrix))return!1;B.default.transformMat4(U,L,G),U.x+=D._anchorPoint.x*N,U.y+=D._anchorPoint.y*k;var V=!1;if(this.type===nt.RECT||this.type===nt.IMAGE_STENCIL)V=U.x>=0&&U.y>=0&&U.x<=N&&U.y<=k;else if(this.type===nt.ELLIPSE){var z=N/2,W=k/2,X=U.x-.5*N,ut=U.y-.5*k;V=X*X/(z*z)+ut*ut/(W*W)<1}return this.inverted&&(V=!V),V},markForRender:function(L){var D=z.FLAG_RENDER|z.FLAG_UPDATE_RENDER_DATA|z.FLAG_POST_RENDER;L?(this.node._renderFlag|=D,this.markForValidate()):L||(this.node._renderFlag&=~D)},disableRender:function(){this.node._renderFlag&=~(z.FLAG_RENDER|z.FLAG_UPDATE_RENDER_DATA|z.FLAG_POST_RENDER)}});cc.Mask=D.exports=ut},{"../../renderer/gfx":252,"../assets/material/material-variant":55,"../graphics/graphics":110,"../renderer/render-flow":169,"../utils/misc":210,"../value-types/mat4":227,"../value-types/vec2":234,"./CCRenderComponent":84}],80:[function(L,D,P){"use strict";var N=L("../components/CCRenderComponent"),F=L("../../core/utils/blend-func"),B=cc.Class({name:"cc.MotionStreak",extends:N,mixins:[F],editor:!1,ctor:function(){this._points=[]},properties:{preview:{default:!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(L){this._fadeTime=L,this.reset()},animatable:!1,tooltip:!1},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(L){this._minSeg=L},animatable:!1,tooltip:!1},_stroke:64,stroke:{get:function(){return this._stroke},set:function(L){this._stroke=L},animatable:!1,tooltip:!1},_texture:{default:null,type:cc.Texture2D},texture:{get:function(){return this._texture},set:function(L){this._texture!==L&&(this._texture=L,this._updateMaterial())},type:cc.Texture2D,animatable:!1,tooltip:!1},_color:cc.Color.WHITE,color:{get:function(){return this._color},set:function(L){this._color=L},type:cc.Color,tooltip:!1},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(L){this._fastMode=L},animatable:!1,tooltip:!1}},onEnable:function(){this._super(),this.reset()},_updateMaterial:function(){var L=this.getMaterial(0);L&&L.setProperty("texture",this._texture),F.prototype._updateMaterial.call(this)},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._points.length=0,this._assembler&&this._assembler._renderData.clear()},lateUpdate:function(L){this._assembler&&this._assembler.update(this,L)}});cc.MotionStreak=D.exports=B},{"../../core/utils/blend-func":205,"../components/CCRenderComponent":84}],81:[function(L,D,P){"use strict";var N=cc.Enum({Unified:0,Free:1}),F=cc.Enum({Horizontal:0,Vertical:1}),B=cc.Enum({PAGE_TURNING:0}),k=cc.Class({name:"cc.PageView",extends:cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._initContentPos=cc.v2(),this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},properties:{sizeMode:{default:N.Unified,type:N,tooltip:!1,notify:function(){this._syncSizeMode()}},direction:{default:F.Horizontal,type:F,tooltip:!1,notify:function(){this._syncScrollDirection()}},scrollThreshold:{default:.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:!1},autoPageTurningThreshold:{default:100,type:cc.Float,tooltip:!1},pageTurningEventTiming:{default:.1,type:cc.Float,range:[0,1,.01],tooltip:!1},indicator:{default:null,type:cc.PageViewIndicator,tooltip:!1,notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageTurningSpeed:{default:.3,type:cc.Float,tooltip:!1},pageEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{SizeMode:N,Direction:F,EventType:B},__preload:function(){this.node.on(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this)},onEnable:function(){this._super(),this.node.on("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off("scroll-ended-with-threshold",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},onDestroy:function(){this.node.off(cc.Node.EventType.SIZE_CHANGED,this._updateAllPagesSize,this)},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(L){this.scrollToPage(L,!0)},getPages:function(){return this._pages},addPage:function(L){L&&-1===this._pages.indexOf(L)&&this.content&&(this.content.addChild(L),this._pages.push(L),this._updatePageView())},insertPage:function(L,D){D<0||!L||-1!==this._pages.indexOf(L)||!this.content||(D>=this._pages.length?this.addPage(L):(this._pages.splice(D,0,L),this.content.addChild(L),this._updatePageView()))},removePage:function(L){if(L&&this.content){var D=this._pages.indexOf(L);-1!==D?this.removePageAtIndex(D):cc.warnID(4300,L.name)}},removePageAtIndex:function(L){var D=this._pages;if(!(L<0||L>=D.length)){var P=D[L];P&&(this.content.removeChild(P),D.splice(L,1),this._updatePageView())}},removeAllPages:function(){if(this.content){for(var L=this._pages,D=0,P=L.length;D<P;D++)this.content.removeChild(L[D]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(L,D){L<0||L>=this._pages.length||(D=void 0!==D?D:.3,this._curPageIdx=L,this.scrollToOffset(this._moveOffsetValue(L),D,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===F.Horizontal,this.vertical=this.direction===F.Vertical},_syncSizeMode:function(){if(this.content){var L=this.content.getComponent(cc.Layout);if(L){if(this.sizeMode===N.Free&&this._pages.length>0){var D=this._pages[this._pages.length-1];this.direction===F.Horizontal?(L.paddingLeft=(this._view.width-this._pages[0].width)/2,L.paddingRight=(this._view.width-D.width)/2):this.direction===F.Vertical&&(L.paddingTop=(this._view.height-this._pages[0].height)/2,L.paddingBottom=(this._view.height-D.height)/2)}L.updateLayout()}}},_updatePageView:function(){var L=this.content.getComponent(cc.Layout);L&&L.enabled&&L.updateLayout();var D=this._pages.length;this._curPageIdx>=D&&(this._curPageIdx=0===D?0:D-1,this._lastPageIdx=this._curPageIdx);for(var P=this._initContentPos,N=0;N<D;++N){var B=this._pages[N];B.setSiblingIndex(N),this.direction===F.Horizontal?this._scrollCenterOffsetX[N]=Math.abs(P.x+B.x):this._scrollCenterOffsetY[N]=Math.abs(P.y+B.y)}this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===N.Unified)for(var L=this._pages,D=this._view.getContentSize(),P=0,F=L.length;P<F;P++)L[P].setContentSize(D)},_initPages:function(){if(this.content){this._initContentPos=this.content.position;for(var L=this.content.children,D=0;D<L.length;++D){var P=L[D];this._pages.indexOf(P)>=0||this._pages.push(P)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,B.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(L,D,P){if(this.sizeMode===N.Free){var B,k;if(this.direction===F.Horizontal)return B=this._scrollCenterOffsetX[D],k=this._scrollCenterOffsetX[P],Math.abs(L.x)>=Math.abs(B-k)*this.scrollThreshold;if(this.direction===F.Vertical)return B=this._scrollCenterOffsetY[D],k=this._scrollCenterOffsetY[P],Math.abs(L.y)>=Math.abs(B-k)*this.scrollThreshold}else{if(this.direction===F.Horizontal)return Math.abs(L.x)>=this._view.width*this.scrollThreshold;if(this.direction===F.Vertical)return Math.abs(L.y)>=this._view.height*this.scrollThreshold}},_isQuicklyScrollable:function(L){if(this.direction===F.Horizontal){if(Math.abs(L.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===F.Vertical&&Math.abs(L.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(L){var D=cc.v2(0,0);return this.sizeMode===N.Free?this.direction===F.Horizontal?D.x=this._scrollCenterOffsetX[L]:this.direction===F.Vertical&&(D.y=this._scrollCenterOffsetY[L]):this.direction===F.Horizontal?D.x=L*this._view.width:this.direction===F.Vertical&&(D.y=L*this._view.height),D},_getDragDirection:function(L){return this.direction===F.Horizontal?0===L.x?0:L.x>0?1:-1:this.direction===F.Vertical?0===L.y?0:L.y<0?1:-1:void 0},_handleReleaseLogic:function(L){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_autoScrollToPage:function(){if(this._startBounceBackIfNeeded()){var L=this._getHowMuchOutOfBoundary();((L=this._clampDelta(L)).x>0||L.y<0)&&(this._curPageIdx=this._pages.length-1),(L.x<0||L.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var D=this._touchBeganPosition.sub(this._touchEndPosition),P=this._curPageIdx,N=P+this._getDragDirection(D),F=this.pageTurningSpeed*Math.abs(P-N);if(N<this._pages.length){if(this._isScrollable(D,P,N))return void this.scrollToPage(N,F);var B=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(B))return void this.scrollToPage(N,F)}this.scrollToPage(P,F)}},_onTouchBegan:function(L,D){this._touchBeganPosition=L.touch.getLocation(),this._super(L,D)},_onTouchMoved:function(L,D){this._super(L,D)},_onTouchEnded:function(L,D){this._touchEndPosition=L.touch.getLocation(),this._super(L,D)},_onTouchCancelled:function(L,D){this._touchEndPosition=L.touch.getLocation(),this._super(L,D)},_onMouseWheel:function(){}});cc.PageView=D.exports=k},{}],82:[function(L,D,P){"use strict";var N=cc.Enum({HORIZONTAL:0,VERTICAL:1}),F=cc.Class({name:"cc.PageViewIndicator",extends:L("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1},direction:{default:N.HORIZONTAL,type:N,tooltip:!1},cellSize:{default:cc.size(20,20),tooltip:!1},spacing:{default:0,tooltip:!1}},statics:{Direction:N},onLoad:function(){this._updateLayout()},setPageView:function(L){this._pageView=L,this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===N.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===N.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var L=new cc.Node,D=L.addComponent(cc.Sprite);return D.spriteFrame=this.spriteFrame,D.sizeMode=cc.Sprite.SizeMode.CUSTOM,L.parent=this.node,L.width=this.cellSize.width,L.height=this.cellSize.height,L},_changedState:function(){var L=this._indicators;if(0!==L.length){var D=this._pageView._curPageIdx;if(!(D>=L.length)){for(var P=0;P<L.length;++P)L[P].opacity=127.5;L[D].opacity=255}}},_refresh:function(){if(this._pageView){var L=this._indicators,D=this._pageView.getPages();if(D.length!==L.length){var P=0;if(D.length>L.length)for(P=0;P<D.length;++P)L[P]||(L[P]=this._createIndicator());else for(P=L.length-D.length;P>0;--P){var N=L[P-1];this.node.removeChild(N),L.splice(P-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}}});cc.PageViewIndicator=D.exports=F},{"./CCComponent":73}],83:[function(L,D,P){"use strict";var N=L("../utils/misc"),F=L("./CCComponent"),B=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),k=cc.Class({name:"cc.ProgressBar",extends:F,editor:!1,_initBarSprite:function(){if(this.barSprite){var L=this.barSprite.node;if(!L)return;var D=this.node.getContentSize(),P=this.node.getAnchorPoint(),N=L.getContentSize();L.parent===this.node&&this.node.setContentSize(N),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=B.FILLED);var F=L.getContentSize();if(this.mode===B.HORIZONTAL?this.totalLength=F.width:this.mode===B.VERTICAL?this.totalLength=F.height:this.totalLength=this.barSprite.fillRange,L.parent===this.node){var k=-D.width*P.x;L.setPosition(cc.v2(k,0))}}},_updateBarStatus:function(){if(this.barSprite){var L=this.barSprite.node;if(!L)return;var D,P,F,k=L.getAnchorPoint(),U=L.getContentSize(),V=L.getPosition(),z=cc.v2(0,.5),W=N.clamp01(this.progress),H=this.totalLength*W;switch(this.mode){case B.HORIZONTAL:this.reverse&&(z=cc.v2(1,.5)),D=cc.size(H,U.height),P=this.totalLength,F=U.height;break;case B.VERTICAL:z=this.reverse?cc.v2(.5,1):cc.v2(.5,0),D=cc.size(U.width,H),P=U.width,F=this.totalLength}if(this.mode===B.FILLED)this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(H*=-1),this.barSprite.fillRange=H);else if(this.barSprite.type!==cc.Sprite.Type.FILLED){var G=z.x-k.x,X=z.y-k.y,nt=cc.v2(P*G,F*X);L.setPosition(V.x+nt.x,V.y+nt.y),L.setAnchorPoint(z),L.setContentSize(D)}else cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:B.HORIZONTAL,type:B,tooltip:!1,notify:function(){if(this.barSprite){var L=this.barSprite.node;if(!L)return;var D=L.getContentSize();this.mode===B.HORIZONTAL?this.totalLength=D.width:this.mode===B.VERTICAL?this.totalLength=D.height:this.mode===B.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(L){this.mode===B.FILLED&&(L=N.clamp01(L)),this._N$totalLength=L,this._updateBarStatus()}},progress:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:B}});cc.ProgressBar=D.exports=k},{"../utils/misc":210,"./CCComponent":73}],84:[function(L,D,P){"use strict";var N=s(L("../renderer/assembler")),F=s(L("../assets/material/material-variant"));function s(L){return L&&L.__esModule?L:{default:L}}var B=L("./CCComponent"),k=L("../renderer/render-flow"),U=L("../assets/material/CCMaterial"),V=cc.Class({name:"RenderComponent",extends:B,editor:!1,properties:{_materials:{default:[],type:U},materials:{get:function(){return this._materials},set:function(L){this._materials=L,this._activateMaterial()},type:[U],displayName:"Materials",animatable:!1}},ctor:function(){this._vertsDirty=!0,this._assembler=null},_resetAssembler:function(){N.default.init(this),this._updateColor()},__preload:function(){this._resetAssembler(),this._activateMaterial()},onEnable:function(){this.node._renderComponent&&(this.node._renderComponent.enabled=!1),this.node._renderComponent=this,this.node._renderFlag|=k.FLAG_OPACITY_COLOR,this.setVertsDirty()},onDisable:function(){this.node._renderComponent=null,this.disableRender()},onDestroy:function(){for(var L=this._materials,D=0;D<L.length;D++)cc.pool.material.put(L[D]);L.length=0,cc.pool.assembler.put(this._assembler)},setVertsDirty:function(){this._vertsDirty=!0,this.markForRender(!0)},_on3DNodeChanged:function(){this._resetAssembler()},_validateRender:function(){},markForValidate:function(){cc.RenderFlow.registerValidate(this)},markForRender:function(L){var D=k.FLAG_RENDER|k.FLAG_UPDATE_RENDER_DATA;L?(this.node._renderFlag|=D,this.markForValidate()):this.node._renderFlag&=~D},disableRender:function(){this.node._renderFlag&=~(k.FLAG_RENDER|k.FLAG_UPDATE_RENDER_DATA)},getMaterial:function(L){if(L<0||L>=this._materials.length)return null;var D=this._materials[L];if(!D)return null;var P=F.default.create(D,this);return P!==D&&this.setMaterial(L,P),P},getMaterials:function(){for(var L=this._materials,D=0;D<L.length;D++)L[D]=F.default.create(L[D],this);return L},setMaterial:function(L,D){return D!==this._materials[L]&&(D=F.default.create(D,this),this._materials[L]=D),this._updateMaterial(),this.markForRender(!0),D},_getDefaultMaterial:function(){return U.getBuiltinMaterial("2d-sprite")},_activateMaterial:function(){var L=this._materials;if(!L[0]){var D=this._getDefaultMaterial();L[0]=D}for(var P=0;P<L.length;P++)L[P]=F.default.create(L[P],this);this._updateMaterial()},_updateMaterial:function(){},_updateColor:function(){this._assembler.updateColor&&this._assembler.updateColor(this)},_checkBacth:function(L,D){var P=this._materials[0];(P&&P.getHash()!==L.material.getHash()||L.cullingMask!==D)&&(L._flush(),L.node=P.getDefine("CC_USE_MODEL")?this.node:L._dummyNode,L.material=P,L.cullingMask=D)}});cc.RenderComponent=D.exports=V},{"../assets/material/CCMaterial":48,"../assets/material/material-variant":55,"../renderer/assembler":165,"../renderer/render-flow":169,"./CCComponent":73}],85:[function(L,D,P){"use strict";var N=L("../CCNode").EventType,F=cc.v2(),B=cc.v2(),o=function(){return(new Date).getMilliseconds()},k=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),U={"scroll-to-top":k.SCROLL_TO_TOP,"scroll-to-bottom":k.SCROLL_TO_BOTTOM,"scroll-to-left":k.SCROLL_TO_LEFT,"scroll-to-right":k.SCROLL_TO_RIGHT,scrolling:k.SCROLLING,"bounce-bottom":k.BOUNCE_BOTTOM,"bounce-left":k.BOUNCE_LEFT,"bounce-right":k.BOUNCE_RIGHT,"bounce-top":k.BOUNCE_TOP,"scroll-ended":k.SCROLL_ENDED,"touch-up":k.TOUCH_UP,"scroll-ended-with-threshold":k.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":k.SCROLL_BEGAN},V=cc.Class({name:"cc.ScrollView",extends:L("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.v2(0,0),this._autoScrollTargetDelta=cc.v2(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._outOfBoundaryAmount=cc.v2(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,tooltip:!1,formerlySerializedAs:"content",notify:function(L){this._calculateBoundary()}},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:cc.Float,range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1},_view:{get:function(){if(this.content)return this.content.parent}}},statics:{EventType:k},scrollToBottom:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!1,applyToVertical:!0});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P,!0)},scrollToTop:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!1,applyToVertical:!0});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToLeft:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!1});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToRight:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!1});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToTopLeft:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(0,1),applyToHorizontal:!0,applyToVertical:!0});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToTopRight:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(1,1),applyToHorizontal:!0,applyToVertical:!0});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToBottomLeft:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(0,0),applyToHorizontal:!0,applyToVertical:!0});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToBottomRight:function(L,D){var P=this._calculateMovePercentDelta({anchor:cc.v2(1,0),applyToHorizontal:!0,applyToVertical:!0});L?this._startAutoScroll(P,L,!1!==D):this._moveContent(P)},scrollToOffset:function(L,D,P){var N=this.getMaxScrollOffset(),F=cc.v2(0,0);0===N.x?F.x=0:F.x=L.x/N.x,0===N.y?F.y=1:F.y=(N.y-L.y)/N.y,this.scrollTo(F,D,P)},getScrollOffset:function(){var L=this._getContentTopBoundary()-this._topBoundary,D=this._getContentLeftBoundary()-this._leftBoundary;return cc.v2(D,L)},getMaxScrollOffset:function(){var L=this._view.getContentSize(),D=this.content.getContentSize(),P=D.width-L.width,N=D.height-L.height;return P=P>=0?P:0,N=N>=0?N:0,cc.v2(P,N)},scrollToPercentHorizontal:function(L,D,P){var N=this._calculateMovePercentDelta({anchor:cc.v2(L,0),applyToHorizontal:!0,applyToVertical:!1});D?this._startAutoScroll(N,D,!1!==P):this._moveContent(N)},scrollTo:function(L,D,P){var N=this._calculateMovePercentDelta({anchor:cc.v2(L),applyToHorizontal:!0,applyToVertical:!0});D?this._startAutoScroll(N,D,!1!==P):this._moveContent(N)},scrollToPercentVertical:function(L,D,P){var N=this._calculateMovePercentDelta({anchor:cc.v2(0,L),applyToHorizontal:!1,applyToVertical:!0});D?this._startAutoScroll(N,D,!1!==P):this._moveContent(N)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(L){L.fuzzyEquals(this.getContentPosition(),1e-4)||(this.content.setPosition(L),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(L,D){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(L,D)){var P=cc.v2(0,0);this.vertical?P=cc.v2(0,-.1*L.getScrollY()):this.horizontal&&(P=cc.v2(-.1*L.getScrollY(),0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(P),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(L)}},_checkMouseWheel:function(L){if(!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=L,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent("scroll-ended"),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(L){var D=L.anchor,P=L.applyToHorizontal,N=L.applyToVertical;this._calculateBoundary(),D=D.clampf(cc.v2(0,0),cc.v2(1,1));var F=this._view.getContentSize(),B=this.content.getContentSize(),k=this._getContentBottomBoundary()-this._bottomBoundary;k=-k;var U=this._getContentLeftBoundary()-this._leftBoundary;U=-U;var V=cc.v2(0,0),z=0;return P&&(z=B.width-F.width,V.x=U-z*D.x),N&&(z=B.height-F.height,V.y=k-z*D.y),V},_moveContentToTopLeft:function(L){var D=this.content.getContentSize(),P=this._getContentBottomBoundary()-this._bottomBoundary;P=-P;var N=cc.v2(0,0),F=0,B=this._getContentLeftBoundary()-this._leftBoundary;B=-B,D.height<L.height&&(F=D.height-L.height,N.y=P-F),D.width<L.width&&(F=D.width-L.width,N.x=B),this._updateScrollBarState(),this._moveContent(N),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var L=this.content.getComponent(cc.Layout);L&&L.enabledInHierarchy&&L.updateLayout();var D=this._view.getContentSize(),P=D.width*this._view.anchorX,N=D.height*this._view.anchorY;this._leftBoundary=-P,this._bottomBoundary=-N,this._rightBoundary=this._leftBoundary+D.width,this._topBoundary=this._bottomBoundary+D.height,this._moveContentToTopLeft(D)}},_hasNestedViewGroup:function(L,D){if(L.eventPhase===cc.Event.CAPTURING_PHASE){if(D)for(var P=0;P<D.length;++P){var N=D[P];if(this.node===N)return!!L.target.getComponent(cc.ViewGroup);if(N.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(L){L.eventPhase===cc.Event.AT_TARGET&&L.target===this.node&&L.stopPropagation()},_onTouchBegan:function(L,D){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(L,D)){var P=L.touch;this.content&&this._handlePressLogic(P),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(L)}},_onTouchMoved:function(L,D){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(L,D)){var P=L.touch;if(this.content&&this._handleMoveLogic(P),this.cancelInnerEvents){if(P.getLocation().sub(P.getStartLocation()).mag()>7&&!this._touchMoved&&L.target!==this.node){var N=new cc.Event.EventTouch(L.getTouches(),L.bubbles);N.type=cc.Node.EventType.TOUCH_CANCEL,N.touch=L.touch,N.simulate=!0,L.target.dispatchEvent(N),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(L)}}},_onTouchEnded:function(L,D){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(L,D)){this._dispatchEvent("touch-up");var P=L.touch;this.content&&this._handleReleaseLogic(P),this._touchMoved?L.stopPropagation():this._stopPropagationIfTargetIsMe(L)}},_onTouchCancelled:function(L,D){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(L,D)){if(!L.simulate){var P=L.touch;this.content&&this._handleReleaseLogic(P)}this._stopPropagationIfTargetIsMe(L)}},_processDeltaMove:function(L){this._scrollChildren(L),this._gatherTouchMove(L)},_getLocalAxisAlignDelta:function(L){return this.node.convertToNodeSpaceAR(L.getLocation(),F),this.node.convertToNodeSpaceAR(L.getPreviousLocation(),B),F.sub(B)},_handleMoveLogic:function(L){var D=this._getLocalAxisAlignDelta(L);this._processDeltaMove(D)},_scrollChildren:function(L){var D,P=L=this._clampDelta(L);this.elastic&&(D=this._getHowMuchOutOfBoundary(),P.x*=0===D.x?1:.5,P.y*=0===D.y?1:.5),this.elastic||(D=this._getHowMuchOutOfBoundary(P),P=P.add(D));var N=-1;P.y>0?this.content.y-this.content.anchorY*this.content.height+P.y>=this._bottomBoundary&&(N="scroll-to-bottom"):P.y<0&&this.content.y-this.content.anchorY*this.content.height+this.content.height+P.y<=this._topBoundary&&(N="scroll-to-top"),P.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+P.x<=this._rightBoundary&&(N="scroll-to-right"):P.x>0&&this.content.x-this.content.anchorX*this.content.width+P.x>=this._leftBoundary&&(N="scroll-to-left"),this._moveContent(P,!1),0===P.x&&0===P.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),-1!==N&&this._dispatchEvent(N)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=o(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(L){var D=this.content.getContentSize(),P=this._view.getContentSize();return D.width<P.width&&(L.x=0),D.height<P.height&&(L.y=0),L},_gatherTouchMove:function(L){for(L=this._clampDelta(L);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(L);var D=o();this._touchMoveTimeDeltas.push((D-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=D},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var L=this._getHowMuchOutOfBoundary();if((L=this._clampDelta(L)).fuzzyEquals(cc.v2(0,0),1e-4))return!1;var D=Math.max(this.bounceDuration,0);return this._startAutoScroll(L,D,!0),this._isBouncing||(L.y>0&&this._dispatchEvent("bounce-top"),L.y<0&&this._dispatchEvent("bounce-bottom"),L.x>0&&this._dispatchEvent("bounce-right"),L.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var L=this._calculateTouchMoveVelocity();!L.fuzzyEquals(cc.v2(0,0),1e-4)&&this.brake<1&&this._startInertiaScroll(L)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(L){var D=this._getLocalAxisAlignDelta(L);this._gatherTouchMove(D),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){return!this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return 1e-4},_processAutoScrolling:function(L){var D=this._isNecessaryAutoScrollBrake(),P=D?.05:1;this._autoScrollAccumulatedTime+=L*(1/P);var N=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(N=function(L){return(L-=1)*L*L*L*L+1}(N));var F=this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(N)),B=Math.abs(N-1)<=1e-4;if(Math.abs(N-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var k=F.sub(this._autoScrollBrakingStartPosition);D&&(k=k.mul(P)),F=this._autoScrollBrakingStartPosition.add(k)}else{var U=F.sub(this.getContentPosition()),V=this._getHowMuchOutOfBoundary(U);V.fuzzyEquals(cc.v2(0,0),1e-4)||(F=F.add(V),B=!0)}B&&(this._autoScrolling=!1);var z=F.sub(this.getContentPosition());this._moveContent(this._clampDelta(z),B),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(L){var D=L.mul(.7);this._startAttenuatingAutoScroll(D,L)},_calculateAttenuatedFactor:function(L){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*L+L*L*8e-9))},_startAttenuatingAutoScroll:function(L,D){var P=this._calculateAutoScrollTimeByInitalSpeed(D.mag()),N=L.normalize(),F=this.content.getContentSize(),B=this._view.getContentSize(),k=F.width-B.width,U=F.height-B.height,V=this._calculateAttenuatedFactor(k),z=this._calculateAttenuatedFactor(U);N=cc.v2(N.x*k*(1-this.brake)*V,N.y*U*z*(1-this.brake));var W=L.mag(),H=N.mag()/W;N=N.add(L),this.brake>0&&H>7&&(H=Math.sqrt(H),N=L.mul(H).add(L)),this.brake>0&&H>3&&(P*=H=3),0===this.brake&&H>1&&(P*=H),this._startAutoScroll(N,P,!0)},_calculateAutoScrollTimeByInitalSpeed:function(L){return Math.sqrt(Math.sqrt(L/5))},_startAutoScroll:function(L,D,P){var N=this._flattenVectorByDirection(L);this._autoScrolling=!0,this._autoScrollTargetDelta=N,this._autoScrollAttenuate=P,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=D,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.v2(0,0),this._getHowMuchOutOfBoundary().fuzzyEquals(cc.v2(0,0),1e-4)||(this._autoScrollCurrentlyOutOfBoundary=!0)},_calculateTouchMoveVelocity:function(){var L=0;if((L=this._touchMoveTimeDeltas.reduce((function(L,D){return L+D}),L))<=0||L>=.5)return cc.v2(0,0);var D=cc.v2(0,0);return D=this._touchMoveDisplacements.reduce((function(L,D){return L.add(D)}),D),cc.v2(D.x*(1-this.brake)/L,D.y*(1-this.brake)/L)},_flattenVectorByDirection:function(L){var D=L;return D.x=this.horizontal?D.x:0,D.y=this.vertical?D.y:0,D},_moveContent:function(L,D){var P=this._flattenVectorByDirection(L),N=this.getContentPosition().add(P);this.setContentPosition(N);var F=this._getHowMuchOutOfBoundary();this._updateScrollBar(F),this.elastic&&D&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var L=this.content.getContentSize();return this._getContentLeftBoundary()+L.width},_getContentTopBoundary:function(){var L=this.content.getContentSize();return this._getContentBottomBoundary()+L.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(L){if((L=L||cc.v2(0,0)).fuzzyEquals(cc.v2(0,0),1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var D=cc.v2(0,0);return this._getContentLeftBoundary()+L.x>this._leftBoundary?D.x=this._leftBoundary-(this._getContentLeftBoundary()+L.x):this._getContentRightBoundary()+L.x<this._rightBoundary&&(D.x=this._rightBoundary-(this._getContentRightBoundary()+L.x)),this._getContentTopBoundary()+L.y<this._topBoundary?D.y=this._topBoundary-(this._getContentTopBoundary()+L.y):this._getContentBottomBoundary()+L.y>this._bottomBoundary&&(D.y=this._bottomBoundary-(this._getContentBottomBoundary()+L.y)),L.fuzzyEquals(cc.v2(0,0),1e-4)&&(this._outOfBoundaryAmount=D,this._outOfBoundaryAmountDirty=!1),this._clampDelta(D)},_updateScrollBarState:function(){if(this.content){var L=this.content.getContentSize(),D=this._view.getContentSize();this.verticalScrollBar&&(L.height<D.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(L.width<D.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},_updateScrollBar:function(L){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(L),this.verticalScrollBar&&this.verticalScrollBar._onScroll(L)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(L){if("scroll-ended"===L)this._scrollEventEmitMask=0;else if("scroll-to-top"===L||"scroll-to-bottom"===L||"scroll-to-left"===L||"scroll-to-right"===L){var D=1<<U[L];if(this._scrollEventEmitMask&D)return;this._scrollEventEmitMask|=D}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,U[L]),this.node.emit(L,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var L=this._getHowMuchOutOfBoundary(cc.v2(0,0)),D=this.getContentPosition().add(L);this.content&&(this.content.setPosition(D),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},onDisable:function(){this._unregisterEvent(),this.content&&(this.content.off(N.SIZE_CHANGED,this._calculateBoundary,this),this.content.off(N.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.off(N.POSITION_CHANGED,this._calculateBoundary,this),this._view.off(N.SCALE_CHANGED,this._calculateBoundary,this),this._view.off(N.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.content&&(this.content.on(N.SIZE_CHANGED,this._calculateBoundary,this),this.content.on(N.SCALE_CHANGED,this._calculateBoundary,this),this._view&&(this._view.on(N.POSITION_CHANGED,this._calculateBoundary,this),this._view.on(N.SCALE_CHANGED,this._calculateBoundary,this),this._view.on(N.SIZE_CHANGED,this._calculateBoundary,this))),this._updateScrollBarState()},update:function(L){this._autoScrolling&&this._processAutoScrolling(L)}});cc.ScrollView=D.exports=V},{"../CCNode":25,"./CCViewGroup":91}],86:[function(L,D,P){"use strict";var N=L("../utils/misc"),F=(L("../CCNode").EventType,L("./CCRenderComponent")),B=L("../utils/blend-func"),k=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),U=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2}),V=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),z=cc.Enum({NORMAL:0,GRAY:1}),W=cc.Class({name:"cc.Sprite",extends:F,mixins:[B],editor:!1,properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:k.SIMPLE,_sizeMode:V.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(L,D){var P=this._spriteFrame;P!==L&&(this._spriteFrame=L,this._applySpriteFrame(P))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(L){this._type!==L&&(this._type=L,this.setVertsDirty(),this._resetAssembler())},type:k,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(L){L!==this._fillType&&(this._fillType=L,this.setVertsDirty(),this._resetAssembler())},type:U,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(L){this._fillCenter.x=L.x,this._fillCenter.y=L.y,this._type===k.FILLED&&this.setVertsDirty()},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(L){this._fillStart=N.clampf(L,-1,1),this._type===k.FILLED&&this.setVertsDirty()},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(L){this._fillRange=N.clampf(L,-1,1),this._type===k.FILLED&&this.setVertsDirty()},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(L){this._isTrimmedMode!==L&&(this._isTrimmedMode=L,this._type!==k.SIMPLE&&this._type!==k.MESH||this.setVertsDirty())},animatable:!1,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(L){this._sizeMode=L,L!==V.CUSTOM&&this._applySpriteSize()},animatable:!1,type:V,tooltip:!1}},statics:{FillType:U,Type:k,SizeMode:V,State:z},setVisible:function(L){this.enabled=L},setState:function(){},getState:function(){},onEnable:function(){this._super(),this._applySpriteFrame(),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},onDisable:function(){this._super(),this.node.off(cc.Node.EventType.SIZE_CHANGED,this.setVertsDirty,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},_updateMaterial:function(){var L=this._spriteFrame&&this._spriteFrame.getTexture(),D=this.getMaterial(0);D&&D.setProperty("texture",L),B.prototype._updateMaterial.call(this)},_applyAtlas:!1,_validateRender:function(){var L=this._spriteFrame;this._materials[0]&&L&&L.textureLoaded()||this.disableRender()},_applySpriteSize:function(){if(this._spriteFrame&&this.isValid){if(V.RAW===this._sizeMode){var L=this._spriteFrame._originalSize;this.node.setContentSize(L)}else if(V.TRIMMED===this._sizeMode){var D=this._spriteFrame._rect;this.node.setContentSize(D.width,D.height)}this.setVertsDirty()}},_applySpriteFrame:function(L){var D=L&&L.getTexture();D&&!D.loaded&&L.off("load",this._applySpriteSize,this);var P=this._spriteFrame;if(P){this._updateMaterial();var N=P.getTexture();D===N&&N.loaded?this._applySpriteSize():(this.disableRender(),P.onTextureLoaded(this._applySpriteSize,this))}else this.disableRender()}});cc.Sprite=D.exports=W},{"../CCNode":25,"../utils/blend-func":205,"../utils/misc":210,"./CCRenderComponent":84}],87:[function(L,D,P){"use strict";var N=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),F=cc.Enum({VERTICAL:0,HORIZONTAL:1}),B=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),k=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),U=cc.Class({name:"cc.StudioComponent",extends:cc.Component,editor:!1,properties:!1,statics:{ComponentType:N,ListDirection:F,VerticalAlign:B,HorizontalAlign:k}}),V=L("../utils/prefab-helper");U.PlaceHolder=cc.Class({name:"cc.StudioComponent.PlaceHolder",extends:cc.Component,properties:{_baseUrl:"",nestedPrefab:cc.Prefab},onLoad:function(){this.nestedPrefab&&this._replaceWithNestedPrefab()},_replaceWithNestedPrefab:function(){var L=this.node,D=L._prefab;D.root=L,D.asset=this.nestedPrefab,V.syncWithPrefab(L)}}),cc.StudioComponent=D.exports=U;var z=cc.Class({name:"cc.StudioWidget",extends:cc.Widget,editor:!1,_validateTargetInDEV:function(){}});cc.StudioWidget=D.exports=z},{"../utils/prefab-helper":213}],88:[function(L,D,P){"use strict";var N=L("../utils/gray-sprite-state"),F=cc.Class({name:"cc.Toggle",extends:L("./CCButton"),mixins:[N],editor:!1,properties:{_N$isChecked:!0,isChecked:{get:function(){return this._N$isChecked},set:function(L){if(L!==this._N$isChecked){var D=this.toggleGroup||this._toggleContainer;D&&D.enabled&&this._N$isChecked&&!D.allowSwitchOff||(this._N$isChecked=L,this._updateCheckMark(),D&&D.enabled&&D.updateToggles(this),cc.Toggle._triggerEventInScript_isChecked&&this._emitToggleEvents())}},tooltip:!1},toggleGroup:{default:null,tooltip:!1,type:L("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(L){L&&this._resizeNodeToTargetNode()}}},statics:{_triggerEventInScript_check:!1,_triggerEventInScript_isChecked:!1},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabledInHierarchy&&this.toggleGroup.removeToggle(this)},_hideCheckMark:function(){this._N$isChecked=!1,this._updateCheckMark()},toggle:function(L){this.isChecked=!this.isChecked,cc.Toggle._triggerEventInScript_isChecked||!cc.Toggle._triggerEventInScript_check&&!L||this._emitToggleEvents()},check:function(){this.isChecked=!0,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},uncheck:function(){this.isChecked=!1,!cc.Toggle._triggerEventInScript_isChecked&&cc.Toggle._triggerEventInScript_check&&this._emitToggleEvents()},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){if(this._super(),this.enableAutoGrayEffect&&this.checkMark){var L=!this.interactable;this._switchGrayMaterial(L,this.checkMark)}},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)}});cc.Toggle=D.exports=F,L("../platform/js").get(F.prototype,"_toggleContainer",(function(){var L=this.node.parent;return cc.Node.isNode(L)?L.getComponent(cc.ToggleContainer):null}))},{"../platform/js":157,"../utils/gray-sprite-state":208,"./CCButton":71,"./CCToggleGroup":90}],89:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},checkEvents:{default:[],type:cc.Component.EventHandler}},updateToggles:function(L){this.enabledInHierarchy&&L.isChecked&&(this.toggleItems.forEach((function(D){D!==L&&D.isChecked&&D.enabled&&D._hideCheckMark()})),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,L))},_allowOnlyOneToggleChecked:function(){var L=!1;return this.toggleItems.forEach((function(D){L?D._hideCheckMark():D.isChecked&&(L=!0)})),L},_makeAtLeastOneToggleChecked:function(){if(!this._allowOnlyOneToggleChecked()&&!this.allowSwitchOff){var L=this.toggleItems;L.length>0&&L[0].check()}},onEnable:function(){this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)},start:function(){this._makeAtLeastOneToggleChecked()}});L("../platform/js").get(N.prototype,"toggleItems",(function(){return this.node.getComponentsInChildren(cc.Toggle)})),cc.ToggleContainer=D.exports=N},{"../platform/js":157}],90:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(L){this.enabledInHierarchy&&this._toggleItems.forEach((function(D){L.isChecked&&D!==L&&D.isChecked&&D.enabled&&D._hideCheckMark()}))},addToggle:function(L){-1===this._toggleItems.indexOf(L)&&this._toggleItems.push(L),this._allowOnlyOneToggleChecked()},removeToggle:function(L){var D=this._toggleItems.indexOf(L);D>-1&&this._toggleItems.splice(D,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var L=!1;return this._toggleItems.forEach((function(D){L&&D.enabled&&D._hideCheckMark(),D.isChecked&&D.enabled&&(L=!0)})),L},_makeAtLeastOneToggleChecked:function(){this._allowOnlyOneToggleChecked()||this.allowSwitchOff||this._toggleItems.length>0&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}}),F=!1;L("../platform/js").get(cc,"ToggleGroup",(function(){return F||(cc.logID(1405,"cc.ToggleGroup","cc.ToggleContainer"),F=!0),N})),D.exports=N},{"../platform/js":157}],91:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.ViewGroup",extends:L("./CCComponent")});cc.ViewGroup=D.exports=N},{"./CCComponent":73}],92:[function(L,D,P){"use strict";var N=L("../base-ui/CCWidgetManager"),F=N.AlignMode,B=N._AlignFlags,k=B.TOP,U=B.MID,V=B.BOT,z=B.LEFT,W=B.CENTER,H=B.RIGHT,G=k|V,X=z|H,nt=cc.Class({name:"cc.Widget",extends:L("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(L){this._target=L},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return(this._alignFlags&k)>0},set:function(L){this._setAlign(k,L)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return(this._alignFlags&U)>0},set:function(L){L?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=U):this._alignFlags&=~U},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return(this._alignFlags&V)>0},set:function(L){this._setAlign(V,L)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return(this._alignFlags&z)>0},set:function(L){this._setAlign(z,L)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&W)>0},set:function(L){L?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=W):this._alignFlags&=~W},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return(this._alignFlags&H)>0},set:function(L){this._setAlign(H,L)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&X)===X},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&G)===G},visible:!1},top:{get:function(){return this._top},set:function(L){this._top=L},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(L){this._bottom=L},tooltip:!1},left:{get:function(){return this._left},set:function(L){this._left=L},tooltip:!1},right:{get:function(){return this._right},set:function(L){this._right=L},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(L){this._horizontalCenter=L},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(L){this._verticalCenter=L},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(L){this._isAbsHorizontalCenter=L},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(L){this._isAbsVerticalCenter=L},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(L){this._isAbsTop=L},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(L){this._isAbsBottom=L},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(L){this._isAbsLeft=L},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(L){this._isAbsRight=L},animatable:!1},alignMode:{default:F.ON_WINDOW_RESIZE,type:F,tooltip:!1},_wasAlignOnce:{default:void 0,formerlySerializedAs:"isAlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},statics:{AlignMode:F},onLoad:function(){void 0!==this._wasAlignOnce&&(this.alignMode=this._wasAlignOnce?F.ONCE:F.ALWAYS,this._wasAlignOnce=void 0)},onEnable:function(){N.add(this)},onDisable:function(){N.remove(this)},_validateTargetInDEV:!1,_setAlign:function(L,D){if(D!==(this._alignFlags&L)>0){var P=(L&X)>0;D?(this._alignFlags|=L,P?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(P?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~L)}},updateAlignment:function(){N.updateAlignment(this.node)}});Object.defineProperty(nt.prototype,"isAlignOnce",{get:function(){return this.alignMode===F.ONCE},set:function(L){this.alignMode=L?F.ONCE:F.ALWAYS}}),cc.Widget=D.exports=nt},{"../base-ui/CCWidgetManager":57,"./CCComponent":73}],93:[function(L,D,P){"use strict";var N=L("../../platform/CCMacro"),F=L("../editbox/EditBoxImplBase"),B=L("../CCLabel"),k=L("./types"),U=k.InputMode,V=k.InputFlag,z=k.KeyboardReturnType;var W=cc.Class({name:"cc.EditBox",extends:cc.Component,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._string},set:function(L){L=""+L,this.maxLength>=0&&L.length>=this.maxLength&&(L=L.slice(0,this.maxLength)),this._string=L,this._updateString(L)}},textLabel:{tooltip:!1,default:null,type:B,notify:function(L){this.textLabel&&this.textLabel!==L&&(this._updateTextLabel(),this._updateLabels())}},placeholderLabel:{tooltip:!1,default:null,type:B,notify:function(L){this.placeholderLabel&&this.placeholderLabel!==L&&(this._updatePlaceholderLabel(),this._updateLabels())}},background:{tooltip:!1,default:null,type:cc.Sprite,notify:function(L){this.background&&this.background!==L&&this._updateBackgroundSprite()}},_N$backgroundImage:{default:void 0,type:cc.SpriteFrame},backgroundImage:{get:function(){return this.background?this.background.spriteFrame:null},set:function(L){this.background&&(this.background.spriteFrame=L)}},returnType:{default:z.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:z},_N$returnType:{default:void 0,type:cc.Float},inputFlag:{tooltip:!1,default:V.DEFAULT,type:V,notify:function(){this._updateString(this._string)}},inputMode:{tooltip:!1,default:U.ANY,type:U,notify:function(L){this.inputMode!==L&&(this._updateTextLabel(),this._updatePlaceholderLabel())}},fontSize:{get:function(){return this.textLabel?this.textLabel.fontSize:null},set:function(L){this.textLabel&&(this.textLabel.fontSize=L)}},_N$fontSize:{default:void 0,type:cc.Float},lineHeight:{get:function(){return this.textLabel?this.textLabel.lineHeight:null},set:function(L){this.textLabel&&(this.textLabel.lineHeight=L)}},_N$lineHeight:{default:void 0,type:cc.Float},fontColor:{get:function(){return this.textLabel?this.textLabel.node.color:null},set:function(L){this.textLabel&&(this.textLabel.node.color=L,this.textLabel.node.opacity=L.a)}},_N$fontColor:void 0,placeholder:{tooltip:!1,get:function(){return this.placeholderLabel?this.placeholderLabel.string:""},set:function(L){this.placeholderLabel&&(this.placeholderLabel.string=L)}},_N$placeholder:{default:void 0,type:cc.String},placeholderFontSize:{get:function(){return this.placeholderLabel?this.placeholderLabel.fontSize:null},set:function(L){this.placeholderLabel&&(this.placeholderLabel.fontSize=L)}},_N$placeholderFontSize:{default:void 0,type:cc.Float},placeholderFontColor:{get:function(){return this.placeholderLabel?this.placeholderLabel.node.color:null},set:function(L){this.placeholderLabel&&(this.placeholderLabel.node.color=L,this.placeholderLabel.node.opacity=L.a)}},_N$placeholderFontColor:void 0,maxLength:{tooltip:!1,default:20},_N$maxLength:{default:void 0,type:cc.Float},stayOnTop:{default:!1,notify:function(){cc.warn("editBox.stayOnTop is removed since v2.1.")}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(L){this._tabIndex!==L&&(this._tabIndex=L,this._impl&&this._impl.setTabIndex(L))}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{_ImplClass:F,KeyboardReturnType:z,InputFlag:V,InputMode:U},_init:function(){this._upgradeComp(),this._isLabelVisible=!0,this.node.on(cc.Node.EventType.SIZE_CHANGED,this._syncSize,this),(this._impl=new W._ImplClass).init(this),this._updateString(this._string),this._syncSize()},_updateBackgroundSprite:function(){var L=this.background;if(!L){var D=this.node.getChildByName("BACKGROUND_SPRITE");D||(D=new cc.Node("BACKGROUND_SPRITE")),(L=D.getComponent(cc.Sprite))||(L=D.addComponent(cc.Sprite)),D.parent=this.node,this.background=L}L.type=cc.Sprite.Type.SLICED,void 0!==this._N$backgroundImage&&(L.spriteFrame=this._N$backgroundImage,this._N$backgroundImage=void 0)},_updateTextLabel:function(){var L=this.textLabel;if(!L){var D=this.node.getChildByName("TEXT_LABEL");D||(D=new cc.Node("TEXT_LABEL")),(L=D.getComponent(B))||(L=D.addComponent(B)),D.parent=this.node,this.textLabel=L}L.node.setAnchorPoint(0,1),L.overflow=B.Overflow.CLAMP,this.inputMode===U.ANY?(L.verticalAlign=N.VerticalTextAlignment.TOP,L.enableWrapText=!0):(L.verticalAlign=N.VerticalTextAlignment.CENTER,L.enableWrapText=!1),L.string=this._updateLabelStringStyle(this._string),void 0!==this._N$fontColor&&(L.node.color=this._N$fontColor,L.node.opacity=this._N$fontColor.a,this._N$fontColor=void 0),void 0!==this._N$fontSize&&(L.fontSize=this._N$fontSize,this._N$fontSize=void 0),void 0!==this._N$lineHeight&&(L.lineHeight=this._N$lineHeight,this._N$lineHeight=void 0)},_updatePlaceholderLabel:function(){var L=this.placeholderLabel;if(!L){var D=this.node.getChildByName("PLACEHOLDER_LABEL");D||(D=new cc.Node("PLACEHOLDER_LABEL")),(L=D.getComponent(B))||(L=D.addComponent(B)),D.parent=this.node,this.placeholderLabel=L}L.node.setAnchorPoint(0,1),L.overflow=B.Overflow.CLAMP,this.inputMode===U.ANY?(L.verticalAlign=N.VerticalTextAlignment.TOP,L.enableWrapText=!0):(L.verticalAlign=N.VerticalTextAlignment.CENTER,L.enableWrapText=!1),L.string=this.placeholder,void 0!==this._N$placeholderFontColor&&(L.node.color=this._N$placeholderFontColor,L.node.opacity=this._N$placeholderFontColor.a,this._N$placeholderFontColor=void 0),void 0!==this._N$placeholderFontSize&&(L.fontSize=this._N$placeholderFontSize,this._N$placeholderFontSize=void 0)},_upgradeComp:function(){void 0!==this._N$returnType&&(this.returnType=this._N$returnType,this._N$returnType=void 0),void 0!==this._N$maxLength&&(this.maxLength=this._N$maxLength,this._N$maxLength=void 0),void 0!==this._N$backgroundImage&&this._updateBackgroundSprite(),void 0===this._N$fontColor&&void 0===this._N$fontSize&&void 0===this._N$lineHeight||this._updateTextLabel(),void 0===this._N$placeholderFontColor&&void 0===this._N$placeholderFontSize||this._updatePlaceholderLabel(),void 0!==this._N$placeholder&&(this.placeholder=this._N$placeholder,this._N$placeholder=void 0)},_syncSize:function(){if(this._impl){var L=this.node.getContentSize();this._impl.setSize(L.width,L.height)}},_showLabels:function(){this._isLabelVisible=!0,this._updateLabels()},_hideLabels:function(){this._isLabelVisible=!1,this.textLabel&&(this.textLabel.node.active=!1),this.placeholderLabel&&(this.placeholderLabel.node.active=!1)},_updateLabels:function(){if(this._isLabelVisible){var L=this._string;this.textLabel&&(this.textLabel.node.active=""!==L),this.placeholderLabel&&(this.placeholderLabel.node.active=""===L)}},_updateString:function(L){var D=this.textLabel;if(D){var P=L;P&&(P=this._updateLabelStringStyle(P)),D.string=P,this._updateLabels()}},_updateLabelStringStyle:function(L,D){var P=this.inputFlag;if(D||P!==V.PASSWORD)P===V.INITIAL_CAPS_ALL_CHARACTERS?L=L.toUpperCase():P===V.INITIAL_CAPS_WORD?L=function(L){return L.replace(/(?:^|\s)\S/g,(function(L){return L.toUpperCase()}))}(L):P===V.INITIAL_CAPS_SENTENCE&&(L=function(L){return L.charAt(0).toUpperCase()+L.slice(1)}(L));else{for(var N="",F=L.length,B=0;B<F;++B)N+="";L=N}return L},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(L){L=this._updateLabelStringStyle(L,!0),this.string=L,cc.Component.EventHandler.emitEvents(this.textChanged,L,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onEnable:function(){this._registerEvent(),this._impl&&this._impl.enable()},onDisable:function(){this._unregisterEvent(),this._impl&&this._impl.disable()},onDestroy:function(){this._impl&&this._impl.clear()},__preload:function(){this._init()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(L){L.stopPropagation()},_onTouchCancel:function(L){L.stopPropagation()},_onTouchEnded:function(L){this._impl&&this._impl.beginEditing(),L.stopPropagation()},setFocus:function(){cc.warnID(1400,"setFocus()","focus()"),this._impl&&this._impl.setFocus(!0)},focus:function(){this._impl&&this._impl.setFocus(!0)},blur:function(){this._impl&&this._impl.setFocus(!1)},isFocused:function(){return!!this._impl&&this._impl.isFocused()},update:function(){this._impl&&this._impl.update()}});cc.EditBox=D.exports=W,cc.sys.isBrowser&&L("./WebEditBoxImpl")},{"../../platform/CCMacro":142,"../CCLabel":75,"../editbox/EditBoxImplBase":94,"./WebEditBoxImpl":95,"./types":97}],94:[function(L,D,P){"use strict";var N=cc.Class({ctor:function(){this._delegate=null,this._editing=!1},init:function(L){},enable:function(){},disable:function(){this._editing&&this.endEditing()},clear:function(){},update:function(){},setTabIndex:function(L){},setSize:function(L,D){},setFocus:function(L){L?this.beginEditing():this.endEditing()},isFocused:function(){return this._editing},beginEditing:function(){},endEditing:function(){}});D.exports=N},{}],95:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../value-types/mat4")),F=L("../../platform/utils"),B=L("../../platform/CCMacro"),k=L("./types"),U=L("../CCLabel"),V=L("./tabIndexUtil"),z=cc.EditBox,W=cc.js,H=k.InputMode,G=k.InputFlag,X=k.KeyboardReturnType,nt={zoomInvalid:!1};cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(nt.zoomInvalid=!0);var ut=0,dt=cc.v3(),ft=null,_t=!1,pt=!1,vt=z._ImplClass;function E(){vt.call(this),this._domId="EditBoxId_"+ ++ut,this._placeholderStyleSheet=null,this._elem=null,this._isTextArea=!1,this._worldMat=new N.default,this._cameraMat=new N.default,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._w=0,this._h=0,this._inputMode=null,this._inputFlag=null,this._returnType=null,this._eventListeners={},this._textLabelFont=null,this._textLabelFontSize=null,this._textLabelFontColor=null,this._textLabelAlign=null,this._placeholderLabelFont=null,this._placeholderLabelFontSize=null,this._placeholderLabelFontColor=null,this._placeholderLabelAlign=null,this._placeholderLineHeight=null}W.extend(E,vt),z._ImplClass=E,Object.assign(E.prototype,{init:function(L){L&&(this._delegate=L,L.inputMode===H.ANY?this._createTextArea():this._createInput(),V.add(this),this.setTabIndex(L.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),_t=cc.view.isAutoFullScreenEnabled(),pt=cc.view._resizeWithBrowserSize)},clear:function(){this._removeEventListeners(),this._removeDomFromGameContainer(),V.remove(this),ft===this&&(ft=null)},update:function(){},setTabIndex:function(L){this._elem.tabIndex=L,V.resort()},setSize:function(L,D){var P=this._elem;P.style.width=L+"px",P.style.height=D+"px"},beginEditing:function(){ft&&ft!==this&&ft.setFocus(!1),this._editing=!0,ft=this,this._delegate.editBoxEditingDidBegan(),this._showDom(),this._elem.focus()},endEditing:function(){this._elem&&this._elem.blur()},_createInput:function(){this._isTextArea=!1,this._elem=document.createElement("input")},_createTextArea:function(){this._isTextArea=!0,this._elem=document.createElement("textarea")},_addDomToGameContainer:function(){cc.game.container.appendChild(this._elem),document.head.appendChild(this._placeholderStyleSheet)},_removeDomFromGameContainer:function(){F.contains(cc.game.container,this._elem)&&cc.game.container.removeChild(this._elem),F.contains(document.head,this._placeholderStyleSheet)&&document.head.removeChild(this._placeholderStyleSheet),delete this._elem,delete this._placeholderStyleSheet},_showDom:function(){this._updateMatrix(),this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._elem.style.display="",this._delegate._hideLabels(),cc.sys.isMobile&&this._showDomOnMobile()},_hideDom:function(){this._elem.style.display="none",this._delegate._showLabels(),cc.sys.isMobile&&this._hideDomOnMobile()},_showDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(_t&&(cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()),pt&&cc.view.resizeWithBrowserSize(!1),this._adjustWindowScroll())},_hideDomOnMobile:function(){cc.sys.os===cc.sys.OS_ANDROID&&(pt&&cc.view.resizeWithBrowserSize(!0),setTimeout((function(){ft||_t&&cc.view.enableAutoFullScreen(!0)}),800)),this._scrollBackWindow()},_adjustWindowScroll:function(){var L=this;setTimeout((function(){window.scrollY<100&&L._elem.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),800)},_scrollBackWindow:function(){setTimeout((function(){var L=cc.sys;L.browserType!==L.BROWSER_TYPE_WECHAT||L.os!==L.OS_IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),800)},_updateMatrix:function(){var L=this._delegate.node;L.getWorldMatrix(this._worldMat);var D=this._worldMat,P=D.m;if(this._m00!==P[0]||this._m01!==P[1]||this._m04!==P[4]||this._m05!==P[5]||this._m12!==P[12]||this._m13!==P[13]||this._w!==L._contentSize.width||this._h!==L._contentSize.height){this._m00=P[0],this._m01=P[1],this._m04=P[4],this._m05=P[5],this._m12=P[12],this._m13=P[13],this._w=L._contentSize.width,this._h=L._contentSize.height;var F,B=cc.view._scaleX,k=cc.view._scaleY,U=cc.view._viewportRect,V=cc.view._devicePixelRatio;dt.x=-L._anchorPoint.x*this._w,dt.y=-L._anchorPoint.y*this._h,N.default.transform(D,D,dt),cc.Camera.findCamera(L).getWorldToScreenMatrix2D(this._cameraMat),F=this._cameraMat,N.default.mul(F,F,D),B/=V,k/=V;var z=cc.game.container,W=F.m,H=W[0]*B,G=W[1],X=W[4],ut=W[5]*k,ft=z&&z.style.paddingLeft&&parseInt(z.style.paddingLeft);ft+=U.x/V;var _t=z&&z.style.paddingBottom&&parseInt(z.style.paddingBottom);_t+=U.y/V;var pt=W[12]*B+ft,vt=W[13]*k+_t;nt.zoomInvalid&&(this.setSize(L.width*H,L.height*ut),H=1,ut=1);var gt=this._elem,mt="matrix("+H+","+-G+","+-X+","+ut+","+pt+","+-vt+")";gt.style.transform=mt,gt.style["-webkit-transform"]=mt,gt.style["transform-origin"]="0px 100% 0px",gt.style["-webkit-transform-origin"]="0px 100% 0px"}},_updateInputType:function(){var L=this._delegate,D=L.inputMode,P=L.inputFlag,N=L.returnType,F=this._elem;if(this._inputMode!==D||this._inputFlag!==P||this._returnType!==N){if(this._inputMode=D,this._inputFlag=P,this._returnType=N,this._isTextArea){var B="none";return P===G.INITIAL_CAPS_ALL_CHARACTERS?B="uppercase":P===G.INITIAL_CAPS_WORD&&(B="capitalize"),void(F.style.textTransform=B)}if(P!==G.PASSWORD){var k=F.type;D===H.EMAIL_ADDR?k="email":D===H.NUMERIC||D===H.DECIMAL?k="number":D===H.PHONE_NUMBER?(k="number",F.pattern="[0-9]*"):D===H.URL?k="url":(k="text",N===X.SEARCH&&(k="search")),F.type=k;var U="none";P===G.INITIAL_CAPS_ALL_CHARACTERS?U="uppercase":P===G.INITIAL_CAPS_WORD&&(U="capitalize"),F.style.textTransform=U}else F.type="password"}},_updateMaxLength:function(){var L=this._delegate.maxLength;L<0&&(L=65535),this._elem.maxLength=L},_initStyleSheet:function(){var L=this._elem;L.style.display="none",L.style.border=0,L.style.background="transparent",L.style.width="100%",L.style.height="100%",L.style.active=0,L.style.outline="medium",L.style.padding="0",L.style.textTransform="uppercase",L.style.position="absolute",L.style.bottom="0px",L.style.left="2px",L.className="cocosEditBox",L.id=this._domId,this._isTextArea?(L.style.resize="none",L.style.overflow_y="scroll"):(L.type="text",L.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")},_updateStyleSheet:function(){var L=this._delegate,D=this._elem;D.value=L.string,D.placeholder=L.placeholder,this._updateTextLabel(L.textLabel),this._updatePlaceholderLabel(L.placeholderLabel)},_updateTextLabel:function(L){if(L){var D=L.font;D=!D||D instanceof cc.BitmapFont?L.fontFamily:D._fontFamily;var P=L.fontSize*L.node.scaleY;if(this._textLabelFont!==D||this._textLabelFontSize!==P||this._textLabelFontColor!==L.fontColor||this._textLabelAlign!==L.horizontalAlign){this._textLabelFont=D,this._textLabelFontSize=P,this._textLabelFontColor=L.fontColor,this._textLabelAlign=L.horizontalAlign;var N=this._elem;switch(N.style.fontSize=P+"px",N.style.color=L.node.color.toCSS(),N.style.fontFamily=D,L.horizontalAlign){case U.HorizontalAlign.LEFT:N.style.textAlign="left";break;case U.HorizontalAlign.CENTER:N.style.textAlign="center";break;case U.HorizontalAlign.RIGHT:N.style.textAlign="right"}}}},_updatePlaceholderLabel:function(L){if(L){var D=L.font;D=!D||D instanceof cc.BitmapFont?L.fontFamily:L.font._fontFamily;var P=L.fontSize*L.node.scaleY;if(this._placeholderLabelFont!==D||this._placeholderLabelFontSize!==P||this._placeholderLabelFontColor!==L.fontColor||this._placeholderLabelAlign!==L.horizontalAlign||this._placeholderLineHeight!==L.fontSize){this._placeholderLabelFont=D,this._placeholderLabelFontSize=P,this._placeholderLabelFontColor=L.fontColor,this._placeholderLabelAlign=L.horizontalAlign,this._placeholderLineHeight=L.fontSize;var N,F=this._placeholderStyleSheet,B=L.node.color.toCSS(),k=L.fontSize;switch(L.horizontalAlign){case U.HorizontalAlign.LEFT:N="left";break;case U.HorizontalAlign.CENTER:N="center";break;case U.HorizontalAlign.RIGHT:N="right"}F.innerHTML="#"+this._domId+"::-webkit-input-placeholder,#"+this._domId+"::-moz-placeholder,#"+this._domId+":-ms-input-placeholder{text-transform: initial; font-family: "+D+"; font-size: "+P+"px; color: "+B+"; line-height: "+k+"px; text-align: "+N+";}",cc.sys.browserType===cc.sys.BROWSER_TYPE_EDGE&&(F.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},_registerEventListeners:function(){var L=this,D=this._elem,P=!1,N=this._eventListeners;N.compositionStart=function(){P=!0},N.compositionEnd=function(){P=!1,L._delegate.editBoxTextChanged(D.value)},N.onInput=function(){P||L._delegate.editBoxTextChanged(D.value)},N.onClick=function(D){L._editing&&cc.sys.isMobile&&L._adjustWindowScroll()},N.onKeydown=function(P){P.keyCode===B.KEY.enter?(P.stopPropagation(),L._delegate.editBoxEditingReturn(),L._isTextArea||D.blur()):P.keyCode===B.KEY.tab&&(P.stopPropagation(),P.preventDefault(),V.next(L))},N.onBlur=function(){L._editing=!1,ft=null,L._hideDom(),L._delegate.editBoxEditingDidEnded()},D.addEventListener("compositionstart",N.compositionStart),D.addEventListener("compositionend",N.compositionEnd),D.addEventListener("input",N.onInput),D.addEventListener("keydown",N.onKeydown),D.addEventListener("blur",N.onBlur),D.addEventListener("touchstart",N.onClick)},_removeEventListeners:function(){var L=this._elem,D=this._eventListeners;L.removeEventListener("compositionstart",D.compositionStart),L.removeEventListener("compositionend",D.compositionEnd),L.removeEventListener("input",D.onInput),L.removeEventListener("keydown",D.onKeydown),L.removeEventListener("blur",D.onBlur),L.removeEventListener("touchstart",D.onClick),D.compositionStart=null,D.compositionEnd=null,D.onInput=null,D.onKeydown=null,D.onBlur=null,D.onClick=null}})},{"../../platform/CCMacro":142,"../../platform/utils":161,"../../value-types/mat4":227,"../CCLabel":75,"./tabIndexUtil":96,"./types":97}],96:[function(L,D,P){"use strict";D.exports={_tabIndexList:[],add:function(L){var D=this._tabIndexList;-1===D.indexOf(L)&&D.push(L)},remove:function(L){var D=this._tabIndexList,P=D.indexOf(L);-1!==P&&D.splice(P,1)},resort:function(){this._tabIndexList.sort((function(L,D){return L._delegate._tabIndex-D._delegate._tabIndex}))},next:function(L){var D=this._tabIndexList,P=D.indexOf(L);if(L.setFocus(!1),-1!==P){var N=D[P+1];N&&N._delegate._tabIndex>=0&&N.setFocus(!0)}}}},{}],97:[function(L,D,P){"use strict";var N=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5}),F=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),B=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});D.exports={KeyboardReturnType:N,InputMode:F,InputFlag:B}},{}],98:[function(L,D,P){"use strict";L("./CCComponent"),L("./CCComponentEventHandler"),L("./missing-script");var N=L("./WXSubContextView"),F=L("./SwanSubContextView");N||(N=cc.Class({name:"cc.WXSubContextView",extends:cc.Component})),F||(F=cc.Class({name:"cc.SwanSubContextView",extends:cc.Component}));var B=[L("./CCSprite"),L("./CCWidget"),L("./CCCanvas"),L("./CCAudioSource"),L("./CCAnimation"),L("./CCButton"),L("./CCLabel"),L("./CCProgressBar"),L("./CCMask"),L("./CCScrollBar"),L("./CCScrollView"),L("./CCPageViewIndicator"),L("./CCPageView"),L("./CCSlider"),L("./CCLayout"),L("./editbox/CCEditBox"),L("./CCLabelOutline"),L("./CCLabelShadow"),L("./CCRichText"),L("./CCToggleContainer"),L("./CCToggleGroup"),L("./CCToggle"),L("./CCBlockInputEvents"),L("./CCMotionStreak"),N,F];D.exports=B},{"./CCAnimation":68,"./CCAudioSource":69,"./CCBlockInputEvents":70,"./CCButton":71,"./CCCanvas":72,"./CCComponent":73,"./CCComponentEventHandler":74,"./CCLabel":75,"./CCLabelOutline":76,"./CCLabelShadow":77,"./CCLayout":78,"./CCMask":79,"./CCMotionStreak":80,"./CCPageView":81,"./CCPageViewIndicator":82,"./CCProgressBar":83,"./CCRichText":void 0,"./CCScrollBar":void 0,"./CCScrollView":85,"./CCSlider":void 0,"./CCSprite":86,"./CCToggle":88,"./CCToggleContainer":89,"./CCToggleGroup":90,"./CCWidget":92,"./SwanSubContextView":void 0,"./WXSubContextView":void 0,"./editbox/CCEditBox":93,"./missing-script":99}],99:[function(L,D,P){"use strict";var N=cc.js,F=L("../utils/misc").BUILTIN_CLASSID_RE,B=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),k=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(L,D){return N._getClassById(L)||(L?(cc.deserialize.reportMissingClass(L),k.getMissingWrapper(L,D)):null)},getMissingWrapper:function(L,D){return D.node&&(/^[0-9a-zA-Z+/]{23}$/.test(L)||F.test(L))?k:B}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=D.exports=k},{"../utils/misc":210}],100:[function(L,D,P){"use strict";var N=cc.js;L("../event/event");var r=function(L,D){cc.Event.call(this,cc.Event.MOUSE,D),this._eventType=L,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};N.extend(r,cc.Event);var F=r.prototype;F.setScrollData=function(L,D){this._scrollX=L,this._scrollY=D},F.getScrollX=function(){return this._scrollX},F.getScrollY=function(){return this._scrollY},F.setLocation=function(L,D){this._x=L,this._y=D},F.getLocation=function(){return cc.v2(this._x,this._y)},F.getLocationInView=function(){return cc.v2(this._x,cc.view._designResolutionSize.height-this._y)},F._setPrevCursor=function(L,D){this._prevX=L,this._prevY=D},F.getPreviousLocation=function(){return cc.v2(this._prevX,this._prevY)},F.getDelta=function(){return cc.v2(this._x-this._prevX,this._y-this._prevY)},F.getDeltaX=function(){return this._x-this._prevX},F.getDeltaY=function(){return this._y-this._prevY},F.setButton=function(L){this._button=L},F.getButton=function(){return this._button},F.getLocationX=function(){return this._x},F.getLocationY=function(){return this._y},r.NONE=0,r.DOWN=1,r.UP=2,r.MOVE=3,r.SCROLL=4,r.BUTTON_LEFT=0,r.BUTTON_RIGHT=2,r.BUTTON_MIDDLE=1,r.BUTTON_4=3,r.BUTTON_5=4,r.BUTTON_6=5,r.BUTTON_7=6,r.BUTTON_8=7;var a=function(L,D){cc.Event.call(this,cc.Event.TOUCH,D),this._eventCode=0,this._touches=L||[],this.touch=null,this.currentTouch=null};N.extend(a,cc.Event),(F=a.prototype).getEventCode=function(){return this._eventCode},F.getTouches=function(){return this._touches},F._setEventCode=function(L){this._eventCode=L},F._setTouches=function(L){this._touches=L},F.setLocation=function(L,D){this.touch&&this.touch.setTouchInfo(this.touch.getID(),L,D)},F.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},F.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},F.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},F.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},F.getID=function(){return this.touch?this.touch.getID():null},F.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},F.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},F.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},F.getLocationX=function(){return this.touch?this.touch.getLocationX():0},F.getLocationY=function(){return this.touch?this.touch.getLocationY():0},a.MAX_TOUCHES=5,a.BEGAN=0,a.MOVED=1,a.ENDED=2,a.CANCELED=3;var o=function(L,D){cc.Event.call(this,cc.Event.ACCELERATION,D),this.acc=L};N.extend(o,cc.Event);var c=function(L,D,P){cc.Event.call(this,cc.Event.KEYBOARD,P),this.keyCode=L,this.isPressed=D};N.extend(c,cc.Event),cc.Event.EventMouse=r,cc.Event.EventTouch=a,cc.Event.EventAcceleration=o,cc.Event.EventKeyboard=c,D.exports=cc.Event},{"../event/event":107}],101:[function(L,D,P){"use strict";var N=L("../platform/js");cc.EventListener=function(L,D,P){this._onEvent=P,this._type=L||0,this._listenerID=D||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},cc.EventListener.prototype={constructor:cc.EventListener,_setPaused:function(L){this._paused=L},_isPaused:function(){return this._paused},_setRegistered:function(L){this._registered=L},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(L){this._fixedPriority=L},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(L){this._target=L,this._node=L},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(L){this._isEnabled=L},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}},cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8;var F=cc.EventListener.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"},s=function(L,D){this._onCustomEvent=D,cc.EventListener.call(this,cc.EventListener.CUSTOM,L,this._callback)};N.extend(s,cc.EventListener),N.mixin(s.prototype,{_onCustomEvent:null,_callback:function(L){null!==this._onCustomEvent&&this._onCustomEvent(L)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new s(this._listenerID,this._onCustomEvent)}});var a=function(){cc.EventListener.call(this,cc.EventListener.MOUSE,F.MOUSE,this._callback)};N.extend(a,cc.EventListener),N.mixin(a.prototype,{onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,_callback:function(L){var D=cc.Event.EventMouse;switch(L._eventType){case D.DOWN:this.onMouseDown&&this.onMouseDown(L);break;case D.UP:this.onMouseUp&&this.onMouseUp(L);break;case D.MOVE:this.onMouseMove&&this.onMouseMove(L);break;case D.SCROLL:this.onMouseScroll&&this.onMouseScroll(L)}},clone:function(){var L=new a;return L.onMouseDown=this.onMouseDown,L.onMouseUp=this.onMouseUp,L.onMouseMove=this.onMouseMove,L.onMouseScroll=this.onMouseScroll,L},checkAvailable:function(){return!0}});var o=function(){cc.EventListener.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,F.TOUCH_ONE_BY_ONE,null),this._claimedTouches=[]};N.extend(o,cc.EventListener),N.mixin(o.prototype,{constructor:o,_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,setSwallowTouches:function(L){this.swallowTouches=L},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var L=new o;return L.onTouchBegan=this.onTouchBegan,L.onTouchMoved=this.onTouchMoved,L.onTouchEnded=this.onTouchEnded,L.onTouchCancelled=this.onTouchCancelled,L.swallowTouches=this.swallowTouches,L},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}});var c=function(){cc.EventListener.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,F.TOUCH_ALL_AT_ONCE,null)};N.extend(c,cc.EventListener),N.mixin(c.prototype,{constructor:c,onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,clone:function(){var L=new c;return L.onTouchesBegan=this.onTouchesBegan,L.onTouchesMoved=this.onTouchesMoved,L.onTouchesEnded=this.onTouchesEnded,L.onTouchesCancelled=this.onTouchesCancelled,L},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}});var l=function(L){this._onAccelerationEvent=L,cc.EventListener.call(this,cc.EventListener.ACCELERATION,F.ACCELERATION,this._callback)};N.extend(l,cc.EventListener),N.mixin(l.prototype,{constructor:l,_onAccelerationEvent:null,_callback:function(L){this._onAccelerationEvent(L.acc,L)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new l(this._onAccelerationEvent)}});var h=function(){cc.EventListener.call(this,cc.EventListener.KEYBOARD,F.KEYBOARD,this._callback)};N.extend(h,cc.EventListener),N.mixin(h.prototype,{constructor:h,onKeyPressed:null,onKeyReleased:null,_callback:function(L){L.isPressed?this.onKeyPressed&&this.onKeyPressed(L.keyCode,L):this.onKeyReleased&&this.onKeyReleased(L.keyCode,L)},clone:function(){var L=new h;return L.onKeyPressed=this.onKeyPressed,L.onKeyReleased=this.onKeyReleased,L},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc.EventListener.create=function(L){cc.assertID(L&&L.event,1900);var D=L.event;delete L.event;var P=null;for(var N in D===cc.EventListener.TOUCH_ONE_BY_ONE?P=new o:D===cc.EventListener.TOUCH_ALL_AT_ONCE?P=new c:D===cc.EventListener.MOUSE?P=new a:D===cc.EventListener.CUSTOM?(P=new s(L.eventName,L.callback),delete L.eventName,delete L.callback):D===cc.EventListener.KEYBOARD?P=new h:D===cc.EventListener.ACCELERATION&&(P=new l(L.callback),delete L.callback),L)P[N]=L[N];return P},D.exports=cc.EventListener},{"../platform/js":157}],102:[function(L,D,P){"use strict";var N=L("../platform/js");L("./CCEventListener");var F=cc.EventListener.ListenerID,s=function(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0};s.prototype={constructor:s,size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(L){0===L._getFixedPriority()?this._sceneGraphListeners.push(L):this._fixedListeners.push(L)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}};var B={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyListeners:{},_inDispatch:0,_isEnabled:!1,_currentTouch:null,_internalCustomListenerIDs:[],_setDirtyForNode:function(L){var D=this._nodeListenersMap[L._id];if(void 0!==D)for(var P=0,N=D.length;P<N;P++){var F=D[P]._getListenerID();null==this._dirtyListeners[F]&&(this._dirtyListeners[F]=!0)}if(L.childrenCount>0)for(var B=L._children,k=0,U=B.length;k<U;k++)this._setDirtyForNode(B[k])},pauseTarget:function(L,D){if(L instanceof cc._BaseNode){var P,N,F=this._nodeListenersMap[L._id];if(F)for(P=0,N=F.length;P<N;P++)F[P]._setPaused(!0);if(!0===D){var B=L._children;for(P=0,N=B?B.length:0;P<N;P++)this.pauseTarget(B[P],!0)}}else cc.warnID(3506)},resumeTarget:function(L,D){if(L instanceof cc._BaseNode){var P,N,F=this._nodeListenersMap[L._id];if(F)for(P=0,N=F.length;P<N;P++)F[P]._setPaused(!1);if(this._setDirtyForNode(L),!0===D){var B=L._children;for(P=0,N=B?B.length:0;P<N;P++)this.resumeTarget(B[P],!0)}}else cc.warnID(3506)},_addListener:function(L){0===this._inDispatch?this._forceAddEventListener(L):this._toAddedListeners.push(L)},_forceAddEventListener:function(L){var D=L._getListenerID(),P=this._listenersMap[D];if(P||(P=new s,this._listenersMap[D]=P),P.push(L),0===L._getFixedPriority()){this._setDirty(D,this.DIRTY_SCENE_GRAPH_PRIORITY);var N=L._getSceneGraphPriority();null===N&&cc.logID(3507),this._associateNodeAndEventListener(N,L),N.activeInHierarchy&&this.resumeTarget(N)}else this._setDirty(D,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(L){return this._listenersMap[L]},_updateDirtyFlagForSceneGraph:function(){var L=this._dirtyListeners;for(var D in L)this._setDirty(D,this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyListeners={}},_removeAllListenersInVector:function(L){if(L)for(var D,P=L.length-1;P>=0;P--)(D=L[P])._setRegistered(!1),null!=D._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(D._getSceneGraphPriority(),D),D._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.removeAt(L,P)},_removeListenersForListenerID:function(L){var D,P=this._listenersMap[L];if(P){var N=P.getFixedPriorityListeners(),F=P.getSceneGraphPriorityListeners();this._removeAllListenersInVector(F),this._removeAllListenersInVector(N),delete this._priorityDirtyFlagMap[L],this._inDispatch||(P.clear(),delete this._listenersMap[L])}var B,k=this._toAddedListeners;for(D=k.length-1;D>=0;D--)(B=k[D])&&B._getListenerID()===L&&cc.js.array.removeAt(k,D)},_sortEventListeners:function(L){var D=this.DIRTY_NONE,P=this._priorityDirtyFlagMap;P[L]&&(D=P[L]),D!==this.DIRTY_NONE&&(P[L]=this.DIRTY_NONE,D&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(L),D&this.DIRTY_SCENE_GRAPH_PRIORITY&&cc.director.getScene()&&this._sortListenersOfSceneGraphPriority(L))},_sortListenersOfSceneGraphPriority:function(L){var D=this._getListeners(L);if(D){var P=D.getSceneGraphPriorityListeners();P&&0!==P.length&&D.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes)}},_sortEventListenersOfSceneGraphPriorityDes:function(L,D){var P=L._getSceneGraphPriority(),N=D._getSceneGraphPriority();if(!(D&&N&&N._activeInHierarchy&&null!==N._parent))return-1;if(!L||!P||!P._activeInHierarchy||null===P._parent)return 1;for(var F=P,B=N,k=!1;F._parent._id!==B._parent._id;)F=null===F._parent._parent?(k=!0)&&N:F._parent,B=null===B._parent._parent?(k=!0)&&P:B._parent;if(F._id===B._id){if(F._id===N._id)return-1;if(F._id===P._id)return 1}return k?F._localZOrder-B._localZOrder:B._localZOrder-F._localZOrder},_sortListenersOfFixedPriority:function(L){var D=this._listenersMap[L];if(D){var P=D.getFixedPriorityListeners();if(P&&0!==P.length){P.sort(this._sortListenersOfFixedPriorityAsc);for(var N=0,F=P.length;N<F&&!(P[N]._getFixedPriority()>=0);)++N;D.gt0Index=N}}},_sortListenersOfFixedPriorityAsc:function(L,D){return L._getFixedPriority()-D._getFixedPriority()},_onUpdateListeners:function(L){var D,P,N,F=L.getFixedPriorityListeners(),B=L.getSceneGraphPriorityListeners(),k=this._toRemovedListeners;if(B)for(D=B.length-1;D>=0;D--)(P=B[D])._isRegistered()||(cc.js.array.removeAt(B,D),-1!==(N=k.indexOf(P))&&k.splice(N,1));if(F)for(D=F.length-1;D>=0;D--)(P=F[D])._isRegistered()||(cc.js.array.removeAt(F,D),-1!==(N=k.indexOf(P))&&k.splice(N,1));B&&0===B.length&&L.clearSceneGraphListeners(),F&&0===F.length&&L.clearFixedListeners()},frameUpdateListeners:function(){var L=this._listenersMap,D=this._priorityDirtyFlagMap;for(var P in L)L[P].empty()&&(delete D[P],delete L[P]);var N=this._toAddedListeners;if(0!==N.length){for(var F=0,B=N.length;F<B;F++)this._forceAddEventListener(N[F]);N.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(L){var D=this._inDispatch;if(cc.assertID(D>0,3508),!(D>1)){var P;(P=this._listenersMap[F.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(P),(P=this._listenersMap[F.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(P),cc.assertID(1===D,3509);var N=this._toAddedListeners;if(0!==N.length){for(var B=0,k=N.length;B<k;B++)this._forceAddEventListener(N[B]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var L=this._toRemovedListeners,D=0;D<L.length;D++){var P=L[D],N=this._listenersMap[P._getListenerID()];if(N){var F,B=N.getFixedPriorityListeners(),k=N.getSceneGraphPriorityListeners();k&&-1!==(F=k.indexOf(P))&&k.splice(F,1),B&&-1!==(F=B.indexOf(P))&&B.splice(F,1)}}L.length=0},_onTouchEventCallback:function(L,D){if(!L._isRegistered())return!1;var P=D.event,N=P.currentTouch;P.currentTarget=L._node;var F,k=!1,U=P.getEventCode(),V=cc.Event.EventTouch;if(U===V.BEGAN){if(!cc.macro.ENABLE_MULTI_TOUCH&&B._currentTouch)return!1;L.onTouchBegan&&(k=L.onTouchBegan(N,P))&&L._registered&&(L._claimedTouches.push(N),B._currentTouch=N)}else if(L._claimedTouches.length>0&&-1!==(F=L._claimedTouches.indexOf(N))){if(k=!0,!cc.macro.ENABLE_MULTI_TOUCH&&B._currentTouch&&B._currentTouch!==N)return!1;U===V.MOVED&&L.onTouchMoved?L.onTouchMoved(N,P):U===V.ENDED?(L.onTouchEnded&&L.onTouchEnded(N,P),L._registered&&L._claimedTouches.splice(F,1),B._currentTouch=null):U===V.CANCELLED&&(L.onTouchCancelled&&L.onTouchCancelled(N,P),L._registered&&L._claimedTouches.splice(F,1),B._currentTouch=null)}return P.isStopped()?(B._updateTouchListeners(P),!0):!(!k||!L.swallowTouches||(D.needsMutableSet&&D.touches.splice(N,1),0))},_dispatchTouchEvent:function(L){this._sortEventListeners(F.TOUCH_ONE_BY_ONE),this._sortEventListeners(F.TOUCH_ALL_AT_ONCE);var D=this._getListeners(F.TOUCH_ONE_BY_ONE),P=this._getListeners(F.TOUCH_ALL_AT_ONCE);if(null!==D||null!==P){var N=L.getTouches(),B=cc.js.array.copy(N),k={event:L,needsMutableSet:D&&P,touches:B,selTouch:null};if(D)for(var U=0;U<N.length;U++)L.currentTouch=N[U],L._propagationStopped=L._propagationImmediateStopped=!1,this._dispatchEventToListeners(D,this._onTouchEventCallback,k);P&&B.length>0&&(this._dispatchEventToListeners(P,this._onTouchesEventCallback,{event:L,touches:B}),L.isStopped())||this._updateTouchListeners(L)}},_onTouchesEventCallback:function(L,D){if(!L._registered)return!1;var P=cc.Event.EventTouch,N=D.event,F=D.touches,k=N.getEventCode();return N.currentTarget=L._node,k===P.BEGAN&&L.onTouchesBegan?L.onTouchesBegan(F,N):k===P.MOVED&&L.onTouchesMoved?L.onTouchesMoved(F,N):k===P.ENDED&&L.onTouchesEnded?L.onTouchesEnded(F,N):k===P.CANCELLED&&L.onTouchesCancelled&&L.onTouchesCancelled(F,N),!!N.isStopped()&&(B._updateTouchListeners(N),!0)},_associateNodeAndEventListener:function(L,D){var P=this._nodeListenersMap[L._id];P||(P=[],this._nodeListenersMap[L._id]=P),P.push(D)},_dissociateNodeAndEventListener:function(L,D){var P=this._nodeListenersMap[L._id];P&&(cc.js.array.remove(P,D),0===P.length&&delete this._nodeListenersMap[L._id])},_dispatchEventToListeners:function(L,D,P){var N,F,B=!1,k=L.getFixedPriorityListeners(),U=L.getSceneGraphPriorityListeners(),V=0;if(k&&0!==k.length)for(;V<L.gt0Index;++V)if((F=k[V]).isEnabled()&&!F._isPaused()&&F._isRegistered()&&D(F,P)){B=!0;break}if(U&&!B)for(N=0;N<U.length;N++)if((F=U[N]).isEnabled()&&!F._isPaused()&&F._isRegistered()&&D(F,P)){B=!0;break}if(k&&!B)for(;V<k.length;++V)if((F=k[V]).isEnabled()&&!F._isPaused()&&F._isRegistered()&&D(F,P)){B=!0;break}},_setDirty:function(L,D){var P=this._priorityDirtyFlagMap;null==P[L]?P[L]=D:P[L]=D|P[L]},_sortNumberAsc:function(L,D){return L-D},hasEventListener:function(L){return!!this._getListeners(L)},addListener:function(L,D){if(cc.assertID(L&&D,3503),cc.js.isNumber(D)||D instanceof cc._BaseNode){if(L instanceof cc.EventListener){if(L._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(D),3504),L=cc.EventListener.create(L);if(L.checkAvailable()){if(cc.js.isNumber(D)){if(0===D)return void cc.logID(3500);L._setSceneGraphPriority(null),L._setFixedPriority(D),L._setRegistered(!0),L._setPaused(!1),this._addListener(L)}else L._setSceneGraphPriority(D),L._setFixedPriority(0),L._setRegistered(!0),this._addListener(L);return L}}else cc.warnID(3506)},addCustomListener:function(L,D){var P=new cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:L,callback:D});return this.addListener(P,1),P},removeListener:function(L){if(null!=L){var D,P=this._listenersMap;for(var N in P){var F=P[N],B=F.getFixedPriorityListeners(),k=F.getSceneGraphPriorityListeners();if((D=this._removeListenerInVector(k,L))?this._setDirty(L._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(D=this._removeListenerInVector(B,L))&&this._setDirty(L._getListenerID(),this.DIRTY_FIXED_PRIORITY),F.empty()&&(delete this._priorityDirtyFlagMap[L._getListenerID()],delete P[N]),D)break}if(!D)for(var U=this._toAddedListeners,V=U.length-1;V>=0;V--){var z=U[V];if(z===L){cc.js.array.removeAt(U,V),z._setRegistered(!1);break}}}},_removeListenerInCallback:function(L,D){if(null==L)return!1;for(var P=L.length-1;P>=0;P--){var N=L[P];if(N._onCustomEvent===D||N._onEvent===D)return N._setRegistered(!1),null!=N._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(N._getSceneGraphPriority(),N),N._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(L,P):this._toRemovedListeners.push(N),!0}return!1},_removeListenerInVector:function(L,D){if(null==L)return!1;for(var P=L.length-1;P>=0;P--){var N=L[P];if(N===D)return N._setRegistered(!1),null!=N._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(N._getSceneGraphPriority(),N),N._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.removeAt(L,P):this._toRemovedListeners.push(N),!0}return!1},removeListeners:function(L,D){var P=this;if(cc.js.isNumber(L)||L instanceof cc._BaseNode)if(void 0!==L._id){var N,B=P._nodeListenersMap[L._id];if(B){var k=cc.js.array.copy(B);for(N=0;N<k.length;N++)P.removeListener(k[N]);delete P._nodeListenersMap[L._id]}var U=P._toAddedListeners;for(N=0;N<U.length;){var V=U[N];V._getSceneGraphPriority()===L?(V._setSceneGraphPriority(null),V._setRegistered(!1),U.splice(N,1)):++N}if(!0===D){var z,W=L.children;for(N=0,z=W.length;N<z;N++)P.removeListeners(W[N],!0)}}else L===cc.EventListener.TOUCH_ONE_BY_ONE?P._removeListenersForListenerID(F.TOUCH_ONE_BY_ONE):L===cc.EventListener.TOUCH_ALL_AT_ONCE?P._removeListenersForListenerID(F.TOUCH_ALL_AT_ONCE):L===cc.EventListener.MOUSE?P._removeListenersForListenerID(F.MOUSE):L===cc.EventListener.ACCELERATION?P._removeListenersForListenerID(F.ACCELERATION):L===cc.EventListener.KEYBOARD?P._removeListenersForListenerID(F.KEYBOARD):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(L){this._removeListenersForListenerID(L)},removeAllListeners:function(){var L=this._listenersMap,D=this._internalCustomListenerIDs;for(var P in L)-1===D.indexOf(P)&&this._removeListenersForListenerID(P)},setPriority:function(L,D){if(null!=L){var P=this._listenersMap;for(var N in P){var F=P[N].getFixedPriorityListeners();if(F&&-1!==F.indexOf(L))return null!=L._getSceneGraphPriority()&&cc.logID(3502),void(L._getFixedPriority()!==D&&(L._setFixedPriority(D),this._setDirty(L._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(L){this._isEnabled=L},isEnabled:function(){return this._isEnabled},dispatchEvent:function(L){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,L&&L.getType){if(L.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(L),void this._inDispatch--;var D=function(L){var D=cc.Event,P=L.type;return P===D.ACCELERATION?F.ACCELERATION:P===D.KEYBOARD?F.KEYBOARD:P.startsWith(D.MOUSE)?F.MOUSE:(P.startsWith(D.TOUCH)&&cc.logID(2e3),"")}(L);this._sortEventListeners(D);var P=this._listenersMap[D];null!=P&&(this._dispatchEventToListeners(P,this._onListenerCallback,L),this._onUpdateListeners(P)),this._inDispatch--}else cc.errorID(3511)},_onListenerCallback:function(L,D){return D.currentTarget=L._target,L._onEvent(D),D.isStopped()},dispatchCustomEvent:function(L,D){var P=new cc.Event.EventCustom(L);P.setUserData(D),this.dispatchEvent(P)}};N.get(cc,"eventManager",(function(){return cc.warnID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),B})),D.exports=cc.internal.eventManager=B},{"../platform/js":157,"./CCEventListener":101}],103:[function(L,D,P){"use strict";cc.Touch=function(L,D,P){this._lastModified=0,this.setTouchInfo(P,L,D)},cc.Touch.prototype={constructor:cc.Touch,getLocation:function(){return cc.v2(this._point.x,this._point.y)},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return cc.v2(this._prevPoint.x,this._prevPoint.y)},getStartLocation:function(){return cc.v2(this._startPoint.x,this._startPoint.y)},getDelta:function(){return this._point.sub(this._prevPoint)},getLocationInView:function(){return cc.v2(this._point.x,cc.view._designResolutionSize.height-this._point.y)},getPreviousLocationInView:function(){return cc.v2(this._prevPoint.x,cc.view._designResolutionSize.height-this._prevPoint.y)},getStartLocationInView:function(){return cc.v2(this._startPoint.x,cc.view._designResolutionSize.height-this._startPoint.y)},getID:function(){return this._id},setTouchInfo:function(L,D,P){this._prevPoint=this._point,this._point=cc.v2(D||0,P||0),this._id=L,this._startPointCaptured||(this._startPoint=cc.v2(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(L,D){void 0===D?(this._point.x=L.x,this._point.y=L.y):(this._point.x=L,this._point.y=D)},_setPrevPoint:function(L,D){this._prevPoint=void 0===D?cc.v2(L.x,L.y):cc.v2(L||0,D||0)}}},{}],104:[function(L,D,P){"use strict";L("./CCEvent"),L("./CCTouch"),L("./CCEventListener");var N=L("./CCEventManager");D.exports=N},{"./CCEvent":100,"./CCEventListener":101,"./CCEventManager":102,"./CCTouch":103}],105:[function(L,D,P){"use strict";var N=cc.js,F=L("../platform/callbacks-invoker");function s(){F.call(this)}N.extend(s,F),s.prototype.emit=function(L,D){var P=L.type,N=this._callbackTable[P];if(N){var F=!N.isInvoking;N.isInvoking=!0;for(var B=N.callbackInfos,k=0,U=B.length;k<U;++k){var V=B[k];if(V&&V.callback&&(V.callback.call(V.target,L,D),L._propagationImmediateStopped))break}F&&(N.isInvoking=!1,N.containCanceled&&N.purgeCanceled())}},D.exports=s},{"../platform/callbacks-invoker":150}],106:[function(L,D,P){"use strict";var N=L("../platform/js"),F=L("../platform/callbacks-invoker"),B=N.array.fastRemove;function a(){F.call(this)}N.extend(a,F);var k=a.prototype;k.__on=k.on,k.on=function(L,D,P,N){if(D)return this.hasEventListener(L,D,P)||(this.__on(L,D,P,N),P&&P.__eventTargets&&P.__eventTargets.push(this)),D;cc.errorID(6800)},k.__off=k.off,k.off=function(L,D,P){if(D)this.__off(L,D,P),P&&P.__eventTargets&&B(P.__eventTargets,this);else{var N=this._callbackTable[L];if(!N)return;for(var F=N.callbackInfos,k=0;k<F.length;++k){var U=F[k]&&F[k].target;U&&U.__eventTargets&&B(U.__eventTargets,this)}this.removeAll(L)}},k.targetOff=function(L){this.removeAll(L),L&&L.__eventTargets&&B(L.__eventTargets,this)},k.once=function(L,D,P){this.on(L,D,P,!0)},k.dispatchEvent=function(L){this.emit(L.type,L)},cc.EventTarget=D.exports=a},{"../platform/callbacks-invoker":150,"../platform/js":157}],107:[function(L,D,P){"use strict";var N=L("../platform/js");cc.Event=function(L,D){this.type=L,this.bubbles=!!D,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(L,D){this.type=L,this.bubbles=D||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(L,D){cc.Event.call(this,L,D),this.detail=null};N.extend(r,cc.Event),r.prototype.reset=r,r.prototype.setUserData=function(L){this.detail=L},r.prototype.getUserData=function(){return this.detail},r.prototype.getEventName=cc.Event.prototype.getType;var F=new N.Pool(10);r.put=function(L){F.put(L)},r.get=function(L,D){var P=F._get();return P?P.reset(L,D):P=new r(L,D),P},cc.Event.EventCustom=r,D.exports=cc.Event},{"../platform/js":157}],108:[function(L,D,P){"use strict";L("./event"),L("./event-listeners"),L("./event-target"),L("./system-event")},{"./event":107,"./event-listeners":105,"./event-target":106,"./system-event":109}],109:[function(L,D,P){"use strict";var N=L("../event/event-target"),F=L("../event-manager"),B=L("../platform/CCInputManager"),k=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),U=null,V=null,z=cc.Class({name:"SystemEvent",extends:N,statics:{EventType:k},setAccelerometerEnabled:function(L){L&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(L){console.log("Device Motion Event request permission: "+L),B.setAccelerometerEnabled("granted"===L)})):B.setAccelerometerEnabled(L)},setAccelerometerInterval:function(L){B.setAccelerometerInterval(L)},on:function(L,D,P,N){this._super(L,D,P,N),L!==k.KEY_DOWN&&L!==k.KEY_UP||(U||(U=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(L,D){D.type=k.KEY_DOWN,cc.systemEvent.dispatchEvent(D)},onKeyReleased:function(L,D){D.type=k.KEY_UP,cc.systemEvent.dispatchEvent(D)}})),F.hasEventListener(cc.EventListener.ListenerID.KEYBOARD)||F.addListener(U,1)),L===k.DEVICEMOTION&&(V||(V=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(L,D){D.type=k.DEVICEMOTION,cc.systemEvent.dispatchEvent(D)}})),F.hasEventListener(cc.EventListener.ListenerID.ACCELERATION)||F.addListener(V,1))},off:function(L,D,P){if(this._super(L,D,P),U&&(L===k.KEY_DOWN||L===k.KEY_UP)){var N=this.hasEventListener(k.KEY_DOWN),B=this.hasEventListener(k.KEY_UP);N||B||F.removeListener(U)}V&&L===k.DEVICEMOTION&&F.removeListener(V)}});cc.SystemEvent=D.exports=z,cc.systemEvent=new cc.SystemEvent},{"../event-manager":104,"../event/event-target":106,"../platform/CCInputManager":141}],110:[function(L,D,P){"use strict";var N=L("../components/CCRenderComponent"),F=L("../assets/material/CCMaterial"),B=L("./types"),k=B.LineCap,U=B.LineJoin,V=cc.Class({name:"cc.Graphics",extends:N,editor:!1,ctor:function(){this._impl=new V._Impl(this)},properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:U.MITER,_lineCap:k.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(L){this._lineWidth=L,this._impl.lineWidth=L}},lineJoin:{get:function(){return this._lineJoin},set:function(L){this._lineJoin=L,this._impl.lineJoin=L},type:U},lineCap:{get:function(){return this._lineCap},set:function(L){this._lineCap=L,this._impl.lineCap=L},type:k},strokeColor:{get:function(){return this._strokeColor},set:function(L){this._impl.strokeColor=this._strokeColor=cc.color(L)}},fillColor:{get:function(){return this._fillColor},set:function(L){this._impl.fillColor=this._fillColor=cc.color(L)}},miterLimit:{get:function(){return this._miterLimit},set:function(L){this._miterLimit=L,this._impl.miterLimit=L}}},statics:{LineJoin:U,LineCap:k},onRestore:function(){this._impl||(this._impl=new V._Impl(this))},onDestroy:function(){this.clear(!0),this._super(),this._impl=null},_getDefaultMaterial:function(){return F.getBuiltinMaterial("2d-base")},_updateMaterial:function(){var L=this._materials[0];L&&L.define("CC_USE_MODEL",!0)},moveTo:function(L,D){this._impl.moveTo(L,D)},lineTo:function(L,D){this._impl.lineTo(L,D)},bezierCurveTo:function(L,D,P,N,F,B){this._impl.bezierCurveTo(L,D,P,N,F,B)},quadraticCurveTo:function(L,D,P,N){this._impl.quadraticCurveTo(L,D,P,N)},arc:function(L,D,P,N,F,B){this._impl.arc(L,D,P,N,F,B)},ellipse:function(L,D,P,N){this._impl.ellipse(L,D,P,N)},circle:function(L,D,P){this._impl.circle(L,D,P)},rect:function(L,D,P,N){this._impl.rect(L,D,P,N)},roundRect:function(L,D,P,N,F){this._impl.roundRect(L,D,P,N,F)},fillRect:function(L,D,P,N){this.rect(L,D,P,N),this.fill()},clear:function(L){this._impl.clear(L),this._assembler&&this._assembler.clear(L)},close:function(){this._impl.close()},stroke:function(){this._assembler||this._resetAssembler(),this._assembler.stroke(this)},fill:function(){this._assembler||this._resetAssembler(),this._assembler.fill(this)}});cc.Graphics=D.exports=V,cc.Graphics.Types=B,cc.Graphics.Helper=L("./helper")},{"../assets/material/CCMaterial":48,"../components/CCRenderComponent":84,"./helper":111,"./types":113}],111:[function(L,D,P){"use strict";var N=L("./types").PointFlags,F=Math.PI,B=Math.min,k=Math.max,U=Math.cos,V=Math.sin,z=Math.abs,W=Math.sign,H=.5522847493;D.exports={arc:function(L,D,P,N,W,H,G){var X,nt,ut,dt=0,ft=0,_t=0,pt=0,vt=0,gt=0,mt=0,yt=0,Tt=0,xt=0,St=0,bt=0,wt=0;if(ft=H-W,G=G||!1)if(z(ft)>=2*F)ft=2*F;else for(;ft<0;)ft+=2*F;else if(z(ft)>=2*F)ft=2*-F;else for(;ft>0;)ft-=2*F;for(ut=0|k(1,B(z(ft)/(.5*F)+.5,5)),_t=z(4/3*(1-U(X=ft/ut/2))/V(X)),G||(_t=-_t),nt=0;nt<=ut;nt++)gt=D+(pt=U(dt=W+ft*(nt/ut)))*N,mt=P+(vt=V(dt))*N,yt=-vt*N*_t,Tt=pt*N*_t,0===nt?L.moveTo(gt,mt):L.bezierCurveTo(xt+bt,St+wt,gt-yt,mt-Tt,gt,mt),xt=gt,St=mt,bt=yt,wt=Tt},ellipse:function(L,D,P,N,F){L.moveTo(D-N,P),L.bezierCurveTo(D-N,P+F*H,D-N*H,P+F,D,P+F),L.bezierCurveTo(D+N*H,P+F,D+N,P+F*H,D+N,P),L.bezierCurveTo(D+N,P-F*H,D+N*H,P-F,D,P-F),L.bezierCurveTo(D-N*H,P-F,D-N,P-F*H,D-N,P),L.close()},roundRect:function(L,D,P,N,F,k){if(k<.1)L.rect(D,P,N,F);else{var U=B(k,.5*z(N))*W(N),V=B(k,.5*z(F))*W(F);L.moveTo(D,P+V),L.lineTo(D,P+F-V),L.bezierCurveTo(D,P+F-V*(1-H),D+U*(1-H),P+F,D+U,P+F),L.lineTo(D+N-U,P+F),L.bezierCurveTo(D+N-U*(1-H),P+F,D+N,P+F-V*(1-H),D+N,P+F-V),L.lineTo(D+N,P+V),L.bezierCurveTo(D+N,P+V*(1-H),D+N-U*(1-H),P,D+N-U,P),L.lineTo(D+U,P),L.bezierCurveTo(D+U*(1-H),P,D,P+V*(1-H),D,P+V),L.close()}},tesselateBezier:function t(L,D,P,F,B,k,U,V,W,H,G){var X,nt,ut,dt,ft,_t,pt,vt,gt,mt,yt,Tt,xt,St,bt,wt;H>10||(ft=.5*(k+V),_t=.5*(U+W),pt=.5*((X=.5*(D+F))+(ut=.5*(F+k))),vt=.5*((nt=.5*(P+B))+(dt=.5*(B+U))),((bt=z((F-V)*(St=W-P)-(B-W)*(xt=V-D)))+(wt=z((k-V)*St-(U-W)*xt)))*(bt+wt)<L._tessTol*(xt*xt+St*St)?L._addPoint(V,W,0===G?G|N.PT_BEVEL:G):(t(L,D,P,X,nt,pt,vt,yt=.5*(pt+(gt=.5*(ut+ft))),Tt=.5*(vt+(mt=.5*(dt+_t))),H+1,0),t(L,yt,Tt,gt,mt,ft,_t,V,W,H+1,G)))}}},{"./types":113}],112:[function(L,D,P){"use strict";L("./graphics")},{"./graphics":110}],113:[function(L,D,P){"use strict";var N=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),F=cc.Enum({BEVEL:0,ROUND:1,MITER:2}),B=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});D.exports={LineCap:N,LineJoin:F,PointFlags:B}},{}],114:[function(L,D,P){"use strict";L("./platform"),L("./assets"),L("./CCNode"),L("./CCPrivateNode"),L("./CCScene"),L("./components"),L("./graphics"),L("./collider"),L("./collider/CCIntersection"),L("./physics"),L("./camera/CCCamera"),L("./geom-utils"),L("./mesh"),L("./3d"),L("./base-ui/CCWidgetManager")},{"./3d":void 0,"./CCNode":25,"./CCPrivateNode":26,"./CCScene":27,"./assets":46,"./base-ui/CCWidgetManager":57,"./camera/CCCamera":58,"./collider":66,"./collider/CCIntersection":64,"./components":98,"./geom-utils":void 0,"./graphics":112,"./mesh":void 0,"./physics":void 0,"./platform":154}],115:[function(L,D,P){"use strict";var N=L("../platform/js"),F=L("./pipeline"),B=L("./loading-items"),k=L("./asset-loader"),U=L("./downloader"),V=L("./loader"),z=L("./asset-table"),W=L("../platform/utils").callInNextTick,H=L("./auto-release-utils"),G=Object.create(null);G.assets=new z,G.internal=new z;var X={url:null,raw:!1};function _(L){var D,P,N;if("object"==typeof L){if(P=L,L.url)return P;D=L.uuid}else P={},D=L;return N=P.type?"uuid"===P.type:cc.AssetLibrary._uuidInSettings(D),cc.AssetLibrary._getAssetInfoInRuntime(D,X),P.url=N?X.url:D,X.url&&"uuid"===P.type&&X.raw?(P.type=null,P.isRawAsset=!0):N||(P.isRawAsset=!0),P}var nt=[],ut=[];function g(){var L=new k,D=new U,P=new V;F.call(this,[L,D,P]),this.assetLoader=L,this.md5Pipe=null,this.downloader=D,this.loader=P,this.onProgress=null,this._autoReleaseSetting=N.createMap(!0)}N.extend(g,F);var dt=g.prototype;dt.init=function(L){},dt.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},dt.addDownloadHandlers=function(L){this.downloader.addHandlers(L)},dt.addLoadHandlers=function(L){this.loader.addHandlers(L)},dt.load=function(L,D,P){void 0===P&&(P=D,D=this.onProgress||null);var N,F=this,k=!1;L instanceof Array||(L?(k=!0,L=[L]):L=[]),nt.length=0;for(var U=0;U<L.length;++U){var V=L[U];if(V&&V.id&&(cc.warnID(4920,V.id),V.uuid||V.url||(V.url=V.id)),(N=_(V)).url||N.uuid){var z=this._cache[N.url];nt.push(z||N)}}var H=B.create(this,D,(function(L,D){W((function(){if(P){if(k){var B=N.url;P.call(F,L,D.getContent(B))}else P.call(F,L,D);P=null}D.destroy()}))}));B.initQueueDeps(H),H.append(nt),nt.length=0},dt.flowInDeps=function(L,D,P){ut.length=0;for(var N=0;N<D.length;++N){var F=_(D[N]);if(F.url||F.uuid){var k=this._cache[F.url];k?ut.push(k):ut.push(F)}}var U=B.create(this,L?function(L,D,P){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(P)}:null,(function(D,N){P(D,N),L&&L.deps&&(L.deps.length=0),N.destroy()}));if(L){var V=B.getQueue(L);U._ownerQueue=V._ownerQueue||V}var z=U.append(ut,L);return ut.length=0,z},dt._assetTables=G,dt._getResUuid=function(L,D,P,N){var F=G[P=P||"assets"];if(!L||!F)return null;var B=L.indexOf("?");-1!==B&&(L=L.substr(0,B));var k=F.getUuid(L,D);if(!k){var U=cc.path.extname(L);U&&(L=L.slice(0,-U.length),(k=F.getUuid(L,D))&&!N&&cc.warnID(4901,L,U))}return k},dt._getReferenceKey=function(L){var D;return"object"==typeof L?D=L._uuid||null:"string"==typeof L&&(D=this._getResUuid(L,null,null,!0)||L),D?(cc.AssetLibrary._getAssetInfoInRuntime(D,X),this._cache[X.url]?X.url:D):(cc.warnID(4800,L),D)},dt._urlNotFound=function(L,D,P){W((function(){L=cc.url.normalize(L);var F=(D?N.getClassName(D):"Asset")+' in "resources/'+L+'" does not exist.';P&&P(new Error(F),[])}))},dt._parseLoadResArgs=function(L,D,P){if(void 0===P){var F=L instanceof Array||N.isChildClassOf(L,cc.RawAsset);D?(P=D,F&&(D=this.onProgress||null)):void 0!==D||F||(P=L,D=this.onProgress||null,L=null),void 0===D||F||(D=L,L=null)}return{type:L,onProgress:D,onComplete:P}},dt.loadRes=function(L,D,P,N,F){5!==arguments.length&&(F=N,N=P,P="assets");var B=this._parseLoadResArgs(D,N,F);D=B.type,N=B.onProgress,F=B.onComplete;var k=this,U=k._getResUuid(L,D,P);U?this.load({type:"uuid",uuid:U},N,(function(L,D){D&&k.setAutoReleaseRecursively(U,!1),F&&F(L,D)})):k._urlNotFound(L,D,F)},dt._loadResUuids=function(L,D,P,N){if(L.length>0){var F=this,B=L.map((function(L){return{type:"uuid",uuid:L}}));this.load(B,D,(function(L,D){if(P){for(var k=[],U=N&&[],V=0;V<B.length;++V){var z=B[V].uuid,W=this._getReferenceKey(z),H=D.getContent(W);H&&(F.setAutoReleaseRecursively(z,!1),k.push(H),U&&U.push(N[V]))}N?P(L,k,U):P(L,k)}}))}else P&&W((function(){N?P(null,[],[]):P(null,[])}))},dt.loadResArray=function(L,D,P,N,F){5!==arguments.length&&(F=N,N=P,P="assets");var B=this._parseLoadResArgs(D,N,F);D=B.type,N=B.onProgress,F=B.onComplete;for(var k=[],U=D instanceof Array,V=0;V<L.length;V++){var z=L[V],W=U?D[V]:D,H=this._getResUuid(z,W,P);if(!H)return void this._urlNotFound(z,W,F);k.push(H)}this._loadResUuids(k,N,F)},dt.loadResDir=function(L,D,P,N,F){if(5!==arguments.length&&(F=N,N=P,P="assets"),G[P]){var B=this._parseLoadResArgs(D,N,F);D=B.type,N=B.onProgress,F=B.onComplete;var k=[],U=G[P].getUuidArray(L,D,k);this._loadResUuids(U,N,F,k)}},dt.getRes=function(L,D){var P=this._cache[L];if(!P){var N=this._getResUuid(L,D,null,!0);if(!N)return null;var F=this._getReferenceKey(N);P=this._cache[F]}return P&&P.alias&&(P=P.alias),P&&P.complete?P.content:null},dt.getResCount=function(){return Object.keys(this._cache).length},dt.getDependsRecursively=function(L){if(L){var D=this._getReferenceKey(L),P=H.getDependsRecursively(D);return P.push(D),P}return[]},dt.release=function(L){if(Array.isArray(L))for(var D=0;D<L.length;D++){var P=L[D];this.release(P)}else if(L){var N=this._getReferenceKey(L);if(N&&N in cc.AssetLibrary.getBuiltinDeps())return;var F=this.getItem(N);if(F&&(this.removeItem(N),L=F.content),L instanceof cc.Asset){var B=L.nativeUrl;B&&this.release(B),L.destroy()}}},dt.releaseAsset=function(L){var D=L._uuid;D&&this.release(D)},dt.releaseRes=function(L,D,P){var N=this._getResUuid(L,D,P);N?this.release(N):cc.errorID(4914,L)},dt.releaseResDir=function(L,D,P){if(G[P=P||"assets"])for(var N=G[P].getUuidArray(L,D),F=0;F<N.length;F++){var B=N[F];this.release(B)}},dt.releaseAll=function(){for(var L in this._cache)this.release(L)},dt.removeItem=function(L){var D=F.prototype.removeItem.call(this,L);return delete this._autoReleaseSetting[L],D},dt.setAutoRelease=function(L,D){var P=this._getReferenceKey(L);P&&(this._autoReleaseSetting[P]=!!D)},dt.setAutoReleaseRecursively=function(L,D){D=!!D;var P=this._getReferenceKey(L);if(P){this._autoReleaseSetting[P]=D;for(var N=H.getDependsRecursively(P),F=0;F<N.length;F++){var B=N[F];this._autoReleaseSetting[B]=D}}},dt.isAutoRelease=function(L){var D=this._getReferenceKey(L);return!!D&&!!this._autoReleaseSetting[D]},cc.loader=new g,D.exports=cc.loader},{"../platform/js":157,"../platform/utils":161,"./asset-loader":116,"./asset-table":117,"./auto-release-utils":119,"./downloader":121,"./loader":124,"./loading-items":125,"./pipeline":128,"./released-asset-checker":129}],116:[function(L,D,P){"use strict";L("../utils/CCPath");var N=L("../CCDebug"),F=L("./pipeline"),B=L("./loading-items"),k="AssetLoader",o=function(L){this.id=k,this.async=!0,this.pipeline=null};o.ID=k;var U=[];o.prototype.handle=function(L,D){var P=L.uuid;if(!P)return L.content||null;cc.AssetLibrary.queryAssetInfo(P,(function(F,k,V){if(F)D(F);else if(L.url=L.rawUrl=k,L.isRawAsset=V,V){var z=cc.path.extname(k).toLowerCase();if(!z)return void D(new Error(N.getError(4931,P,k)));z=z.substr(1);var W=B.getQueue(L);U[0]={queueId:L.queueId,id:k,url:k,type:z,error:null,alias:L,complete:!0},W.append(U),L.type=z,D(null,L.content)}else L.type="uuid",D(null,L.content)}))},F.AssetLoader=D.exports=o},{"../CCDebug":22,"../utils/CCPath":201,"./loading-items":125,"./pipeline":128}],117:[function(L,D,P){"use strict";var N=L("../utils/misc").pushToMap,F=L("../platform/js");function s(L,D){this.uuid=L,this.type=D}function a(){this._pathToUuid=F.createMap(!0)}function o(L,D){if(L.length>D.length){var P=L.charCodeAt(D.length);return 46===P||47===P}return!0}var B=a.prototype;B.getUuid=function(L,D){L=cc.url.normalize(L);var P=this._pathToUuid[L];if(P)if(Array.isArray(P)){if(!D)return P[0].uuid;for(var N=0;N<P.length;N++){var B=P[N];if(F.isChildClassOf(B.type,D))return B.uuid}}else if(!D||F.isChildClassOf(P.type,D))return P.uuid;return""},B.getUuidArray=function(L,D,P){"/"===(L=cc.url.normalize(L))[L.length-1]&&(L=L.slice(0,-1));var N=this._pathToUuid,B=[],k=F.isChildClassOf;for(var U in N)if(U.startsWith(L)&&o(U,L)||!L){var V=N[U];if(Array.isArray(V))for(var z=0;z<V.length;z++){var W=V[z];(!D||k(W.type,D))&&(B.push(W.uuid),P&&P.push(U))}else(!D||k(V.type,D))&&(B.push(V.uuid),P&&P.push(U))}return B},B.add=function(L,D,P,F){L=L.substring(0,L.length-cc.path.extname(L).length);var B=new s(D,P);N(this._pathToUuid,L,B,F)},B._getInfo_DEBUG=!1,B.reset=function(){this._pathToUuid=F.createMap(!0)},D.exports=a},{"../platform/js":157,"../utils/misc":210}],118:[function(L,D,P){"use strict";var N=L("../platform/CCSys"),F=L("../CCDebug"),B=N.__audioSupport,k=B.format,U=B.context;function c(L,D){var P=document.createElement("audio");P.src=L.url;var n=function(){clearTimeout(N),P.removeEventListener("canplaythrough",a,!1),P.removeEventListener("error",o,!1),B.USE_LOADER_EVENT&&P.removeEventListener(B.USE_LOADER_EVENT,a,!1)},N=setTimeout((function(){0===P.readyState?o():a()}),8e3),a=function(){n(),D(null,P)},o=function(){n();var P="load audio failure - "+L.url;cc.log(P),D(P)};P.addEventListener("canplaythrough",a,!1),P.addEventListener("error",o,!1),B.USE_LOADER_EVENT&&P.addEventListener(B.USE_LOADER_EVENT,a,!1)}function l(L,D){U||D(new Error(F.getError(4926)));var P=cc.loader.getXMLHttpRequest();P.open("GET",L.url,!0),P.responseType="arraybuffer",P.onload=function(){U.decodeAudioData(P.response,(function(L){D(null,L)}),(function(){D("decode error - "+L.id,null)}))},P.onerror=function(){D("request error - "+L.id,null)},P.send()}D.exports=function(L,D){if(0===k.length)return new Error(F.getError(4927));(B.WEB_AUDIO?L._owner instanceof cc.AudioClip?L._owner.loadMode===cc.AudioClip.LoadMode.WEB_AUDIO?l:c:L.urlParam&&L.urlParam.useDom?c:l:c)(L,D)}},{"../CCDebug":22,"../platform/CCSys":146}],119:[function(L,D,P){"use strict";var N=L("../platform/js");function r(L,D){var P=cc.loader.getItem(L);if(P){var N=P.dependKeys;if(N)for(var F=0;F<N.length;F++){var B=N[F];D[B]||(D[B]=!0,r(B,D))}}}function s(L,D){if(L._uuid){var P=cc.loader._getReferenceKey(L);D[P]||(D[P]=!0,r(P,D))}}function a(L,D){for(var P=Object.getOwnPropertyNames(L),N=0;N<P.length;N++){var F=L[P[N]];if("object"==typeof F&&F)if(Array.isArray(F))for(var B=0;B<F.length;B++){var k=F[B];k instanceof cc.RawAsset&&s(k,D)}else if(F.constructor&&F.constructor!==Object)F instanceof cc.RawAsset&&s(F,D);else for(var U=Object.getOwnPropertyNames(F),V=0;V<U.length;V++){var z=F[U[V]];z instanceof cc.RawAsset&&s(z,D)}}}function o(L,D){for(var P=0;P<L._components.length;P++)a(L._components[P],D);for(var N=0;N<L._children.length;N++)o(L._children[N],D)}D.exports={autoRelease:function(L,D,P){var F=cc.loader._autoReleaseSetting,B=N.createMap();if(D)for(var k=0;k<D.length;k++)B[D[k]]=!0;for(var U=0;U<P.length;U++)o(P[U],B);if(L)for(var V=0;V<L.length;V++){var z=L[V];!1===F[z]||B[z]||cc.loader.release(z)}for(var W=Object.keys(F),H=0;H<W.length;H++){var G=W[H];!0!==F[G]||B[G]||cc.loader.release(G)}},getDependsRecursively:function(L){var D={};return r(L,D),Object.keys(D)}}},{"../platform/js":157}],120:[function(L,D,P){"use strict";D.exports=function(L,D){var P=L.url,N=cc.loader.getXMLHttpRequest(),F="Load binary data failed: "+P;N.open("GET",P,!0),N.responseType="arraybuffer",N.onload=function(){var L=N.response;if(L){var P=new Uint8Array(L);D(null,P)}else D({status:N.status,errorMessage:F+"(no response)"})},N.onerror=function(){D({status:N.status,errorMessage:F+"(error)"})},N.ontimeout=function(){D({status:N.status,errorMessage:F+"(time out)"})},N.send(null)}},{}],121:[function(L,D,P){"use strict";var N=L("../platform/js"),F=L("../CCDebug");L("../utils/CCPath");var B,k=L("./pipeline"),U=L("./pack-downloader"),V=L("./binary-downloader"),z=L("./text-downloader"),W=L("./utils").urlAppendTimestamp;function u(){return null}function d(L,D,P){var N=L.url,B=document,k=document.createElement("script");function o(){k.parentNode.removeChild(k),k.removeEventListener("load",o,!1),k.removeEventListener("error",c,!1),D(null,N)}function c(){k.parentNode.removeChild(k),k.removeEventListener("load",o,!1),k.removeEventListener("error",c,!1),D(new Error(F.getError(4928,N)))}"file:"!==window.location.protocol&&(k.crossOrigin="anonymous"),k.async=P,k.src=W(N),k.addEventListener("load",o,!1),k.addEventListener("error",c,!1),B.body.appendChild(k)}function f(L,D,P,N){void 0===P&&(P=!0);var B=W(L.url);if(N=N||new Image,P&&"file:"!==window.location.protocol?N.crossOrigin="anonymous":N.crossOrigin=null,N.complete&&N.naturalWidth>0&&N.src===B)return N;var k=function i(){N.removeEventListener("load",i),N.removeEventListener("error",U),N.id=L.id,D(null,N)},U=function i(){N.removeEventListener("load",k),N.removeEventListener("error",i),"https:"!==window.location.protocol&&N.crossOrigin&&"anonymous"===N.crossOrigin.toLowerCase()?f(L,D,!1,N):D(new Error(F.getError(4930,B)))};N.addEventListener("load",k),N.addEventListener("error",U),N.src=B}var H={js:d,png:f,jpg:f,bmp:f,jpeg:f,gif:f,ico:f,tiff:f,webp:f,image:f,pvr:V,pkm:V,mp3:B=L("./audio-downloader"),ogg:B,wav:B,m4a:B,txt:z,xml:z,vsh:z,fsh:z,atlas:z,tmx:z,tsx:z,json:z,ExportJson:z,plist:z,fnt:z,font:u,eot:u,ttf:u,woff:u,svg:u,ttc:u,uuid:function(L,D){var P=U.load(L,D);return void 0===P?this.extMap.json(L,D):P||void 0},binary:V,bin:V,dbbin:V,skel:V,default:z},G="Downloader",v=function(L){this.id=G,this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this._subpackages={},this.extMap=N.mixin(L,H)};v.ID=G,v.PackDownloader=U,v.prototype.addHandlers=function(L){N.mixin(this.extMap,L)},v.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var L=this._loadQueue.shift();if(!L)break;var D=this.handle(L.item,L.callback);void 0!==D&&(D instanceof Error?L.callback(D):L.callback(null,D))}},v.prototype.handle=function(L,D){var P=this,N=this.extMap[L.type]||this.extMap.default,F=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(F=N.call(this,L,(function(L,N){P._curConcurrent=Math.max(0,P._curConcurrent-1),P._handleLoadQueue(),D&&D(L,N)}))))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),F}else if(L.ignoreMaxConcurrency){if(void 0!==(F=N.call(this,L,D)))return F}else this._loadQueue.push({item:L,callback:D})},v.prototype.loadSubpackage=function(L,D,P){!P&&D&&(P=D,D=null);var N=this._subpackages[L];N?N.loaded?P&&P():d({url:N.path+"index.js"},(function(L){L||(N.loaded=!0),P&&P(L)})):P&&P(new Error("Can't find subpackage "+L))},k.Downloader=D.exports=v},{"../CCDebug":22,"../platform/js":157,"../utils/CCPath":201,"./audio-downloader":118,"./binary-downloader":120,"./pack-downloader":127,"./pipeline":128,"./text-downloader":131,"./utils":133}],122:[function(L,D,P){"use strict";var N=L("../utils/text-utils"),F=null,B="BES bswy:->@123",k={},U=-1,V=[],z=3e3,W=function(){var L=void 0;return function(){if(void 0===L)if(window.FontFace){var D=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),P=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);L=D?parseInt(D[1],10)>42:!P}else L=!1;return L}}();function u(){for(var L=!0,D=Date.now(),P=V.length-1;P>=0;P--){var k=V[P],W=k.fontFamilyName;if(D-k.startTime>z)cc.warnID(4933,W),k.callback(null,W),V.splice(P,1);else{var H=k.refWidth,G="40px "+W;F.font=G,H!==N.safeMeasureText(F,B,G)?(V.splice(P,1),k.callback(null,W)):L=!1}}L&&(clearInterval(U),U=-1)}function d(L,D,P){var N=new Promise((function(P,N){!function r(){Date.now()-L>=z?N():document.fonts.load("40px "+D).then((function(L){L.length>=1?P():setTimeout(r,100)}),(function(){N()}))}()})),F=null,B=new Promise((function(L,D){F=setTimeout(D,z)}));Promise.race([B,N]).then((function(){F&&(clearTimeout(F),F=null),P(null,D)}),(function(){cc.warnID(4933,D),P(null,D)}))}var H={loadFont:function(L,D){var P=L.url,z=H._getFontFamily(P);if(k[z])return z;if(!F){var G=document.createElement("canvas");G.width=100,G.height=100,F=G.getContext("2d")}var X="40px "+z;F.font=X;var nt=N.safeMeasureText(F,B,X),ut=document.createElement("style");ut.type="text/css";var dt="";isNaN(z-0)?dt+="@font-face { font-family:"+z+"; src:":dt+="@font-face { font-family:'"+z+"'; src:",dt+="url('"+P+"');",ut.textContent=dt+"}",document.body.appendChild(ut);var ft=document.createElement("div"),_t=ft.style;if(_t.fontFamily=z,ft.innerHTML=".",_t.position="absolute",_t.left="-100px",_t.top="-100px",document.body.appendChild(ft),W())d(Date.now(),z,D);else{var pt={fontFamilyName:z,refWidth:nt,callback:D,startTime:Date.now()};V.push(pt),-1===U&&(U=setInterval(u,100))}k[z]=ut},_getFontFamily:function(L){var D=L.lastIndexOf(".ttf");if(-1===D)return L;var P,N=L.lastIndexOf("/");return-1!==(P=-1===N?L.substring(0,D)+"_LABEL":L.substring(N+1,D)+"_LABEL").indexOf(" ")&&(P='"'+P+'"'),P}};D.exports=H},{"../utils/text-utils":217}],123:[function(L,D,P){"use strict";L("./downloader"),L("./loader"),L("./loading-items"),L("./pipeline"),L("./CCLoader")},{"./CCLoader":115,"./downloader":121,"./loader":124,"./loading-items":125,"./pipeline":128}],124:[function(L,D,P){"use strict";var N=L("../platform/js"),F=L("../platform/CCSAXParser").plistParser,B=L("./pipeline"),k=L("../assets/CCTexture2D"),U=L("./uuid-loader"),V=L("./font-loader");function l(L){if("string"!=typeof L.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(L.content)}catch(D){return new Error("JSON Loader: Parse json ["+L.id+"] failed : "+D)}}function h(L){if(L._owner instanceof cc.Asset)return null;var D=L.content;if(cc.sys.platform!==cc.sys.FB_PLAYABLE_ADS&&!(D instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var P=L.texture||new k;return P._uuid=L.uuid,P.url=L.url,P._setRawAsset(L.rawUrl,!1),P._nativeAsset=D,P}function u(L,D){if(L._owner instanceof cc.Asset)return null;var P=new cc.AudioClip;return P._setRawAsset(L.rawUrl,!1),P._nativeAsset=L.content,P.url=L.url,P}function d(L){return L.load?L.load(L.content):null}function R(L,D){return L[D]<<8|L[D+1]}var z={png:h,jpg:h,bmp:h,jpeg:h,gif:h,ico:h,tiff:h,webp:h,image:h,pvr:function(L){var D=L.content instanceof ArrayBuffer?L.content:L.content.buffer,P=new Int32Array(D,0,13);if(55727696!=P[0])return new Error("Invalid magic number in PVR header");var N=P[7],F=P[6],B=P[12]+52;return{_data:new Uint8Array(D,B),_compressed:!0,width:N,height:F}},pkm:function(L){var D=L.content instanceof ArrayBuffer?L.content:L.content.buffer,P=new Uint8Array(D),N=R(P,6);if(0!==N&&1!==N&&3!==N)return new Error("Invalid magic number in ETC header");var F=R(P,12),B=R(P,14);return R(P,8),R(P,10),{_data:new Uint8Array(D,16),_compressed:!0,width:F,height:B}},mp3:u,ogg:u,wav:u,m4a:u,json:l,ExportJson:l,plist:function(L){return"string"!=typeof L.content?new Error("Plist Loader: Input item doesn't contain string content"):F.parse(L.content)||new Error("Plist Loader: Parse ["+L.id+"] failed")},uuid:U,prefab:U,fire:U,scene:U,binary:d,dbbin:d,bin:d,skel:d,font:V.loadFont,eot:V.loadFont,ttf:V.loadFont,woff:V.loadFont,svg:V.loadFont,ttc:V.loadFont,default:function(){return null}},M=function(L){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=N.mixin(L,z)};M.ID="Loader",M.prototype.addHandlers=function(L){this.extMap=N.mixin(this.extMap,L)},M.prototype.handle=function(L,D){return(this.extMap[L.type]||this.extMap.default).call(this,L,D)},B.Loader=D.exports=M},{"../assets/CCTexture2D":45,"../platform/CCSAXParser":144,"../platform/js":157,"./font-loader":122,"./pipeline":128,"./uuid-loader":134}],125:[function(L,D,P){"use strict";var N=L("../platform/callbacks-invoker");L("../utils/CCPath");var F=L("../platform/js"),B=0|998*Math.random(),k=F.createMap(!0),U=[],V={WORKING:1,COMPLETE:2,ERROR:3},z=F.createMap(!0);function h(L){return"string"==typeof(L.url||L)}function u(L){if(L){var D=L.split("?");if(D&&D[0]&&D[1]){var P={};return D[1].split("&").forEach((function(L){var D=L.split("=");P[D[0]]=D[1]})),P}}}function d(L,D){var P="object"==typeof L?L.url:L,N={queueId:D,id:P,url:P,rawUrl:void 0,urlParam:u(P),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof L&&(F.mixin(N,L),L.skips))for(var B=0;B<L.skips.length;B++){var k=L.skips[B];N.states[k]=V.COMPLETE}return N.rawUrl=N.url,P&&!N.type&&(N.type=cc.path.extname(P).toLowerCase().substr(1)),N}var W=[];function _(L,D,P){if(!L||!D)return!1;var N=!1;if(W.push(D.id),D.deps){var F,B,k=D.deps;for(F=0;F<k.length;F++){if((B=k[F]).id===L.id){N=!0;break}if(!(W.indexOf(B.id)>=0)&&B.deps&&_(L,B,!0)){N=!0;break}}}return P||(W.length=0),N}var p=function(L,D,P,U){N.call(this),this._id=++B,k[this._id]=this,this._pipeline=L,this._errorUrls=F.createMap(!0),this._appending=!1,this._ownerQueue=null,this.onProgress=P,this.onComplete=U,this.map=F.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,D&&(D.length>0?this.append(D):this.allComplete())};p.ItemState=new cc.Enum(V),p.create=function(L,D,P,N){void 0===P?"function"==typeof D&&(N=D,D=P=null):void 0===N&&("function"==typeof D?(N=P,P=D,D=null):(N=P,P=null));var F=U.pop();return F?(F._pipeline=L,F.onProgress=P,F.onComplete=N,k[F._id]=F,F._pipeline&&(F.active=!0),D&&F.append(D)):F=new p(L,D,P,N),F},p.getQueue=function(L){return L.queueId?k[L.queueId]:null},p.itemComplete=function(L){var D=k[L.queueId];D&&D.itemComplete(L.id)},p.initQueueDeps=function(L){var D=z[L._id];D?(D.completed.length=0,D.deps.length=0):D=z[L._id]={completed:[],deps:[]}},p.registerQueueDep=function(L,D){var P=L.queueId||L;if(!P)return!1;var N=z[P];if(N)-1===N.deps.indexOf(D)&&N.deps.push(D);else if(L.id)for(var F in z){var B=z[F];-1!==B.deps.indexOf(L.id)&&-1===B.deps.indexOf(D)&&B.deps.push(D)}},p.finishDep=function(L){for(var D in z){var P=z[D];-1!==P.deps.indexOf(L)&&-1===P.completed.indexOf(L)&&P.completed.push(L)}};var H=p.prototype;F.mixin(H,N.prototype),H.append=function(L,D){if(!this.active)return[];D&&!D.deps&&(D.deps=[]),this._appending=!0;var P,N,F,B=[];for(P=0;P<L.length;++P)if(!(N=L[P]).queueId||this.map[N.id]){if(h(N)){var U=(F=d(N,this._id)).id;this.map[U]||(this.map[U]=F,this.totalCount++,D&&D.deps.push(F),p.registerQueueDep(D||this._id,U),B.push(F))}}else{if(this.map[N.id]=N,D&&D.deps.push(N),N.complete||_(D,N)){this.totalCount++,this.itemComplete(N.id);continue}var V=this,z=k[N.queueId];z&&(this.totalCount++,p.registerQueueDep(D||this._id,N.id),z.addListener(N.id,(function(L){V.itemComplete(L.id)})))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(B),B},H._childOnProgress=function(L){if(this.onProgress){var D=z[this._id];this.onProgress(D?D.completed.length:this.completedCount,D?D.deps.length:this.totalCount,L)}},H.allComplete=function(){var L=F.isEmptyObject(this._errorUrls)?null:this._errorUrls;this.onComplete&&this.onComplete(L,this)},H.isCompleted=function(){return this.completedCount>=this.totalCount},H.isItemCompleted=function(L){return!!this.completed[L]},H.exists=function(L){return!!this.map[L]},H.getContent=function(L){var D=this.map[L],P=null;return D&&(D.content?P=D.content:D.alias&&(P=D.alias.content)),P},H.getError=function(L){var D=this.map[L],P=null;return D&&(D.error?P=D.error:D.alias&&(P=D.alias.error)),P},H.addListener=N.prototype.on,H.hasListener=N.prototype.hasEventListener,H.removeListener=N.prototype.off,H.removeAllListeners=N.prototype.removeAll,H.removeItem=function(L){var D=this.map[L];D&&this.completed[D.alias||L]&&(delete this.completed[L],delete this.map[L],D.alias&&(delete this.completed[D.alias.id],delete this.map[D.alias.id]),this.completedCount--,this.totalCount--)},H.itemComplete=function(L){var D=this.map[L];if(D){var P=L in this._errorUrls;if(D.error instanceof Error||F.isString(D.error)?this._errorUrls[L]=D.error:D.error?F.mixin(this._errorUrls,D.error):!D.error&&P&&delete this._errorUrls[L],this.completed[L]=D,this.completedCount++,p.finishDep(D.id),this.onProgress){var N=z[this._id];this.onProgress(N?N.completed.length:this.completedCount,N?N.deps.length:this.totalCount,D)}this.emit(L,D),this.removeAll(L),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete()}},H.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,F.clear(this._errorUrls),this.onProgress=null,this.onComplete=null,this.map=F.createMap(!0),this.completed={},this.totalCount=0,this.completedCount=0,N.call(this),z[this._id]&&(z[this._id].completed.length=0,z[this._id].deps.length=0),delete k[this._id],delete z[this._id],-1===U.indexOf(this)&&U.length<10&&U.push(this)},cc.LoadingItems=D.exports=p},{"../platform/callbacks-invoker":150,"../platform/js":157,"../utils/CCPath":201}],126:[function(L,D,P){"use strict";var N=L("./pipeline"),F="MD5Pipe",B=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/,a=function(L,D,P){this.id=F,this.async=!1,this.pipeline=null,this.md5AssetsMap=L,this.md5NativeAssetsMap=D,this.libraryBase=P};a.ID=F,a.prototype.handle=function(L){return L.url=this.transformURL(L.url),null},a.prototype.transformURL=function(L){var D=L.startsWith(this.libraryBase)?this.md5AssetsMap:this.md5NativeAssetsMap;return L.replace(B,(function(L,P){var N=D[P];return N?L+"."+N:L}))},N.MD5Pipe=D.exports=a},{"./pipeline":128}],127:[function(L,D,P){"use strict";var N=L("./unpackers"),F=L("../utils/misc").pushToMap,B=0,k=2,U=3;function a(){this.unpacker=null,this.state=B,this.duration=0}var V={},z={},W={},H=[],G=null;function d(L,D){return new Error("Can not retrieve "+L+" from packer "+D)}D.exports={msToRelease:12e4,initPacks:function(L){for(var D in z=L,V={},L)for(var P=L[D],N=0;N<P.length;N++){var B=P[N],k=1===P.length;F(V,B,D,k)}},_loadNewPack:function(L,D,P){var N=this,F=cc.AssetLibrary.getLibUrlNoExt(D)+".json";cc.loader.load({url:F,ignoreMaxConcurrency:!0},(function(B,k){if(B)return cc.errorID(4916,L),P(B);W[D].url=F;var U=N._doLoadNewPack(L,D,k);U?P(null,U):P(d(L,D))}))},_doPreload:function(L,D){var P=W[L];P||((P=W[L]=new a).state=k),P.state!==U&&(P.unpacker=new N.JsonUnpacker,P.unpacker.load(z[L],D),P.state=U)},_doLoadNewPack:function(L,D,P){var F=W[D];if(F.state!==U){"string"==typeof P&&(P=JSON.parse(P)),Array.isArray(P)?F.unpacker=new N.JsonUnpacker:P.type===N.TextureUnpacker.ID&&(F.unpacker=new N.TextureUnpacker),F.unpacker.load(z[D],P),F.state=U,F.duration=0,H.push(D);var B=this;G||(G=setInterval((function(){for(var L=B.msToRelease/5e3,D=H.length-1;D>=0;D--){var P=H[D];++W[P].duration>L&&B.release(P)}0===H.length&&(clearInterval(G),G=null)}),5e3))}return F.unpacker.retrieve(L)},_selectLoadedPack:function(L){for(var D=B,P="",N=0;N<L.length;N++){var F=L[N],k=W[F];if(k){var V=k.state;if(V===U)return F;V>D&&(D=V,P=F)}}return D!==B?P:L[0]},load:function(L,D){var P=L.uuid,N=V[P];if(N){Array.isArray(N)&&(N=this._selectLoadedPack(N));var F=W[N];return F&&F.state===U?(F.duration=0,F.unpacker.retrieve(P)||d(P,N)):(F||(console.log("Create unpacker %s for %s",N,P),(F=W[N]=new a).state=k),this._loadNewPack(P,N,D),null)}},release:function(L){var D=W[L];D&&(cc.loader.release(D.url),delete W[L],cc.js.array.fastRemove(H,L))}}},{"../utils/misc":210,"./unpackers":132}],128:[function(L,D,P){"use strict";var N=L("../platform/js"),F=L("./loading-items"),B=F.ItemState;function a(L,D){var P=L.id,N=D.states[P],F=L.next,k=L.pipeline;if(!D.error&&N!==B.WORKING&&N!==B.ERROR)if(N===B.COMPLETE)F?a(F,D):k.flowOut(D);else{D.states[P]=B.WORKING;var U=L.handle(D,(function(L,N){L?(D.error=L,D.states[P]=B.ERROR,k.flowOut(D)):(N&&(D.content=N),D.states[P]=B.COMPLETE,F?a(F,D):k.flowOut(D))}));U instanceof Error?(D.error=U,D.states[P]=B.ERROR,k.flowOut(D)):void 0!==U&&(null!==U&&(D.content=U),D.states[P]=B.COMPLETE,F?a(F,D):k.flowOut(D))}}var o=function(L){this._pipes=L,this._cache=N.createMap(!0);for(var D=0;D<L.length;++D){var P=L[D];P.handle&&P.id&&(P.pipeline=this,P.next=D<L.length-1?L[D+1]:null)}};o.ItemState=B;var k=o.prototype;k.insertPipe=function(L,D){if(!L.handle||!L.id||D>this._pipes.length)cc.warnID(4921);else if(this._pipes.indexOf(L)>0)cc.warnID(4922);else{L.pipeline=this;var P=null;D<this._pipes.length&&(P=this._pipes[D]);var N=null;D>0&&(N=this._pipes[D-1]),N&&(N.next=L),L.next=P,this._pipes.splice(D,0,L)}},k.insertPipeAfter=function(L,D){var P=this._pipes.indexOf(L);P<0||this.insertPipe(D,P+1)},k.appendPipe=function(L){L.handle&&L.id&&(L.pipeline=this,L.next=null,this._pipes.length>0&&(this._pipes[this._pipes.length-1].next=L),this._pipes.push(L))},k.flowIn=function(L){var D,P,N=this._pipes[0];if(N){for(D=0;D<L.length;D++)P=L[D],this._cache[P.id]=P;for(D=0;D<L.length;D++)a(N,P=L[D])}else for(D=0;D<L.length;D++)this.flowOut(L[D])},k.flowInDeps=function(L,D,P){return F.create(this,(function(L,D){P(L,D),D.destroy()})).append(D,L)},k.flowOut=function(L){L.error?delete this._cache[L.id]:this._cache[L.id]||(this._cache[L.id]=L),L.complete=!0,F.itemComplete(L)},k.copyItemStates=function(L,D){if(D instanceof Array)for(var P=0;P<D.length;++P)D[P].states=L.states;else D.states=L.states},k.getItem=function(L){var D=this._cache[L];return D?(D.alias&&(D=D.alias),D):D},k.removeItem=function(L){var D=this._cache[L];return D&&D.complete&&delete this._cache[L],D},k.clear=function(){for(var L in this._cache){var D=this._cache[L];delete this._cache[L],D.complete||(D.error=new Error("Canceled manually"),this.flowOut(D))}},cc.Pipeline=D.exports=o},{"../platform/js":157,"./loading-items":125}],129:[function(L,D,P){},{"../platform/js":157}],130:[function(L,D,P){"use strict";var N=L("./pipeline"),F="SubPackPipe",B=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-]{8,})/;var k=Object.create(null),c=function(L){for(var D in this.id=F,this.async=!1,this.pipeline=null,L){var P=L[D];P.uuids&&P.uuids.forEach((function(L){k[L]=P.path}))}};c.ID=F,c.prototype.handle=function(L){return L.url=this.transformURL(L.url),null},c.prototype.transformURL=function(L){var D=function(L){var D=L.match(B);return D?D[1]:""}(L);if(D){var P=k[D];if(P)return L.replace("res/raw-assets/",P+"raw-assets/")}return L},N.SubPackPipe=D.exports=c},{"./pipeline":128}],131:[function(L,D,P){"use strict";var N=L("./utils").urlAppendTimestamp;D.exports=function(L,D){var P=L.url;P=N(P);var F=cc.loader.getXMLHttpRequest(),B="Load text file failed: "+P;F.open("GET",P,!0),F.overrideMimeType&&F.overrideMimeType("text/plain; charset=utf-8"),F.onload=function(){4===F.readyState?200===F.status||0===F.status?D(null,F.responseText):D({status:F.status,errorMessage:B+"(wrong status)"}):D({status:F.status,errorMessage:B+"(wrong readyState)"})},F.onerror=function(){D({status:F.status,errorMessage:B+"(error)"})},F.ontimeout=function(){D({status:F.status,errorMessage:B+"(time out)"})},F.send(null)}},{"./utils":133}],132:[function(L,D,P){"use strict";var N=L("../assets/CCTexture2D"),F=L("../platform/js");function s(){this.jsons={}}function a(){this.contents={}}s.prototype.load=function(L,D){D.length!==L.length&&cc.errorID(4915);for(var P=0;P<L.length;P++){var N=L[P],F=D[P];this.jsons[N]=F}},s.prototype.retrieve=function(L){return this.jsons[L]||null},a.ID=F._getClassId(N),a.prototype.load=function(L,D){var P=D.data.split("|");P.length!==L.length&&cc.errorID(4915);for(var N=0;N<L.length;N++)this.contents[L[N]]=P[N]},a.prototype.retrieve=function(L){var D=this.contents[L];return D?{__type__:a.ID,content:D}:null},D.exports={JsonUnpacker:s,TextureUnpacker:a}},{"../assets/CCTexture2D":45,"../platform/js":157}],133:[function(L,D,P){"use strict";var N=/\?/;D.exports={urlAppendTimestamp:function(L){return cc.game.config.noCache&&"string"==typeof L&&(N.test(L)?L+="&_t="+(new Date-0):L+="?_t="+(new Date-0)),L}}},{}],134:[function(L,D,P){"use strict";var N=L("../platform/js"),F=L("../CCDebug");L("../platform/deserialize");var B=L("./loading-items");function a(L){return L&&(L[0]&&"cc.Scene"===L[0].__type__||L[1]&&"cc.Scene"===L[1].__type__||L[0]&&"cc.Prefab"===L[0].__type__)}function c(L,D,P,N,F){D.content=P;var k=D.dependKeys;L.flowInDeps(D,N,(function(L,D){var U,V=D.map;for(var z in V)(U=V[z]).uuid&&U.content&&(U.content._uuid=U.uuid);function h(L){var D=L.content;this._stillUseUrl&&(D=D&&cc.RawAsset.wasRawAssetType(D.constructor)?D.nativeUrl:L.rawUrl),"_nativeAsset"===this._ownerProp&&(this._owner.url=L.url),this._owner[this._ownerProp]=D,L.uuid!==P._uuid&&k.indexOf(L.id)<0&&k.push(L.id)}for(var W=0;W<N.length;W++){var H=N[W],G=H.uuid,X=H.url;if(H._owner,H._ownerProp,U=V[X]){var nt=H;if(U.complete||U.content)U.error?cc._throw(U.error.message||U.error.errorMessage||U.error):h.call(nt,U);else{var ut=B.getQueue(U),dt=ut._callbackTable[G];dt?dt.unshift(h,nt):ut.addListener(G,h,nt)}}}if(!L&&P.onLoad)try{P.onLoad()}catch(L){cc._throw(L)}F(L,P)}))}function h(L,D){var P,B;if("string"==typeof L.content)try{P=JSON.parse(L.content)}catch(D){return new Error(F.getError(4923,L.id,D.stack))}else{if("object"!=typeof L.content)return new Error(F.getError(4924));P=L.content}var k=a(P);B=k?cc._MissingScript.safeFindClass:function(L){return N._getClassById(L)||(cc.warnID(4903,L),Object)};var U,V=cc.deserialize.Details.pool.get();try{U=cc.deserialize(P,V,{classFinder:B,target:L.existingAsset,customEnv:L})}catch(D){cc.deserialize.Details.pool.put(V);var z=D.stack;return new Error(F.getError(4925,L.id,z))}U._uuid=L.uuid,U.url=U.nativeUrl;var W=function(L,D,P,N){var F,B,k,U=P.uuidList,V=P.uuidObjList,z=P.uuidPropList,W=P._stillUseUrl,H=L.dependKeys=[];if(N)for(F=[],B=0;B<U.length;B++){k=U[B];var G=V[B],X=z[B],nt=cc.AssetLibrary._getAssetInfoInRuntime(k);if(nt.raw){var ut=nt.url;G[X]=ut,H.push(ut)}else F.push({type:"uuid",uuid:k,deferredLoadRaw:!0,_owner:G,_ownerProp:X,_stillUseUrl:W[B]})}else{for(F=new Array(U.length),B=0;B<U.length;B++)k=U[B],F[B]={type:"uuid",uuid:k,_owner:V[B],_ownerProp:z[B],_stillUseUrl:W[B]};D._native&&!D.constructor.preventPreloadNativeObject&&F.push({url:D.nativeUrl,_owner:D,_ownerProp:"_nativeAsset"})}return F}(L,U,V,function(L,D,P){var N=D.deferredLoadRaw;return N?L instanceof cc.Asset&&L.constructor.preventDeferredLoadDependents&&(N=!1):P&&(L instanceof cc.SceneAsset||L instanceof cc.Prefab)&&(N=L.asyncLoadAssets),N}(U,L,k));if(cc.deserialize.Details.pool.put(V),0===W.length)return U.onLoad&&U.onLoad(),D(null,U);c(this.pipeline,L,U,W,D)}D.exports=h,h.isSceneObj=a},{"../CCDebug":22,"../platform/deserialize":152,"../platform/js":157,"./loading-items":125}],135:[function(L,D,P){"use strict";var N=L("./component-scheduler"),F=L("./platform/CCObject").Flags,B=L("./platform/js"),k=F.IsPreloadStarted,U=F.IsOnLoadStarted,V=F.IsOnLoadCalled,z=F.Deactivating,W=cc.Class({extends:N.LifeCycleInvoker,add:function(L){this._zero.array.push(L)},remove:function(L){this._zero.fastRemove(L)},cancelInactive:function(L){N.LifeCycleInvoker.stableRemoveInactive(this._zero,L)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),H=N.createInvokeImpl("c.__preload();"),G=N.createInvokeImpl("c.onLoad();c._objFlags|="+V,!1,V),X=new B.Pool(4);function _(L,D,P){D?L._removeComponent(D):B.array.removeAt(L._components,P)}function p(){this._activatingStack=[]}X.get=function(){var L=this._get()||{preload:new W(H),onLoad:new N.OneOffInvoker(G),onEnable:new N.OneOffInvoker(N.invokeOnEnable)};L.preload._zero.i=-1;var D=L.onLoad;return D._zero.i=-1,D._neg.i=-1,D._pos.i=-1,(D=L.onEnable)._zero.i=-1,D._neg.i=-1,D._pos.i=-1,L};var nt=cc.Class({ctor:p,reset:p,_activateNodeRecursively:function(L,D,P,N){if(L._objFlags&z)cc.errorID(3816,L.name);else{L._activeInHierarchy=!0;for(var F=L._components.length,B=0;B<F;++B){var k=L._components[B];k instanceof cc.Component?this.activateComp(k,D,P,N):(_(L,k,B),--B,--F)}L._childArrivalOrder=L._children.length;for(var U=0,V=L._children.length;U<V;++U){var W=L._children[U];W._localZOrder=4294901760&W._localZOrder|U+1,W._active&&this._activateNodeRecursively(W,D,P,N)}L._onPostActivated(!0)}},_deactivateNodeRecursively:function(L){L._objFlags|=z,L._activeInHierarchy=!1;for(var D=L._components.length,P=0;P<D;++P){var N=L._components[P];if(N._enabled&&(cc.director._compScheduler.disableComp(N),L._activeInHierarchy))return void(L._objFlags&=~z)}for(var F=0,B=L._children.length;F<B;++F){var k=L._children[F];if(k._activeInHierarchy&&(this._deactivateNodeRecursively(k),L._activeInHierarchy))return void(L._objFlags&=~z)}L._onPostActivated(!1),L._objFlags&=~z},activateNode:function(L,D){if(D){var P=X.get();this._activatingStack.push(P),this._activateNodeRecursively(L,P.preload,P.onLoad,P.onEnable),P.preload.invoke(),P.onLoad.invoke(),P.onEnable.invoke(),this._activatingStack.pop(),X.put(P)}else{this._deactivateNodeRecursively(L);for(var N=this._activatingStack,F=0;F<N.length;F++){var B=N[F];B.preload.cancelInactive(k),B.onLoad.cancelInactive(U),B.onEnable.cancelInactive()}}L.emit("active-in-hierarchy-changed",L)},activateComp:function(L,D,P,N){if(cc.isValid(L,!0)&&(L._objFlags&k||(L._objFlags|=k,L.__preload&&(D?D.add(L):L.__preload())),L._objFlags&U||(L._objFlags|=U,L.onLoad?P?P.add(L):(L.onLoad(),L._objFlags|=V):L._objFlags|=V),L._enabled)){if(!L.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(L,N)}},destroyComp:function(L){cc.director._compScheduler.disableComp(L),L.onDestroy&&L._objFlags&V&&L.onDestroy()},resetComp:!1});D.exports=nt},{"./component-scheduler":67,"./platform/CCObject":143,"./platform/js":157,"./utils/misc":210}],136:[function(L,D,P){"use strict";L("../assets/CCAsset");var N=L("./utils").callInNextTick,F=L("../load-pipeline/CCLoader"),B=L("../load-pipeline/asset-table"),k=L("../load-pipeline/pack-downloader"),U=L("../load-pipeline/auto-release-utils"),V=L("../utils/decode-uuid"),z=L("../load-pipeline/md5-pipe"),W=L("../load-pipeline/subpackage-pipe"),H=L("./js"),G="",X="",nt=H.createMap(!0);function p(L){return L&&(L.constructor===cc.SceneAsset||L instanceof cc.Scene)}function v(L,D){this.url=L,this.type=D}var ut={loadAsset:function(L,D,P){if("string"!=typeof L)return N(D,new Error("[AssetLibrary] uuid must be string"),null);var B={uuid:L,type:"uuid"};P&&P.existingAsset&&(B.existingAsset=P.existingAsset),F.load(B,(function(P,N){if(P||!N){var B="string"==typeof P?P:P?P.message||P.errorMessage||JSON.stringify(P):"Unknown error";P=new Error("[AssetLibrary] loading JSON or dependencies failed:"+B)}else{if(N.constructor===cc.SceneAsset){var k=cc.loader._getReferenceKey(L);N.scene.dependAssets=U.getDependsRecursively(k)}if(p(N)){var V=cc.loader._getReferenceKey(L);F.removeItem(V)}}D&&D(P,N)}))},getLibUrlNoExt:function(L,D){return L=V(L),(D?X+"assets/":G)+L.slice(0,2)+"/"+L},_queryAssetInfoInEditor:function(L,D){},_getAssetInfoInRuntime:function(L,D){D=D||{url:null,raw:!1};var P=nt[L];return P&&!H.isChildClassOf(P.type,cc.Asset)?(D.url=X+P.url,D.raw=!0):(D.url=this.getLibUrlNoExt(L)+".json",D.raw=!1),D},_uuidInSettings:function(L){return L in nt},queryAssetInfo:function(L,D){var P=this._getAssetInfoInRuntime(L);D(null,P.url,P.raw)},parseUuidInEditor:function(L){},loadJson:function(L,D){var P=""+((new Date).getTime()+Math.random()),N={uuid:P,type:"uuid",content:L,skips:[F.assetLoader.id,F.downloader.id]};F.load(N,(function(L,N){if(L)L=new Error("[AssetLibrary] loading JSON or dependencies failed: "+L.message);else{if(N.constructor===cc.SceneAsset){var B=cc.loader._getReferenceKey(P);N.scene.dependAssets=U.getDependsRecursively(B)}if(p(N)){var k=cc.loader._getReferenceKey(P);F.removeItem(k)}}N._uuid="",D&&D(L,N)}))},getAssetByUuid:function(L){return ut._uuidToAsset[L]||null},init:function(L){var D=L.libraryPath;if(D=D.replace(/\\/g,"/"),G=cc.path.stripSep(D)+"/",X=L.rawAssetsBase,L.subpackages){var P=new W(L.subpackages);cc.loader.insertPipeAfter(cc.loader.assetLoader,P),cc.loader.subPackPipe=P}var N=L.md5AssetsMap;if(N&&N.import){var U=0,ut=0,dt=H.createMap(!0),ft=N.import;for(U=0;U<ft.length;U+=2)dt[ut=V(ft[U])]=ft[U+1];var _t=H.createMap(!0);for(ft=N["raw-assets"],U=0;U<ft.length;U+=2)_t[ut=V(ft[U])]=ft[U+1];var pt=new z(dt,_t,G);cc.loader.insertPipeAfter(cc.loader.assetLoader,pt),cc.loader.md5Pipe=pt}var vt=F._assetTables;for(var gt in vt)vt[gt].reset();var mt=L.rawAssets;if(mt)for(var yt in mt){var Tt=mt[yt];for(var ut in Tt){var xt=Tt[ut],St=xt[0],bt=xt[1],wt=cc.js._getClassById(bt);if(wt){nt[ut]=new v(yt+"/"+St,wt);var Rt=cc.path.extname(St);Rt&&(St=St.slice(0,-Rt.length));var It=1===xt[2];vt[yt]||(vt[yt]=new B),vt[yt].add(St,ut,wt,!It)}else cc.error("Cannot get",bt)}}L.packedAssets&&k.initPacks(L.packedAssets),cc.url._init(L.mountPaths&&L.mountPaths.assets||X+"assets")},_uuidToAsset:{}},dt={effect:{},material:{}},ft={};function T(L,D,P){var N=L+"s",F=dt[L]={};cc.loader.loadResDir(N,D,"internal",(function(){}),(function(L,D){if(L)cc.error(L);else for(var N=0;N<D.length;N++){var B=D[N];cc.loader.getDependsRecursively(B).forEach((function(L){return ft[L]=!0})),F[""+B.name]=B}P()}))}ut._loadBuiltins=function(L){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS)return L&&L();T("effect",cc.EffectAsset,(function(){T("material",cc.Material,L)}))},ut.getBuiltin=function(L,D){return dt[L][D]},ut.getBuiltins=function(L){return L?dt[L]:dt},ut.resetBuiltins=function(){dt={effect:{},material:{}},ft={}},ut.getBuiltinDeps=function(){return ft},D.exports=cc.AssetLibrary=ut},{"../assets/CCAsset":29,"../load-pipeline/CCLoader":115,"../load-pipeline/asset-table":117,"../load-pipeline/auto-release-utils":119,"../load-pipeline/md5-pipe":126,"../load-pipeline/pack-downloader":127,"../load-pipeline/subpackage-pipe":130,"../utils/decode-uuid":206,"./js":157,"./utils":161}],137:[function(L,D,P){"use strict";var N=L("./js"),F=L("./CCEnum"),B=L("./utils"),k=(B.isPlainEmptyObj_DEV,B.cloneable_DEV,L("./attribute")),U=k.DELIMETER,V=L("./preprocess-class");L("./requiring-frame");var z=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"];function h(L,D){L.indexOf(D)<0&&L.push(D)}var W={datas:null,push:function(L){if(this.datas)this.datas.push(L);else{this.datas=[L];var D=this;setTimeout((function(){D.init()}),0)}},init:function(){var L=this.datas;if(L){for(var D=0;D<L.length;++D){var P=L[D],F=P.cls,B=P.props;"function"==typeof B&&(B=B());var k=N.getClassName(F);B?R(F,k,B,F.$super,P.mixins):cc.errorID(3633,k)}this.datas=null}}};function f(L,D,P,N,F){var B=N.default;k.setClassAttr(L,P,"default",B),function(L,D){h(L.__props__,D)}(L,P),O(L,N,D,P,!1)}function _(L,D,P,F,B){var U=F.get,V=F.set,z=L.prototype,W=!Object.getOwnPropertyDescriptor(z,P);U&&(O(L,F,D,P,!0),k.setClassAttr(L,P,"serializable",!1),B||N.get(z,P,U,W,W)),V&&(B||N.set(z,P,V,W,W))}function p(L){return"function"==typeof L?L():L}function v(L,D,P){for(var F in D)L.hasOwnProperty(F)||P&&!P(F)||Object.defineProperty(L,F,N.getPropertyDescriptor(D,F))}function g(L,D,P,F){var B,U,V=F.__ctor__,z=F.ctor,W=F.__ES6__;W?(B=[z],U=z):(B=V?[V]:S(D,P,F),U=x(B,D,L,F),N.value(U,"extend",(function(L){return L.extends=this,I(L)}),!0)),N.value(U,"__ctors__",B.length>0?B:null,!0);var H=U.prototype;if(D&&(W||(N.extend(U,D),H=U.prototype),U.$super=D),P){for(var G=P.length-1;G>=0;G--){var X=P[G];v(H,X.prototype),v(U,X,(function(L){return X.hasOwnProperty(L)&&!0})),I._isCCClass(X)&&v(k.getClassAttrs(U),k.getClassAttrs(X))}H.constructor=U}return W||(H.__initProps__=C),N.setClassName(L,U),U}function y(L){for(var D=N.getClassName(L),P=L.constructor,F="new "+D+"(",B=0;B<P.__props__.length;B++){F+=L[P.__props__[B]],B<P.__props__.length-1&&(F+=",")}return F+")"}function T(L){return JSON.stringify(L).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}var H=/^[A-Za-z_$][0-9A-Za-z_$]*$/;function C(L){var D=k.getClassAttrs(L),P=L.__props__;null===P&&(W.init(),P=L.__props__);var N=function(L,D){for(var P=[],N="",F=0;F<D.length;F++){var B=D[F],k=B+U+"default";if(k in L){var V,z;V=H.test(B)?"this."+B+"=":"this["+T(B)+"]=";var W=L[k];if("object"==typeof W&&W)z=W instanceof cc.ValueType?y(W):Array.isArray(W)?"[]":"{}";else if("function"==typeof W){var G=P.length;P.push(W),z="F["+G+"]()"}else z="string"==typeof W?T(W):W;N+=V=V+z+";\n"}}return 0===P.length?Function(N):Function("F","return (function(){\n"+N+"})")(P)}(D,P);L.prototype.__initProps__=N,N.call(this)}var x=function(L,D,P,N){var F="return function CCClass(){\n";D&&w(D,N,P)&&(F+="this._super=null;\n"),F+="this.__initProps__(CCClass);\n";var B=L.length;if(B>0){var k="].apply(this,arguments);\n";if(1===B)F+="CCClass.__ctors__[0"+k;else{F+="var cs=CCClass.__ctors__;\n";for(var U=0;U<B;U++)F+="cs["+U+k}}return F+="}",Function(F)()};function S(L,D,P){function n(L){return I._isCCClass(L)?L.__ctors__||[]:[L]}for(var N=[],F=[L].concat(D),B=0;B<F.length;B++){var k=F[B];if(k)for(var U=n(k),V=0;V<U.length;V++)h(N,U[V])}var z=P.ctor;return z&&N.push(z),N}var G=/xyz/.test((function(){xyz}))?/\b\._super\b/:/.*/;function w(L,D,P){var F=!1;for(var B in D)if(!(z.indexOf(B)>=0)){var k=D[B];if("function"==typeof k){var U=N.getPropertyDescriptor(L.prototype,B);if(U){var V=U.value;if("function"==typeof V){G.test(k)&&(F=!0,D[B]=function(L,D){return function(){var P=this._super;this._super=L;var N=D.apply(this,arguments);return this._super=P,N}}(V,k));continue}}}}return F}function R(L,D,P,N,F,B){if(L.__props__=[],N&&N.__props__&&(L.__props__=N.__props__.slice()),F)for(var z=0;z<F.length;++z){var W=F[z];W.__props__&&(L.__props__=L.__props__.concat(W.__props__.filter((function(D){return L.__props__.indexOf(D)<0}))))}if(P)for(var H in V.preprocessAttrs(P,D,L,B),P){var G=P[H];"default"in G?f(L,D,H,G):_(L,D,H,G,B)}var X=k.getClassAttrs(L);L.__values__=L.__props__.filter((function(L){return!1!==X[L+U+"serializable"]}))}function I(L){var D=(L=L||{}).name,P=L.extends,F=L.mixins,B=function(L,D,P,F){var B=cc.Component,k=cc._RF.peek();if(k&&N.isChildClassOf(D,B)){if(N.isChildClassOf(k.cls,B))return cc.errorID(3615),null;L=L||k.script}var U=g(L,D,P,F);if(k)if(N.isChildClassOf(D,B)){var V=k.uuid;V&&N._setClassId(V,U),k.cls=U}else N.isChildClassOf(k.cls,B)||(k.cls=U);return U}(D,P,F,L);D||(D=cc.js.getClassName(B)),B._sealed=!0,P&&(P._sealed=!1);var k=L.properties;"function"==typeof k||P&&null===P.__props__||F&&F.some((function(L){return null===L.__props__}))?(W.push({cls:B,props:k,mixins:F}),B.__props__=B.__values__=null):R(B,D,k,P,L.mixins,L.__ES6__);var U,H=L.statics;if(H)for(U in H)B[U]=H[U];for(var G in L)if(!(z.indexOf(G)>=0)){var X=L[G];V.validateMethodWithProps(X,G,D,B,P)&&N.value(B.prototype,G,X,!0,!0)}var nt=L.editor;return nt&&N.isChildClassOf(P,cc.Component)&&cc.Component._registerEditorProps(B,nt),B}/xyz/.test((function(){xyz})),I._isCCClass=function(L){return L&&L.hasOwnProperty("__ctors__")},I._fastDefine=function(L,D,P){N.setClassName(L,D);for(var F=D.__props__=D.__values__=Object.keys(P),B=k.getClassAttrs(D),V=0;V<F.length;V++){var z=F[V];B[z+U+"visible"]=!1,B[z+U+"default"]=P[z]}},I.Attr=k,I.attr=k.attr,I.getInheritanceChain=function(L){for(var D=[];L=N.getSuper(L);)L!==Object&&D.push(L);return D};var X={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function O(L,D,P,N,B){var V=null,z="";function h(){return z=N+U,V=k.getClassAttrs(L)}var W=D.type;W&&(X[W]?(V||h())[z+"type"]=W:"Object"===W||(W===k.ScriptUuid?((V||h())[z+"type"]="Script",V[z+"ctor"]=cc.ScriptAsset):"object"==typeof W?F.isEnum(W)&&((V||h())[z+"type"]="Enum",V[z+"enumList"]=F.getList(W)):"function"==typeof W&&((V||h())[z+"type"]="Object",V[z+"ctor"]=W)));function f(L,P){if(L in D){var N=D[L];typeof N===P&&((V||h())[z+L]=N)}}D.editorOnly&&((V||h())[z+"editorOnly"]=!0),D.url&&((V||h())[z+"saveUrlAsAsset"]=!0),!1===D.serializable&&((V||h())[z+"serializable"]=!1),f("formerlySerializedAs","string");var H=D.range;H&&Array.isArray(H)&&H.length>=2&&((V||h())[z+"min"]=H[0],V[z+"max"]=H[1],H.length>2&&(V[z+"step"]=H[2])),f("min","number"),f("max","number"),f("step","number")}cc.Class=I,D.exports={isArray:function(L){return L=p(L),Array.isArray(L)},fastDefine:I._fastDefine,getNewValueTypeCode:y,IDENTIFIER_RE:H,escapeForJS:T,getDefault:p}},{"./CCEnum":139,"./attribute":149,"./js":157,"./preprocess-class":158,"./requiring-frame":159,"./utils":161}],138:[function(L,D,P){"use strict";L("./CCClass");var N=L("./preprocess-class"),F=L("./js"),B="__ccclassCache__";function a(L){return L}function o(L,D){return L[D]||(L[D]={})}function c(L){return function(D){return"function"==typeof D?L(D):function(P){return L(P,D)}}}function l(L,D,P){return function(L){return function(P){return D(P,L)}}}var k=l.bind(null,!1);function u(L){return l.bind(null,!1)}var U=u(),V=u();function _(L,D){return o(L,B)}function g(L,D,P,B,k,U){var V;B&&(V=N.getFullFormOfProperty(B));var z=D[P],W=F.mixin(z||{},V||B||{});if(k&&(k.get||k.set))k.get&&(W.get=k.get),k.set&&(W.set=k.set);else{var H=void 0;if(k)k.initializer&&(H=function(L){var D;try{D=L()}catch(D){return L}return"object"!=typeof D||null===D?D:L}(k.initializer));else{var G=U.default||(U.default=function(L){var D;try{D=new L}catch(L){return{}}return D}(L));G.hasOwnProperty(P)&&(H=G[P])}W.default=H}D[P]=W}var z=c((function(L,D){var P=F.getSuper(L);P===Object&&(P=null);var N={name:D,extends:P,ctor:L,__ES6__:!0},k=L[B];if(k){var U=k.proto;U&&F.mixin(N,U),L[B]=void 0}return cc.Class(N)}));function y(L,D,P){return L((function(L,N){var F=_(L);if(F){var B=void 0!==P?P:N;o(o(F,"proto"),"editor")[D]=B}}),D)}function T(L){return L(a)}var W=T(c),H=y(k,"requireComponent"),G=T(U),X=y(V,"executionOrder"),nt=T(c),ut=T(c),dt=T(U),ft=T(U),_t=T(U);cc._decorator=D.exports={ccclass:z,property:function(L,D,P){var N=null;function r(L,D,P){var F=_(L.constructor);if(F){var B=o(o(F,"proto"),"properties");g(L.constructor,B,D,N,P,F)}}if(void 0===D)return N=L,r;r(L,D,P)},executeInEditMode:W,requireComponent:H,menu:G,executionOrder:X,disallowMultiple:nt,playOnFocus:ut,inspector:dt,icon:ft,help:_t,mixins:function(){for(var L=[],D=0;D<arguments.length;D++)L[D]=arguments[D];return function(D){var P=_(D);P&&(o(P,"proto").mixins=L)}}}},{"./CCClass":137,"./js":157,"./preprocess-class":158,"./utils":161}],139:[function(L,D,P){"use strict";var N=L("./js");function r(L){if("__enums__"in L)return L;N.value(L,"__enums__",null,!0);for(var D=-1,P=Object.keys(L),F=0;F<P.length;F++){var B=P[F],k=L[B];if(-1===k)k=++D,L[B]=k;else if("number"==typeof k)D=k;else if("string"==typeof k&&Number.isInteger(parseFloat(B)))continue;var U=""+k;B!==U&&N.value(L,U,B)}return L}r.isEnum=function(L){return L&&L.hasOwnProperty("__enums__")},r.getList=function(L){if(L.__enums__)return L.__enums__;var D=L.__enums__=[];for(var P in L){var N=L[P];Number.isInteger(N)&&D.push({name:P,value:N})}return D.sort((function(L,D){return L.value-D.value})),D},D.exports=cc.Enum=r},{"./js":157}],140:[function(L,D,P){"use strict";var N,F=L("../event-manager"),B=L("./CCInputManager");cc.Acceleration=function(L,D,P,N){this.x=L||0,this.y=D||0,this.z=P||0,this.timestamp=N||0},B.setAccelerometerEnabled=function(L){var D=this;if(D._accelEnabled!==L){D._accelEnabled=L;var P=cc.director.getScheduler();P.enableForTarget(D),D._accelEnabled?(D._registerAccelerometerEvent(),D._accelCurTime=0,P.scheduleUpdate(D)):(D._unregisterAccelerometerEvent(),D._accelCurTime=0,P.unscheduleUpdate(D))}},B.setAccelerometerInterval=function(L){this._accelInterval!==L&&(this._accelInterval=L)},B._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",(function(L){F.dispatchEvent(new cc.Event.EventKeyboard(L.keyCode,!0)),L.stopPropagation(),L.preventDefault()}),!1),cc.game.canvas.addEventListener("keyup",(function(L){F.dispatchEvent(new cc.Event.EventKeyboard(L.keyCode,!1)),L.stopPropagation(),L.preventDefault()}),!1)},B._registerAccelerometerEvent=function(){var L=window,D=this;D._acceleration=new cc.Acceleration,D._accelDeviceEvent=L.DeviceMotionEvent||L.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(D._accelDeviceEvent=window.DeviceOrientationEvent);var P=D._accelDeviceEvent===L.DeviceMotionEvent?"devicemotion":"deviceorientation",F=navigator.userAgent;(/Android/.test(F)||/Adr/.test(F)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(D._minus=-1),N=D.didAccelerate.bind(D),L.addEventListener(P,N,!1)},B._unregisterAccelerometerEvent=function(){var L=window,D=this._accelDeviceEvent===L.DeviceMotionEvent?"devicemotion":"deviceorientation";N&&L.removeEventListener(D,N,!1)},B.didAccelerate=function(L){var D=this,P=window;if(D._accelEnabled){var N,F,B,k=D._acceleration;if(D._accelDeviceEvent===window.DeviceMotionEvent){var U=L.accelerationIncludingGravity;N=D._accelMinus*U.x*.1,F=D._accelMinus*U.y*.1,B=.1*U.z}else N=L.gamma/90*.981,F=-L.beta/90*.981,B=L.alpha/90*.981;if(cc.view._isRotated){var V=N;N=-F,F=V}k.x=N,k.y=F,k.z=B,k.timestamp=L.timeStamp||Date.now();var z=k.x;90===P.orientation?(k.x=-k.y,k.y=z):-90===P.orientation?(k.x=k.y,k.y=-z):180===P.orientation&&(k.x=-k.x,k.y=-k.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(k.x=-k.x,k.y=-k.y)}}},{"../event-manager":104,"./CCInputManager":141}],141:[function(L,D,P){"use strict";var N=L("./CCMacro"),F=L("./CCSys"),B=L("../event-manager"),k=N.TOUCH_TIMEOUT,U=cc.v2(),V={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.v2(0,0),_prevMousePoint:cc.v2(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:8,_accelEnabled:!1,_accelInterval:.2,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_canvasBoundingRect:{left:0,top:0,adjustedLeft:0,adjustedTop:0,width:0,height:0},_getUnUsedIndex:function(){for(var L=this._indexBitsUsed,D=cc.sys.now(),P=0;P<this._maxTouches;P++){if(!(1&L))return this._indexBitsUsed|=1<<P,P;var N=this._touches[P];if(D-N._lastModified>k)return this._removeUsedIndexBit(P),delete this._touchesIntegerDict[N.getID()],P;L>>=1}return-1},_removeUsedIndexBit:function(L){if(!(L<0||L>=this._maxTouches)){var D=1<<L;D=~D,this._indexBitsUsed&=D}},_glView:null,_updateCanvasBoundingRect:function(){var L=cc.game.canvas,D=this._canvasBoundingRect,P=document.documentElement,N=window.pageXOffset-P.clientLeft,F=window.pageYOffset-P.clientTop;if(L.getBoundingClientRect){var B=L.getBoundingClientRect();D.left=B.left+N,D.top=B.top+F,D.width=B.width,D.height=B.height}else L instanceof HTMLCanvasElement?(D.left=N,D.top=F,D.width=L.width,D.height=L.height):(D.left=N,D.top=F,D.width=parseInt(L.style.width),D.height=parseInt(L.style.height))},handleTouchesBegin:function(L){for(var D,P,N,k=[],U=this._touchesIntegerDict,V=F.now(),z=0,W=L.length;z<W;z++)if(null==U[N=(D=L[z]).getID()]){var H=this._getUnUsedIndex();if(-1===H){cc.logID(2300,H);continue}(P=this._touches[H]=new cc.Touch(D._point.x,D._point.y,D.getID()))._lastModified=V,P._setPrevPoint(D._prevPoint),U[N]=H,k.push(P)}if(k.length>0){this._glView._convertTouchesWithScale(k);var G=new cc.Event.EventTouch(k);G._eventCode=cc.Event.EventTouch.BEGAN,B.dispatchEvent(G)}},handleTouchesMove:function(L){for(var D,P,N,k=[],U=this._touches,V=F.now(),z=0,W=L.length;z<W;z++)N=(D=L[z]).getID(),null!=(P=this._touchesIntegerDict[N])&&U[P]&&(U[P]._setPoint(D._point),U[P]._setPrevPoint(D._prevPoint),U[P]._lastModified=V,k.push(U[P]));if(k.length>0){this._glView._convertTouchesWithScale(k);var H=new cc.Event.EventTouch(k);H._eventCode=cc.Event.EventTouch.MOVED,B.dispatchEvent(H)}},handleTouchesEnd:function(L){var D=this.getSetOfTouchesEndOrCancel(L);if(D.length>0){this._glView._convertTouchesWithScale(D);var P=new cc.Event.EventTouch(D);P._eventCode=cc.Event.EventTouch.ENDED,B.dispatchEvent(P)}this._preTouchPool.length=0},handleTouchesCancel:function(L){var D=this.getSetOfTouchesEndOrCancel(L);if(D.length>0){this._glView._convertTouchesWithScale(D);var P=new cc.Event.EventTouch(D);P._eventCode=cc.Event.EventTouch.CANCELLED,B.dispatchEvent(P)}this._preTouchPool.length=0},getSetOfTouchesEndOrCancel:function(L){for(var D,P,N,F=[],B=this._touches,k=this._touchesIntegerDict,U=0,V=L.length;U<V;U++)null!=(P=k[N=(D=L[U]).getID()])&&B[P]&&(B[P]._setPoint(D._point),B[P]._setPrevPoint(D._prevPoint),F.push(B[P]),this._removeUsedIndexBit(P),delete k[N]);return F},getPreTouch:function(L){for(var D=null,P=this._preTouchPool,N=L.getID(),F=P.length-1;F>=0;F--)if(P[F].getID()===N){D=P[F];break}return D||(D=L),D},setPreTouch:function(L){for(var D=!1,P=this._preTouchPool,N=L.getID(),F=P.length-1;F>=0;F--)if(P[F].getID()===N){P[F]=L,D=!0;break}D||(P.length<=50?P.push(L):(P[this._preTouchPoolPointer]=L,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(L,D,P){var N=this._preTouchPoint,F=this._glView.convertToLocationInView(L,D,P),B=new cc.Touch(F.x,F.y,0);return B._setPrevPoint(N.x,N.y),N.x=F.x,N.y=F.y,B},getMouseEvent:function(L,D,P){var N=this._prevMousePoint,F=new cc.Event.EventMouse(P);return F._setPrevCursor(N.x,N.y),N.x=L.x,N.y=L.y,this._glView._convertMouseToLocationInView(N,D),F.setLocation(N.x,N.y),F},getPointByEvent:function(L,D){return cc.sys.browserType!==cc.sys.BROWSER_TYPE_QQ&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_SAFARI||this._updateCanvasBoundingRect(),null!=L.pageX?{x:L.pageX,y:L.pageY}:(D.left-=document.body.scrollLeft,D.top-=document.body.scrollTop,{x:L.clientX,y:L.clientY})},getTouchesByEvent:function(L,D){for(var P,N,B,k=[],V=this._glView,z=this._preTouchPoint,W=L.changedTouches.length,H=0;H<W;H++)if(P=L.changedTouches[H]){var G;G=F.BROWSER_TYPE_FIREFOX===F.browserType?V.convertToLocationInView(P.pageX,P.pageY,D,U):V.convertToLocationInView(P.clientX,P.clientY,D,U),null!=P.identifier?(N=new cc.Touch(G.x,G.y,P.identifier),B=this.getPreTouch(N).getLocation(),N._setPrevPoint(B.x,B.y),this.setPreTouch(N)):(N=new cc.Touch(G.x,G.y))._setPrevPoint(z.x,z.y),z.x=G.x,z.y=G.y,k.push(N)}return k},registerSystemEvent:function(L){if(!this._isRegisterEvent){this._glView=cc.view;var D=this,P=this._canvasBoundingRect;window.addEventListener("resize",this._updateCanvasBoundingRect.bind(this));var N=F.isMobile,k="mouse"in F.capabilities,U="touches"in F.capabilities;if(k){N||(window.addEventListener("mousedown",(function(){D._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(L){if(D._mousePressed){D._mousePressed=!1;var N=D.getPointByEvent(L,P);if(!cc.rect(P.left,P.top,P.width,P.height).contains(N)){D.handleTouchesEnd([D.getTouchByXY(N.x,N.y,P)]);var F=D.getMouseEvent(N,P,cc.Event.EventMouse.UP);F.setButton(L.button),B.dispatchEvent(F)}}}),!1));for(var V=cc.Event.EventMouse,z=[!N&&["mousedown",V.DOWN,function(P,N,F,B){D._mousePressed=!0,D.handleTouchesBegin([D.getTouchByXY(F.x,F.y,B)]),L.focus()}],!N&&["mouseup",V.UP,function(L,P,N,F){D._mousePressed=!1,D.handleTouchesEnd([D.getTouchByXY(N.x,N.y,F)])}],!N&&["mousemove",V.MOVE,function(L,P,N,F){D.handleTouchesMove([D.getTouchByXY(N.x,N.y,F)]),D._mousePressed||P.setButton(null)}],["mousewheel",V.SCROLL,function(L,D){D.setScrollData(0,L.wheelDelta)}],["DOMMouseScroll",V.SCROLL,function(L,D){D.setScrollData(0,-120*L.detail)}]],W=0;W<z.length;++W){var H=z[W];H&&function(){var N=H[0],F=H[1],k=H[2];L.addEventListener(N,(function(L){var N=D.getPointByEvent(L,P),U=D.getMouseEvent(N,P,F);U.setButton(L.button),k(L,U,N,P),B.dispatchEvent(U),L.stopPropagation(),L.preventDefault()}),!1)}()}}if(window.navigator.msPointerEnabled){var G={MSPointerDown:D.handleTouchesBegin,MSPointerMove:D.handleTouchesMove,MSPointerUp:D.handleTouchesEnd,MSPointerCancel:D.handleTouchesCancel},f=function(N){var F=G[N];L.addEventListener(N,(function(L){var N=document.documentElement;P.adjustedLeft=P.left-N.scrollLeft,P.adjustedTop=P.top-N.scrollTop,F.call(D,[D.getTouchByXY(L.clientX,L.clientY,P)]),L.stopPropagation()}),!1)};for(var X in G)f(X)}if(U){var nt={touchstart:function(P){D.handleTouchesBegin(P),L.focus()},touchmove:function(L){D.handleTouchesMove(L)},touchend:function(L){D.handleTouchesEnd(L)},touchcancel:function(L){D.handleTouchesCancel(L)}},v=function(N){var F=nt[N];L.addEventListener(N,(function(L){if(L.changedTouches){var N=document.body;P.adjustedLeft=P.left-(N.scrollLeft||0),P.adjustedTop=P.top-(N.scrollTop||0),F(D.getTouchesByEvent(L,P)),L.stopPropagation(),L.preventDefault()}}),!1)};for(var ut in nt)v(ut)}this._registerKeyboardEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(L){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,B.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=L}};D.exports=cc.internal.inputManager=V},{"../event-manager":104,"./CCMacro":142,"./CCSys":146}],142:[function(L,D,P){"use strict";cc.macro={RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,MIN_ZINDEX:-Math.pow(2,15),MAX_ZINDEX:Math.pow(2,15)-1,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:!0,DIRECTOR_STATS_POSITION:cc.v2(0,0),ENABLE_STACKABLE_ACTIONS:!0,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1,ENABLE_CULLING:!1,CLEANUP_IMAGE_CACHE:!1,SHOW_MESH_WIREFRAME:!1,SHOW_MESH_NORMAL:!1,ROTATE_ACTION_CCW:!1,ENABLE_MULTI_TOUCH:!0},cc.macro.SUPPORT_TEXTURE_FORMATS=[".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],cc.macro.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.macro.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.macro.BlendFactor=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775}),cc.macro.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.macro.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),D.exports=cc.macro},{}],143:[function(L,D,P){"use strict";var N=L("./js"),F=L("./CCClass");function a(){this._name="",this._objFlags=0}F.fastDefine("cc.Object",a,{_name:"",_objFlags:0}),N.value(a,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var B=[];N.value(a,"_deferredDestroy",(function(){for(var L=B.length,D=0;D<L;++D){var P=B[D];1&P._objFlags||P._destroyImmediate()}L===B.length?B.length=0:B.splice(0,L)}));var k=a.prototype;N.getset(k,"name",(function(){return this._name}),(function(L){this._name=L}),!0),N.get(k,"isValid",(function(){return!(1&this._objFlags)}),!0),k.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,B.push(this),0))},k._destruct=function(){var L=this.constructor,D=L.__destruct__;D||(D=function(L,D){var P,N=L instanceof cc._BaseNode||L instanceof cc.Component,B=N?"_id":null,k={};for(P in L)if(L.hasOwnProperty(P)){if(P===B)continue;switch(typeof L[P]){case"string":k[P]="";break;case"object":case"function":k[P]=null}}if(cc.Class._isCCClass(D))for(var U=cc.Class.Attr.getClassAttrs(D),V=D.__props__,z=0;z<V.length;z++){var W=(P=V[z])+cc.Class.Attr.DELIMETER+"default";if(W in U){if(N&&"_id"===P)continue;switch(typeof U[W]){case"string":k[P]="";break;case"object":case"function":k[P]=null;break;case"undefined":k[P]=void 0}}}var H="";for(P in k){var G;G=F.IDENTIFIER_RE.test(P)?"o."+P+"=":"o["+F.escapeForJS(P)+"]=";var X=k[P];""===X&&(X='""'),H+=G+X+";\n"}return Function("o",H)}(this,L),N.value(L,"__destruct__",D,!0)),D(this)},k._onPreDestroy=null,k._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},k._deserialize=null,cc.isValid=function(L,D){return"object"==typeof L?!(!L||L._objFlags&(D?5:1)):void 0!==L},cc.Object=D.exports=a},{"./CCClass":137,"./js":157}],144:[function(L,D,P){"use strict";var N=L("../platform/js");cc.SAXParser=function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},cc.SAXParser.prototype={constructor:cc.SAXParser,parse:function(L){return this._parseXML(L)},_parseXML:function(L){var D;return this._isSupportDOMParser?D=this._parser.parseFromString(L,"text/xml"):((D=new ActiveXObject("Microsoft.XMLDOM")).async="false",D.loadXML(L)),D}},cc.PlistParser=function(){cc.SAXParser.call(this)},N.extend(cc.PlistParser,cc.SAXParser),N.mixin(cc.PlistParser.prototype,{parse:function(L){var D=this._parseXML(L),P=D.documentElement;if("plist"!==P.tagName)return cc.warnID(5100),{};for(var N=null,F=0,B=P.childNodes.length;F<B&&1!==(N=P.childNodes[F]).nodeType;F++);return D=null,this._parseNode(N)},_parseNode:function(L){var D=null,P=L.tagName;if("dict"===P)D=this._parseDict(L);else if("array"===P)D=this._parseArray(L);else if("string"===P)if(1===L.childNodes.length)D=L.firstChild.nodeValue;else{D="";for(var N=0;N<L.childNodes.length;N++)D+=L.childNodes[N].nodeValue}else"false"===P?D=!1:"true"===P?D=!0:"real"===P?D=parseFloat(L.firstChild.nodeValue):"integer"===P&&(D=parseInt(L.firstChild.nodeValue,10));return D},_parseArray:function(L){for(var D=[],P=0,N=L.childNodes.length;P<N;P++){var F=L.childNodes[P];1===F.nodeType&&D.push(this._parseNode(F))}return D},_parseDict:function(L){for(var D={},P=null,N=0,F=L.childNodes.length;N<F;N++){var B=L.childNodes[N];1===B.nodeType&&("key"===B.tagName?P=B.firstChild.nodeValue:D[P]=this._parseNode(B))}return D}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser,D.exports={saxParser:cc.saxParser,plistParser:cc.plistParser}},{"../platform/js":157}],145:[function(L,D,P){"use strict";cc.screen={_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenChange:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],init:function(){this._fn={};var L,D,P,N,F=this._fnMap;for(L=0,D=F.length;L<D;L++)if((P=F[L])&&void 0!==document[P[1]]){for(L=0,N=P.length;L<N;L++)this._fn[F[0][L]]=P[L];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchend"in window?"touchend":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&!!(document[this._fn.fullscreenElement]||document[this._fn.webkitFullscreenElement]||document[this._fn.mozFullScreenElement])},requestFullScreen:function(L,D,P){if(L&&"video"===L.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser&&L.readyState>0)return void(L.webkitEnterFullscreen&&L.webkitEnterFullscreen());L.setAttribute("x5-video-player-fullscreen","true")}if(this._supportsFullScreen){if(L=L||document.documentElement,D){var N=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(N,this._onfullscreenchange),this._onfullscreenchange=D,document.addEventListener(N,D,!1)}if(P){var F=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(F,this._onfullscreenerror),this._onfullscreenerror=P,document.addEventListener(F,P,{once:!0})}L[this._fn.requestFullscreen]()}},exitFullScreen:function(L){if(L&&"video"===L.tagName.toLowerCase()){if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isBrowser)return void(L.webkitExitFullscreen&&L.webkitExitFullscreen());L.setAttribute("x5-video-player-fullscreen","false")}return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(L,D){L=L||document.body,this._ensureFullScreen(L,D),this.requestFullScreen(L,D)},disableAutoFullScreen:function(L){var D=cc.game.canvas||L,P=this._touchEvent;this._preOnTouch&&(D.removeEventListener(P,this._preOnTouch),this._preOnTouch=null)},_ensureFullScreen:function(L,D){var P=this,N=cc.game.canvas||L,F=this._fn.fullscreenerror;if(void 0!==document[F]){var B=this._touchEvent;this._preOnFullScreenError&&L.removeEventListener(F,this._preOnFullScreenError),this._preOnFullScreenError=a,L.addEventListener(F,a,{once:!0})}function a(){P._preOnFullScreenError=null,P._preOnTouch&&N.removeEventListener(B,P._preOnTouch),P._preOnTouch=function(){P._preOnTouch=null,P.requestFullScreen(L,D)},N.addEventListener(B,P._preOnTouch,{once:!0})}}},cc.screen.init()},{}],146:[function(L,D,P){"use strict";window._CCSettings&&_CCSettings.platform;var N="undefined"==typeof window?global:window,F=cc&&cc.sys?cc.sys:function(){cc.sys={};var L=cc.sys;if(L.LANGUAGE_ENGLISH="en",L.LANGUAGE_CHINESE="zh",L.LANGUAGE_FRENCH="fr",L.LANGUAGE_ITALIAN="it",L.LANGUAGE_GERMAN="de",L.LANGUAGE_SPANISH="es",L.LANGUAGE_DUTCH="du",L.LANGUAGE_RUSSIAN="ru",L.LANGUAGE_KOREAN="ko",L.LANGUAGE_JAPANESE="ja",L.LANGUAGE_HUNGARIAN="hu",L.LANGUAGE_PORTUGUESE="pt",L.LANGUAGE_ARABIC="ar",L.LANGUAGE_NORWEGIAN="no",L.LANGUAGE_POLISH="pl",L.LANGUAGE_TURKISH="tr",L.LANGUAGE_UKRAINIAN="uk",L.LANGUAGE_ROMANIAN="ro",L.LANGUAGE_BULGARIAN="bg",L.LANGUAGE_UNKNOWN="unknown",L.OS_IOS="iOS",L.OS_ANDROID="Android",L.OS_WINDOWS="Windows",L.OS_MARMALADE="Marmalade",L.OS_LINUX="Linux",L.OS_BADA="Bada",L.OS_BLACKBERRY="Blackberry",L.OS_OSX="OS X",L.OS_WP8="WP8",L.OS_WINRT="WINRT",L.OS_UNKNOWN="Unknown",L.UNKNOWN=-1,L.WIN32=0,L.LINUX=1,L.MACOS=2,L.ANDROID=3,L.IPHONE=4,L.IPAD=5,L.BLACKBERRY=6,L.NACL=7,L.EMSCRIPTEN=8,L.TIZEN=9,L.WINRT=10,L.WP8=11,L.MOBILE_BROWSER=100,L.DESKTOP_BROWSER=101,L.EDITOR_PAGE=102,L.EDITOR_CORE=103,L.WECHAT_GAME=104,L.QQ_PLAY=105,L.FB_PLAYABLE_ADS=106,L.BAIDU_GAME=107,L.VIVO_GAME=108,L.OPPO_GAME=109,L.HUAWEI_GAME=110,L.XIAOMI_GAME=111,L.JKW_GAME=112,L.ALIPAY_GAME=113,L.WECHAT_GAME_SUB=114,L.BAIDU_GAME_SUB=115,L.QTT_GAME=116,L.BROWSER_TYPE_WECHAT="wechat",L.BROWSER_TYPE_WECHAT_GAME="wechatgame",L.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",L.BROWSER_TYPE_BAIDU_GAME="baidugame",L.BROWSER_TYPE_BAIDU_GAME_SUB="baidugamesub",L.BROWSER_TYPE_XIAOMI_GAME="xiaomigame",L.BROWSER_TYPE_ALIPAY_GAME="alipaygame",L.BROWSER_TYPE_QQ_PLAY="qqplay",L.BROWSER_TYPE_ANDROID="androidbrowser",L.BROWSER_TYPE_IE="ie",L.BROWSER_TYPE_EDGE="edge",L.BROWSER_TYPE_QQ="qqbrowser",L.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",L.BROWSER_TYPE_UC="ucbrowser",L.BROWSER_TYPE_UCBS="ucbs",L.BROWSER_TYPE_360="360browser",L.BROWSER_TYPE_BAIDU_APP="baiduboxapp",L.BROWSER_TYPE_BAIDU="baidubrowser",L.BROWSER_TYPE_MAXTHON="maxthon",L.BROWSER_TYPE_OPERA="opera",L.BROWSER_TYPE_OUPENG="oupeng",L.BROWSER_TYPE_MIUI="miuibrowser",L.BROWSER_TYPE_FIREFOX="firefox",L.BROWSER_TYPE_SAFARI="safari",L.BROWSER_TYPE_CHROME="chrome",L.BROWSER_TYPE_LIEBAO="liebao",L.BROWSER_TYPE_QZONE="qzone",L.BROWSER_TYPE_SOUGOU="sogou",L.BROWSER_TYPE_UNKNOWN="unknown",L.isNative=!1,L.isBrowser="object"==typeof window&&"object"==typeof document&&!0,L.glExtension=function(L){return!!cc.renderer.device.ext(L)},L.getMaxJointMatrixSize=function(){if(!L._maxJointMatrixSize){var D=cc.game._renderContext,P=Math.floor(D.getParameter(D.MAX_VERTEX_UNIFORM_VECTORS)/4)-10;L._maxJointMatrixSize=P<50?0:50}return L._maxJointMatrixSize},N.__globalAdapter&&N.__globalAdapter.adaptSys)N.__globalAdapter.adaptSys(L);else{var D=window,P=D.navigator,F=document,B=F.documentElement,k=P.userAgent.toLowerCase();L.isMobile=/mobile|android|iphone|ipad/.test(k),"undefined"!=typeof FbPlayableAd?L.platform=L.FB_PLAYABLE_ADS:L.platform=L.isMobile?L.MOBILE_BROWSER:L.DESKTOP_BROWSER;var U=P.language;U=U||P.browserLanguage,L.languageCode=U.toLowerCase(),U=U?U.split("-")[0]:L.LANGUAGE_ENGLISH,L.language=U;var V=!1,z=!1,W="",H=0,G=/android (\d+(?:\.\d+)*)/i.exec(k)||/android (\d+(?:\.\d+)*)/i.exec(P.platform);G&&(V=!0,W=G[1]||"",H=parseInt(W)||0),(G=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(k))?(z=!0,W=G[2]||"",H=parseInt(W)||0):(/(iPhone|iPad|iPod)/.exec(P.platform)||"MacIntel"===P.platform&&P.maxTouchPoints&&P.maxTouchPoints>1)&&(z=!0,W="",H=0);var X=L.OS_UNKNOWN;-1!==P.appVersion.indexOf("Win")?X=L.OS_WINDOWS:z?X=L.OS_IOS:-1!==P.appVersion.indexOf("Mac")?X=L.OS_OSX:-1!==P.appVersion.indexOf("X11")&&-1===P.appVersion.indexOf("Linux")?X=L.OS_UNIX:V?X=L.OS_ANDROID:-1===P.appVersion.indexOf("Linux")&&-1===k.indexOf("ubuntu")||(X=L.OS_LINUX),L.os=X,L.osVersion=W,L.osMainVersion=H,L.browserType=L.BROWSER_TYPE_UNKNOWN,function(){var D=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(k)||/qq|ucbrowser|ubrowser|edge/i.exec(k)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(k),P=D?D[0].toLowerCase():L.BROWSER_TYPE_UNKNOWN;("safari"===P&&V||"qq"===P&&k.match(/android.*applewebkit/i))&&(P=L.BROWSER_TYPE_ANDROID);var N={micromessenger:L.BROWSER_TYPE_WECHAT,trident:L.BROWSER_TYPE_IE,edge:L.BROWSER_TYPE_EDGE,"360 aphone":L.BROWSER_TYPE_360,mxbrowser:L.BROWSER_TYPE_MAXTHON,"opr/":L.BROWSER_TYPE_OPERA,ubrowser:L.BROWSER_TYPE_UC};L.browserType=N[P]||P}(),L.browserVersion="",function(){var D=k.match(/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i);D||(D=k.match(/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i)),L.browserVersion=D?D[4]:""}();var nt=window.innerWidth||document.documentElement.clientWidth,ut=window.innerHeight||document.documentElement.clientHeight,dt=window.devicePixelRatio||1;L.windowPixelResolution={width:dt*nt,height:dt*ut},L._checkWebGLRenderMode=function(){if(cc.game.renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var ft=document.createElement("canvas");try{var _t=L.localStorage=D.localStorage;_t.setItem("storage",""),_t.removeItem("storage"),_t=null}catch(D){var y=function(){cc.warnID(5200)};L.localStorage={getItem:y,setItem:y,removeItem:y,clear:y}}var pt=ft.toDataURL("image/webp").startsWith("data:image/webp"),vt=!!ft.getContext("2d"),gt=!1;D.WebGLRenderingContext&&(gt=!0);var mt,yt=L.capabilities={canvas:vt,opengl:gt,webp:pt};(void 0!==B.ontouchstart||void 0!==F.ontouchstart||P.msPointerEnabled)&&(yt.touches=!0),void 0!==B.onmouseup&&(yt.mouse=!0),void 0!==B.onkeyup&&(yt.keyboard=!0),(D.DeviceMotionEvent||D.DeviceOrientationEvent)&&(yt.accelerometer=!0),function(){L.browserVersion;var D=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);mt={ONLY_ONE:!1,WEB_AUDIO:D,DELAY_CREATE_CTX:!1},L.os===L.OS_IOS&&(mt.USE_LOADER_EVENT="loadedmetadata"),L.browserType===L.BROWSER_TYPE_FIREFOX&&(mt.DELAY_CREATE_CTX=!0,mt.USE_LOADER_EVENT="canplay"),L.os===L.OS_ANDROID&&L.browserType===L.BROWSER_TYPE_UC&&(mt.ONE_SOURCE=!0)}();try{mt.WEB_AUDIO&&(mt.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),mt.DELAY_CREATE_CTX&&setTimeout((function(){mt.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}),0))}catch(L){mt.WEB_AUDIO=!1,cc.logID(5201)}var Tt=[];(function(){var L=document.createElement("audio");L.canPlayType&&(L.canPlayType('audio/ogg; codecs="vorbis"')&&Tt.push(".ogg"),L.canPlayType("audio/mpeg")&&Tt.push(".mp3"),L.canPlayType('audio/wav; codecs="1"')&&Tt.push(".wav"),L.canPlayType("audio/mp4")&&Tt.push(".mp4"),L.canPlayType("audio/x-m4a")&&Tt.push(".m4a"))})(),mt.format=Tt,L.__audioSupport=mt}return L.NetworkType={NONE:0,LAN:1,WWAN:2},L.getNetworkType=function(){return L.NetworkType.LAN},L.getBatteryLevel=function(){return 1},L.garbageCollect=function(){},L.restartVM=function(){},L.getSafeAreaRect=function(){var L=cc.view.getVisibleSize();return cc.rect(0,0,L.width,L.height)},L.isObjectValid=function(L){return!!L},L.dump=function(){var L="";L+="isMobile : "+this.isMobile+"\r\n",L+="language : "+this.language+"\r\n",L+="browserType : "+this.browserType+"\r\n",L+="browserVersion : "+this.browserVersion+"\r\n",L+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",L+="os : "+this.os+"\r\n",L+="osVersion : "+this.osVersion+"\r\n",L+="platform : "+this.platform+"\r\n",L+="Using "+(cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(L)},L.openURL=function(L){window.open(L)},L.now=function(){return Date.now?Date.now():+new Date},L}();D.exports=F},{}],147:[function(L,D,P){"use strict";var N=L("../event/event-target"),F=L("../platform/js"),B=L("../renderer");L("../platform/CCClass");var k={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(L){return L&&L!==this.html?L.clientWidth:window.innerWidth},availHeight:function(L){return L&&L!==this.html?L.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(k.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),k.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:k.meta["minimal-ui"]="true",k.availWidth=cc.sys.isMobile?function(L){return window.innerWidth}:function(L){return L.clientWidth},k.availHeight=cc.sys.isMobile?function(L){return window.innerHeight}:function(L){return L.clientHeight};break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:k.meta["minimal-ui"]="true",k.availWidth=function(L){return L.clientWidth},k.availHeight=function(L){return L.clientHeight}}var U=null,c=function(){N.call(this);var L=this,D=cc.ContainerStrategy,P=cc.ContentStrategy;k.init(this),L._frameSize=cc.size(0,0),L._designResolutionSize=cc.size(0,0),L._originalDesignResolutionSize=cc.size(0,0),L._scaleX=1,L._scaleY=1,L._viewportRect=cc.rect(0,0,0,0),L._visibleRect=cc.rect(0,0,0,0),L._autoFullScreen=!1,L._devicePixelRatio=1,L._maxPixelRatio=2,L._retinaEnabled=!1,L._resizeCallback=null,L._resizing=!1,L._resizeWithBrowserSize=!1,L._orientationChanging=!0,L._isRotated=!1,L._orientation=cc.macro.ORIENTATION_AUTO,L._isAdjustViewport=!0,L._antiAliasEnabled=!1,L._resolutionPolicy=null,L._rpExactFit=new cc.ResolutionPolicy(D.EQUAL_TO_FRAME,P.EXACT_FIT),L._rpShowAll=new cc.ResolutionPolicy(D.EQUAL_TO_FRAME,P.SHOW_ALL),L._rpNoBorder=new cc.ResolutionPolicy(D.EQUAL_TO_FRAME,P.NO_BORDER),L._rpFixedHeight=new cc.ResolutionPolicy(D.EQUAL_TO_FRAME,P.FIXED_HEIGHT),L._rpFixedWidth=new cc.ResolutionPolicy(D.EQUAL_TO_FRAME,P.FIXED_WIDTH),cc.game.once(cc.game.EVENT_ENGINE_INITED,this.init,this)};cc.js.extend(c,N),cc.js.mixin(c.prototype,{init:function(){this._initFrameSize();var L=cc.game.canvas.width,D=cc.game.canvas.height;this._designResolutionSize.width=L,this._designResolutionSize.height=D,this._originalDesignResolutionSize.width=L,this._originalDesignResolutionSize.height=D,this._viewportRect.width=L,this._viewportRect.height=D,this._visibleRect.width=L,this._visibleRect.height=D,cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},_resizeEvent:function(L){var D,P=(D=this.setDesignResolutionSize?this:cc.view)._frameSize.width,N=D._frameSize.height,F=D._isRotated;if(cc.sys.isMobile){var B=cc.game.container.style,k=B.margin;B.margin="0",B.display="none",D._initFrameSize(),B.margin=k,B.display="block"}else D._initFrameSize();if(!0===L||D._isRotated!==F||D._frameSize.width!==P||D._frameSize.height!==N){var U=D._originalDesignResolutionSize.width,V=D._originalDesignResolutionSize.height;D._resizing=!0,U>0&&D.setDesignResolutionSize(U,V,D._resolutionPolicy),D._resizing=!1,D.emit("canvas-resize"),D._resizeCallback&&D._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent(),cc.sys.browserType===cc.sys.BROWSER_TYPE_SAFARI&&cc.sys.isMobile&&setTimeout((function(){window.innerHeight>window.innerWidth&&window.scrollTo(0,1)}),500)},resizeWithBrowserSize:function(L){L?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(L){"function"!=typeof L&&null!=L||(this._resizeCallback=L)},setOrientation:function(L){if((L&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==L){this._orientation=L;var D=this._originalDesignResolutionSize.width,P=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(D,P,this._resolutionPolicy)}},_initFrameSize:function(){var L=this._frameSize,D=k.availWidth(cc.game.frame),P=k.availHeight(cc.game.frame),N=D>=P;!cc.sys.isMobile||N&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!N&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(L.width=D,L.height=P,cc.game.container.style["-webkit-transform"]="rotate(0deg)",cc.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(L.width=P,L.height=D,cc.game.container.style["-webkit-transform"]="rotate(90deg)",cc.game.container.style.transform="rotate(90deg)",cc.game.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout((function(){cc.view._orientationChanging=!1}),1e3)},_setViewportMeta:function(L,D){var P=document.getElementById("cocosMetaElement");P&&D&&document.head.removeChild(P);var N,F,B,k=document.getElementsByName("viewport"),U=k?k[0]:null;for(F in N=U?U.content:"",(P=P||document.createElement("meta")).id="cocosMetaElement",P.name="viewport",P.content="",L)-1==N.indexOf(F)?N+=","+F+"="+L[F]:D&&(B=new RegExp(F+"s*=s*[^,]+"),N.replace(B,F+"="+L[F]));/^,/.test(N)&&(N=N.substr(1)),P.content=N,U&&(U.content=N),document.head.appendChild(P)},_adjustViewportMeta:function(){this._isAdjustViewport&&(this._setViewportMeta(k.meta,!1),this._isAdjustViewport=!1)},adjustViewportMeta:function(L){this._isAdjustViewport=L},enableRetina:function(L){this._retinaEnabled=!!L},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(L){if(cc.warnID(9200),this._antiAliasEnabled!==L)if(this._antiAliasEnabled=L,cc.game.renderType===cc.game.RENDER_TYPE_WEBGL){var D=cc.loader._cache;for(var P in D){var N=D[P],F=N&&N.content instanceof cc.Texture2D?N.content:null;if(F){var B=cc.Texture2D.Filter;L?F.setFilters(B.LINEAR,B.LINEAR):F.setFilters(B.NEAREST,B.NEAREST)}}}else if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){var k=cc.game.canvas.getContext("2d");k.imageSmoothingEnabled=L,k.mozImageSmoothingEnabled=L}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(L){L&&L!==this._autoFullScreen&&cc.sys.isMobile?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):(this._autoFullScreen=!1,cc.screen.disableAutoFullScreen(cc.game.frame))},isAutoFullScreenEnabled:function(){return this._autoFullScreen},setCanvasSize:function(L,D){var P=cc.game.canvas,N=cc.game.container;P.width=L*this._devicePixelRatio,P.height=D*this._devicePixelRatio,P.style.width=L+"px",P.style.height=D+"px",N.style.width=L+"px",N.style.height=D+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(L,D){this._frameSize.width=L,this._frameSize.height=D,cc.game.frame.style.width=L+"px",cc.game.frame.style.height=D+"px",this._resizeEvent(!0)},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.v2(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.v2(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(L){var D=this;if(L instanceof cc.ResolutionPolicy)D._resolutionPolicy=L;else{var P=cc.ResolutionPolicy;L===P.EXACT_FIT&&(D._resolutionPolicy=D._rpExactFit),L===P.SHOW_ALL&&(D._resolutionPolicy=D._rpShowAll),L===P.NO_BORDER&&(D._resolutionPolicy=D._rpNoBorder),L===P.FIXED_HEIGHT&&(D._resolutionPolicy=D._rpFixedHeight),L===P.FIXED_WIDTH&&(D._resolutionPolicy=D._rpFixedWidth)}},setDesignResolutionSize:function(L,D,P){if(L>0||D>0){this.setResolutionPolicy(P);var N=this._resolutionPolicy;if(N&&N.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),N){this._originalDesignResolutionSize.width=this._designResolutionSize.width=L,this._originalDesignResolutionSize.height=this._designResolutionSize.height=D;var F=N.apply(this,this._designResolutionSize);if(F.scale&&2===F.scale.length&&(this._scaleX=F.scale[0],this._scaleY=F.scale[1]),F.viewport){var k=this._viewportRect,U=this._visibleRect,V=F.viewport;k.x=V.x,k.y=V.y,k.width=V.width,k.height=V.height,U.x=0,U.y=0,U.width=V.width/this._scaleX,U.height=V.height/this._scaleY}N.postApply(this),cc.winSize.width=this._visibleRect.width,cc.winSize.height=this._visibleRect.height,cc.visibleRect&&cc.visibleRect.init(this._visibleRect),B.updateCameraViewport(),cc.internal.inputManager._updateCanvasBoundingRect(),this.emit("design-resolution-changed")}else cc.logID(2201)}else cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(L,D,P){this._setViewportMeta({width:L},!0),document.documentElement.style.width=L+"px",document.body.style.width=L+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(L,D,P)},setViewportInPoints:function(L,D,P,N){var F=this._scaleX,B=this._scaleY;cc.game._renderContext.viewport(L*F+this._viewportRect.x,D*B+this._viewportRect.y,P*F,N*B)},setScissorInPoints:function(L,D,P,N){var F=this._scaleX,B=this._scaleY,k=Math.ceil(L*F+this._viewportRect.x),V=Math.ceil(D*B+this._viewportRect.y),z=Math.ceil(P*F),W=Math.ceil(N*B),H=cc.game._renderContext;if(!U){var G=H.getParameter(H.SCISSOR_BOX);U=cc.rect(G[0],G[1],G[2],G[3])}U.x===k&&U.y===V&&U.width===z&&U.height===W||(U.x=k,U.y=V,U.width=z,U.height=W,H.scissor(k,V,z,W))},isScissorEnabled:function(){return cc.game._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!U){var L=gl.getParameter(gl.SCISSOR_BOX);U=cc.rect(L[0],L[1],L[2],L[3])}var D=1/this._scaleX,P=1/this._scaleY;return cc.rect((U.x-this._viewportRect.x)*D,(U.y-this._viewportRect.y)*P,U.width*D,U.height*P)},getViewportRect:function(){return this._viewportRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(L,D,P,N){var F=N||cc.v2(),B=P.adjustedLeft?P.adjustedLeft:P.left,k=P.adjustedTop?P.adjustedTop:P.top,U=this._devicePixelRatio*(L-B),V=this._devicePixelRatio*(k+P.height-D);return this._isRotated?(F.x=cc.game.canvas.width-V,F.y=U):(F.x=U,F.y=V),F},_convertMouseToLocationInView:function(L,D){var P=this._viewportRect;L.x=(this._devicePixelRatio*(L.x-D.left)-P.x)/this._scaleX,L.y=(this._devicePixelRatio*(D.top+D.height-L.y)-P.y)/this._scaleY},_convertPointWithScale:function(L){var D=this._viewportRect;L.x=(L.x-D.x)/this._scaleX,L.y=(L.y-D.y)/this._scaleY},_convertTouchesWithScale:function(L){for(var D,P,N,F=this._viewportRect,B=this._scaleX,k=this._scaleY,U=0;U<L.length;U++)P=(D=L[U])._point,N=D._prevPoint,P.x=(P.x-F.x)/B,P.y=(P.y-F.y)/k,N.x=(N.x-F.x)/B,N.y=(N.y-F.y)/k}}),cc.ContainerStrategy=cc.Class({name:"ContainerStrategy",preApply:function(L){},apply:function(L,D){},postApply:function(L){},_setupContainer:function(L,D,P){var N=cc.game.canvas;this._setupStyle(L,D,P);var F=L._devicePixelRatio=1;L.isRetinaEnabled()&&(F=L._devicePixelRatio=Math.min(L._maxPixelRatio,window.devicePixelRatio||1)),N.width=D*F,N.height=P*F},_setupStyle:function(L,D,P){var N=cc.game.canvas,F=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(L._isRotated?P:D)+"px",document.body.style.height=(L._isRotated?D:P)+"px"),F.style.width=N.style.width=D+"px",F.style.height=N.style.height=P+"px"},_fixContainer:function(){document.body.insertBefore(cc.game.container,document.body.firstChild);var L=document.body.style;L.width=window.innerWidth+"px",L.height=window.innerHeight+"px",L.overflow="hidden";var D=cc.game.container.style;D.position="fixed",D.left=D.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class({name:"ContentStrategy",ctor:function(){this._result={scale:[1,1],viewport:null}},_buildResult:function(L,D,P,N,F,B){Math.abs(L-P)<2&&(P=L),Math.abs(D-N)<2&&(N=D);var k=cc.rect((L-P)/2,(D-N)/2,P,N);return cc.game.renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[F,B],this._result.viewport=k,this._result},preApply:function(L){},apply:function(L,D){return{scale:[1,1]}},postApply:function(L){}}),function(){var L=cc.Class({name:"EqualToFrame",extends:cc.ContainerStrategy,apply:function(L){var D=L._frameSize.height,P=cc.game.container.style;this._setupContainer(L,L._frameSize.width,L._frameSize.height),L._isRotated?P.margin="0 0 0 "+D+"px":P.margin="0px",P.padding="0px"}}),D=cc.Class({name:"ProportionalToFrame",extends:cc.ContainerStrategy,apply:function(L,D){var P,N,F=L._frameSize.width,B=L._frameSize.height,k=cc.game.container.style,U=D.width,V=D.height,z=F/U,W=B/V;z<W?(P=F,N=V*z):(P=U*W,N=B);var H=Math.round((F-P)/2),G=Math.round((B-N)/2);P=F-2*H,N=B-2*G,this._setupContainer(L,P,N),L._isRotated?k.margin="0 0 0 "+B+"px":k.margin="0px",k.paddingLeft=H+"px",k.paddingRight=H+"px",k.paddingTop=G+"px",k.paddingBottom=G+"px"}}),P=(cc.Class({name:"EqualToWindow",extends:L,preApply:function(L){this._super(L),cc.game.frame=document.documentElement},apply:function(L){this._super(L),this._fixContainer()}}),cc.Class({name:"ProportionalToWindow",extends:D,preApply:function(L){this._super(L),cc.game.frame=document.documentElement},apply:function(L,D){this._super(L,D),this._fixContainer()}}),cc.Class({name:"OriginalContainer",extends:cc.ContainerStrategy,apply:function(L){this._setupContainer(L,cc.game.canvas.width,cc.game.canvas.height)}})),N=("undefined"==typeof window?global:window).__globalAdapter;N&&(N.adaptContainerStrategy&&N.adaptContainerStrategy(cc.ContainerStrategy.prototype),N.adaptView&&N.adaptView(c.prototype)),cc.ContainerStrategy.EQUAL_TO_FRAME=new L,cc.ContainerStrategy.PROPORTION_TO_FRAME=new D,cc.ContainerStrategy.ORIGINAL_CONTAINER=new P;var F=cc.Class({name:"ExactFit",extends:cc.ContentStrategy,apply:function(L,D){var P=cc.game.canvas.width,N=cc.game.canvas.height,F=P/D.width,B=N/D.height;return this._buildResult(P,N,P,N,F,B)}}),B=cc.Class({name:"ShowAll",extends:cc.ContentStrategy,apply:function(L,D){var P,N,F=cc.game.canvas.width,B=cc.game.canvas.height,k=D.width,U=D.height,V=F/k,z=B/U,W=0;return V<z?(P=F,N=U*(W=V)):(P=k*(W=z),N=B),this._buildResult(F,B,P,N,W,W)}}),k=cc.Class({name:"NoBorder",extends:cc.ContentStrategy,apply:function(L,D){var P,N,F,B=cc.game.canvas.width,k=cc.game.canvas.height,U=D.width,V=D.height,z=B/U,W=k/V;return z<W?(N=U*(P=W),F=k):(N=B,F=V*(P=z)),this._buildResult(B,k,N,F,P,P)}}),U=cc.Class({name:"FixedHeight",extends:cc.ContentStrategy,apply:function(L,D){var P=cc.game.canvas.width,N=cc.game.canvas.height,F=N/D.height,B=P,k=N;return this._buildResult(P,N,B,k,F,F)}}),V=cc.Class({name:"FixedWidth",extends:cc.ContentStrategy,apply:function(L,D){var P=cc.game.canvas.width,N=cc.game.canvas.height,F=P/D.width,B=P,k=N;return this._buildResult(P,N,B,k,F,F)}});cc.ContentStrategy.EXACT_FIT=new F,cc.ContentStrategy.SHOW_ALL=new B,cc.ContentStrategy.NO_BORDER=new k,cc.ContentStrategy.FIXED_HEIGHT=new U,cc.ContentStrategy.FIXED_WIDTH=new V}(),cc.ResolutionPolicy=cc.Class({name:"cc.ResolutionPolicy",ctor:function(L,D){this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(L),this.setContentStrategy(D)},preApply:function(L){this._containerStrategy.preApply(L),this._contentStrategy.preApply(L)},apply:function(L,D){return this._containerStrategy.apply(L,D),this._contentStrategy.apply(L,D)},postApply:function(L){this._containerStrategy.postApply(L),this._contentStrategy.postApply(L)},setContainerStrategy:function(L){L instanceof cc.ContainerStrategy&&(this._containerStrategy=L)},setContentStrategy:function(L){L instanceof cc.ContentStrategy&&(this._contentStrategy=L)}}),F.get(cc.ResolutionPolicy.prototype,"canvasSize",(function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)})),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.view=new c,cc.winSize=cc.size(),D.exports=cc.view},{"../event/event-target":106,"../platform/CCClass":137,"../platform/js":157,"../renderer":168}],148:[function(L,D,P){"use strict";cc.visibleRect={topLeft:cc.v2(0,0),topRight:cc.v2(0,0),top:cc.v2(0,0),bottomLeft:cc.v2(0,0),bottomRight:cc.v2(0,0),bottom:cc.v2(0,0),center:cc.v2(0,0),left:cc.v2(0,0),right:cc.v2(0,0),width:0,height:0,init:function(L){var D=this.width=L.width,P=this.height=L.height,N=L.x,F=L.y,B=F+P,k=N+D;this.topLeft.x=N,this.topLeft.y=B,this.topRight.x=k,this.topRight.y=B,this.top.x=N+D/2,this.top.y=B,this.bottomLeft.x=N,this.bottomLeft.y=F,this.bottomRight.x=k,this.bottomRight.y=F,this.bottom.x=N+D/2,this.bottom.y=F,this.center.x=N+D/2,this.center.y=F+P/2,this.left.x=N,this.left.y=F+P/2,this.right.x=k,this.right.y=F+P/2}}},{}],149:[function(L,D,P){"use strict";var N=L("./js"),F=(L("./utils").isPlainEmptyObj_DEV,"$_$");function s(L,D){var P=D?Object.create(D):{};return N.value(L,"__attrs__",P),P}function c(L){return L.hasOwnProperty("__attrs__")&&L.__attrs__||function(L){if("function"!=typeof L)return s(L,c(L.constructor));for(var D,P=cc.Class.getInheritanceChain(L),N=P.length-1;N>=0;N--){var F=P[N];F.hasOwnProperty("__attrs__")&&F.__attrs__||s(F,(D=P[N+1])&&D.__attrs__)}return s(L,(D=P[0])&&D.__attrs__),L.__attrs__}(L)}function l(L,D){this.name=L,this.default=D}l.prototype.toString=function(){return this.name},cc.Integer=new l("Integer",0),cc.Float=new l("Float",0),cc.Boolean=new l("Boolean",!1),cc.String=new l("String",""),D.exports={PrimitiveType:l,attr:function(L,D,P){var N=c(L),B=D+F,k={};for(var U in N)U.startsWith(B)&&(k[U.slice(B.length)]=N[U]);return k},getClassAttrs:c,setClassAttr:function(L,D,P,N){c(L)[D+F+P]=N},DELIMETER:F,getTypeChecker_ET:!1,getObjTypeChecker_ET:!1,ScriptUuid:{}}},{"./CCClass":137,"./js":157,"./utils":161}],150:[function(L,D,P){"use strict";var N=L("./js"),F=N.array.fastRemoveAt;function s(){}function a(){this.callback=s,this.target=void 0,this.once=!1}a.prototype.set=function(L,D,P){this.callback=L,this.target=D,this.once=!!P};var B=new N.Pool((function(L){return L.callback=s,L.target=void 0,L.once=!1,!0}),32);function c(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}B.get=function(){return this._get()||new a};var k=c.prototype;k.removeByCallback=function(L){for(var D=0;D<this.callbackInfos.length;++D){var P=this.callbackInfos[D];P&&P.callback===L&&(B.put(P),F(this.callbackInfos,D),--D)}},k.removeByTarget=function(L){for(var D=0;D<this.callbackInfos.length;++D){var P=this.callbackInfos[D];P&&P.target===L&&(B.put(P),F(this.callbackInfos,D),--D)}},k.cancel=function(L){var D=this.callbackInfos[L];D&&(B.put(D),this.callbackInfos[L]=null),this.containCanceled=!0},k.cancelAll=function(){for(var L=0;L<this.callbackInfos.length;L++){var D=this.callbackInfos[L];D&&(B.put(D),this.callbackInfos[L]=null)}this.containCanceled=!0},k.purgeCanceled=function(){for(var L=this.callbackInfos.length-1;L>=0;--L)this.callbackInfos[L]||F(this.callbackInfos,L);this.containCanceled=!1},k.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1};var U=new N.Pool((function(L){return L.callbackInfos=[],L.isInvoking=!1,L.containCanceled=!1,!0}),16);function u(){this._callbackTable=N.createMap(!0)}U.get=function(){return this._get()||new c},(k=u.prototype).on=function(L,D,P,N){var F=this._callbackTable[L];F||(F=this._callbackTable[L]=U.get());var k=B.get();k.set(D,P,N),F.callbackInfos.push(k)},k.hasEventListener=function(L,D,P){var N=this._callbackTable[L];if(!N)return!1;var F=N.callbackInfos;if(!D){if(N.isInvoking){for(var B=0;B<F.length;++B)if(F[B])return!0;return!1}return F.length>0}for(var k=0;k<F.length;++k){var U=F[k];if(U&&U.callback===D&&U.target===P)return!0}return!1},k.removeAll=function(L){if("string"==typeof L){var D=this._callbackTable[L];D&&(D.isInvoking?D.cancelAll():(D.clear(),U.put(D),delete this._callbackTable[L]))}else if(L)for(var P in this._callbackTable){var N=this._callbackTable[P];if(N.isInvoking)for(var F=N.callbackInfos,B=0;B<F.length;++B){var k=F[B];k&&k.target===L&&N.cancel(B)}else N.removeByTarget(L)}},k.off=function(L,D,P){var N=this._callbackTable[L];if(N)for(var k=N.callbackInfos,U=0;U<k.length;++U){var V=k[U];if(V&&V.callback===D&&V.target===P){N.isInvoking?N.cancel(U):(F(k,U),B.put(V));break}}},k.emit=function(L,D,P,N,F,B){var k=this._callbackTable[L];if(k){var U=!k.isInvoking;k.isInvoking=!0;for(var V=k.callbackInfos,z=0,W=V.length;z<W;++z){var H=V[z];if(H){var G=H.target,X=H.callback;H.once&&this.off(L,X,G),G?X.call(G,D,P,N,F,B):X(D,P,N,F,B)}}U&&(k.isInvoking=!1,k.containCanceled&&k.purgeCanceled())}},D.exports=u},{"./js":157}],151:[function(L,D,P){"use strict";D.exports={flattenCodeArray:function(L){var D=[];return function n(L,D){for(var P=0;P<D.length;P++){var N=D[P];Array.isArray(N)?n(L,N):L.push(N)}}(D,L),D.join("")}}},{}],152:[function(L,D,P){"use strict";var N=L("./js"),F=L("./attribute"),B=L("./CCClass"),k=L("../utils/misc"),o=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this._stillUseUrl=N.createMap(!0)};o.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,N.clear(this._stillUseUrl)},o.prototype.push=function(L,D,P,N){N&&(this._stillUseUrl[this.uuidList.length]=!0),this.uuidList.push(P),this.uuidObjList.push(L),this.uuidPropList.push(D)},(o.pool=new N.Pool((function(L){L.reset()}),10)).get=function(){return this._get()||new o};var U=function(){function t(L,D,P,N,F){this.result=L,this.customEnv=N,this.deserializedList=[],this.deserializedData=null,this._classFinder=P,this._idList=[],this._idObjList=[],this._idPropList=[]}var L=t.prototype;function o(L,D,P,F,B,k){if(D instanceof cc.ValueType){B||L.push("if(prop){");var U=N.getClassName(D);L.push("s._deserializeTypedObject(o"+P+",prop,"+U+");"),B||L.push("}else o"+P+"=null;")}else L.push("if(prop){"),L.push("s._deserializeObjField(o,prop,"+F+",null,"+!!k+");"),L.push("}else o"+P+"=null;")}L.deserialize=function(L){if(Array.isArray(L)){var D=L,P=D.length;this.deserializedList.length=P;for(var N=0;N<P;N++)D[N]&&(this.deserializedList[N]=this._deserializeObject(D[N],!1));this.deserializedData=P>0?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=L?this._deserializeObject(L,!1):null,this.deserializedList[0]=this.deserializedData;return function(L){var D,P,N,F=L.deserializedList,B=L._idPropList,k=L._idList,U=L._idObjList;for(L._classFinder&&L._classFinder.onDereferenced,D=0;D<k.length;D++)P=B[D],N=k[D],U[D][P]=F[N]}(this),this.deserializedData},L._deserializeObject=function(L,D,P,F,B){var k,U=null,V=null,z=L.__type__;if("TypedArray"===z){var W=L.array;U=new window[L.ctor](W.length);for(var H=0;H<W.length;++H)U[H]=W[H];return U}if(z){if(!(V=this._classFinder(z,L,F,B)))return this._classFinder===N._getClassById&&cc.deserialize.reportMissingClass(z),null;if((U=new V)._deserialize)return U._deserialize(L.content,this),U;cc.Class._isCCClass(V)?l(this,U,L,V,P):this._deserializeTypedObject(U,L,V)}else if(Array.isArray(L)){U=new Array(L.length);for(var G=0;G<L.length;G++)"object"==typeof(k=L[G])&&k?this._deserializeObjField(U,k,""+G,null,D):U[G]=k}else U={},this._deserializePrimitiveObject(U,L);return U},L._deserializeObjField=function(L,D,P,N,F){var B=D.__id__;if(void 0===B){var k=D.__uuid__;k?this.result.push(L,P,k,F):L[P]=this._deserializeObject(D,F)}else{var U=this.deserializedList[B];U?L[P]=U:(this._idList.push(B),this._idObjList.push(L),this._idPropList.push(P))}},L._deserializePrimitiveObject=function(L,D){for(var P in D)if(D.hasOwnProperty(P)){var N=D[P];"object"!=typeof N?"__type__"!==P&&(L[P]=N):N?this._deserializeObjField(L,N,P):L[P]=null}},L._deserializeTypedObject=function(L,D,P){if(P===cc.Vec2)return L.x=D.x||0,void(L.y=D.y||0);if(P===cc.Vec3)return L.x=D.x||0,L.y=D.y||0,void(L.z=D.z||0);if(P!==cc.Color){if(P===cc.Size)return L.width=D.width||0,void(L.height=D.height||0);for(var N=F.DELIMETER+"default",k=F.getClassAttrs(P),U=P.__props__||Object.keys(L),V=0;V<U.length;V++){var z=U[V],W=D[z];void 0!==W&&D.hasOwnProperty(z)||(W=B.getDefault(k[z+N])),"object"!=typeof W?L[z]=W:W?this._deserializeObjField(L,W,z):L[z]=null}}else{L.r=D.r||0,L.g=D.g||0,L.b=D.b||0;var H=D.a;L.a=void 0===H?255:H}};var c=function(L,D){for(var P=F.DELIMETER+"type",U=(F.DELIMETER,F.DELIMETER+"default"),V=F.DELIMETER+"saveUrlAsAsset",z=F.DELIMETER+"formerlySerializedAs",W=F.getClassAttrs(D),H=D.__values__,G=["var prop;"],X=k.BUILTIN_CLASSID_RE.test(N._getClassId(D)),nt=0;nt<H.length;nt++){var ut,dt,ft=H[nt];B.IDENTIFIER_RE.test(ft)?(dt='"'+ft+'"',ut="."+ft):ut="["+(dt=B.escapeForJS(ft))+"]";var _t=ut;if(W[ft+z]){var pt=W[ft+z];_t=B.IDENTIFIER_RE.test(pt)?"."+pt:"["+B.escapeForJS(pt)+"]"}G.push("prop=d"+_t+";"),G.push('if(typeof prop!=="undefined"){');var vt=W[ft+V],gt=B.getDefault(W[ft+U]);if(X){var mt,yt=W[ft+P];if(void 0===gt&&yt)mt=yt instanceof F.PrimitiveType;else{var Tt=typeof gt;mt="string"===Tt&&!vt||"number"===Tt||"boolean"===Tt}mt?G.push("o"+ut+"=prop;"):o(G,gt,ut,dt,!0,vt)}else G.push('if(typeof prop!=="object"){o'+ut+"=prop;}else{"),o(G,gt,ut,dt,!1,vt),G.push("}");G.push("}")}return(cc.js.isChildClassOf(D,cc._BaseNode)||cc.js.isChildClassOf(D,cc.Component))&&G.push("d._id&&(o._id=d._id);"),"_$erialized"===H[H.length-1]&&(G.push("o._$erialized=JSON.parse(JSON.stringify(d));"),G.push("s._deserializePrimitiveObject(o._$erialized,d);")),Function("s","o","d","k","t",G.join(""))};function l(L,D,P,F,B){var k;F.hasOwnProperty("__deserialize__")?k=F.__deserialize__:(k=c(0,F),N.value(F,"__deserialize__",k,!0)),k(L,D,P,F,B)}return t.pool=new N.Pool((function(L){L.result=null,L.customEnv=null,L.deserializedList.length=0,L.deserializedData=null,L._classFinder=null,L._idList.length=0,L._idObjList.length=0,L._idPropList.length=0}),1),t.pool.get=function(L,D,P,N,F){var B=this._get();return B?(B.result=L,B.customEnv=N,B._classFinder=P,B):new t(L,D,P,N,F)},t}();cc.deserialize=function(L,D,P){var F=(P=P||{}).classFinder||N._getClassById,B=P.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,k=P.customEnv,V=P.ignoreEditorOnly;"string"==typeof L&&(L=JSON.parse(L));var z=!D;D=D||o.pool.get();var W=U.pool.get(D,!1,F,k,V);cc.game._isCloning=!0;var H=W.deserialize(L);return cc.game._isCloning=!1,U.pool.put(W),B&&D.assignAssetsBy(Editor.serialize.asAsset),z&&o.pool.put(D),H},cc.deserialize.Details=o,cc.deserialize.reportMissingClass=function(L){cc.warnID(5302,L)}},{"../utils/misc":210,"./CCClass":137,"./attribute":149,"./js":157}],153:[function(L,D,P){"use strict";function r(L){this.id=0|998*Math.random(),this.prefix=L?L+".":""}r.prototype.getNewId=function(){return this.prefix+ ++this.id},r.global=new r("global"),D.exports=r},{}],154:[function(L,D,P){"use strict";L("./js"),L("./CCClass"),L("./CCClassDecorator"),L("./CCEnum"),L("./CCObject"),L("./callbacks-invoker"),L("./url"),L("./deserialize"),L("./instantiate"),L("./instantiate-jit"),L("./requiring-frame"),L("./CCSys"),L("./CCMacro"),L("./CCAssetLibrary"),L("./CCVisibleRect")},{"./CCAssetLibrary":136,"./CCClass":137,"./CCClassDecorator":138,"./CCEnum":139,"./CCMacro":142,"./CCObject":143,"./CCSys":146,"./CCVisibleRect":148,"./callbacks-invoker":150,"./deserialize":152,"./instantiate":156,"./instantiate-jit":155,"./js":157,"./requiring-frame":159,"./url":160}],155:[function(L,D,P){"use strict";var N=L("./CCObject"),F=N.Flags.Destroyed,B=N.Flags.PersistentMask,k=L("./attribute"),U=L("./js"),V=L("./CCClass"),z=L("./compiler"),W=k.DELIMETER+"default",H=V.IDENTIFIER_RE,G=V.escapeForJS,X="var ",nt="o",ut={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};try{!Float32Array.name&&(Float32Array.name="Float32Array"),!Float64Array.name&&(Float64Array.name="Float64Array"),!Int8Array.name&&(Int8Array.name="Int8Array"),!Int16Array.name&&(Int16Array.name="Int16Array"),!Int32Array.name&&(Int32Array.name="Int32Array"),!Uint8Array.name&&(Uint8Array.name="Uint8Array"),!Uint16Array.name&&(Uint16Array.name="Uint16Array"),!Uint32Array.name&&(Uint32Array.name="Uint32Array")}catch(L){}function m(L,D){this.varName=L,this.expression=D}function y(L,D){return D instanceof m?new m(D.varName,L+D.expression):L+D}function T(L,D,P){Array.isArray(P)?(P[0]=y(D,P[0]),L.push(P)):L.push(y(D,P)+";")}function E(L){this._exps=[],this._targetExp=L}function A(L,D){if("function"==typeof L)try{L=L()}catch(L){return!1}if(L===D)return!0;if(L&&D){if(L instanceof cc.ValueType&&L.equals(D))return!0;if(Array.isArray(L)&&Array.isArray(D)||L.constructor===Object&&D.constructor===Object)try{return Array.isArray(L)&&Array.isArray(D)&&0===L.length&&0===D.length}catch(L){}}return!1}function C(L){return H.test(L)?"."+L:"["+G(L)+"]"}function x(L,D){var P;this.parent=D,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=U.createMap(),U.mixin(this.funcModuleCache,ut),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(L.constructor,!0)+"();","}"),U.value(L,"_iN$t",{globalVar:"R"},!0),this.objsToClear_iN$t.push(L),this.enumerateObject(this.codeArray,L),this.globalVariables.length>0&&(P=X+this.globalVariables.join(",")+";");var N=z.flattenCodeArray(["return (function(R){",P||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",N)(this.objs,this.funcs);for(var F=0,B=this.objsToClear_iN$t.length;F<B;++F)this.objsToClear_iN$t[F]._iN$t=null;this.objsToClear_iN$t.length=0}m.prototype.toString=function(){return X+this.varName+"="+this.expression+";"},E.prototype.append=function(L,D){this._exps.push([L,D])},E.prototype.writeCode=function(L){var D;if(this._exps.length>1)L.push("t="+this._targetExp+";"),D="t";else{if(1!==this._exps.length)return;D=this._targetExp}for(var P=0;P<this._exps.length;P++){var N=this._exps[P];T(L,D+C(N[0])+"=",N[1])}},E.pool=new U.Pool((function(L){L._exps.length=0,L._targetExp=null}),1),E.pool.get=function(L){var D=this._get()||new E;return D._targetExp=L,D};var dt=x.prototype;dt.getFuncModule=function(L,D){var P=U.getClassName(L);if(P){var N=this.funcModuleCache[P];if(N)return N;if(void 0===N){var F=-1!==P.indexOf(".");if(F)try{if(F=L===Function("return "+P)())return this.funcModuleCache[P]=P,P}catch(L){}}}var B=this.funcs.indexOf(L);B<0&&(B=this.funcs.length,this.funcs.push(L));var k="F["+B+"]";return D&&(k="("+k+")"),this.funcModuleCache[P]=k,k},dt.getObjRef=function(L){var D=this.objs.indexOf(L);return D<0&&(D=this.objs.length,this.objs.push(L)),"O["+D+"]"},dt.setValueType=function(L,D,P,N){var F=E.pool.get(N),B=D.constructor.__props__;B||(B=Object.keys(D));for(var k=0;k<B.length;k++){var U=B[k],V=P[U];if(D[U]!==V){var z=this.enumerateField(P,U,V);F.append(U,z)}}F.writeCode(L),E.pool.put(F)},dt.enumerateCCClass=function(L,D,P){for(var N=P.__values__,F=k.getClassAttrs(P),B=0;B<N.length;B++){var U=N[B],z=D[U],H=F[U+W];if(!A(H,z))if("object"==typeof z&&z instanceof cc.ValueType&&(H=V.getDefault(H))&&H.constructor===z.constructor){var G=nt+C(U);this.setValueType(L,H,z,G)}else this.setObjProp(L,D,U,z)}},dt.instantiateArray=function(L){if(0===L.length)return"[]";var D="a"+ ++this.localVariableId,P=[new m(D,"new Array("+L.length+")")];U.value(L,"_iN$t",{globalVar:"",source:P},!0),this.objsToClear_iN$t.push(L);for(var N=0;N<L.length;++N)T(P,D+"["+N+"]=",this.enumerateField(L,N,L[N]));return P},dt.instantiateTypedArray=function(L){var D=L.constructor.name||function(L){if(L===Float32Array)return"Float32Array";if(L===Float64Array)return"Float64Array";if(L===Int8Array)return"Int8Array";if(L===Int16Array)return"Int16Array";if(L===Int32Array)return"Int32Array";if(L===Uint8Array)return"Uint8Array";if(L===Uint16Array)return"Uint16Array";if(L===Uint32Array)return"Uint32Array";throw new Error("Unknown TypedArray could not be instantiated: "+L)}(L.constructor);if(0===L.length)return"new "+D;var P="a"+ ++this.localVariableId,N=[new m(P,"new "+D+"("+L.length+")")];L._iN$t={globalVar:"",source:N},this.objsToClear_iN$t.push(L);for(var F=0;F<L.length;++F)0!==L[F]&&T(N,P+"["+F+"]=",L[F]);return N},dt.enumerateField=function(L,D,P){if("object"==typeof P&&P){var F=P._iN$t;if(F){var k=F.globalVar;if(!k){k=F.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(k);var U=F.source[0];F.source[0]=y(k+"=",U)}return k}return ArrayBuffer.isView(P)?this.instantiateTypedArray(P):Array.isArray(P)?this.instantiateArray(P):this.instantiateObj(P)}return"function"==typeof P?this.getFuncModule(P):"string"==typeof P?G(P):("_objFlags"===D&&L instanceof N&&(P&=B),P)},dt.setObjProp=function(L,D,P,N){T(L,nt+C(P)+"=",this.enumerateField(D,P,N))},dt.enumerateObject=function(L,D){var P=D.constructor;if(cc.Class._isCCClass(P))this.enumerateCCClass(L,D,P);else for(var N in D)if(D.hasOwnProperty(N)&&(95!==N.charCodeAt(0)||95!==N.charCodeAt(1)||"__type__"===N)){var F=D[N];"object"==typeof F&&F&&F===D._iN$t||this.setObjProp(L,D,N,F)}},dt.instantiateObj=function(L){if(L instanceof cc.ValueType)return V.getNewValueTypeCode(L);if(L instanceof cc.Asset)return this.getObjRef(L);if(L._objFlags&F)return null;var D,P=L.constructor;if(cc.Class._isCCClass(P)){if(this.parent)if(this.parent instanceof cc.Component){if(L instanceof cc._BaseNode||L instanceof cc.Component)return this.getObjRef(L)}else if(this.parent instanceof cc._BaseNode)if(L instanceof cc._BaseNode){if(!L.isChildOf(this.parent))return this.getObjRef(L)}else if(L instanceof cc.Component&&!L.node.isChildOf(this.parent))return this.getObjRef(L);D=new m(nt,"new "+this.getFuncModule(P,!0)+"()")}else if(P===Object)D=new m(nt,"{}");else{if(P)return this.getObjRef(L);D=new m(nt,"Object.create(null)")}var N=[D];return U.value(L,"_iN$t",{globalVar:"",source:N},!0),this.objsToClear_iN$t.push(L),this.enumerateObject(N,L),["(function(){",N,"return o;})();"]},D.exports={compile:function(L){return new x(L,L instanceof cc._BaseNode&&L).result},equalsToDefault:A}},{"./CCClass":137,"./CCObject":143,"./attribute":149,"./compiler":151,"./js":157}],156:[function(L,D,P){"use strict";var N=L("./CCObject"),F=L("../value-types/value-type"),B=N.Flags.Destroyed,k=N.Flags.PersistentMask,U=L("./utils").isDomNode,V=L("./js");function l(L,D){if(!D){if("object"!=typeof L||Array.isArray(L))return null;if(!L)return null;if(!cc.isValid(L))return null}var P;if(L instanceof N){if(L._instantiate)return cc.game._isCloning=!0,P=L._instantiate(),cc.game._isCloning=!1,P;if(L instanceof cc.Asset)return null}return cc.game._isCloning=!0,P=u(L),cc.game._isCloning=!1,P}var z=[];function u(L,D){if(Array.isArray(L))return null;if(U&&U(L))return null;var P;f(L,P=L._iN$t?L._iN$t:L.constructor?new(0,L.constructor):Object.create(null),D);for(var N=0,F=z.length;N<F;++N)z[N]._iN$t=null;return z.length=0,P}function d(L,D,P,N){for(var B=L.__values__,k=0;k<B.length;k++){var U=B[k],V=D[U];if("object"==typeof V&&V){var z=P[U];z instanceof F&&z.constructor===V.constructor?z.set(V):P[U]=V._iN$t||_(V,N)}else P[U]=V}}function f(L,D,P){V.value(L,"_iN$t",D,!0),z.push(L);var F=L.constructor;if(cc.Class._isCCClass(F))d(F,L,D,P);else for(var B in L)if(L.hasOwnProperty(B)&&(95!==B.charCodeAt(0)||95!==B.charCodeAt(1)||"__type__"===B)){var U=L[B];if("object"==typeof U&&U){if(U===D)continue;D[B]=U._iN$t||_(U,P)}else D[B]=U}L instanceof N&&(D._objFlags&=k)}function _(L,D){if(L instanceof F)return L.clone();if(L instanceof cc.Asset)return L;var P;if(ArrayBuffer.isView(L)){var N=L.length;P=new L.constructor(N),L._iN$t=P,z.push(L);for(var k=0;k<N;++k)P[k]=L[k];return P}if(Array.isArray(L)){var U=L.length;P=new Array(U),V.value(L,"_iN$t",P,!0),z.push(L);for(var W=0;W<U;++W){var H=L[W];P[W]="object"==typeof H&&H?H._iN$t||_(H,D):H}return P}if(L._objFlags&B)return null;var G=L.constructor;if(cc.Class._isCCClass(G)){if(D)if(D instanceof cc.Component){if(L instanceof cc._BaseNode||L instanceof cc.Component)return L}else if(D instanceof cc._BaseNode)if(L instanceof cc._BaseNode){if(!L.isChildOf(D))return L}else if(L instanceof cc.Component&&!L.node.isChildOf(D))return L;P=new G}else if(G===Object)P={};else{if(G)return L;P=Object.create(null)}return f(L,P,D),P}l._clone=u,cc.instantiate=l,D.exports=l},{"../value-types/value-type":233,"./CCObject":143,"./js":157,"./utils":161}],157:[function(L,D,P){"use strict";var N=new(L("./id-generater"))("TmpCId.");function r(L,D){for(;L;){var P=Object.getOwnPropertyDescriptor(L,D);if(P)return P;L=Object.getPrototypeOf(L)}return null}function s(L,D,P){var N=r(D,L);Object.defineProperty(P,L,N)}var F={isNumber:function(L){return"number"==typeof L||L instanceof Number},isString:function(L){return"string"==typeof L||L instanceof String},addon:function(L){L=L||{};for(var D=1,P=arguments.length;D<P;D++){var N=arguments[D];if(N){if("object"!=typeof N){cc.errorID(5402,N);continue}for(var F in N)F in L||s(F,N,L)}}return L},mixin:function(L){L=L||{};for(var D=1,P=arguments.length;D<P;D++){var N=arguments[D];if(N){if("object"!=typeof N){cc.errorID(5403,N);continue}for(var F in N)s(F,N,L)}}return L},extend:function(L,D){for(var P in D)D.hasOwnProperty(P)&&(L[P]=D[P]);return L.prototype=Object.create(D.prototype,{constructor:{value:L,writable:!0,configurable:!0}}),L},getSuper:function(L){var D=L.prototype,P=D&&Object.getPrototypeOf(D);return P&&P.constructor},isChildClassOf:function(L,D){if(L&&D){if("function"!=typeof L)return!1;if("function"!=typeof D)return!1;if(L===D)return!0;for(;;){if(!(L=F.getSuper(L)))return!1;if(L===D)return!0}}return!1},clear:function(L){for(var D=Object.keys(L),P=0;P<D.length;P++)delete L[D[P]]},isEmptyObject:function(L){for(var D in L)return!1;return!0},getPropertyDescriptor:r},B={value:void 0,enumerable:!1,writable:!1,configurable:!0};F.value=function(L,D,P,N,F){B.value=P,B.writable=N,B.enumerable=F,Object.defineProperty(L,D,B),B.value=void 0};var k={get:null,set:null,enumerable:!1};F.getset=function(L,D,P,N,F,B){"function"!=typeof N&&(F=N,N=void 0),k.get=P,k.set=N,k.enumerable=F,k.configurable=B,Object.defineProperty(L,D,k),k.get=null,k.set=null};var U={get:null,enumerable:!1,configurable:!1};F.get=function(L,D,P,N,F){U.get=P,U.enumerable=N,U.configurable=F,Object.defineProperty(L,D,U),U.get=null};var V={set:null,enumerable:!1,configurable:!1};F.set=function(L,D,P,N,F){V.set=P,V.enumerable=N,V.configurable=F,Object.defineProperty(L,D,V),V.set=null},F.getClassName=function(L){if("function"==typeof L){var D=L.prototype;if(D&&D.hasOwnProperty("__classname__")&&D.__classname__)return D.__classname__;var P="";if(L.name&&(P=L.name),L.toString){var N,B=L.toString();(N="["===B.charAt(0)?B.match(/\[\w+\s*(\w+)\]/):B.match(/function\s*(\w+)/))&&2===N.length&&(P=N[1])}return"Object"!==P?P:""}return L&&L.constructor?F.getClassName(L.constructor):""},function(){var L={},D={};function i(L,D,P){return F.getset(F,D,(function(){return Object.assign({},P)}),(function(L){F.clear(P),Object.assign(P,L)})),function(D,N){if(N.prototype.hasOwnProperty(L)&&delete P[N.prototype[L]],F.value(N.prototype,L,D),D){var B=P[D];if(B&&B!==N){var k="A Class already exists with the same "+L+' : "'+D+'".';cc.error(k)}else P[D]=N}}}F._setClassId=i("__cid__","_registeredClassIds",L);var P=i("__classname__","_registeredClassNames",D);F.setClassName=function(L,D){if(P(L,D),!D.prototype.hasOwnProperty("__cid__")){var B=L||N.getNewId();B&&F._setClassId(B,D)}},F.unregisterClass=function(){for(var P=0;P<arguments.length;P++){var N=arguments[P].prototype,F=N.__cid__;F&&delete L[F];var B=N.__classname__;B&&delete D[B]}},F._getClassById=function(D){return L[D]},F.getClassByName=function(L){return D[L]},F._getClassId=function(L,D){if(D=void 0===D||D,"function"==typeof L&&L.prototype.hasOwnProperty("__cid__"))return L.prototype.__cid__;if(L&&L.constructor){var P=L.constructor.prototype;if(P&&P.hasOwnProperty("__cid__"))return L.__cid__}return""}}(),F.obsolete=function(L,D,P,N){var B=/([^.]+)$/,k=B.exec(D)[0],U=B.exec(P)[0];function c(){return this[U]}N?F.getset(L,k,c,(function(L){this[U]=L})):F.get(L,k,c)},F.obsoletes=function(L,D,P,N){for(var B in P){var k=P[B];F.obsolete(L,D+"."+B,k,N)}};var z=/(%d)|(%s)/,W=/%s/;function f(L,D){L.splice(D,1)}function _(L,D){var P=L.indexOf(D);return P>=0&&(f(L,P),!0)}F.formatStr=function(){var L=arguments.length;if(0===L)return"";var D=arguments[0];if(1===L)return""+D;if("string"==typeof D&&z.test(D))for(var P=1;P<L;++P){var N=arguments[P],F="number"==typeof N?z:W;F.test(D)?D=D.replace(F,N):D+=" "+N}else for(var B=1;B<L;++B)D+=" "+arguments[B];return D},F.shiftArguments=function(){for(var L=arguments.length-1,D=new Array(L),P=0;P<L;++P)D[P]=arguments[P+1];return D},F.createMap=function(L){var D=Object.create(null);return L&&(D["."]=!0,D["/"]=!0,delete D["."],delete D["/"]),D};var H=Array.prototype.indexOf;function v(L,D){void 0===D&&(D=L,L=null),this.get=null,this.count=0,this._pool=new Array(D),this._cleanup=L}F.array={remove:_,fastRemove:function(L,D){var P=L.indexOf(D);P>=0&&(L[P]=L[L.length-1],--L.length)},removeAt:f,fastRemoveAt:function(L,D){var P=L.length;D<0||D>=P||(L[D]=L[P-1],L.length=P-1)},contains:function(L,D){return L.indexOf(D)>=0},verifyType:function(L,D){if(L&&L.length>0)for(var P=0;P<L.length;P++)if(!(L[P]instanceof D))return cc.logID(1300),!1;return!0},removeArray:function(L,D){for(var P=0,N=D.length;P<N;P++)_(L,D[P])},appendObjectsAt:function(L,D,P){return L.splice.apply(L,[P,0].concat(D)),L},copy:function(L){var D,P=L.length,N=new Array(P);for(D=0;D<P;D+=1)N[D]=L[D];return N},indexOf:H,MutableForwardIterator:L("../utils/mutable-forward-iterator")},v.prototype._get=function(){if(this.count>0){--this.count;var L=this._pool[this.count];return this._pool[this.count]=null,L}return null},v.prototype.put=function(L){var D=this._pool;if(this.count<D.length){if(this._cleanup&&!1===this._cleanup(L))return;D[this.count]=L,++this.count}},v.prototype.resize=function(L){L>=0&&(this._pool.length=L,this.count>L&&(this.count=L))},F.Pool=v,cc.js=F,D.exports=F},{"../utils/mutable-forward-iterator":211,"./id-generater":153}],158:[function(L,D,P){"use strict";var N=L("./js"),F=L("./attribute"),B={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function a(L,D,P,N){if(!L.get&&!L.set&&L.hasOwnProperty("default")){var F="_N$"+D;L.get=function(){return this[F]},L.set=function(L){var D=this[F];this[F]=L,P.call(this,D)};var k={};for(var U in N[F]=k,B){var V=B[U];L.hasOwnProperty(U)&&(k[U]=L[U],V.canUsedInGet||delete L[U])}}}function o(L,D,P,N){Array.isArray(N)&&N.length>0&&(N=N[0]),L.type=N}function c(L,D,P,N){if(Array.isArray(D)){if(!(D.length>0))return cc.errorID(5508,P,N);if(cc.RawAsset.isRawAssetType(D[0]))return L.url=D[0],void delete L.type;L.type=D=D[0]}"function"==typeof D&&(D===String?L.type=cc.String:D===Boolean?L.type=cc.Boolean:D===Number&&(L.type=cc.Float))}P.getFullFormOfProperty=function(L,D,P){if(L&&L.constructor===Object)return null;if(Array.isArray(L)&&L.length>0)return L[0],{default:[],type:L,_short:!0};if("function"==typeof L){var B=L;return cc.RawAsset.isRawAssetType(B)||cc.RawAsset.wasRawAssetType(B)?{default:"",url:B,_short:!0}:{default:N.isChildClassOf(B,cc.ValueType)?new B:null,type:B,_short:!0}}return L instanceof F.PrimitiveType?{default:L.default,_short:!0}:{default:L,_short:!0}},P.preprocessAttrs=function(L,D,N,F){for(var B in L){var k=L[B],U=P.getFullFormOfProperty(k,B,D);if(U&&(k=L[B]=U),k){var V=k.notify;V&&a(k,B,V,L),"type"in k&&c(k,k.type,D,B),"url"in k&&o(k,0,0,k.url),"type"in k&&k.type}}},P.validateMethodWithProps=function(L,D,P,N,F){return"function"==typeof L||null===L}},{"./CCClass":137,"./attribute":149,"./js":157}],159:[function(L,D,P){"use strict";var N=[];cc._RF={push:function(L,D,P){void 0===P&&(P=D,D=""),N.push({uuid:D,script:P,module:L,exports:L.exports,beh:null})},pop:function(){var L=N.pop(),D=L.module,P=D.exports;if(P===L.exports){for(var F in P)return;D.exports=P=L.cls}},peek:function(){return N[N.length-1]}}},{}],160:[function(L,D,P){"use strict";cc.url={_rawAssets:"",normalize:function(L){return L&&(46===L.charCodeAt(0)&&47===L.charCodeAt(1)?L=L.slice(2):47===L.charCodeAt(0)&&(L=L.slice(1))),L},raw:function(L){if((L=this.normalize(L)).startsWith("resources/")){var D=cc.loader._getResUuid(L.slice(10),cc.Asset,null,!0);if(D)return cc.AssetLibrary.getLibUrlNoExt(D,!0)+cc.path.extname(L)}else cc.errorID(7002,L);return this._rawAssets+L},_init:function(L){this._rawAssets=cc.path.stripSep(L)+"/"}},D.exports=cc.url},{}],161:[function(L,D,P){"use strict";L("./js"),D.exports={contains:function(L,D){if("function"==typeof L.contains)return L.contains(D);if("function"==typeof L.compareDocumentPosition)return!!(16&L.compareDocumentPosition(D));var P=D.parentNode;if(P)do{if(P===L)return!0;P=P.parentNode}while(null!==P);return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(L){return L instanceof Node}:function(L){return L&&"object"==typeof L&&"number"==typeof L.nodeType&&"string"==typeof L.nodeName}),callInNextTick:function(L,D,P){L&&setTimeout((function(){L(D,P)}),0)}}},{"./js":157}],162:[function(L,D,P){"use strict";L("./platform/js"),L("./value-types"),L("./utils"),L("./platform/CCInputManager"),L("./platform/CCInputExtension"),L("./event"),L("./platform/CCSys"),L("./platform/CCMacro"),L("./load-pipeline"),L("./CCDirector"),L("./renderer"),L("./platform/CCView"),L("./platform/CCScreen"),L("./CCScheduler"),L("./event-manager")},{"./CCDirector":23,"./CCScheduler":28,"./event":108,"./event-manager":104,"./load-pipeline":123,"./platform/CCInputExtension":140,"./platform/CCInputManager":141,"./platform/CCMacro":142,"./platform/CCScreen":145,"./platform/CCSys":146,"./platform/CCView":147,"./platform/js":157,"./renderer":168,"./utils":209,"./value-types":225}],163:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=a(L("./assembler")),F=a(L("./utils/dynamic-atlas/manager")),B=a(L("./webgl/render-data"));function a(L){return L&&L.__esModule?L:{default:L}}function o(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var k=function(L){function e(){var D;return(D=L.call(this)||this)._renderData=new B.default,D._renderData.init(function(L){if(void 0===L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L}(D)),D.initData(),D.initLocal(),D}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(){this._renderData.createQuadData(0,this.verticesFloats,this.indicesCount)},D.initLocal=function(){this._local=[],this._local.length=4},D.updateColor=function(L,D){var P=this._renderData.uintVDatas[0];if(P){D=D||L.node.color._val;for(var N=this.floatsPerVert,F=this.colorOffset,B=P.length;F<B;F+=N)P[F]=D}},D.getBuffer=function(){return cc.renderer._handle._meshBuffer},D.updateWorldVerts=function(L){var D=this._local,P=this._renderData.vDatas[0],N=L.node._worldMatrix.m,F=N[0],B=N[1],k=N[4],U=N[5],V=N[12],z=N[13],W=D[0],H=D[2],G=D[1],X=D[3];if(1===F&&0===B&&0===k&&1===U)P[0]=W+V,P[1]=G+z,P[5]=H+V,P[6]=G+z,P[10]=W+V,P[11]=X+z,P[15]=H+V,P[16]=X+z;else{var nt=F*W,ut=F*H,dt=B*W,ft=B*H,_t=k*G,pt=k*X,vt=U*G,gt=U*X;P[0]=nt+_t+V,P[1]=dt+vt+z,P[5]=ut+_t+V,P[6]=ft+vt+z,P[10]=nt+pt+V,P[11]=dt+gt+z,P[15]=ut+pt+V,P[16]=ft+gt+z}},D.fillBuffers=function(L,D){D.worldMatDirty&&this.updateWorldVerts(L);var P=this._renderData,N=P.vDatas[0],F=P.iDatas[0],B=this.getBuffer(D),k=B.request(this.verticesCount,this.indicesCount),U=k.byteOffset>>2,V=B._vData;N.length+U>V.length?V.set(N.subarray(0,V.length-U),U):V.set(N,U);for(var z=B._iData,W=k.indiceOffset,H=k.vertexOffset,G=0,X=F.length;G<X;G++)z[W++]=H+F[G]},D.packToDynamicAtlas=function(L,D){if(!D._original&&F.default&&D._texture.packable){var P=F.default.insertSpriteFrame(D);P&&D._setDynamicAtlasFrame(P)}var N=L._materials[0];N&&N.getProperty("texture")!==D._texture&&(L._vertsDirty=!0,L._updateMaterial())},function(L,D,P){D&&o(L.prototype,D),P&&o(L,P)}(e,[{key:"verticesFloats",get:function(){return this.verticesCount*this.floatsPerVert}}]),e}(N.default);P.default=k,cc.js.addon(k.prototype,{floatsPerVert:5,verticesCount:4,indicesCount:6,uvOffset:2,colorOffset:4}),cc.Assembler2D=k,D.exports=P.default},{"./assembler":165,"./utils/dynamic-atlas/manager":171,"./webgl/render-data":198}],164:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../utils/pool"));var F=0;function a(L){return Object.getOwnPropertyDescriptor(L,"__assemblerId__")||(L.__assemblerId__=++F),L.__assemblerId__}var B=new(function(L){function e(){for(var D,P=arguments.length,N=new Array(P),F=0;F<P;F++)N[F]=arguments[F];return(D=L.call.apply(L,[this].concat(N))||this)._pool={},D}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.put=function(L){if(L&&this.enabled){var D=a(L.constructor),P=this._pool;P[D]||(P[D]=[]),this.count>this.maxSize||(this._clean(L),P[D].push(L),this.count++)}},D.get=function(L){var D;if(this.enabled){var P=this._pool,N=a(L);D=P[N]&&P[N].pop()}return D?this.count--:D=new L,D},D.clear=function(){this._pool={},this.count=0},D._clean=function(L){L._renderComp=null},e}(N.default));N.default.register("assembler",B);var k=B;P.default=k,D.exports=P.default},{"../utils/pool":212}],165:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("./webgl/vertex-format"),F=function(L){return L&&L.__esModule?L:{default:L}}(L("./assembler-pool")),B=function(){function t(){this._extendNative&&this._extendNative()}var L=t.prototype;return L.init=function(L){this._renderComp=L},L.updateRenderData=function(L){},L.fillBuffers=function(L,D){},L.getVfmt=function(){return N.vfmtPosUvColor},t}();P.default=B,B.register=function(L,D){L.__assembler__=D},B.init=function(L){for(var D=L.constructor,P=D.__assembler__;!P;){if(!(D=D.$super))return void cc.warn("Can not find assembler for render component : ["+cc.js.getClassName(L)+"]");P=D.__assembler__}if(P.getConstructor&&(P=P.getConstructor(L)),!L._assembler||L._assembler.constructor!==P){var N=F.default.get(P);N.init(L),L._assembler=N}},cc.Assembler=B,D.exports=P.default},{"./assembler-pool":164,"./webgl/vertex-format":200}],166:[function(L,D,P){"use strict";var n=function(L){var D;try{D=L.getContext("2d")}catch(L){return void console.error(L)}this._canvas=L,this._ctx=D,this._caps={},this._stats={drawcalls:0},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0};n.prototype._restoreTexture=function(L){},n.prototype.setViewport=function(L,D,P,N){this._vx===L&&this._vy===D&&this._vw===P&&this._vh===N||(this._vx=L,this._vy=D,this._vw=P,this._vh=N)},n.prototype.setScissor=function(L,D,P,N){this._sx===L&&this._sy===D&&this._sw===P&&this._sh===N||(this._sx=L,this._sy=D,this._sw=P,this._sh=N)},n.prototype.clear=function(L){var D=this._ctx;D.clearRect(this._vx,this._vy,this._vw,this._vh),!L||0===L[0]&&0===L[1]&&0===L[2]||(D.fillStyle="rgb("+L[0]+","+L[1]+","+L[2]+")",D.globalAlpha=L[3],D.fillRect(this._vx,this._vy,this._vw,this._vh))},n.prototype.resetDrawCalls=function(){this._stats.drawcalls=0},n.prototype.getDrawCalls=function(){return this._stats.drawcalls},D.exports=n},{}],167:[function(L,D,P){"use strict";var n=function(L,D){this._device=L,this._width=4,this._height=4,this._image=null,D&&(void 0!==D.width&&(this._width=D.width),void 0!==D.height&&(this._height=D.height),this.updateImage(D))};n.prototype.update=function(L){this.updateImage(L)},n.prototype.updateImage=function(L){if(L.images&&L.images[0]){var D=L.images[0];D&&D!==this._image&&(this._image=D)}},n.prototype.destroy=function(){this._image=null},D.exports=n},{}],168:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=a(L("../../renderer/gfx")),F=a(L("../../renderer/core/input-assembler")),B=a(L("../../renderer/core/pass"));function a(L){return L&&L.__esModule?L:{default:L}}var k=cc.renderer={Texture2D:null,InputAssembler:F.default,Pass:B.default,renderEngine:null,canvas:null,device:null,scene:null,drawCalls:0,_handle:null,_cameraNode:null,_camera:null,_forward:null,_flow:null,initWebGL:function(D,P){L("./webgl/assemblers");var F=L("./webgl/model-batcher");this.Texture2D=N.default.Texture2D,this.canvas=D,this._flow=cc.RenderFlow;var B=L("../../renderer/scene/scene"),k=L("../../renderer/renderers/forward-renderer");this.device=new N.default.Device(D,P),this.scene=new B;var U=function(L){return{defaultTexture:new N.default.Texture2D(L,{images:[],width:128,height:128,wrapS:N.default.WRAP_REPEAT,wrapT:N.default.WRAP_REPEAT,format:N.default.TEXTURE_FMT_RGB8,mipmap:!1}),programTemplates:[],programChunks:{}}}(this.device);this._forward=new k(this.device,U),this._handle=new F(this.device,this.scene),this._flow.init(this._handle,this._forward)},initCanvas:function(D){var P=L("./canvas"),N=L("./canvas/Texture2D"),F=L("./canvas/Device");this.Device=F,this.Texture2D=N,this.canvas=D,this.device=new F(D),this._camera={a:1,b:0,c:0,d:1,tx:0,ty:0},this._handle=new P.RenderComponentHandle(this.device,this._camera),this._forward=new P.ForwardRenderer,this._flow=cc.RenderFlow,this._flow.init(this._handle,this._forward)},updateCameraViewport:function(){if(cc.director){var L=cc.director.getScene();L&&L.setScale(1,1,1)}if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){var D=cc.view.getViewportRect();this.device.setViewport(D.x,D.y,D.width,D.height),this._camera.a=cc.view.getScaleX(),this._camera.d=cc.view.getScaleY(),this._camera.tx=D.x,this._camera.ty=D.y+D.height}},render:function(L,D){this.device.resetDrawCalls(),L&&(this._flow.render(L,D),this.drawCalls=this.device.getDrawCalls())},clear:function(){this._handle.reset(),this._forward.clear()}};P.default=k,D.exports=P.default},{"../../renderer/core/input-assembler":242,"../../renderer/core/pass":243,"../../renderer/gfx":252,"../../renderer/renderers/forward-renderer":271,"../../renderer/scene/scene":274,"./canvas":void 0,"./canvas/Device":166,"./canvas/Texture2D":167,"./webgl/assemblers":180,"./webgl/model-batcher":196}],169:[function(L,D,P){"use strict";var N,F,B=0,k=1<<B++,U=1<<B++,V=1<<B++,z=1<<B++,W=V|z,H=1<<B++,G=1<<B++,X=1<<B++,nt=G|X,ut=1<<B++,dt=1<<B++,ft=1<<B++,_t=1<<B++,pt=0;function T(){this._func=b,this._next=null}var vt=T.prototype;vt._doNothing=function(){},vt._localTransform=function(L){L._updateLocalMatrix(),L._renderFlag&=~V,this._next._func(L)},vt._worldTransform=function(L){N.worldMatDirty++;var D=L._matrix,P=L._trs,F=D.m;F[12]=P[0],F[13]=P[1],F[14]=P[2],L._mulMat(L._worldMatrix,L._parent._worldMatrix,D),L._renderFlag&=~z,this._next._func(L),N.worldMatDirty--},vt._opacity=function(L){N.parentOpacityDirty++,L._renderFlag&=~G,this._next._func(L),N.parentOpacityDirty--},vt._color=function(L){var D=L._renderComponent;D&&D._updateColor(),L._renderFlag&=~X,this._next._func(L)},vt._updateRenderData=function(L){var D=L._renderComponent;D._assembler.updateRenderData(D),L._renderFlag&=~H,this._next._func(L)},vt._render=function(L){var D=L._renderComponent;D._checkBacth(N,L._cullingMask),D._assembler.fillBuffers(D,N),this._next._func(L)},vt._children=function(L){for(var D=pt,P=N,F=P.parentOpacity,B=P.parentOpacity*=L._opacity/255,k=(P.worldMatDirty?z:0)|(P.parentOpacityDirty?nt:0),U=L._children,V=0,W=U.length;V<W;V++){var H=U[V];if(H._renderFlag|=k,H._activeInHierarchy&&0!==H._opacity){pt=H._cullingMask=0===H.groupIndex?D:1<<H.groupIndex;var G=H._color._val;H._color._fastSetA(H._opacity*B),mt[H._renderFlag]._func(H),H._color._val=G}}P.parentOpacity=F,this._next._func(L)},vt._postRender=function(L){var D=L._renderComponent;D._checkBacth(N,L._cullingMask),D._assembler.postFillBuffers(D,N),this._next._func(L)};var gt=new T;gt._func=gt._doNothing,gt._next=gt;var mt={};function x(L,D){var P=new T;switch(P._next=D||gt,L){case k:case U:P._func=P._doNothing;break;case V:P._func=P._localTransform;break;case z:P._func=P._worldTransform;break;case G:P._func=P._opacity;break;case X:P._func=P._color;break;case H:P._func=P._updateRenderData;break;case ut:P._func=P._render;break;case dt:P._func=P._children;break;case ft:P._func=P._postRender}return P}function b(L){var D=L._renderFlag;(mt[D]=function(L){for(var D=null,P=_t;P>0;)P&L&&(D=x(P,D)),P>>=1;return D}(D))._func(L)}T.flows=mt,T.createFlow=x;var yt=[];T.registerValidate=function(L){L._inValidateList||(yt.push(L),L._inValidateList=!0)},T.validateRenderers=function(){for(var L=0,D=yt.length;L<D;L++){var P=yt[L];P.isValid&&(P.enabledInHierarchy?P._validateRender():P.disableRender(),P._inValidateList=!1)}yt.length=0},T.visitRootNode=function(L){T.validateRenderers(),pt=1<<L.groupIndex,L._renderFlag&z?(N.worldMatDirty++,L._calculWorldMatrix(),L._renderFlag&=~z,mt[L._renderFlag]._func(L),N.worldMatDirty--):mt[L._renderFlag]._func(L)},T.render=function(L,D){N.reset(),N.walking=!0,T.visitRootNode(L),N.terminate(),N.walking=!1,F.render(N._renderScene,D)},T.init=function(L,D){N=L,F=D,mt[0]=gt;for(var P=1;P<_t;P++)mt[P]=new T},T.getBachther=function(){return N},T.FLAG_DONOTHING=k,T.FLAG_BREAK_FLOW=U,T.FLAG_LOCAL_TRANSFORM=V,T.FLAG_WORLD_TRANSFORM=z,T.FLAG_TRANSFORM=W,T.FLAG_OPACITY=G,T.FLAG_COLOR=X,T.FLAG_OPACITY_COLOR=nt,T.FLAG_UPDATE_RENDER_DATA=H,T.FLAG_RENDER=ut,T.FLAG_CHILDREN=dt,T.FLAG_POST_RENDER=ft,T.FLAG_FINAL=_t,D.exports=cc.RenderFlow=T},{}],170:[function(L,D,P){"use strict";var N=L("../../../assets/CCRenderTexture");function s(L,D){var P=new N;P.initWithSize(L,D),P.update(),this._texture=P,this._x=2,this._y=2,this._nexty=2,this._width=L,this._height=D,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}s.DEFAULT_HASH=(new N)._getHash(),cc.js.mixin(s.prototype,{insertSpriteFrame:function(L){var D=L._rect,P=L._texture,N=this._innerTextureInfos[P._id],F=D.x,B=D.y;if(N)F+=N.x,B+=N.y;else{var k=P.width,U=P.height;if(this._x+k+2>this._width&&(this._x=2,this._y=this._nexty),this._y+U+2>this._nexty&&(this._nexty=this._y+U+2),this._nexty>this._height)return null;cc.dynamicAtlasManager.textureBleeding&&((k<=8||U<=8)&&(this._texture.drawTextureAt(P,this._x-1,this._y-1),this._texture.drawTextureAt(P,this._x-1,this._y+1),this._texture.drawTextureAt(P,this._x+1,this._y-1),this._texture.drawTextureAt(P,this._x+1,this._y+1)),this._texture.drawTextureAt(P,this._x-1,this._y),this._texture.drawTextureAt(P,this._x+1,this._y),this._texture.drawTextureAt(P,this._x,this._y-1),this._texture.drawTextureAt(P,this._x,this._y+1)),this._texture.drawTextureAt(P,this._x,this._y),this._innerTextureInfos[P._id]={x:this._x,y:this._y,texture:P},this._count++,F+=this._x,B+=this._y,this._x+=k+2,this._dirty=!0}var V={x:F,y:B,texture:this._texture};return this._innerSpriteFrames.push(L),V},update:function(){this._dirty&&(this._texture.update(),this._dirty=!1)},deleteInnerTexture:function(L){L&&this._innerTextureInfos[L._id]&&(delete this._innerTextureInfos[L._id],this._count--)},isEmpty:function(){return this._count<=0},reset:function(){this._x=2,this._y=2,this._nexty=2;for(var L=this._innerSpriteFrames,D=0,P=L.length;D<P;D++){var N=L[D];N.isValid&&N._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},destroy:function(){this.reset(),this._texture.destroy()}}),D.exports=s},{"../../../assets/CCRenderTexture":38}],171:[function(L,D,P){"use strict";var N=L("./atlas"),F=[],B=-1,k=5,U=2048,V=512,z=!0;function h(){var L=F[++B];return L||(L=new N(U,U),F.push(L)),L}function u(){H.reset()}var W=!1,H={Atlas:N,get enabled(){return W},set enabled(L){W!==L&&(L?(this.reset(),cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,u)):cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,u),W=L)},get maxAtlasCount(){return k},set maxAtlasCount(L){k=L},get textureBleeding(){return z},set textureBleeding(L){z=L},get textureSize(){return U},set textureSize(L){U=L},get maxFrameSize(){return V},set maxFrameSize(L){V=L},insertSpriteFrame:function(L){if(!W||B===k||!L||L._original)return null;if(!L._texture.packable)return null;var D=F[B];D||(D=h());var P=D.insertSpriteFrame(L);return P||B===k?P:(D=h()).insertSpriteFrame(L)},reset:function(){for(var L=0,D=F.length;L<D;L++)F[L].destroy();F.length=0,B=-1},deleteAtlasSpriteFrame:function(L){if(L._original){var D=L._original._texture;this.deleteAtlasTexture(D)}},deleteAtlasTexture:function(L){if(L)for(var D=F.length-1;D>=0;D--)F[D].deleteInnerTexture(L),F[D].isEmpty()&&(F[D].destroy(),F.splice(D,1),B--)},showDebug:!1,update:function(){if(this.enabled)for(var L=0;L<=B;L++)F[L].update()}};D.exports=cc.dynamicAtlasManager=H},{"./atlas":170}],172:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../assembler-2d"));var F=L("../../../utils/text-utils"),B=L("../../../platform/CCMacro"),k=L("../../../components/CCLabel").Overflow,U=L("../utils").shareLabelInfo,l=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},V=cc.rect(),z=null,W=[],H=[],G=[],X=[],nt=null,ut=0,dt=0,ft=0,_t=0,pt=0,vt=1,gt=null,mt=cc.size(),yt="",Tt=0,xt=0,St=0,bt=0,wt=0,Rt=0,It=0,Mt=!1,Ot=0,Lt=0,Dt=0,Pt=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.updateRenderData=function(L){L._vertsDirty&&z!==L&&(z=L,this._reserveQuads(L,L.string.toString().length),this._updateFontFamily(L),this._updateProperties(L),this._updateLabelInfo(L),this._updateContent(),this.updateWorldVerts(L),z._actualFontSize=Tt,z.node.setContentSize(mt),z._vertsDirty=!1,z=null,this._resetProperties())},D._updateFontScale=function(){vt=Tt/xt},D._updateFontFamily=function(L){var D=L.font;gt=D.spriteFrame,nt=D._fntConfig,U.fontAtlas=D._fontDefDictionary,this.packToDynamicAtlas(L,gt)},D._updateLabelInfo=function(){U.hash="",U.margin=0},D._updateProperties=function(L){yt=L.string.toString(),Tt=L.fontSize,xt=nt?nt.fontSize:L.fontSize,St=L.horizontalAlign,bt=L.verticalAlign,wt=L.spacingX,It=L.overflow,Rt=L._lineHeight,mt.width=L.node.width,mt.height=L.node.height,It===k.NONE?(Mt=!1,mt.width+=2*U.margin,mt.height+=2*U.margin):It===k.RESIZE_HEIGHT?(Mt=!0,mt.height+=2*U.margin):Mt=L.enableWrapText,U.lineHeight=Rt,U.fontSize=Tt,this._setupBMFontOverflowMetrics()},D._resetProperties=function(){nt=null,gt=null,U.hash="",U.margin=0},D._updateContent=function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},D._computeHorizontalKerningForText=function(){for(var L=yt,D=L.length,P=nt.kerningDict,N=W,F=-1,B=0;B<D;++B){var k=L.charCodeAt(B),U=P[F<<16|65535&k]||0;N[B]=B<D-1?U:0,F=k}},D._multilineTextWrap=function(L){for(var D=yt.length,P=0,N=0,B=0,V=0,z=0,H=0,X=0,ft=null,gt=cc.v2(0,0),Tt=0;Tt<D;){var xt=yt.charAt(Tt);if("\n"!==xt){for(var St=L(yt,Tt,D),bt=H,Pt=X,Nt=z,Ft=N,Bt=!1,kt=0;kt<St;++kt){var Ut=Tt+kt;if("\r"!==(xt=yt.charAt(Ut)))if(ft=U.fontAtlas.getLetterDefinitionForChar(xt,U)){var Vt=Ft+ft.offsetX*vt-U.margin;if(Mt&&Dt>0&&N>0&&Vt+ft.w*vt>Dt&&!F.isUnicodeSpace(xt)){G.push(z),z=0,P++,N=0,B-=Rt*this._getFontScale()+0,Bt=!0;break}gt.x=Vt,gt.y=B-ft.offsetY*vt+U.margin,this._recordLetterInfo(gt,xt,Ut,P),Ut+1<W.length&&Ut<D-1&&(Ft+=W[Ut+1]),Ft+=ft.xAdvance*vt+wt-2*U.margin,Nt=gt.x+ft.w*vt-U.margin,bt<gt.y&&(bt=gt.y),Pt>gt.y-ft.h*vt&&(Pt=gt.y-ft.h*vt)}else this._recordPlaceholderInfo(Ut,xt),console.log("Can't find letter definition in texture atlas "+nt.atlasName+" for letter:"+xt);else this._recordPlaceholderInfo(Ut,xt)}Bt||(N=Ft,H<bt&&(H=bt),X>Pt&&(X=Pt),V<(z=Nt)&&(V=z),Tt+=St)}else G.push(z),z=0,P++,N=0,B-=Rt*this._getFontScale()+0,this._recordPlaceholderInfo(Tt,xt),Tt++}return G.push(z),dt=(ut=P+1)*Rt*this._getFontScale(),ut>1&&(dt+=0*(ut-1)),mt.width=Ot,mt.height=Lt,Ot<=0&&(mt.width=parseFloat(V.toFixed(2))+2*U.margin),Lt<=0&&(mt.height=parseFloat(dt.toFixed(2))+2*U.margin),_t=mt.height,pt=0,It!==k.CLAMP&&(H>0&&(_t=mt.height+H),X<-dt&&(pt=dt+X)),!0},D._getFirstCharLen=function(){return 1},D._getFontScale=function(){return It===k.SHRINK?vt:1},D._getFirstWordLen=function(L,D,P){var N=L.charAt(D);if(F.isUnicodeCJK(N)||"\n"===N||F.isUnicodeSpace(N))return 1;var B=1,k=U.fontAtlas.getLetterDefinitionForChar(N,U);if(!k)return B;for(var V=k.xAdvance*vt+wt,z=D+1;z<P&&(N=L.charAt(z),k=U.fontAtlas.getLetterDefinitionForChar(N,U));++z){if(V+k.offsetX*vt+k.w*vt>Dt&&!F.isUnicodeSpace(N)&&Dt>0)return B;if(V+=k.xAdvance*vt+wt,"\n"===N||F.isUnicodeSpace(N)||F.isUnicodeCJK(N))break;B++}return B},D._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen)},D._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen)},D._recordPlaceholderInfo=function(L,D){if(L>=H.length){var P=new l;H.push(P)}H[L].char=D,H[L].hash=D.charCodeAt(0)+U.hash,H[L].valid=!1},D._recordLetterInfo=function(L,D,P,N){if(P>=H.length){var F=new l;H.push(F)}var B=D.charCodeAt(0)+U.hash;H[P].line=N,H[P].char=D,H[P].hash=B,H[P].valid=U.fontAtlas.getLetter(B).valid,H[P].x=L.x,H[P].y=L.y},D._alignText=function(){dt=0,G.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),It===k.SHRINK&&Tt>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||It===k.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},D._scaleFontSizeDown=function(L){var D=!0;L||(L=.1,D=!1),Tt=L,D&&this._updateContent()},D._shrinkLabelToContentSize=function(L){for(var D=0,P=0|Tt,N=0;D<P&&!((N=D+P+1>>1)<=0);)vt=N/xt,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),L()?P=N-1:D=N;var F=D;F>=0&&this._scaleFontSizeDown(F)},D._isVerticalClamp=function(){return dt>mt.height},D._isHorizontalClamp=function(){for(var L=!1,D=0,P=yt.length;D<P;++D){var N=H[D];if(N.valid){var F=U.fontAtlas.getLetter(N.hash),B=N.x+F.w*vt,k=N.line;if(Ot>0)if(Mt){if(G[k]>mt.width&&(B>mt.width||B<0)){L=!0;break}}else if(B>mt.width){L=!0;break}}}return L},D._isHorizontalClamped=function(L,D){var P=G[D],N=L>mt.width||L<0;return Mt?P>mt.width&&N:N},D._updateQuads=function(){var L=gt?gt._texture:U.fontAtlas.getTexture(),D=z.node;this.verticesCount=this.indicesCount=0,this._renderData&&(this._renderData.dataLength=0);for(var P=mt,N=D._anchorPoint.x*P.width,F=D._anchorPoint.y*P.height,B=!0,W=0,G=yt.length;W<G;++W){var nt=H[W];if(nt.valid){var ut=U.fontAtlas.getLetter(nt.hash);V.height=ut.h,V.width=ut.w,V.x=ut.u,V.y=ut.v;var dt=nt.y+ft;if(Lt>0){if(dt>_t){var Tt=dt-_t;V.y+=Tt,V.height-=Tt,dt-=Tt}dt-ut.h*vt<pt&&It===k.CLAMP&&(V.height=dt<pt?0:(dt-pt)/vt)}var xt=nt.line,St=nt.x+ut.w/2*vt+X[xt];if(Ot>0&&this._isHorizontalClamped(St,xt))if(It===k.CLAMP)V.width=0;else if(It===k.SHRINK){if(mt.width>ut.w){B=!1;break}V.width=0}if(V.height>0&&V.width>0){var bt=this._determineRect(V),wt=nt.x+X[nt.line];this.appendQuad(z,L,V,bt,wt-N,dt-F,vt)}}}return this._quadsUpdated(z),B},D._determineRect=function(L){var D=gt.isRotated(),P=gt._originalSize,N=gt._rect,F=gt._offset,B=F.x+(P.width-N.width)/2,k=F.y-(P.height-N.height)/2;if(D){var U=L.x;L.x=N.x+N.height-L.y-L.height-k,L.y=U+N.y-B,L.y<0&&(L.height=L.height+k)}else L.x+=N.x-B,L.y+=N.y+k;return D},D._computeAlignmentOffset=function(){switch(X.length=0,St){case B.TextAlignment.LEFT:for(var L=0;L<ut;++L)X.push(0);break;case B.TextAlignment.CENTER:for(var D=0,P=G.length;D<P;D++)X.push((mt.width-G[D])/2);break;case B.TextAlignment.RIGHT:for(var N=0,F=G.length;N<F;N++)X.push(mt.width-G[N])}if(ft=mt.height,bt!==B.VerticalTextAlignment.TOP){var k=mt.height-dt+Rt*this._getFontScale()-xt*vt;bt===B.VerticalTextAlignment.BOTTOM?ft-=k:ft-=k/2}},D._setupBMFontOverflowMetrics=function(){var L=mt.width,D=mt.height;It===k.RESIZE_HEIGHT&&(D=0),It===k.NONE&&(L=0,D=0),Ot=L,Lt=D,Dt=L},D.updateWorldVerts=function(){},D.appendQuad=function(L,D,P,N,F,B,k){},D._quadsUpdated=function(L){},D._reserveQuads=function(){},e}(N.default);P.default=Pt,D.exports=P.default},{"../../../components/CCLabel":75,"../../../platform/CCMacro":142,"../../../utils/text-utils":217,"../../assembler-2d":163,"../utils":176}],173:[function(L,D,P){"use strict";function n(){this._rect=null,this.uv=[],this._texture=null,this._original=null}n.prototype={constructor:n,getRect:function(){return cc.rect(this._rect)},setRect:function(L){this._rect=L,this._texture&&this._calculateUV()},_setDynamicAtlasFrame:function(L){L&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=L.texture,this._rect.x=L.x,this._rect.y=L.y,this._calculateUV())},_resetDynamicAtlasFrame:function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},_refreshTexture:function(L){this._texture=L,this._rect=cc.rect(0,0,L.width,L.height),this._calculateUV()},_calculateUV:function(){var L=this._rect,D=this._texture,P=this.uv,N=D.width,F=D.height,B=0===N?0:L.x/N,k=0===N?0:(L.x+L.width)/N,U=0===F?0:(L.y+L.height)/F,V=0===F?0:L.y/F;P[0]=B,P[1]=U,P[2]=k,P[3]=U,P[4]=B,P[5]=V,P[6]=k,P[7]=V}},D.exports=n},{}],174:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../webgl/assemblers/label/2d/bmfont"));var F=L("../../../components/CCLabel"),B=L("../../../components/CCLabelOutline"),k=L("../../../utils/text-utils"),U=L("../../../components/CCComponent"),V=L("../../../assets/CCRenderTexture"),z=cc.js.isChildClassOf(B,U),W=L("../utils").getFontFamily,H=L("../utils").shareLabelInfo,G=cc.BitmapFont.FontLetterDefinition,X=cc.BitmapFont.FontAtlas,nt=cc.Color.WHITE,ut=(1/255).toFixed(3);function m(L,D){this._texture=null,this._labelInfo=D,this._char=L,this._hash=null,this._data=null,this._canvas=null,this._context=null,this._width=0,this._height=0,this._offsetY=0,this._hash=L.charCodeAt(0)+D.hash}function y(L,D){var P=new V;P.initWithSize(L,D),P.update(),this._fontDefDictionary=new X(P),this._x=0,this._y=0,this._nexty=0,this._width=L,this._height=D,cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}m.prototype={constructor:m,updateRenderData:function(){this._updateProperties(),this._updateTexture()},_updateProperties:function(){this._texture=new cc.Texture2D,this._data=F._canvasPool.get(),this._canvas=this._data.canvas,this._context=this._data.context,this._context.font=this._labelInfo.fontDesc;var L=k.safeMeasureText(this._context,this._char,this._labelInfo.fontDesc),D=2*this._labelInfo.margin+2;this._width=parseFloat(L.toFixed(2))+D,this._height=(1+k.BASELINE_RATIO)*this._labelInfo.fontSize+D,this._offsetY=-this._labelInfo.fontSize*k.BASELINE_RATIO/2,this._canvas.width!==this._width&&(this._canvas.width=this._width),this._canvas.height!==this._height&&(this._canvas.height=this._height),this._texture.initWithElement(this._canvas)},_updateTexture:function(){var L=this._context,D=this._labelInfo,P=this._canvas.width,N=this._canvas.height,F=P/2,B=N/2+this._labelInfo.fontSize*k.MIDDLE_RATIO,U=D.color;if(L.textAlign="center",L.textBaseline="alphabetic",L.clearRect(0,0,P,N),L.fillStyle="rgba("+U.r+", "+U.g+", "+U.b+", "+ut+")",L.fillRect(0,0,P,N),L.font=D.fontDesc,L.lineJoin="round",L.fillStyle="rgba("+U.r+", "+U.g+", "+U.b+", 1)",D.isOutlined&&D.margin>0){var V=D.out||nt;L.strokeStyle="rgba("+V.r+", "+V.g+", "+V.b+", "+V.a/255+")",L.lineWidth=2*D.margin,L.strokeText(this._char,F,B)}L.fillText(this._char,F,B),this._texture.handleLoadedTexture()},destroy:function(){this._texture.destroy(),this._texture=null,F._canvasPool.put(this._data)}},cc.js.mixin(y.prototype,{insertLetterTexture:function(L){var D=L._texture,P=D.width,N=D.height;if(this._x+P+0>this._width&&(this._x=0,this._y=this._nexty),this._y+N>this._nexty&&(this._nexty=this._y+N+0),this._nexty>this._height)return null;this._fontDefDictionary._texture.drawTextureAt(D,this._x,this._y),this._dirty=!0;var F=new G;return F.u=this._x+1,F.v=this._y+1,F.texture=this._fontDefDictionary._texture,F.valid=!0,F.w=L._width-2,F.h=L._height-2,F.xAdvance=F.w,F.offsetY=L._offsetY,this._x+=P+0,this._fontDefDictionary.addLetterDefinitions(L._hash,F),F},update:function(){this._dirty&&(this._fontDefDictionary._texture.update(),this._dirty=!1)},reset:function(){this._x=0,this._y=0,this._nexty=0;for(var L=this._fontDefDictionary._letterDefinitions,D=0,P=L.length;D<P;D++){var N=L[D];N.isValid&&N.destroy()}this._fontDefDictionary.clear()},destroy:function(){this.reset(),this._fontDefDictionary._texture.destroy(),this._fontDefDictionary._texture=null},beforeSceneLoad:function(){this.clearAllCache()},clearAllCache:function(){this.destroy();var L=new V;L.initWithSize(this._width,this._height),L.update(),this._fontDefDictionary._texture=L},getLetter:function(L){return this._fontDefDictionary._letterDefinitions[L]},getTexture:function(){return this._fontDefDictionary.getTexture()},getLetterDefinitionForChar:function(L,D){var P=L.charCodeAt(0)+D.hash,N=this._fontDefDictionary._letterDefinitions[P];if(!N){var F=new m(L,D);F.updateRenderData(),N=this.insertLetterTexture(F),F.destroy()}return N}});var dt=null,ft=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D._getAssemblerData=function(){return dt||(dt=new y(2048,2048),cc.Label._shareAtlas=dt),dt.getTexture()},D._updateFontFamily=function(L){H.fontAtlas=dt,H.fontFamily=W(L);var D=z&&L.getComponent(B);D&&D.enabled?(H.isOutlined=!0,H.margin=D.width,H.out=D.color.clone(),H.out.a=D.color.a*L.node.color.a/255):(H.isOutlined=!1,H.margin=0)},D._updateLabelInfo=function(L){H.fontDesc=this._getFontDesc(),H.color=L.node.color,H.hash=function(L){var D=L.color.toHEX("#rrggbb"),P="";return L.isOutlined&&L.margin>0&&(P=P+L.margin+L.out.toHEX("#rrggbb")),""+L.fontSize+L.fontFamily+D+P}(H)},D._getFontDesc=function(){return H.fontSize.toString()+"px "+H.fontFamily},D._computeHorizontalKerningForText=function(){},D._determineRect=function(L){return!1},e}(N.default);P.default=ft,D.exports=P.default},{"../../../assets/CCRenderTexture":38,"../../../components/CCComponent":73,"../../../components/CCLabel":75,"../../../components/CCLabelOutline":76,"../../../utils/text-utils":217,"../../webgl/assemblers/label/2d/bmfont":181,"../utils":176}],175:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../assembler-2d"));var F,B=L("../../../utils/text-utils"),k=L("../../../platform/CCMacro"),U=L("../../../components/CCLabel"),V=L("../../../components/CCLabelOutline"),z=L("../../../components/CCLabelShadow"),W=U.Overflow,H=L("../utils").deleteFromDynamicAtlas,G=L("../utils").getFontFamily,X=(1/255).toFixed(3),nt=null,ut=null,dt=null,ft="",_t="",pt=0,vt=0,gt=[],mt=cc.Size.ZERO,yt=0,Tt=0,xt=0,St=null,bt="",wt=W.NONE,Rt=!1,It=null,Mt=cc.Color.WHITE,Ot=null,Lt=cc.Color.BLACK,Dt=cc.rect(),Pt=cc.Size.ZERO,Nt=cc.Size.ZERO,Ft=!1,Bt=!1,kt=!1,Ut=0,Vt=cc.Vec2.ZERO,zt=0,Wt=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D._getAssemblerData=function(){return(F=U._canvasPool.get()).canvas.width=F.canvas.height=1,F},D._resetAssemblerData=function(L){L&&U._canvasPool.put(L)},D.updateRenderData=function(D){L.prototype.updateRenderData.call(this,D),D._vertsDirty&&(this._updateFontFamily(D),this._updateProperties(D),this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture(D),this._calDynamicAtlas(D),D._actualFontSize=pt,D.node.setContentSize(Nt),this.updateVerts(D),D._vertsDirty=!1,nt=null,ut=null,dt=null)},D.updateVerts=function(){},D._updatePaddingRect=function(){var L=0,D=0,P=0,N=0,F=0;if(Pt.width=Pt.height=0,It&&(L=D=P=N=F=It.width,Pt.width=Pt.height=2*F),Ot){var B=Ot.blur+F;P=Math.max(P,-Ot._offset.x+B),N=Math.max(N,Ot._offset.x+B),L=Math.max(L,Ot._offset.y+B),D=Math.max(D,-Ot._offset.y+B)}if(Bt){var k=vt*Math.tan(.20943951);N+=k,Pt.width+=k}Dt.x=P,Dt.y=L,Dt.width=P+N,Dt.height=L+D},D._updateFontFamily=function(L){bt=G(L)},D._updateProperties=function(L){var D=L._assemblerData;nt=D.context,ut=D.canvas,dt=L._frame._original?L._frame._original._texture:L._frame._texture,_t=L.string.toString(),pt=L._fontSize,vt=pt,Ut=L.underlineHeight||vt/8,wt=L.overflow,mt.width=L.node.width,mt.height=L.node.height,Nt=L.node.getContentSize(),yt=L._lineHeight,Tt=L.horizontalAlign,xt=L.verticalAlign,St=L.node.color,Ft=L.enableBold,Bt=L.enableItalic,kt=L.enableUnderline,Rt=wt!==W.NONE&&(wt===W.RESIZE_HEIGHT||L.enableWrapText),(It=(It=V&&L.getComponent(V))&&It.enabled&&It.width>0?It:null)&&Mt.set(It.color),(Ot=(Ot=z&&L.getComponent(z))&&Ot.enabled?Ot:null)&&(Lt.set(Ot.color),Lt.a=Lt.a*L.node.color.a/255),this._updatePaddingRect()},D._calculateFillTextStartPosition=function(){var L=0;Tt===k.TextAlignment.RIGHT?L=mt.width-Dt.width:Tt===k.TextAlignment.CENTER&&(L=(mt.width-Dt.width)/2);var D=this._getLineHeight()*(gt.length-1),P=pt*(1-B.BASELINE_RATIO/2);if(xt!==k.VerticalTextAlignment.TOP){var N=D+Dt.height+pt-mt.height;xt===k.VerticalTextAlignment.BOTTOM?P-=N+=B.BASELINE_RATIO/2*pt:P-=N/2}return cc.v2(L+Dt.x,P+Dt.y)},D._setupOutline=function(){nt.strokeStyle="rgba("+Mt.r+", "+Mt.g+", "+Mt.b+", "+Mt.a/255+")",nt.lineWidth=2*It.width},D._setupShadow=function(){nt.shadowColor="rgba("+Lt.r+", "+Lt.g+", "+Lt.b+", "+Lt.a/255+")",nt.shadowBlur=Ot.blur,nt.shadowOffsetX=Ot.offset.x,nt.shadowOffsetY=-Ot.offset.y},D._drawUnderline=function(L){It&&(this._setupOutline(),nt.strokeRect(Vt.x,Vt.y,L,Ut)),nt.lineWidth=Ut,nt.fillStyle="rgba("+St.r+", "+St.g+", "+St.b+", "+St.a/255+")",nt.fillRect(Vt.x,Vt.y,L,Ut)},D._updateTexture=function(){nt.clearRect(0,0,ut.width,ut.height);var L=It?Mt:St;nt.fillStyle="rgba("+L.r+", "+L.g+", "+L.b+", "+X+")",nt.fillRect(0,0,ut.width,ut.height),nt.font=ft;var D=this._calculateFillTextStartPosition(),P=this._getLineHeight();nt.lineJoin="round",nt.fillStyle="rgba("+St.r+", "+St.g+", "+St.b+", 1)";var N=gt.length>1,F=this._measureText(nt,ft),B=0,U=0;Ot&&this._setupShadow(),It&&It.width>0&&this._setupOutline();for(var V=0;V<gt.length;++V)B=D.x,U=D.y+V*P,Ot&&N&&(It&&It.width>0&&nt.strokeText(gt[V],B,U),nt.fillText(gt[V],B,U)),kt&&(zt=F(gt[V]),Tt===k.TextAlignment.RIGHT?Vt.x=D.x-zt:Tt===k.TextAlignment.CENTER?Vt.x=D.x-zt/2:Vt.x=D.x,Vt.y=U+vt/8,this._drawUnderline(zt));Ot&&N&&(nt.shadowColor="transparent");for(var z=0;z<gt.length;++z)B=D.x,U=D.y+z*P,It&&It.width>0&&nt.strokeText(gt[z],B,U),nt.fillText(gt[z],B,U);Ot&&(nt.shadowColor="transparent"),dt.handleLoadedTexture()},D._calDynamicAtlas=function(L){if(L.cacheMode===U.CacheMode.BITMAP){var D=L._frame;H(L,D),D._original||D.setRect(cc.rect(0,0,ut.width,ut.height)),this.packToDynamicAtlas(L,D)}},D._updateLabelDimensions=function(){var L=_t.split("\n");if(wt===W.RESIZE_HEIGHT){var D=(gt.length+B.BASELINE_RATIO)*this._getLineHeight();mt.height=D+Dt.height,Nt.height=D+Pt.height}else if(wt===W.NONE){gt=L;for(var P=0,N=0,F=0;F<L.length;++F){var k=B.safeMeasureText(nt,L[F],ft);P=P>k?P:k}N=(gt.length+B.BASELINE_RATIO)*this._getLineHeight();var U=parseFloat(P.toFixed(2)),V=parseFloat(N.toFixed(2));mt.width=U+Dt.width,mt.height=V+Dt.height,Nt.width=U+Pt.width,Nt.height=V+Pt.height}mt.width=Math.min(mt.width,2048),mt.height=Math.min(mt.height,2048),ut.width!==mt.width&&(ut.width=mt.width),ut.height!==mt.height&&(ut.height=mt.height)},D._calculateTextBaseline=function(){var L;L=Tt===k.TextAlignment.RIGHT?"right":Tt===k.TextAlignment.CENTER?"center":"left",nt.textAlign=L,nt.textBaseline="alphabetic"},D._calculateSplitedStrings=function(){var L=_t.split("\n");if(Rt){gt=[];for(var D=Nt.width,P=0;P<L.length;++P){var N=B.safeMeasureText(nt,L[P],ft),F=B.fragmentText(L[P],N,D,this._measureText(nt,ft));gt=gt.concat(F)}}else gt=L},D._getFontDesc=function(){var L=pt.toString()+"px ";return L+=bt,Ft&&(L="bold "+L),Bt&&(L="italic "+L),L},D._getLineHeight=function(){return 0|(0===yt?pt:yt*pt/vt)},D._calculateParagraphLength=function(L,D){for(var P=[],N=0;N<L.length;++N){var F=B.safeMeasureText(D,L[N],ft);P.push(F)}return P},D._measureText=function(L,D){return function(P){return B.safeMeasureText(L,P,D)}},D._calculateLabelFont=function(){if(ft=this._getFontDesc(),nt.font=ft,wt===W.SHRINK){var L=_t.split("\n"),D=this._calculateParagraphLength(L,nt),P=0,N=0,F=0;if(Rt){var k=Nt.width,U=Nt.height;if(k<0||U<0)return ft=this._getFontDesc(),void(nt.font=ft);N=U+1,F=k+1;for(var V="",z=0,H=0|pt+1,G=0;z<H;){if((G=z+H+1>>1)<=0){cc.logID(4003);break}for(pt=G,ft=this._getFontDesc(),nt.font=ft,N=0,P=0;P<L.length;++P){var X=0,ut=B.safeMeasureText(nt,L[P],ft);for(V=B.fragmentText(L[P],ut,k,this._measureText(nt,ft));X<V.length;)F=B.safeMeasureText(nt,V[X],ft),N+=this._getLineHeight(),++X}N>U?H=G-1:z=G}0===z?cc.logID(4003):(pt=z,ft=this._getFontDesc(),nt.font=ft)}else{for(N=L.length*this._getLineHeight(),P=0;P<L.length;++P)F<D[P]&&(F=D[P]);var dt=(mt.width-Dt.width)/F,gt=mt.height/N;pt=vt*Math.min(1,dt,gt)|0,ft=this._getFontDesc(),nt.font=ft}}},e}(N.default);P.default=Wt,D.exports=P.default},{"../../../components/CCLabel":75,"../../../components/CCLabelOutline":76,"../../../components/CCLabelShadow":77,"../../../platform/CCMacro":142,"../../../utils/text-utils":217,"../../assembler-2d":163,"../utils":176}],176:[function(L,D,P){"use strict";var N=L("./dynamic-atlas/manager"),F=cc.Color.WHITE,B={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:F,isOutlined:!1,out:F,margin:0};D.exports={deleteFromDynamicAtlas:function(L,D){D&&D._original&&N&&(N.deleteAtlasSpriteFrame(D),D._resetDynamicAtlasFrame())},getFontFamily:function(L){return L.useSystemFont?L.fontFamily||"Arial":L.font?L.font._nativeAsset?L.font._nativeAsset:(cc.loader.load(L.font.nativeUrl,(function(D,P){L.font._nativeAsset=P,L.setVertsDirty()})),"Arial"):"Arial"},shareLabelInfo:B}},{"./dynamic-atlas/manager":171}],177:[function(L,D,P){"use strict";function n(L,D,P){P=P||2;var N,F,B,k,U,V,z,W=D&&D.length,H=W?D[0]*P:L.length,G=r(L,0,H,P,!0),X=[];if(!G)return X;if(W&&(G=u(L,D,G,P)),L.length>80*P){N=B=L[0],F=k=L[1];for(var nt=P;nt<H;nt+=P)(U=L[nt])<N&&(N=U),(V=L[nt+1])<F&&(F=V),U>B&&(B=U),V>k&&(k=V);z=Math.max(B-N,k-F)}return a(G,X,P,N,F,z),X}function r(L,D,P,N,F){var B,k;if(F===O(L,D,P,N)>0)for(B=D;B<P;B+=N)k=R(B,L[B],L[B+1],k);else for(B=P-N;B>=D;B-=N)k=R(B,L[B],L[B+1],k);return k&&A(k,k.next)&&(I(k),k=k.next),k}function s(L,D){if(!L)return L;D||(D=L);var P,N=L;do{if(P=!1,N.steiner||!A(N,N.next)&&0!==E(N.prev,N,N.next))N=N.next;else{if(I(N),(N=D=N.prev)===N.next)return null;P=!0}}while(P||N!==D);return D}function a(L,D,P,N,F,B,k){if(L){!k&&B&&p(L,N,F,B);for(var U,V,z=L;L.prev!==L.next;)if(U=L.prev,V=L.next,B?c(L,N,F,B):o(L))D.push(U.i/P),D.push(L.i/P),D.push(V.i/P),I(L),L=V.next,z=V.next;else if((L=V)===z){k?1===k?a(L=l(L,D,P),D,P,N,F,B,2):2===k&&h(L,D,P,N,F,B):a(s(L),D,P,N,F,B,1);break}}}function o(L){var D=L.prev,P=L,N=L.next;if(E(D,P,N)>=0)return!1;for(var F=L.next.next;F!==L.prev;){if(y(D.x,D.y,P.x,P.y,N.x,N.y,F.x,F.y)&&E(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function c(L,D,P,N){var F=L.prev,B=L,k=L.next;if(E(F,B,k)>=0)return!1;for(var U=F.x<B.x?F.x<k.x?F.x:k.x:B.x<k.x?B.x:k.x,V=F.y<B.y?F.y<k.y?F.y:k.y:B.y<k.y?B.y:k.y,z=F.x>B.x?F.x>k.x?F.x:k.x:B.x>k.x?B.x:k.x,W=F.y>B.y?F.y>k.y?F.y:k.y:B.y>k.y?B.y:k.y,H=g(U,V,D,P,N),G=g(z,W,D,P,N),X=L.nextZ;X&&X.z<=G;){if(X!==L.prev&&X!==L.next&&y(F.x,F.y,B.x,B.y,k.x,k.y,X.x,X.y)&&E(X.prev,X,X.next)>=0)return!1;X=X.nextZ}for(X=L.prevZ;X&&X.z>=H;){if(X!==L.prev&&X!==L.next&&y(F.x,F.y,B.x,B.y,k.x,k.y,X.x,X.y)&&E(X.prev,X,X.next)>=0)return!1;X=X.prevZ}return!0}function l(L,D,P){var N=L;do{var F=N.prev,B=N.next.next;!A(F,B)&&C(F,N,N.next,B)&&S(F,B)&&S(B,F)&&(D.push(F.i/P),D.push(N.i/P),D.push(B.i/P),I(N),I(N.next),N=L=B),N=N.next}while(N!==L);return N}function h(L,D,P,N,F,B){var k=L;do{for(var U=k.next.next;U!==k.prev;){if(k.i!==U.i&&T(k,U)){var V=w(k,U);return k=s(k,k.next),V=s(V,V.next),a(k,D,P,N,F,B),void a(V,D,P,N,F,B)}U=U.next}k=k.next}while(k!==L)}function u(L,D,P,N){var F,B,k,U=[];for(F=0,B=D.length;F<B;F++)(k=r(L,D[F]*N,F<B-1?D[F+1]*N:L.length,N,!1))===k.next&&(k.steiner=!0),U.push(m(k));for(U.sort(d),F=0;F<U.length;F++)f(U[F],P),P=s(P,P.next);return P}function d(L,D){return L.x-D.x}function f(L,D){if(D=function(L,D){var P,N=D,F=L.x,B=L.y,k=-1/0;do{if(B<=N.y&&B>=N.next.y){var U=N.x+(B-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(U<=F&&U>k){if(k=U,U===F){if(B===N.y)return N;if(B===N.next.y)return N.next}P=N.x<N.next.x?N:N.next}}N=N.next}while(N!==D);if(!P)return null;if(F===k)return P.prev;var V,z=P,W=P.x,H=P.y,G=1/0;for(N=P.next;N!==z;)F>=N.x&&N.x>=W&&y(B<H?F:k,B,W,H,B<H?k:F,B,N.x,N.y)&&((V=Math.abs(B-N.y)/(F-N.x))<G||V===G&&N.x>P.x)&&S(N,L)&&(P=N,G=V),N=N.next;return P}(L,D)){var P=w(D,L);s(P,P.next)}}function p(L,D,P,N){var F=L;do{null===F.z&&(F.z=g(F.x,F.y,D,P,N)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next}while(F!==L);F.prevZ.nextZ=null,F.prevZ=null,function(L){var D,P,N,F,B,k,U,V,z=1;do{for(P=L,L=null,B=null,k=0;P;){for(k++,N=P,U=0,D=0;D<z&&(U++,N=N.nextZ);D++);for(V=z;U>0||V>0&&N;)0===U?(F=N,N=N.nextZ,V--):0!==V&&N?P.z<=N.z?(F=P,P=P.nextZ,U--):(F=N,N=N.nextZ,V--):(F=P,P=P.nextZ,U--),B?B.nextZ=F:L=F,F.prevZ=B,B=F;P=N}B.nextZ=null,z*=2}while(k>1)}(F)}function g(L,D,P,N,F){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-P)/F)|L<<8))|L<<4))|L<<2))|L<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-N)/F)|D<<8))|D<<4))|D<<2))|D<<1))<<1}function m(L){var D=L,P=L;do{D.x<P.x&&(P=D),D=D.next}while(D!==L);return P}function y(L,D,P,N,F,B,k,U){return(F-k)*(D-U)-(L-k)*(B-U)>=0&&(L-k)*(N-U)-(P-k)*(D-U)>=0&&(P-k)*(B-U)-(F-k)*(N-U)>=0}function T(L,D){return L.next.i!==D.i&&L.prev.i!==D.i&&!function(L,D){var P=L;do{if(P.i!==L.i&&P.next.i!==L.i&&P.i!==D.i&&P.next.i!==D.i&&C(P,P.next,L,D))return!0;P=P.next}while(P!==L);return!1}(L,D)&&S(L,D)&&S(D,L)&&function(L,D){var P=L,N=!1,F=(L.x+D.x)/2,B=(L.y+D.y)/2;do{P.y>B!=P.next.y>B&&F<(P.next.x-P.x)*(B-P.y)/(P.next.y-P.y)+P.x&&(N=!N),P=P.next}while(P!==L);return N}(L,D)}function E(L,D,P){return(D.y-L.y)*(P.x-D.x)-(D.x-L.x)*(P.y-D.y)}function A(L,D){return L.x===D.x&&L.y===D.y}function C(L,D,P,N){return!!(A(L,D)&&A(P,N)||A(L,N)&&A(P,D))||E(L,D,P)>0!=E(L,D,N)>0&&E(P,N,L)>0!=E(P,N,D)>0}function S(L,D){return E(L.prev,L,L.next)<0?E(L,D,L.next)>=0&&E(L,L.prev,D)>=0:E(L,D,L.prev)<0||E(L,L.next,D)<0}function w(L,D){var P=new M(L.i,L.x,L.y),N=new M(D.i,D.x,D.y),F=L.next,B=D.prev;return L.next=D,D.prev=L,P.next=F,F.prev=P,N.next=P,P.prev=N,B.next=N,N.prev=B,N}function R(L,D,P,N){var F=new M(L,D,P);return N?(F.next=N.next,F.prev=N,N.next.prev=F,N.next=F):(F.prev=F,F.next=F),F}function I(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function M(L,D,P){this.i=L,this.x=D,this.y=P,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(L,D,P,N){for(var F=0,B=D,k=P-N;B<P;B+=N)F+=(L[k]-L[B])*(L[B+1]+L[k+1]),k=B;return F}cc.Graphics.earcut=D.exports=n,n.deviation=function(L,D,P,N){var F=D&&D.length,B=F?D[0]*P:L.length,k=Math.abs(O(L,0,B,P));if(F)for(var U=0,V=D.length;U<V;U++){var z=D[U]*P,W=U<V-1?D[U+1]*P:L.length;k-=Math.abs(O(L,z,W,P))}var H=0;for(U=0;U<N.length;U+=3){var G=N[U]*P,X=N[U+1]*P,nt=N[U+2]*P;H+=Math.abs((L[G]-L[nt])*(L[X+1]-L[G+1])-(L[G]-L[X])*(L[nt+1]-L[G+1]))}return 0===k&&0===H?0:Math.abs((H-k)/k)},n.flatten=function(L){for(var D=L[0][0].length,P={vertices:[],holes:[],dimensions:D},N=0,F=0;F<L.length;F++){for(var B=0;B<L[F].length;B++)for(var k=0;k<D;k++)P.vertices.push(L[F][B][k]);F>0&&(N+=L[F-1].length,P.holes.push(N))}return P}},{}],178:[function(L,D,P){"use strict";var N=L("../../../../graphics/helper"),F=L("../../../../graphics/types").PointFlags,B=cc.Graphics.Point=cc.Class({name:"cc.GraphicsPoint",extends:cc.Vec2,ctor:function(L,D){this.reset()},reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}});function a(){this.reset()}function o(L){this._tessTol=.25,this._distTol=.01,this._updatePathOffset=!1,this._paths=null,this._pathLength=0,this._pathOffset=0,this._points=null,this._pointsOffset=0,this._commandx=0,this._commandy=0,this._paths=[],this._points=[]}cc.js.mixin(a.prototype,{reset:function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]}}),cc.js.mixin(o.prototype,{moveTo:function(L,D){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(L,D,F.PT_CORNER),this._commandx=L,this._commandy=D},lineTo:function(L,D){this._addPoint(L,D,F.PT_CORNER),this._commandx=L,this._commandy=D},bezierCurveTo:function(L,D,P,B,k,U){var V=this._curPath,z=V.points[V.points.length-1];z.x!==L||z.y!==D||P!==k||B!==U?(N.tesselateBezier(this,z.x,z.y,L,D,P,B,k,U,0,F.PT_CORNER),this._commandx=k,this._commandy=U):this.lineTo(k,U)},quadraticCurveTo:function(L,D,P,N){var F=this._commandx,B=this._commandy;this.bezierCurveTo(F+2/3*(L-F),B+2/3*(D-B),P+2/3*(L-P),N+2/3*(D-N),P,N)},arc:function(L,D,P,F,B,k){N.arc(this,L,D,P,F,B,k)},ellipse:function(L,D,P,F){N.ellipse(this,L,D,P,F),this._curPath.complex=!1},circle:function(L,D,P){N.ellipse(this,L,D,P,P),this._curPath.complex=!1},rect:function(L,D,P,N){this.moveTo(L,D),this.lineTo(L,D+N),this.lineTo(L+P,D+N),this.lineTo(L+P,D),this.close(),this._curPath.complex=!1},roundRect:function(L,D,P,F,B){N.roundRect(this,L,D,P,F,B),this._curPath.complex=!1},clear:function(L){this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,L&&(this._paths.length=0,this._points.length=0)},close:function(){this._curPath.closed=!0},_addPath:function(){var L=this._pathLength,D=this._paths[L];return D?D.reset():(D=new a,this._paths.push(D)),this._pathLength++,this._curPath=D,D},_addPoint:function(L,D,P){var N=this._curPath;if(N){var F,k=this._points,U=N.points;(F=k[this._pointsOffset++])?(F.x=L,F.y=D):(F=new B(L,D),k.push(F)),F.flags=P,U.push(F)}}}),cc.Graphics._Impl=o,D.exports=o},{"../../../../graphics/helper":111,"../../../../graphics/types":113}],179:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=s(L("../../../assembler")),F=s(L("../../../../../renderer/core/input-assembler"));function s(L){return L&&L.__esModule?L:{default:L}}var B=L("../../mesh-buffer"),k=L("../../vertex-format").vfmtPosColor,U=L("../../../index"),V=L("../../../../graphics/graphics"),z=L("../../../../graphics/types").PointFlags,W=V.LineJoin,H=V.LineCap,G=L("./earcut"),X=(L("./impl"),Math.PI),nt=Math.min,ut=Math.max,dt=Math.ceil,ft=Math.acos,_t=Math.cos,pt=Math.sin,vt=Math.atan2;function C(L,D,P){var N=2*ft(L/(L+P));return ut(2,dt(D/N))}function x(L,D,P){return L<D?D:L>P?P:L}var gt=function(L){function e(D){var P;return(P=L.call(this,D)||this)._buffer=null,P._buffers=[],P._bufferOffset=0,P}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.getVfmt=function(){return k},D.requestBuffer=function(){var L={indiceStart:0,vertexStart:0},D=new B(U._handle,k);L.meshbuffer=D;var P=new F.default(D._vb,D._ib);return L.ia=P,this._buffers.push(L),L},D.getBuffers=function(){return 0===this._buffers.length&&this.requestBuffer(),this._buffers},D.clear=function(L){this._bufferOffset=0;var D=this._buffers;if(L){for(var P=0,N=D.length;P<N;P++){var F=D[P];F.meshbuffer.destroy(),F.meshbuffer=null}D.length=0}else for(var B=0,k=D.length;B<k;B++){var U=D[B];U.indiceStart=0,U.vertexStart=0,U.meshbuffer.reset()}},D.fillBuffers=function(L,D){D._flush(),D.node=L.node,D.material=L._materials[0];for(var P=this.getBuffers(),N=0,F=P.length;N<F;N++){var B=P[N],k=B.meshbuffer;B.ia._count=B.indiceStart,D._flushIA(B.ia),k.uploadData()}},D.genBuffer=function(L,D){var P=this.getBuffers(),N=P[this._bufferOffset],F=N.meshbuffer,B=N.vertexStart+D;return(B>65535||3*B>131070)&&(++this._bufferOffset,B=D,this._bufferOffset<P.length?N=P[this._bufferOffset]:(N=this.requestBuffer(L),P[this._bufferOffset]=N),F=N.meshbuffer),B>F.vertexOffset&&F.requestStatic(D,3*D),this._buffer=N,N},D.stroke=function(L){this._curColor=L._strokeColor._val,this._flattenPaths(L._impl),this._expandStroke(L),L._impl._updatePathOffset=!0},D.fill=function(L){this._curColor=L._fillColor._val,this._expandFill(L),L._impl._updatePathOffset=!0},D._expandStroke=function(L){var D=.5*L.lineWidth,P=L.lineCap,N=L.lineJoin,F=L.miterLimit,B=L._impl,k=C(D,X,B._tessTol);this._calculateJoins(B,D,N,F);for(var U=B._paths,V=0,G=B._pathOffset,nt=B._pathLength;G<nt;G++){var ut=U[G],dt=ut.points.length;N===W.ROUND?V+=2*(dt+ut.nbevel*(k+2)+1):V+=2*(dt+5*ut.nbevel+1),ut.closed||(P===H.ROUND?V+=2*(2*k+2):V+=12)}for(var ft=this.genBuffer(L,V),_t=ft.meshbuffer,pt=_t._vData,vt=_t._iData,gt=B._pathOffset,mt=B._pathLength;gt<mt;gt++){var yt,Tt=U[gt],xt=Tt.points,St=xt.length,bt=ft.vertexStart,wt=void 0,Rt=void 0,It=void 0,Mt=void 0;if((yt=Tt.closed)?(wt=xt[St-1],Rt=xt[0],It=0,Mt=St):(wt=xt[0],Rt=xt[1],It=1,Mt=St-1),!yt){var Ot=Rt.sub(wt);Ot.normalizeSelf();var Lt=Ot.x,Dt=Ot.y;P===H.BUTT?this._buttCapStart(wt,Lt,Dt,D,0):P===H.SQUARE?this._buttCapStart(wt,Lt,Dt,D,D):P===H.ROUND&&this._roundCapStart(wt,Lt,Dt,D,k)}for(var Pt=It;Pt<Mt;++Pt)N===W.ROUND?this._roundJoin(wt,Rt,D,D,k):0!=(Rt.flags&(z.PT_BEVEL|z.PT_INNERBEVEL))?this._bevelJoin(wt,Rt,D,D):(this._vset(Rt.x+Rt.dmx*D,Rt.y+Rt.dmy*D),this._vset(Rt.x-Rt.dmx*D,Rt.y-Rt.dmy*D)),wt=Rt,Rt=xt[Pt+1];if(yt){var Nt=3*bt;this._vset(pt[Nt],pt[Nt+1]),this._vset(pt[Nt+3],pt[Nt+4])}else{var Ft=Rt.sub(wt);Ft.normalizeSelf();var Bt=Ft.x,kt=Ft.y;P===H.BUTT?this._buttCapEnd(Rt,Bt,kt,D,0):P===H.SQUARE?this._buttCapEnd(Rt,Bt,kt,D,D):P===H.ROUND&&this._roundCapEnd(Rt,Bt,kt,D,k)}for(var Ut=ft.indiceStart,Vt=bt+2,zt=ft.vertexStart;Vt<zt;Vt++)vt[Ut++]=Vt-2,vt[Ut++]=Vt-1,vt[Ut++]=Vt;ft.indiceStart=Ut}},D._expandFill=function(L){for(var D=L._impl,P=D._paths,N=0,F=D._pathOffset,B=D._pathLength;F<B;F++)N+=P[F].points.length;for(var k=this.genBuffer(L,N),U=k.meshbuffer,V=U._vData,z=U._iData,W=D._pathOffset,H=D._pathLength;W<H;W++){var X=P[W],nt=X.points,ut=nt.length;if(0!==ut){for(var dt=k.vertexStart,ft=0;ft<ut;++ft)this._vset(nt[ft].x,nt[ft].y);var _t=k.indiceStart;if(X.complex){for(var pt=[],vt=dt,gt=k.vertexStart;vt<gt;vt++){var mt=3*vt;pt.push(V[mt]),pt.push(V[mt+1])}var yt=G(pt,null,2);if(!yt||0===yt.length)continue;for(var Tt=0,xt=yt.length;Tt<xt;Tt++)z[_t++]=yt[Tt]+dt}else for(var St=dt,bt=dt+2,wt=k.vertexStart;bt<wt;bt++)z[_t++]=St,z[_t++]=bt-1,z[_t++]=bt;k.indiceStart=_t}}},D._calculateJoins=function(L,D,P,N){var F=0;D>0&&(F=1/D);for(var B=L._paths,k=L._pathOffset,U=L._pathLength;k<U;k++){var V=B[k],H=V.points,G=H.length,X=H[G-1],dt=H[0];V.nbevel=0;for(var ft=0;ft<G;ft++){var _t,pt,vt=X.dy,gt=-X.dx,mt=dt.dy,yt=-dt.dx;if(dt.dmx=.5*(vt+mt),dt.dmy=.5*(gt+yt),(_t=dt.dmx*dt.dmx+dt.dmy*dt.dmy)>1e-6){var Tt=1/_t;Tt>600&&(Tt=600),dt.dmx*=Tt,dt.dmy*=Tt}dt.dx*X.dy-X.dx*dt.dy>0&&(dt.flags|=z.PT_LEFT),_t*(pt=ut(11,nt(X.len,dt.len)*F))*pt<1&&(dt.flags|=z.PT_INNERBEVEL),dt.flags&z.PT_CORNER&&(_t*N*N<1||P===W.BEVEL||P===W.ROUND)&&(dt.flags|=z.PT_BEVEL),0!=(dt.flags&(z.PT_BEVEL|z.PT_INNERBEVEL))&&V.nbevel++,X=dt,dt=H[ft+1]}}},D._flattenPaths=function(L){for(var D=L._paths,P=L._pathOffset,N=L._pathLength;P<N;P++){var F=D[P],B=F.points,k=B[B.length-1],U=B[0];B.length>2&&k.equals(U)&&(F.closed=!0,B.pop(),k=B[B.length-1]);for(var V=0,z=B.length;V<z;V++){var W=U.sub(k);k.len=W.mag(),(W.x||W.y)&&W.normalizeSelf(),k.dx=W.x,k.dy=W.y,k=U,U=B[V+1]}}},D._chooseBevel=function(L,D,P,N){var F,B,k,U,V=P.x,z=P.y;return 0!==L?(F=V+D.dy*N,B=z-D.dx*N,k=V+P.dy*N,U=z-P.dx*N):(F=k=V+P.dmx*N,B=U=z+P.dmy*N),[F,B,k,U]},D._buttCapStart=function(L,D,P,N,F){var B=L.x-D*F,k=L.y-P*F,U=P,V=-D;this._vset(B+U*N,k+V*N),this._vset(B-U*N,k-V*N)},D._buttCapEnd=function(L,D,P,N,F){var B=L.x+D*F,k=L.y+P*F,U=P,V=-D;this._vset(B+U*N,k+V*N),this._vset(B-U*N,k-V*N)},D._roundCapStart=function(L,D,P,N,F){for(var B=L.x,k=L.y,U=P,V=-D,z=0;z<F;z++){var W=z/(F-1)*X,H=_t(W)*N,G=pt(W)*N;this._vset(B-U*H-D*G,k-V*H-P*G),this._vset(B,k)}this._vset(B+U*N,k+V*N),this._vset(B-U*N,k-V*N)},D._roundCapEnd=function(L,D,P,N,F){var B=L.x,k=L.y,U=P,V=-D;this._vset(B+U*N,k+V*N),this._vset(B-U*N,k-V*N);for(var z=0;z<F;z++){var W=z/(F-1)*X,H=_t(W)*N,G=pt(W)*N;this._vset(B,k),this._vset(B-U*H+D*G,k-V*H+P*G)}},D._roundJoin=function(L,D,P,N,F){var B=L.dy,k=-L.dx,U=D.dy,V=-D.dx,W=D.x,H=D.y;if(0!=(D.flags&z.PT_LEFT)){var G=this._chooseBevel(D.flags&z.PT_INNERBEVEL,L,D,P),nt=G[0],ut=G[1],ft=G[2],gt=G[3],mt=vt(-k,-B),yt=vt(-V,-U);yt>mt&&(yt-=2*X),this._vset(nt,ut),this._vset(W-B*N,D.y-k*N);for(var Tt=x(dt((mt-yt)/X)*F,2,F),xt=0;xt<Tt;xt++){var St=mt+xt/(Tt-1)*(yt-mt),bt=W+_t(St)*N,wt=H+pt(St)*N;this._vset(W,H),this._vset(bt,wt)}this._vset(ft,gt),this._vset(W-U*N,H-V*N)}else{var Rt=this._chooseBevel(D.flags&z.PT_INNERBEVEL,L,D,-N),It=Rt[0],Mt=Rt[1],Ot=Rt[2],Lt=Rt[3],Dt=vt(k,B),Pt=vt(V,U);Pt<Dt&&(Pt+=2*X),this._vset(W+B*N,H+k*N),this._vset(It,Mt);for(var Nt=x(dt((Pt-Dt)/X)*F,2,F),Ft=0;Ft<Nt;Ft++){var Bt=Dt+Ft/(Nt-1)*(Pt-Dt),kt=W+_t(Bt)*P,Ut=H+pt(Bt)*P;this._vset(kt,Ut),this._vset(W,H)}this._vset(W+U*N,H+V*N),this._vset(Ot,Lt)}},D._bevelJoin=function(L,D,P,N){var F,B,k,U,V,W,H,G,X=L.dy,nt=-L.dx,ut=D.dy,dt=-D.dx;if(D.flags&z.PT_LEFT){var ft=this._chooseBevel(D.flags&z.PT_INNERBEVEL,L,D,P);V=ft[0],W=ft[1],H=ft[2],G=ft[3],this._vset(V,W),this._vset(D.x-X*N,D.y-nt*N),this._vset(H,G),this._vset(D.x-ut*N,D.y-dt*N)}else{var _t=this._chooseBevel(D.flags&z.PT_INNERBEVEL,L,D,-N);F=_t[0],B=_t[1],k=_t[2],U=_t[3],this._vset(D.x+X*P,D.y+nt*P),this._vset(F,B),this._vset(D.x+ut*P,D.y+dt*P),this._vset(k,U)}},D._vset=function(L,D){var P=this._buffer,N=P.meshbuffer,F=3*P.vertexStart,B=N._vData,k=N._uintVData;B[F]=L,B[F+1]=D,k[F+2]=this._curColor,P.vertexStart++,N._dirty=!0},e}(N.default);P.default=gt,N.default.register(cc.Graphics,gt),D.exports=P.default},{"../../../../../renderer/core/input-assembler":242,"../../../../graphics/graphics":110,"../../../../graphics/types":113,"../../../assembler":165,"../../../index":168,"../../mesh-buffer":195,"../../vertex-format":200,"./earcut":177,"./impl":178}],180:[function(L,D,P){"use strict";cc.assemblers={},L("./sprite"),L("./mask-assembler"),L("./graphics"),L("./label"),L("./motion-streak")},{"./graphics":179,"./label":184,"./mask-assembler":185,"./motion-streak":186,"./sprite":193}],181:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=0,F=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(){this._renderData.createFlexData(0,4,6,this.getVfmt())},D._reserveQuads=function(L,D){var P=4*D,F=6*D,B=this._renderData._flexBuffer;B.reserve(P,F),B.used(P,F);for(var k=this._renderData.iDatas[0],U=0,V=0,z=F;U<z;U+=6,V+=4)k[U]=V,k[U+1]=V+1,k[U+2]=V+2,k[U+3]=V+1,k[U+4]=V+3,k[U+5]=V+2;N=0},D._quadsUpdated=function(L){N=0,this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount)},D._getColor=function(L){return L.node._color._val},D.appendQuad=function(L,D,P,F,B,k,U){var V=this._renderData,z=V.vDatas[0],W=V.uintVDatas[0];this.verticesCount+=4,this.indicesCount=this.verticesCount/2*3;var H,G,X,nt,ut=D.width,dt=D.height,ft=P.width,_t=P.height,pt=this._getColor(L),vt=this.floatsPerVert,gt=N+this.uvOffset;F?(H=P.x/ut,X=(P.x+_t)/ut,G=(P.y+ft)/dt,nt=P.y/dt,z[gt]=H,z[gt+1]=nt,z[gt+=vt]=H,z[gt+1]=G,z[gt+=vt]=X,z[gt+1]=nt,z[gt+=vt]=X,z[gt+1]=G):(H=P.x/ut,X=(P.x+ft)/ut,G=(P.y+_t)/dt,nt=P.y/dt,z[gt]=H,z[gt+1]=G,z[gt+=vt]=X,z[gt+1]=G,z[gt+=vt]=H,z[gt+1]=nt,z[gt+=vt]=X,z[gt+1]=nt),H=B,X=B+ft*U,G=k-_t*U,nt=k,this.appendVerts(L,N,H,X,G,nt);for(var mt=N+this.colorOffset,yt=0;yt<4;yt++)W[mt]=pt,mt+=vt;N+=4*this.floatsPerVert},D.appendVerts=function(L,D,P,N,F,B){var k=this._local,U=this.floatsPerVert;k[D]=P,k[D+1]=F,k[D+=U]=N,k[D+1]=F,k[D+=U]=P,k[D+1]=B,k[D+=U]=N,k[D+1]=B},D.updateWorldVerts=function(L){for(var D=L.node._worldMatrix.m,P=D[0],N=D[1],F=D[4],B=D[5],k=D[12],U=D[13],V=this._local,z=this._renderData.vDatas[0],W=this.floatsPerVert,H=0;H<V.length;H+=W){var G=V[H],X=V[H+1];z[H]=G*P+X*F+k,z[H+1]=G*N+X*B+U}},e}(function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../utils/label/bmfont")).default);P.default=F,D.exports=P.default},{"../../../../utils/label/bmfont":172}],182:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0,L("../../../../../platform/js"),L("./bmfont");var N=L("../../../../utils/label/letter-font"),F=cc.color(255,255,255,255),B=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.createData=function(L){return L.requestRenderData()},D._getColor=function(L){return F._fastSetA(L.node._color.a),F._val},D.updateColor=function(D){var P=this._getColor(D);L.prototype.updateColor.call(this,D,P)},e}(N);P.default=B,D.exports=P.default},{"../../../../../platform/js":157,"../../../../utils/label/letter-font":174,"./bmfont":181}],183:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../utils/label/ttf"));var F=L("../../../../../components/CCLabelShadow"),B=cc.color(255,255,255,255),k=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.updateUVs=function(L){for(var D=this._renderData.vDatas[0],P=L._frame.uv,N=this.uvOffset,F=this.floatsPerVert,B=0;B<4;B++){var k=2*B,U=F*B+N;D[U]=P[k],D[U+1]=P[k+1]}},D.updateColor=function(D){B._fastSetA(D.node._color.a);var P=B._val;L.prototype.updateColor.call(this,D,P)},D.updateVerts=function(L){var D=L.node,P=L._ttfTexture.width,N=L._ttfTexture.height,B=D.anchorX*D.width,k=D.anchorY*D.height,U=F&&L.getComponent(F);if(U&&U._enabled){var V=(P-D.width)/2,z=(N-D.height)/2,W=U.offset;-W.x>V?B+=P-D.width:V>W.x&&(B+=V-W.x),-W.y>z?k+=N-D.height:z>W.y&&(k+=z-W.y)}var H=this._local;H[0]=-B,H[1]=-k,H[2]=P-B,H[3]=N-k,this.updateUVs(L),this.updateWorldVerts(L)},e}(N.default);P.default=k,D.exports=P.default},{"../../../../../components/CCLabelShadow":77,"../../../../utils/label/ttf":175}],184:[function(L,D,P){"use strict";var N=u(L("../../../assembler")),F=u(L("../../../../components/CCLabel")),B=u(L("./2d/ttf")),k=u(L("./2d/bmfont")),U=u(L("./2d/letter")),V=u(L("./3d/ttf")),z=u(L("./3d/bmfont")),W=u(L("./3d/letter"));function u(L){return L&&L.__esModule?L:{default:L}}F.default._canvasPool={pool:[],get:function(){var L=this.pool.pop();if(!L){var D=document.createElement("canvas");L={canvas:D,context:D.getContext("2d")}}return L},put:function(L){this.pool.length>=32||this.pool.push(L)}},N.default.register(cc.Label,{getConstructor:function(L){var D=L.node.is3DNode,P=D?V.default:B.default;return L.font instanceof cc.BitmapFont?P=D?z.default:k.default:L.cacheMode===F.default.CacheMode.CHAR&&(cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?cc.warn("sorry, subdomain does not support CHAR mode currently!"):P=D?W.default:U.default),P},TTF:B.default,Bmfont:k.default,Letter:U.default,TTF3D:V.default,Bmfont3D:z.default,Letter3D:W.default})},{"../../../../components/CCLabel":75,"../../../assembler":165,"./2d/bmfont":181,"./2d/letter":182,"./2d/ttf":183,"./3d/bmfont":void 0,"./3d/letter":void 0,"./3d/ttf":void 0}],185:[function(L,D,P){"use strict";P.__esModule=!0,P.MaskAssembler=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../assembler"));var F=L("../../../components/CCMask"),B=L("../../render-flow"),k=L("./sprite/2d/simple"),U=L("./graphics"),V=L("../../../../renderer/gfx"),z=L("../vertex-format").vfmtPos,W=[];function f(){return 1<<W.length-1}function p(L,D,P,N,F,B){var k=L.effect,U=V.STENCIL_OP_KEEP,z=V.STENCIL_OP_KEEP;k.setStencil(V.STENCIL_ENABLE,D,N,F,P,U,z,B)}function T(L){var D=V.DS_FUNC_EQUAL,P=V.STENCIL_OP_KEEP,N=function(){for(var L=0,D=0;D<W.length;++D)L+=1<<D;return L}(),F=N,B=f(),k=W[W.length-1];p(k._enableMaterial,D,P,N,F,B),L._flushMaterial(k._enableMaterial)}var H=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.updateRenderData=function(L){L._type===F.Type.IMAGE_STENCIL?L.spriteFrame?k.prototype.updateRenderData.call(this,L):L.setMaterial(0,null):(L._graphics.setMaterial(0,L._materials[0]),U.prototype.updateRenderData.call(L._graphics._assembler,L._graphics,L._graphics))},D.fillBuffers=function(L,D){(L._type!==F.Type.IMAGE_STENCIL||L.spriteFrame)&&(function(L){W.length+1>8&&cc.errorID(9e3,8),W.push(L)}(L),function(L,D){var P=V.DS_FUNC_NEVER,N=f(),F=N,B=N,k=L.inverted?V.STENCIL_OP_REPLACE:V.STENCIL_OP_ZERO;p(L._clearMaterial,P,k,N,F,B);var U=D.getBuffer("mesh",z),W=U.request(4,6),H=W.indiceOffset,G=W.byteOffset>>2,X=W.vertexOffset,nt=U._vData,ut=U._iData;nt[G++]=-1,nt[G++]=-1,nt[G++]=-1,nt[G++]=1,nt[G++]=1,nt[G++]=1,nt[G++]=1,nt[G++]=-1,ut[H++]=X,ut[H++]=X+3,ut[H++]=X+1,ut[H++]=X+1,ut[H++]=X+3,ut[H++]=X+2,D.node=D._dummyNode,D.material=L._clearMaterial,D._flush()}(L,D),function(L,D){var P=V.DS_FUNC_NEVER,N=f(),B=N,z=N,W=L.inverted?V.STENCIL_OP_ZERO:V.STENCIL_OP_REPLACE;p(L._materials[0],P,W,N,B,z),D.material=L._materials[0],L._type===F.Type.IMAGE_STENCIL?(D.node=D._dummyNode,k.prototype.fillBuffers.call(L._assembler,L,D),D._flush()):(D.node=L.node,U.prototype.fillBuffers.call(L._graphics._assembler,L._graphics,D))}(L,D),T(D)),L.node._renderFlag|=B.FLAG_UPDATE_RENDER_DATA},D.postFillBuffers=function(L,D){(L._type!==F.Type.IMAGE_STENCIL||L.spriteFrame)&&function(L,D){0===W.length&&cc.errorID(9001),W.pop(),0===W.length?D._flushMaterial(L._exitMaterial):T(D)}(L,D),L.node._renderFlag|=B.FLAG_UPDATE_RENDER_DATA},e}(k);P.MaskAssembler=H,N.default.register(F,H)},{"../../../../renderer/gfx":252,"../../../components/CCMask":79,"../../assembler":165,"../../render-flow":169,"../vertex-format":200,"./graphics":179,"./sprite/2d/simple":190}],186:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../assembler-2d"));var F=L("../../../components/CCMotionStreak"),B=L("../../render-flow");function o(L,D){this.point=L||cc.v2(),this.dir=D||cc.v2(),this.distance=0,this.time=0}o.prototype.setPoint=function(L,D){this.point.x=L,this.point.y=D},o.prototype.setDir=function(L,D){this.dir.x=L,this.dir.y=D},cc.v2(),cc.v2();var k=cc.v2(),U=cc.v2();function h(L,D){return L.x=-D.y,L.y=D.x,L}var V=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(){this._renderData.createFlexData(0,16,42)},D.update=function(L,D){var P,N=L._stroke/2,F=L.node._worldMatrix.m,B=F[12],V=F[13],z=L._points;if(z.length>1){var W=z[0].point.x-B,H=z[0].point.y-V;W*W+H*H<L.minSeg&&(P=z[0])}P||(P=new o,z.splice(0,0,P)),P.setPoint(B,V),P.time=L._fadeTime+D;var G,X=0;if(!(z.length<2)){var nt=L._color,ut=nt.r,dt=nt.g,ft=nt.b,_t=nt.a,pt=z[1];pt.distance=P.point.sub(pt.point,U).mag(),U.normalizeSelf(),pt.setDir(U.x,U.y),P.setDir(U.x,U.y);var vt=this._renderData._flexBuffer;vt.reserve(2*z.length,6*(z.length-1));for(var gt=vt.vData,mt=vt.uintVData,yt=L._fadeTime,Tt=!1,xt=z.length-1;xt>=0;xt--){var St=z[xt],bt=St.point,wt=St.dir;if(St.time-=D,St.time<0)z.splice(xt,1);else{var Rt=St.time/yt,It=z[xt-1];if(!Tt){if(!It){z.splice(xt,1);continue}bt.x=It.point.x-wt.x*Rt,bt.y=It.point.y-wt.y*Rt}Tt=!0,h(k,wt);var Mt=(Rt*_t<<24>>>0)+(ft<<16)+(dt<<8)+ut,Ot=5*X;gt[Ot]=bt.x+k.x*N,gt[Ot+1]=bt.y+k.y*N,gt[Ot+2]=1,gt[Ot+3]=Rt,mt[Ot+4]=Mt,gt[Ot+=5]=bt.x-k.x*N,gt[Ot+1]=bt.y-k.y*N,gt[Ot+2]=0,gt[Ot+3]=Rt,mt[Ot+4]=Mt,X+=2}}G=X<=2?0:3*(X-2),vt.used(X,G)}},D.fillBuffers=function(L,D){var P=this._renderData._flexBuffer,N=P.vData,F=P.usedVertices,k=P.usedIndices,U=P.usedVerticesFloats,V=D._meshBuffer,z=V.request(F,k),W=z.byteOffset>>2,H=V._vData;N.length+W>H.length?H.set(N.subarray(0,U),W):H.set(N,W);for(var G=V._iData,X=z.indiceOffset,nt=z.vertexOffset,ut=0,dt=F;ut<dt;ut+=2){var ft=nt+ut;G[X++]=ft,G[X++]=ft+2,G[X++]=ft+1,G[X++]=ft+1,G[X++]=ft+2,G[X++]=ft+3}L.node._renderFlag|=B.FLAG_UPDATE_RENDER_DATA},e}(N.default);P.default=V,V.register(F,V),D.exports=P.default},{"../../../components/CCMotionStreak":80,"../../assembler-2d":163,"../../render-flow":169}],187:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../assembler-2d"));var F=L("../../../../../components/CCSprite").FillType,B=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.updateRenderData=function(L){var D=L._spriteFrame;if(this.packToDynamicAtlas(L,D),L._vertsDirty){var P=L._fillStart,N=L._fillRange;N<0&&(P+=N,N=-N),N=(N=(N=P+N)>1?1:N)<0?0:N;var F=(P=(P=P>1?1:P)<0?0:P)+(N=(N-=P)<0?0:N);F=F>1?1:F,this.updateUVs(L,P,F),this.updateVerts(L,P,F),L._vertsDirty=!1}},D.updateUVs=function(L,D,P){var N,B,k,U,V,z,W,H,G,X,nt=L._spriteFrame,ut=nt._texture.width,dt=nt._texture.height,ft=nt._rect;nt._rotated?(N=ft.x/ut,B=(ft.y+ft.width)/dt,k=V=N,W=G=(ft.x+ft.height)/ut,z=X=B,U=H=ft.y/dt):(N=ft.x/ut,B=(ft.y+ft.height)/dt,k=W=N,V=G=(ft.x+ft.width)/ut,U=z=B,H=X=ft.y/dt);var _t=this._renderData.vDatas[0],pt=this.uvOffset,vt=this.floatsPerVert;switch(L._fillType){case F.HORIZONTAL:_t[pt]=k+(V-k)*D,_t[pt+1]=U+(z-U)*D,_t[pt+vt]=k+(V-k)*P,_t[pt+vt+1]=U+(z-U)*P,_t[pt+2*vt]=W+(G-W)*D,_t[pt+2*vt+1]=H+(X-H)*D,_t[pt+3*vt]=W+(G-W)*P,_t[pt+3*vt+1]=H+(X-H)*P;break;case F.VERTICAL:_t[pt]=k+(W-k)*D,_t[pt+1]=U+(H-U)*D,_t[pt+vt]=V+(G-V)*D,_t[pt+vt+1]=z+(X-z)*D,_t[pt+2*vt]=k+(W-k)*P,_t[pt+2*vt+1]=U+(H-U)*P,_t[pt+3*vt]=V+(G-V)*P,_t[pt+3*vt+1]=z+(X-z)*P;break;default:cc.errorID(2626)}},D.updateVerts=function(L,D,P){var N,B=L.node,k=B.width,U=B.height,V=B.anchorX*k,z=B.anchorY*U,W=-V,H=-z,G=k-V,X=U-z;switch(L._fillType){case F.HORIZONTAL:N=W+(G-W)*P,W+=(G-W)*D,G=N;break;case F.VERTICAL:N=H+(X-H)*P,H+=(X-H)*D,X=N;break;default:cc.errorID(2626)}var nt=this._local;nt[0]=W,nt[1]=H,nt[2]=G,nt[3]=X,this.updateWorldVerts(L)},e}(N.default);P.default=B,D.exports=P.default},{"../../../../../components/CCSprite":86,"../../../../assembler-2d":163}],188:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(L){this._renderData.createFlexData(0,4,6,this.getVfmt())},D.updateRenderData=function(L){this.packToDynamicAtlas(L,L._spriteFrame);var D=L.spriteFrame;if(D){var P=D.vertices;if(P){this.verticesCount=P.x.length,this.indicesCount=P.triangles.length;var N=this._renderData._flexBuffer;N.reserve(this.verticesCount,this.indicesCount)&&(this.updateColor(L),L._vertsDirty=!0),N.used(this.verticesCount,this.indicesCount),this.updateIndices(P.triangles),L._vertsDirty&&(this.updateUVs(L),this.updateVerts(L),this.updateWorldVerts(L),L._vertsDirty=!1)}}},D.updateIndices=function(L){this._renderData.iDatas[0].set(L)},D.updateUVs=function(L){for(var D=L.spriteFrame.vertices,P=D.nu,N=D.nv,F=this.uvOffset,B=this.floatsPerVert,k=this._renderData.vDatas[0],U=0;U<P.length;U++){var V=B*U+F;k[V]=P[U],k[V+1]=N[U]}},D.updateVerts=function(L){var D=L.node,P=Math.abs(D.width),N=Math.abs(D.height),F=D.anchorX*P,B=D.anchorY*N,k=L.spriteFrame,U=k.vertices,V=U.x,z=U.y,W=k._originalSize.width,H=k._originalSize.height,G=k._rect.width,X=k._rect.height,nt=k._offset.x+(W-G)/2,ut=k._offset.y+(H-X)/2,dt=P/(L.trim?G:W),ft=N/(L.trim?X:H),_t=this._local;if(L.trim)for(var pt=0,vt=V.length;pt<vt;pt++){var gt=2*pt;_t[gt]=(V[pt]-nt)*dt-F,_t[gt+1]=(H-z[pt]-ut)*ft-B}else for(var mt=0,yt=V.length;mt<yt;mt++){var Tt=2*mt;_t[Tt]=V[mt]*dt-F,_t[Tt+1]=(H-z[mt])*ft-B}},D.updateWorldVerts=function(L){for(var D=L.node._worldMatrix.m,P=D[0],N=D[1],F=D[4],B=D[5],k=D[12],U=D[13],V=this._local,z=this._renderData.vDatas[0],W=this.floatsPerVert,H=0,G=this.verticesCount;H<G;H++){var X=V[2*H],nt=V[2*H+1];z[W*H]=X*P+nt*F+k,z[W*H+1]=X*N+nt*B+U}},e}(function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../assembler-2d")).default);P.default=N,D.exports=P.default},{"../../../../assembler-2d":163}],189:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../assembler-2d"));var F=2*Math.PI,B=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],k=[0,0,0,0],U=[0,0,0,0,0,0,0,0],V=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],z=[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],W=cc.v2(0,0),H=[];function f(L,D,P,N,F,B,k){var U,V,z=Math.sin(B),W=Math.cos(B);if(0!==Math.cos(B)){if(U=z/W,(L-F.x)*W>0){var H=F.y+U*(L-F.x);k[0].x=L,k[0].y=H}if((D-F.x)*W>0){var G=F.y+U*(D-F.x);k[2].x=D,k[2].y=G}}if(0!==Math.sin(B)){if(V=W/z,(N-F.y)*z>0){var X=F.x+V*(N-F.y);k[3].x=X,k[3].y=N}if((P-F.y)*z>0){var nt=F.x+V*(P-F.y);k[1].x=nt,k[1].y=P}}}function v(L,D){var P,N;if(P=D.x-L.x,N=D.y-L.y,0!==P||0!==N){if(0===P)return N>0?.5*Math.PI:1.5*Math.PI;var F=Math.atan(N/P);return P<0&&(F+=Math.PI),F}}var G=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(L){this._renderData.createFlexData(0,4,6,this.getVfmt()),this.updateIndices()},D.updateRenderData=function(D){L.prototype.updateRenderData.call(this,D);var P=D.spriteFrame;if(this.packToDynamicAtlas(D,P),D._vertsDirty){var N=D._fillStart,G=D._fillRange;for(G<0&&(N+=G,G=-G);N>=1;)N-=1;for(;N<0;)N+=1;N*=F,G*=F,function(L){var D=L.node,P=D.width,N=D.height,F=D.anchorX*P,U=D.anchorY*N,V=-F,z=-U,G=P-F,X=N-U,nt=k;nt[0]=V,nt[1]=z,nt[2]=G,nt[3]=X;var ut=L._fillCenter,dt=W.x=Math.min(Math.max(0,ut.x),1)*(G-V)+V,ft=W.y=Math.min(Math.max(0,ut.y),1)*(X-z)+z;B[0].x=B[3].x=V,B[1].x=B[2].x=G,B[0].y=B[1].y=z,B[2].y=B[3].y=X,H.length=0,dt!==nt[0]&&(H[0]=[3,0]),dt!==nt[2]&&(H[2]=[1,2]),ft!==nt[1]&&(H[1]=[0,1]),ft!==nt[3]&&(H[3]=[2,3])}(D),function(L){var D,P,N,F,B=L._texture.width,k=L._texture.height,V=L._rect,z=U;L._rotated?(D=V.x/B,P=(V.x+V.height)/B,N=V.y/k,F=(V.y+V.width)/k,z[0]=z[2]=D,z[4]=z[6]=P,z[3]=z[7]=F,z[1]=z[5]=N):(D=V.x/B,P=(V.x+V.width)/B,N=V.y/k,F=(V.y+V.height)/k,z[0]=z[4]=D,z[2]=z[6]=P,z[1]=z[3]=F,z[5]=z[7]=N)}(P),f(k[0],k[2],k[1],k[3],W,N,V),f(k[0],k[2],k[1],k[3],W,N+G,z),this.updateVerts(D,N,G),D._vertsDirty=!1}},D.updateVerts=function(L,D,P){var N=D+P,k=this._local;k.length=0;for(var U=0,G=3*this.floatsPerVert,X=0;X<4;++X){var nt=H[X];if(nt)if(P>=F)k.length=U+G,this._generateTriangle(k,U,W,B[nt[0]],B[nt[1]]),U+=G;else{var ut=v(W,B[nt[0]]),dt=v(W,B[nt[1]]);dt<ut&&(dt+=F),ut-=F,dt-=F;for(var ft=0;ft<3;++ft)ut>=N||(ut>=D?(k.length=U+G,dt>=N?this._generateTriangle(k,U,W,B[nt[0]],z[X]):this._generateTriangle(k,U,W,B[nt[0]],B[nt[1]]),U+=G):dt<=D||(dt<=N?(k.length=U+G,this._generateTriangle(k,U,W,V[X],B[nt[1]]),U+=G):(k.length=U+G,this._generateTriangle(k,U,W,V[X],z[X]),U+=G))),ut+=F,dt+=F}}this.allocWorldVerts(L),this.updateWorldVerts(L)},D.allocWorldVerts=function(L){var D=L.node._color._val,P=this._renderData,N=this.floatsPerVert,F=this._local,B=F.length/N;this.verticesCount=this.indicesCount=B;var k=P._flexBuffer;k.reserve(B,B)&&this.updateIndices(),k.used(this.verticesCount,this.indicesCount);for(var U=P.vDatas[0],V=P.uintVDatas[0],z=this.uvOffset,W=0;W<F.length;W+=N){var H=W+z;U[H]=F[H],U[H+1]=F[H+1],V[H+2]=D}},D.updateIndices=function(){for(var L=this._renderData.iDatas[0],D=0;D<L.length;D++)L[D]=D},D.updateWorldVerts=function(L){for(var D=L.node._worldMatrix.m,P=D[0],N=D[1],F=D[4],B=D[5],k=D[12],U=D[13],V=this._local,z=this._renderData.vDatas[0],W=this.floatsPerVert,H=0;H<V.length;H+=W){var G=V[H],X=V[H+1];z[H]=G*P+X*F+k,z[H+1]=G*N+X*B+U}},D._generateTriangle=function(L,D,P,N,F){var B=k[0],U=k[1],V=k[2],z=k[3],W=this.floatsPerVert;L[D]=P.x,L[D+1]=P.y,L[D+W]=N.x,L[D+W+1]=N.y,L[D+2*W]=F.x,L[D+2*W+1]=F.y;var H,G,X=this.uvOffset;H=(P.x-B)/(V-B),G=(P.y-U)/(z-U),this._generateUV(H,G,L,D+X),H=(N.x-B)/(V-B),G=(N.y-U)/(z-U),this._generateUV(H,G,L,D+W+X),H=(F.x-B)/(V-B),G=(F.y-U)/(z-U),this._generateUV(H,G,L,D+2*W+X)},D._generateUV=function(L,D,P,N){var F=U[0]+(U[2]-U[0])*L,B=U[4]+(U[6]-U[4])*L,k=U[1]+(U[3]-U[1])*L,V=U[5]+(U[7]-U[5])*L;P[N]=F+(B-F)*D,P[N+1]=k+(V-k)*D},e}(N.default);P.default=G,D.exports=P.default},{"../../../../assembler-2d":163}],190:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.updateRenderData=function(L){this.packToDynamicAtlas(L,L._spriteFrame),L._vertsDirty&&(this.updateUVs(L),this.updateVerts(L),L._vertsDirty=!1)},D.updateUVs=function(L){for(var D=L._spriteFrame.uv,P=this.uvOffset,N=this.floatsPerVert,F=this._renderData.vDatas[0],B=0;B<4;B++){var k=2*B,U=N*B+P;F[U]=D[k],F[U+1]=D[k+1]}},D.updateVerts=function(L){var D,P,N,F,B=L.node,k=B.width,U=B.height,V=B.anchorX*k,z=B.anchorY*U;if(L.trim)D=-V,P=-z,N=k-V,F=U-z;else{var W=L.spriteFrame,H=W._originalSize.width,G=W._originalSize.height,X=W._rect.width,nt=W._rect.height,ut=W._offset,dt=k/H,ft=U/G,_t=ut.x+(H-X)/2,pt=ut.x-(H-X)/2;D=_t*dt-V,P=(ut.y+(G-nt)/2)*ft-z,N=k+pt*dt-V,F=U+(ut.y-(G-nt)/2)*ft-z}var vt=this._local;vt[0]=D,vt[1]=P,vt[2]=N,vt[3]=F,this.updateWorldVerts(L)},e}(function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../assembler-2d")).default);P.default=N,D.exports=P.default},{"../../../../assembler-2d":163}],191:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(L){if(!(this._renderData.meshCount>0)){this._renderData.createData(0,this.verticesFloats,this.indicesCount);for(var D=this._renderData.iDatas[0],P=0,N=0;N<3;++N)for(var F=0;F<3;++F){var B=4*N+F;D[P++]=B,D[P++]=B+1,D[P++]=B+4,D[P++]=B+1,D[P++]=B+5,D[P++]=B+4}}},D.initLocal=function(){this._local=[],this._local.length=8},D.updateRenderData=function(L){var D=L._spriteFrame;this.packToDynamicAtlas(L,D),L._vertsDirty&&(this.updateUVs(L),this.updateVerts(L),L._vertsDirty=!1)},D.updateVerts=function(L){var D=L.node,P=D.width,N=D.height,F=D.anchorX*P,B=D.anchorY*N,k=L.spriteFrame,U=k.insetLeft,V=k.insetRight,z=k.insetTop,W=k.insetBottom,H=P-U-V,G=N-z-W,X=P/(U+V),nt=N/(z+W);X=isNaN(X)||X>1?1:X,nt=isNaN(nt)||nt>1?1:nt,H=H<0?0:H,G=G<0?0:G;var ut=this._local;ut[0]=-F,ut[1]=-B,ut[2]=U*X-F,ut[3]=W*nt-B,ut[4]=ut[2]+H,ut[5]=ut[3]+G,ut[6]=P-F,ut[7]=N-B,this.updateWorldVerts(L)},D.updateUVs=function(L){for(var D=this._renderData.vDatas[0],P=L.spriteFrame.uvSliced,N=this.uvOffset,F=this.floatsPerVert,B=0;B<4;++B)for(var k=0;k<4;++k){var U=4*B+k,V=P[U],z=U*F;D[z+N]=V.u,D[z+N+1]=V.v}},D.updateWorldVerts=function(L){for(var D=L.node._worldMatrix.m,P=D[0],N=D[1],F=D[4],B=D[5],k=D[12],U=D[13],V=this._local,z=this._renderData.vDatas[0],W=this.floatsPerVert,H=0;H<4;++H)for(var G=V[2*H+1],X=0;X<4;++X){var nt=V[2*X],ut=(4*H+X)*W;z[ut]=nt*P+G*F+k,z[ut+1]=nt*N+G*B+U}},e}(function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../assembler-2d")).default);P.default=N,Object.assign(N.prototype,{verticesCount:16,indicesCount:54}),D.exports=P.default},{"../../../../assembler-2d":163}],192:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.initData=function(L){this.verticesCount=0,this.contentWidth=0,this.contentHeight=0,this.rectWidth=0,this.rectHeight=0,this.hRepeat=0,this.vRepeat=0,this.row=0,this.col=0,this._renderData.createFlexData(0,4,6,this.getVfmt()),this._updateIndices()},D.initLocal=function(){this._local={x:[],y:[]}},D._updateIndices=function(){for(var L=this._renderData.iDatas[0],D=0,P=0,N=L.length;D<N;D+=6,P+=4)L[D]=P,L[D+1]=P+1,L[D+2]=P+2,L[D+3]=P+1,L[D+4]=P+3,L[D+5]=P+2},D.updateRenderData=function(L){var D=L._spriteFrame;this.packToDynamicAtlas(L,D);var P=L.node,N=this.contentWidth=Math.abs(P.width),F=this.contentHeight=Math.abs(P.height),B=D._rect,k=this.rectWidth=B.width,U=this.rectHeight=B.height,V=this.hRepeat=N/k,z=this.vRepeat=F/U,W=(this.row=Math.ceil(z))*(this.col=Math.ceil(V));this.verticesCount=4*W,this.indicesCount=6*W;var H=this._renderData._flexBuffer;H.reserve(this.verticesCount,this.indicesCount)&&(this._updateIndices(),this.updateColor(L)),H.used(this.verticesCount,this.indicesCount),L._vertsDirty&&(this.updateUVs(L),this.updateVerts(L),L._vertsDirty=!1)},D.updateVerts=function(L){var D=L.node,P=D.anchorX*D.width,N=D.anchorY*D.height,F=this.row,B=this.col,k=this.rectWidth,U=this.rectHeight,V=this.contentWidth,z=this.contentHeight,W=this._local,H=W.x,G=W.y;H.length=G.length=0;for(var X=0;X<=B;++X)H[X]=Math.min(k*X,V)-P;for(var nt=0;nt<=F;++nt)G[nt]=Math.min(U*nt,z)-N;this.updateWorldVerts(L)},D.updateWorldVerts=function(L){for(var D,P,N,F,B=this._renderData,k=this._local,U=k.x,V=k.y,z=B.vDatas[0],W=this.row,H=this.col,G=L.node._worldMatrix.m,X=G[0],nt=G[1],ut=G[4],dt=G[5],ft=G[12],_t=G[13],pt=this.floatsPerVert,vt=0,gt=0,mt=W;gt<mt;++gt){N=V[gt],F=V[gt+1];for(var yt=0,Tt=H;yt<Tt;++yt)D=U[yt],P=U[yt+1],z[vt]=D*X+N*ut+ft,z[vt+1]=D*nt+N*dt+_t,z[vt+=pt]=P*X+N*ut+ft,z[vt+1]=P*nt+N*dt+_t,z[vt+=pt]=D*X+F*ut+ft,z[vt+1]=D*nt+F*dt+_t,z[vt+=pt]=P*X+F*ut+ft,z[vt+1]=P*nt+F*dt+_t,vt+=pt}},D.updateUVs=function(L){var D=this._renderData.vDatas[0];if(D)for(var P=this.row,N=this.col,F=this.hRepeat,B=this.vRepeat,k=L.spriteFrame.uv,U=L.spriteFrame._rotated,V=this.floatsPerVert,z=this.uvOffset,W=0,H=P;W<H;++W)for(var G=Math.min(1,B-W),X=0,nt=N;X<nt;++X){var ut=Math.min(1,F-X);U?(D[z]=k[0],D[z+1]=k[1],D[z+=V]=k[0],D[z+1]=k[1]+(k[7]-k[1])*ut,D[z+=V]=k[0]+(k[6]-k[0])*G,D[z+1]=k[1],D[z+=V]=D[z-V],D[z+1]=D[z+1-2*V],z+=V):(D[z]=k[0],D[z+1]=k[1],D[z+=V]=k[0]+(k[6]-k[0])*ut,D[z+1]=k[1],D[z+=V]=k[0],D[z+1]=k[1]+(k[7]-k[1])*G,D[z+=V]=D[z-2*V],D[z+1]=D[z+1-V],z+=V)}},e}(function(L){return L&&L.__esModule?L:{default:L}}(L("../../../../assembler-2d")).default);P.default=N,D.exports=P.default},{"../../../../assembler-2d":163}],193:[function(L,D,P){"use strict";var N=g(L("../../../assembler")),F=L("../../../../components/CCSprite"),B=g(L("./2d/simple")),k=g(L("./2d/sliced")),U=g(L("./2d/tiled")),V=g(L("./2d/radial-filled")),z=g(L("./2d/bar-filled")),W=g(L("./2d/mesh")),H=g(L("./3d/simple")),G=g(L("./3d/sliced")),X=g(L("./3d/tiled")),nt=g(L("./3d/radial-filled")),ut=g(L("./3d/bar-filled")),dt=g(L("./3d/mesh"));function g(L){return L&&L.__esModule?L:{default:L}}var ft={getConstructor:function(L){var D=L.node.is3DNode,P=D?H.default:B.default;switch(L.type){case F.Type.SLICED:P=D?G.default:k.default;break;case F.Type.TILED:P=D?X.default:U.default;break;case F.Type.FILLED:P=L._fillType===F.FillType.RADIAL?D?nt.default:V.default:D?ut.default:z.default;break;case F.Type.MESH:P=D?dt.default:W.default}return P},Simple:B.default,Sliced:k.default,Tiled:U.default,RadialFilled:V.default,BarFilled:z.default,Mesh:W.default,Simple3D:H.default,Sliced3D:G.default,Tiled3D:X.default,RadialFilled3D:nt.default,BarFilled3D:ut.default,Mesh3D:dt.default};N.default.register(cc.Sprite,ft)},{"../../../../components/CCSprite":86,"../../../assembler":165,"./2d/bar-filled":187,"./2d/mesh":188,"./2d/radial-filled":189,"./2d/simple":190,"./2d/sliced":191,"./2d/tiled":192,"./3d/bar-filled":void 0,"./3d/mesh":void 0,"./3d/radial-filled":void 0,"./3d/simple":void 0,"./3d/sliced":void 0,"./3d/tiled":void 0}],194:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(L,D,P,N,F){this._handler=L,this._index=D,this._vfmt=F,this._verticesBytes=F._bytes,this._initVerticesCount=P,this._initIndicesCount=N,this.reset()}var L=t.prototype;return L._reallocVData=function(L,D){this.vData=new Float32Array(L),this.uintVData=new Uint32Array(this.vData.buffer),D&&this.vData.set(D),this._handler.updateMesh(this._index,this.vData,this.iData)},L._reallocIData=function(L,D){this.iData=new Uint16Array(L),D&&this.iData.set(D),this._handler.updateMesh(this._index,this.vData,this.iData)},L.reserve=function(L,D){var P=L*this._verticesBytes>>2,N=this.vData.length,F=!1;if(P>N){for(;N<P;)N*=2;this._reallocVData(N,this.vData),F=!0}var B=this.iData.length;if(D>B){for(;B<D;)B*=2;this._reallocIData(D,this.iData),F=!0}return F},L.used=function(L,D){this.usedVertices=L,this.usedIndices=D,this.usedVerticesFloats=L*this._verticesBytes>>2,this._handler.updateMeshRange(L,D)},L.reset=function(){var L=this._initVerticesCount*this._verticesBytes>>2;this._reallocVData(L),this._reallocIData(this._initIndicesCount),this.usedVertices=0,this.usedVerticesFloats=0,this.usedIndices=0},t}();P.default=N,cc.FlexBuffer=N,D.exports=P.default},{}],195:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../renderer/gfx")),F=cc.Class({name:"cc.MeshBuffer",ctor:function(L,D){this.init(L,D)},init:function(L,D){this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1,this._vertexFormat=D,this._vertexBytes=this._vertexFormat._bytes,this._arrOffset=0,this._vbArr=[],this._vb=new N.default.VertexBuffer(L._device,D,N.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[0]=this._vb,this._ibArr=[],this._ib=new N.default.IndexBuffer(L._device,N.default.INDEX_FMT_UINT16,N.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[0]=this._ib,this._vData=null,this._uintVData=null,this._iData=null,this._batcher=L,this._initVDataCount=256*D._bytes,this._initIDataCount=1536,this._offsetInfo={byteOffset:0,vertexOffset:0,indiceOffset:0},this._reallocBuffer()},uploadData:function(){if(0!==this.byteOffset&&this._dirty){var L=new Float32Array(this._vData.buffer,0,this.byteOffset>>2),D=new Uint16Array(this._iData.buffer,0,this.indiceOffset);this._vb.update(0,L),this._ib.update(0,D),this._dirty=!1}},switchBuffer:function(){var L=++this._arrOffset;this.byteOffset=0,this.vertexOffset=0,this.indiceOffset=0,this.indiceStart=0,L<this._vbArr.length?(this._vb=this._vbArr[L],this._ib=this._ibArr[L]):(this._vb=new N.default.VertexBuffer(this._batcher._device,this._vertexFormat,N.default.USAGE_DYNAMIC,new ArrayBuffer,0),this._vbArr[L]=this._vb,this._ib=new N.default.IndexBuffer(this._batcher._device,N.default.INDEX_FMT_UINT16,N.default.USAGE_STATIC,new ArrayBuffer,0),this._ibArr[L]=this._ib)},checkAndSwitchBuffer:function(L){this.vertexOffset+L>65535&&(this.uploadData(),this._batcher._flush(),this.switchBuffer())},requestStatic:function(L,D){this.checkAndSwitchBuffer(L);var P=this.byteOffset+L*this._vertexBytes,N=this.indiceOffset+D,F=this._vData.byteLength,B=this._iData.length;if(P>F||N>B){for(;F<P||B<N;)this._initVDataCount*=2,this._initIDataCount*=2,F=4*this._initVDataCount,B=this._initIDataCount;this._reallocBuffer()}this._updateOffset(L,D,P)},_updateOffset:function(L,D,P){var N=this._offsetInfo;N.vertexOffset=this.vertexOffset,this.vertexOffset+=L,N.indiceOffset=this.indiceOffset,this.indiceOffset+=D,N.byteOffset=this.byteOffset,this.byteOffset=P,this._dirty=!0},request:function(L,D){return this._batcher._buffer!==this&&(this._batcher._flush(),this._batcher._buffer=this),this.requestStatic(L,D),this._offsetInfo},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(!0)},_reallocVData:function(L){var D;this._vData&&(D=new Uint8Array(this._vData.buffer)),this._vData=new Float32Array(this._initVDataCount),this._uintVData=new Uint32Array(this._vData.buffer);var P=new Uint8Array(this._uintVData.buffer);if(D&&L)for(var N=0,F=D.length;N<F;N++)P[N]=D[N]},_reallocIData:function(L){var D=this._iData;if(this._iData=new Uint16Array(this._initIDataCount),D&&L)for(var P=this._iData,N=0,F=D.length;N<F;N++)P[N]=D[N]},reset:function(){this._arrOffset=0,this._vb=this._vbArr[0],this._ib=this._ibArr[0],this.byteOffset=0,this.indiceOffset=0,this.vertexOffset=0,this.indiceStart=0,this._dirty=!1},destroy:function(){this.reset();for(var L=0;L<this._vbArr.length;L++)this._vbArr[L].destroy();this._vbArr=null;for(var D=0;D<this._ibArr.length;D++)this._ibArr[D].destroy();this._ibArr=null,this._ib=null,this._vb=null},forwardIndiceStartToOffset:function(){this.indiceStart=this.indiceOffset}});cc.MeshBuffer=D.exports=F},{"../../../renderer/gfx":252}],196:[function(L,D,P){"use strict";var N=a(L("../../../renderer/core/input-assembler")),F=a(L("../../../renderer/memop/recycle-pool")),B=a(L("../../../renderer/scene/model"));function a(L){return L&&L.__esModule?L:{default:L}}var k=L("./vertex-format"),U=k.vfmtPosUvColor,V=k.vfmt3D,z=L("./quad-buffer"),W=L("./mesh-buffer"),H=L("./spine-buffer"),G=L("../../assets/material/CCMaterial"),X=(new(L("../../platform/id-generater"))("VertextFormat"),{}),nt=new G,ut=new N.default;ut._count=0;var g=function(L,D){this._renderScene=D,this._device=L,this.walking=!1,this.material=nt,this.cullingMask=1,this._iaPool=new F.default((function(){return new N.default}),16),this._modelPool=new F.default((function(){return new B.default}),16),this._quadBuffer=this.getBuffer("quad",U),this._meshBuffer=this.getBuffer("mesh",U),this._quadBuffer3D=this.getBuffer("quad",V),this._meshBuffer3D=this.getBuffer("mesh",V),this._buffer=this._meshBuffer,this._batchedModels=[],this._dummyNode=new cc.Node,this._sortKey=0,this.node=this._dummyNode,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0};g.prototype={constructor:g,reset:function(){this._iaPool.reset();for(var L=this._renderScene,D=this._batchedModels,P=0;P<D.length;++P)D[P].setInputAssembler(null),D[P].setEffect(null),L.removeModel(D[P]);for(var N in this._modelPool.reset(),D.length=0,this._sortKey=0,X)X[N].reset();this._buffer=this._meshBuffer,this.node=this._dummyNode,this.material=nt,this.cullingMask=1,this.parentOpacity=1,this.parentOpacityDirty=0,this.worldMatDirty=0},_flushMaterial:function(L){if(L){this.material=L;var D=L.effect;if(D){var P=this._modelPool.add();this._batchedModels.push(P),P.sortKey=this._sortKey++,P._cullingMask=this.cullingMask,P.setNode(this.node),P.setEffect(D,null),P.setInputAssembler(ut),this._renderScene.addModel(P)}}},_flush:function(){var L=this.material,D=this._buffer,P=D.indiceOffset-D.indiceStart;if(this.walking&&L&&!(P<=0)){var N=L.effect;if(N){var F=this._iaPool.add();F._vertexBuffer=D._vb,F._indexBuffer=D._ib,F._start=D.indiceStart,F._count=P;var B=this._modelPool.add();this._batchedModels.push(B),B.sortKey=this._sortKey++,B._cullingMask=this.cullingMask,B.setNode(this.node),B.setEffect(N),B.setInputAssembler(F),this._renderScene.addModel(B),D.forwardIndiceStartToOffset()}}},_flushIA:function(L){if(L){var D=this.material.effect;if(D){var P=this._modelPool.add();this._batchedModels.push(P),P.sortKey=this._sortKey++,P._cullingMask=this.cullingMask,P.setNode(this.node),P.setEffect(D),P.setInputAssembler(L),this._renderScene.addModel(P)}}},terminate:function(){for(var L in cc.dynamicAtlasManager&&cc.dynamicAtlasManager.enabled&&cc.dynamicAtlasManager.update(),this._flush(),X)X[L].uploadData();this.walking=!1},getBuffer:function(L,D){var P=L+D.getHash(),N=X[P];if(!N){if("mesh"===L)N=new W(this,D);else if("quad"===L)N=new z(this,D);else{if("spine"!==L)return cc.error("Not support buffer type ["+L+"]"),null;N=new H(this,D)}X[P]=N}return N}},D.exports=g},{"../../../renderer/core/input-assembler":242,"../../../renderer/memop/recycle-pool":267,"../../../renderer/scene/model":273,"../../assets/material/CCMaterial":48,"../../platform/id-generater":153,"./mesh-buffer":195,"./quad-buffer":197,"./spine-buffer":199,"./vertex-format":200}],197:[function(L,D,P){"use strict";var N=L("./mesh-buffer"),F=cc.Class({name:"cc.QuadBuffer",extends:N,_fillQuadBuffer:function(){for(var L=this._initIDataCount/6,D=this._iData,P=0,N=0;P<L;P++){var F=4*P;D[N++]=F,D[N++]=F+1,D[N++]=F+2,D[N++]=F+1,D[N++]=F+3,D[N++]=F+2}var B=new Uint16Array(this._iData.buffer,0,6*L);this._ib.update(0,B)},uploadData:function(){if(0!==this.byteOffset&&this._dirty){var L=new Float32Array(this._vData.buffer,0,this.byteOffset>>2);this._vb.update(0,L),this._dirty=!1}},switchBuffer:function(){this._super();var L=new Uint16Array(this._iData.buffer,0,this._initIDataCount);this._ib.update(0,L)},_reallocBuffer:function(){this._reallocVData(!0),this._reallocIData(),this._fillQuadBuffer()}});cc.QuadBuffer=D.exports=F},{"./mesh-buffer":195}],198:[function(L,D,P){"use strict";P.__esModule=!0,P.default=s;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./flex-buffer")),F=L("./vertex-format");function s(){this.vDatas=[],this.uintVDatas=[],this.iDatas=[],this.meshCount=0,this._infos=null,this._flexBuffer=null}cc.js.mixin(s.prototype,{init:function(L){},clear:function(){this.vDatas.length=0,this.iDatas.length=0,this.uintVDatas.length=0,this.meshCount=0,this._infos=null,this._flexBuffer&&this._flexBuffer.reset()},updateMesh:function(L,D,P){this.vDatas[L]=D,this.uintVDatas[L]=new Uint32Array(D.buffer,0,D.length),this.iDatas[L]=P,this.meshCount=this.vDatas.length},updateMeshRange:function(L,D){},createData:function(L,D,P){var N=new Float32Array(D),F=new Uint16Array(P);this.updateMesh(L,N,F)},createQuadData:function(L,D,P){this.createData(L,D,P),this.initQuadIndices(this.iDatas[L])},createFlexData:function(L,D,P,B){B=B||F.vfmtPosUvColor,this._flexBuffer=new N.default(this,L,D,P,B)},initQuadIndices:function(L){for(var D=L.length/6,P=0,N=0;P<D;P++){var F=4*P;L[N++]=F,L[N++]=F+1,L[N++]=F+2,L[N++]=F+1,L[N++]=F+3,L[N++]=F+2}}}),cc.RenderData=s,D.exports=P.default},{"./flex-buffer":194,"./vertex-format":200}],199:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.SpineBuffer",extends:L("./mesh-buffer"),requestStatic:function(L,D){this.checkAndSwitchBuffer(L);var P=this.byteOffset+L*this._vertexBytes,N=this.indiceOffset+D,F=this._vData.byteLength,B=this._iData.length;if(P>F||N>B){for(;F<P||B<N;)this._initVDataCount*=2,this._initIDataCount*=2,F=4*this._initVDataCount,B=this._initIDataCount;this._reallocBuffer()}var k=this._offsetInfo;k.vertexOffset=this.vertexOffset,k.indiceOffset=this.indiceOffset,k.byteOffset=this.byteOffset},adjust:function(L,D){this.vertexOffset+=L,this.indiceOffset+=D,this.byteOffset=this.byteOffset+L*this._vertexBytes,this._dirty=!0}});cc.SpineBuffer=D.exports=N},{"./mesh-buffer":195}],200:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../../renderer/gfx")),F=new N.default.VertexFormat([{name:N.default.ATTR_POSITION,type:N.default.ATTR_TYPE_FLOAT32,num:3},{name:N.default.ATTR_UV0,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_COLOR,type:N.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);F.name="vfmt3D",N.default.VertexFormat.XYZ_UV_Color=F;var B=new N.default.VertexFormat([{name:N.default.ATTR_POSITION,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_UV0,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_COLOR,type:N.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);B.name="vfmtPosUvColor",N.default.VertexFormat.XY_UV_Color=B;var k=new N.default.VertexFormat([{name:N.default.ATTR_POSITION,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_UV0,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_COLOR,type:N.default.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:N.default.ATTR_COLOR0,type:N.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);k.name="vfmtPosUvTwoColor",N.default.VertexFormat.XY_UV_Two_Color=k;var U=new N.default.VertexFormat([{name:N.default.ATTR_POSITION,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_UV0,type:N.default.ATTR_TYPE_FLOAT32,num:2}]);U.name="vfmtPosUv",N.default.VertexFormat.XY_UV=U;var V=new N.default.VertexFormat([{name:N.default.ATTR_POSITION,type:N.default.ATTR_TYPE_FLOAT32,num:2},{name:N.default.ATTR_COLOR,type:N.default.ATTR_TYPE_UINT8,num:4,normalize:!0}]);V.name="vfmtPosColor",N.default.VertexFormat.XY_Color=V;var z=new N.default.VertexFormat([{name:N.default.ATTR_POSITION,type:N.default.ATTR_TYPE_FLOAT32,num:2}]);z.name="vfmtPos",N.default.VertexFormat.XY=z,D.exports={vfmt3D:F,vfmtPosUvColor:B,vfmtPosUvTwoColor:k,vfmtPosUv:U,vfmtPosColor:V,vfmtPos:z}},{"../../../renderer/gfx":252}],201:[function(L,D,P){"use strict";L("../platform/CCSys");var N=/(\.[^\.\/\?\\]*)(\?.*)?$/,F=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,B=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var L=arguments.length,D="",P=0;P<L;P++)D=(D+(""===D?"":"/")+arguments[P]).replace(/(\/|\\\\)$/,"");return D},extname:function(L){var D=N.exec(L);return D?D[1]:""},mainFileName:function(L){if(L){var D=L.lastIndexOf(".");if(-1!==D)return L.substring(0,D)}return L},basename:function(L,D){var P=L.indexOf("?");P>0&&(L=L.substring(0,P));var N=/(\/|\\)([^\/\\]+)$/g.exec(L.replace(/(\/|\\)$/,""));if(!N)return null;var F=N[2];return D&&L.substring(L.length-D.length).toLowerCase()===D.toLowerCase()?F.substring(0,F.length-D.length):F},dirname:function(L){var D=F.exec(L);return D?D[2]:""},changeExtname:function(L,D){D=D||"";var P=L.indexOf("?"),N="";return P>0&&(N=L.substring(P),L=L.substring(0,P)),(P=L.lastIndexOf("."))<0?L+D+N:L.substring(0,P)+D+N},changeBasename:function(L,D,P){if(0===D.indexOf("."))return this.changeExtname(L,D);var N=L.indexOf("?"),F="",B=P?this.extname(L):"";return N>0&&(F=L.substring(N),L=L.substring(0,N)),N=(N=L.lastIndexOf("/"))<=0?0:N+1,L.substring(0,N)+D+B+F},_normalize:function(L){var D=L=String(L);do{D=L,L=L.replace(B,"")}while(D.length!==L.length);return L},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(L){return L.replace(/[\/\\]$/,"")}},D.exports=cc.path},{"../platform/CCSys":146}],202:[function(L,D,P){"use strict";var n=function(L,D,P,N,F,B){this.a=L,this.b=D,this.c=P,this.d=N,this.tx=F,this.ty=B};n.create=function(L,D,P,N,F,B){return{a:L,b:D,c:P,d:N,tx:F,ty:B}},n.identity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},n.clone=function(L){return{a:L.a,b:L.b,c:L.c,d:L.d,tx:L.tx,ty:L.ty}},n.concat=function(L,D,P){var N=D.a,F=D.b,B=D.c,k=D.d,U=D.tx,V=D.ty;return L.a=N*P.a+F*P.c,L.b=N*P.b+F*P.d,L.c=B*P.a+k*P.c,L.d=B*P.b+k*P.d,L.tx=U*P.a+V*P.c+P.tx,L.ty=U*P.b+V*P.d+P.ty,L},n.invert=function(L,D){var P=D.a,N=D.b,F=D.c,B=D.d,k=1/(P*B-N*F),U=D.tx,V=D.ty;return L.a=k*B,L.b=-k*N,L.c=-k*F,L.d=k*P,L.tx=k*(F*V-B*U),L.ty=k*(N*U-P*V),L},n.fromMat4=function(L,D){var P=D.m;return L.a=P[0],L.b=P[1],L.c=P[4],L.d=P[5],L.tx=P[12],L.ty=P[13],L},n.transformVec2=function(L,D,P,N){var F,B;return void 0===N?(N=P,F=D.x,B=D.y):(F=D,B=P),L.x=N.a*F+N.c*B+N.tx,L.y=N.b*F+N.d*B+N.ty,L},n.transformSize=function(L,D,P){return L.width=P.a*D.width+P.c*D.height,L.height=P.b*D.width+P.d*D.height,L},n.transformRect=function(L,D,P){var N=D.x,F=D.y,B=N+D.width,k=F+D.height,U=P.a*N+P.c*F+P.tx,V=P.b*N+P.d*F+P.ty,z=P.a*B+P.c*F+P.tx,W=P.b*B+P.d*F+P.ty,H=P.a*N+P.c*k+P.tx,G=P.b*N+P.d*k+P.ty,X=P.a*B+P.c*k+P.tx,nt=P.b*B+P.d*k+P.ty,ut=Math.min(U,z,H,X),dt=Math.max(U,z,H,X),ft=Math.min(V,W,G,nt),_t=Math.max(V,W,G,nt);return L.x=ut,L.y=ft,L.width=dt-ut,L.height=_t-ft,L},n.transformObb=function(L,D,P,N,F,B){var k=F.x,U=F.y,V=F.width,z=F.height,W=B.a*k+B.c*U+B.tx,H=B.b*k+B.d*U+B.ty,G=B.a*V,X=B.b*V,nt=B.c*z,ut=B.d*z;D.x=W,D.y=H,P.x=G+W,P.y=X+H,L.x=nt+W,L.y=ut+H,N.x=G+nt+W,N.y=X+ut+H},cc.AffineTransform=D.exports=n},{}],203:[function(L,D,P){"use strict";var N=L("../platform/CCObject").Flags,F=L("./misc"),B=L("../platform/js"),k=L("../platform/id-generater"),U=L("../event-manager"),V=L("../renderer/render-flow"),z=N.Destroying,W=N.DontDestroy,H=N.Deactivating,G=new k("Node");function f(L){return L?"string"==typeof L?B.getClassByName(L):L:(cc.errorID(3804),null)}function _(L,D){if(D._sealed)for(var P=0;P<L._components.length;++P){var N=L._components[P];if(N.constructor===D)return N}else for(var F=0;F<L._components.length;++F){var B=L._components[F];if(B instanceof D)return B}return null}function p(L,D,P){if(D._sealed)for(var N=0;N<L._components.length;++N){var F=L._components[N];F.constructor===D&&P.push(F)}else for(var B=0;B<L._components.length;++B){var k=L._components[B];k instanceof D&&P.push(k)}}var X=cc.Class({name:"cc._BaseNode",extends:cc.Object,properties:{_parent:null,_children:[],_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&W)>0},set:function(L){L?this._objFlags|=W:this._objFlags&=~W}},name:{get:function(){return this._name},set:function(L){this._name=L}},uuid:{get:function(){return this._id}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(L){if(L=!!L,this._active!==L){this._active=L;var D=this._parent;D&&D._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,L)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(L){this._name=void 0!==L?L:"New Node",this._activeInHierarchy=!1,this._id=G.getNewId(),cc.director._scheduler&&cc.director._scheduler.enableForTarget(this),this.__eventTargets=[]},getParent:function(){return this._parent},setParent:function(L){if(this._parent!==L){var D=this._parent;if(this._parent=L||null,this._onSetParent(L),L&&(U._setDirtyForNode(this),L._children.push(this),L.emit&&L.emit("child-added",this),L._renderFlag|=V.FLAG_CHILDREN),D){if(!(D._objFlags&z)){var P=D._children.indexOf(this);D._children.splice(P,1),D.emit&&D.emit("child-removed",this),this._onHierarchyChanged(D),0===D._children.length&&(D._renderFlag&=~V.FLAG_CHILDREN)}}else L&&this._onHierarchyChanged(null)}},attr:function(L){B.mixin(this,L)},getChildByUuid:function(L){if(!L)return cc.log("Invalid uuid"),null;for(var D=this._children,P=0,N=D.length;P<N;P++)if(D[P]._id===L)return D[P];return null},getChildByName:function(L){if(!L)return cc.log("Invalid name"),null;for(var D=this._children,P=0,N=D.length;P<N;P++)if(D[P]._name===L)return D[P];return null},addChild:function(L){cc.assertID(L,1606),cc.assertID(null===L._parent,1605),L.setParent(this)},insertChild:function(L,D){L.parent=this,L.setSiblingIndex(D)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(L){if(this._parent)if(this._parent._objFlags&H)cc.errorID(3821);else{var D=this._parent._children;L=-1!==L?L:D.length-1;var P=D.indexOf(this);L!==P&&(D.splice(P,1),L<D.length?D.splice(L,0,this):D.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(L))}},walk:function(L,D){var P,N,F,B,k=cc._BaseNode,U=1,V=k._stacks[k._stackId];V||(V=[],k._stacks.push(V)),k._stackId++,V.length=0,V[0]=this;var z=null;for(B=!1;U;)if(N=V[--U])if(!B&&L?L(N):B&&D&&D(N),V[U]=null,B){if(B=!1,P)if(P[++F])V[U]=P[F],U++;else if(z&&(V[U]=z,U++,B=!0,z._parent?(F=(P=z._parent._children).indexOf(z),z=z._parent):(z=null,P=null),F<0))break}else N._children.length>0?(z=N,P=N._children,F=0,V[U]=P[F],U++):(V[U]=N,U++,B=!0);V.length=0,k._stackId--},cleanup:function(){},removeFromParent:function(L){this._parent&&(void 0===L&&(L=!0),this._parent.removeChild(this,L))},removeChild:function(L,D){this._children.indexOf(L)>-1&&((D||void 0===D)&&L.cleanup(),L.parent=null)},removeAllChildren:function(L){var D=this._children;void 0===L&&(L=!0);for(var P=D.length-1;P>=0;P--){var N=D[P];N&&(L&&N.cleanup(),N.parent=null)}this._children.length=0},isChildOf:function(L){var D=this;do{if(D===L)return!0;D=D._parent}while(D);return!1},getComponent:function(L){var D=f(L);return D?_(this,D):null},getComponents:function(L){var D=f(L),P=[];return D&&p(this,D,P),P},getComponentInChildren:function(L){var D=f(L);return D?function v(L,D){for(var P=0;P<L.length;++P){var N=L[P],F=_(N,D);if(F)return F;if(N._children.length>0&&(F=v(N._children,D)))return F}return null}(this._children,D):null},getComponentsInChildren:function(L){var D=f(L),P=[];return D&&(p(this,D,P),function g(L,D,P){for(var N=0;N<L.length;++N){var F=L[N];p(F,D,P),F._children.length>0&&g(F._children,D,P)}}(this._children,D,P)),P},_checkMultipleComp:!1,addComponent:function(L){var D;if("string"==typeof L){if(!(D=B.getClassByName(L)))return cc.errorID(3807,L),cc._RFpeek()&&cc.errorID(3808,L),null}else{if(!L)return cc.errorID(3804),null;D=L}if("function"!=typeof D)return cc.errorID(3809),null;if(!B.isChildClassOf(D,cc.Component))return cc.errorID(3810),null;var P=D._requireComponent;if(P&&!this.getComponent(P)&&!this.addComponent(P))return null;var N=new D;return N.node=this,this._components.push(N),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(N),N},_addComponentAt:!1,removeComponent:function(L){L?(L instanceof cc.Component||(L=this.getComponent(L)),L&&L.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(L){if(L){if(!(this._objFlags&z)){var D=this._components.indexOf(L);-1!==D?this._components.splice(D,1):L.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},destroy:function(){cc.Object.prototype.destroy.call(this)&&(this.active=!1)},destroyAllChildren:function(){for(var L=this._children,D=0;D<L.length;++D)L[D].destroy()},_onSetParent:function(L){},_onPostActivated:function(){},_onBatchRestored:function(){},_onBatchCreated:function(){},_onHierarchyChanged:function(L){var D=this._parent;!this._persistNode||D instanceof cc.Scene||cc.game.removePersistRootNode(this);var P=this._active&&!(!D||!D._activeInHierarchy);this._activeInHierarchy!==P&&cc.director._nodeActivator.activateNode(this,P)},_instantiate:function(L){L||(L=cc.instantiate._clone(this,this));var D=this._prefab;return D&&this===D.root&&D.sync,L._parent=null,L._onBatchRestored(),L},_registerIfAttached:!1,_onPreDestroy:function(){var L,D;this._objFlags|=z;var P=this._parent,N=P&&P._objFlags&z,F=this._children;for(L=0,D=F.length;L<D;++L)F[L]._destroyImmediate();for(L=0,D=this._components.length;L<D;++L)this._components[L]._destroyImmediate();var B=this.__eventTargets;for(L=0,D=B.length;L<D;++L){var k=B[L];k&&k.targetOff(this)}if(B.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!N&&P){var U=P._children.indexOf(this);P._children.splice(U,1),P.emit&&P.emit("child-removed",this)}return N},onRestore:!1});X.idGenerater=G,X._stacks=[[]],X._stackId=0,X.prototype._onPreDestroyBase=X.prototype._onPreDestroy,X.prototype._onHierarchyChangedBase=X.prototype._onHierarchyChanged,F.propertyDefine(X,["parent","name","children","childrenCount"],{}),cc._BaseNode=D.exports=X},{"../event-manager":104,"../platform/CCObject":143,"../platform/id-generater":153,"../platform/js":157,"../renderer/render-flow":169,"./misc":210}],204:[function(L,D,P){"use strict";var N=1e-6;D.exports={binarySearchEpsilon:function(L,D){for(var P=0,F=L.length-1,B=F>>>1;P<=F;B=P+F>>>1){var k=L[B];if(k>D+N)F=B-1;else{if(!(k<D-N))return B;P=B+1}}return~P}}},{}],205:[function(L,D,P){"use strict";var N=L("../components/CCRenderComponent"),F=L("../platform/CCMacro").BlendFactor,B=L("../../renderer/gfx"),k=cc.Class({properties:{_srcBlendFactor:F.SRC_ALPHA,_dstBlendFactor:F.ONE_MINUS_SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(L){this._srcBlendFactor!==L&&(this._srcBlendFactor=L,this._updateBlendFunc())},animatable:!1,type:F,tooltip:!1,visible:!0},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(L){this._dstBlendFactor!==L&&(this._dstBlendFactor=L,this._updateBlendFunc())},animatable:!1,type:F,tooltip:!1,visible:!0}},setMaterial:function(L,D){N.prototype.setMaterial.call(this,L,D),this._srcBlendFactor===F.SRC_ALPHA&&this._dstBlendFactor===F.ONE_MINUS_SRC_ALPHA||this._updateMaterialBlendFunc(D)},_updateMaterial:function(){this._updateBlendFunc()},_updateBlendFunc:function(){if(this._srcBlendFactor!==F.SRC_ALPHA||this._dstBlendFactor!==F.ONE_MINUS_SRC_ALPHA)for(var L=this.getMaterials(),D=0;D<L.length;D++){var P=L[D];this._updateMaterialBlendFunc(P)}},_updateMaterialBlendFunc:function(L){L.setBlend(!0,B.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor,B.BLEND_FUNC_ADD,this._srcBlendFactor,this._dstBlendFactor)}});D.exports=cc.BlendFunc=k},{"../../renderer/gfx":252,"../components/CCRenderComponent":84,"../platform/CCMacro":142}],206:[function(L,D,P){"use strict";var N=L("./misc").BASE64_VALUES,F="0123456789abcdef".split(""),B=["","","",""],k=B.concat(B,"-",B,"-",B,"-",B,"-",B,B,B),U=k.map((function(L,D){return"-"===L?NaN:D})).filter(isFinite);D.exports=function(L){if(22!==L.length)return L;k[0]=L[0],k[1]=L[1];for(var D=2,P=2;D<22;D+=2){var B=N[L.charCodeAt(D)],V=N[L.charCodeAt(D+1)];k[U[P++]]=F[B>>2],k[U[P++]]=F[(3&B)<<2|V>>4],k[U[P++]]=F[15&V]}return k.join("")}},{"./misc":210}],207:[function(L,D,P){"use strict";cc.find=D.exports=function(L,D){if(null==L)return cc.errorID(5600),null;if(D);else{var P=cc.director.getScene();if(!P)return null;D=P}for(var N=D,F="/"!==L[0]?0:1,B=L.split("/"),k=F;k<B.length;k++){var U=B[k],V=N._children;N=null;for(var z=0,W=V.length;z<W;++z){var H=V[z];if(H.name===U){N=H;break}}if(!N)return null}return N}},{}],208:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../assets/material/material-variant")),F=L("../assets/material/CCMaterial"),B=cc.Class({properties:{_normalMaterial:null,normalMaterial:{get:function(){return this._normalMaterial},set:function(L){this._normalMaterial=L,this._updateDisabledState&&this._updateDisabledState()},type:F,tooltip:!1,animatable:!1},_grayMaterial:null,grayMaterial:{get:function(){return this._grayMaterial},set:function(L){this._grayMaterial=L,this._updateDisabledState&&this._updateDisabledState()},type:F,tooltip:!1,animatable:!1}},_switchGrayMaterial:function(L,D){var P;L?((P=this._grayMaterial)||(P=F.getBuiltinMaterial("2d-gray-sprite")),P=this._grayMaterial=N.default.create(P,D)):((P=this._normalMaterial)||(P=F.getBuiltinMaterial("2d-sprite",D)),P=this._normalMaterial=N.default.create(P,D)),D.setMaterial(0,P)}});D.exports=B},{"../assets/material/CCMaterial":48,"../assets/material/material-variant":55}],209:[function(L,D,P){"use strict";L("./CCPath"),L("./profiler/CCProfiler"),L("./find"),L("./mutable-forward-iterator")},{"./CCPath":201,"./find":207,"./mutable-forward-iterator":211,"./profiler/CCProfiler":214}],210:[function(L,D,P){"use strict";for(var N=L("../platform/js"),F={propertyDefine:function(L,D,P){function r(L,D,P,F){var B=Object.getOwnPropertyDescriptor(L,D);if(B)B.get&&(L[P]=B.get),B.set&&F&&(L[F]=B.set);else{var k=L[P];N.getset(L,D,k,L[F])}}for(var F,B=L.prototype,k=0;k<D.length;k++){var U=(F=D[k])[0].toUpperCase()+F.slice(1);r(B,F,"get"+U,"set"+U)}for(F in P){var V=P[F];r(B,F,V[0],V[1])}},NextPOT:function(L){return L-=1,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,1+(L|=L>>16)},BUILTIN_CLASSID_RE:/^(?:cc|dragonBones|sp|ccsg)\..+/},B=new Array(123),k=0;k<123;++k)B[k]=64;for(var U=0;U<64;++U)B["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(U)]=U;F.BASE64_VALUES=B,F.pushToMap=function(L,D,P,N){var F=L[D];F?Array.isArray(F)?N?(F.push(F[0]),F[0]=P):F.push(P):L[D]=N?[P,F]:[F,P]:L[D]=P},F.clampf=function(L,D,P){if(D>P){var N=D;D=P,P=N}return L<D?D:L<P?L:P},F.clamp01=function(L){return L<0?0:L<1?L:1},F.lerp=function(L,D,P){return L+(D-L)*P},F.degreesToRadians=function(L){return L*cc.macro.RAD},F.radiansToDegrees=function(L){return L*cc.macro.DEG},cc.misc=D.exports=F},{"../platform/js":157}],211:[function(L,D,P){"use strict";function n(L){this.i=0,this.array=L}var N=n.prototype;N.remove=function(L){var D=this.array.indexOf(L);D>=0&&this.removeAt(D)},N.removeAt=function(L){this.array.splice(L,1),L<=this.i&&--this.i},N.fastRemove=function(L){var D=this.array.indexOf(L);D>=0&&this.fastRemoveAt(D)},N.fastRemoveAt=function(L){var D=this.array;D[L]=D[D.length-1],--D.length,L<=this.i&&--this.i},N.push=function(L){this.array.push(L)},D.exports=n},{}],212:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(){this.enabled=!1,this.count=0,this.maxSize=1024}var L=t.prototype;return L.get=function(){},L.put=function(){},L.clear=function(){},t}();P.default=N,cc.pool={},N.register=function(L,D){cc.pool[L]=D},D.exports=P.default},{}],213:[function(L,D,P){"use strict";cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),D.exports={syncWithPrefab:function(L){var D=L._prefab;if(D._synced=!0,!D.asset)return cc.errorID(3701,L.name),void(L._prefab=null);var P=L._objFlags,N=L._parent,F=L._id,B=L._name,k=L._active,U=L._eulerAngles.x,V=L._eulerAngles.y,z=L._eulerAngles.z,W=L._localZOrder,H=L._globalZOrder,G=L._trs,X=G[0],nt=G[1],ut=G[2];cc.game._isCloning=!0,D.asset._doInstantiate(L),cc.game._isCloning=!1,L._objFlags=P,L._parent=N,L._id=F,L._prefab=D,L._name=B,L._active=k,L._localZOrder=W,L._globalZOrder=H,(G=L._trs)[0]=X,G[1]=nt,G[2]=ut,L._eulerAngles.x=U,L._eulerAngles.y=V,L._eulerAngles.z=z}}},{}],214:[function(L,D,P){"use strict";var N=L("../../platform/CCMacro"),F=L("./perf-counter"),B=!1,k=null,U=null,V=null;function d(){!function(){if(!U||!U.isValid){(U=new cc.Node("PROFILER-NODE")).x=U.y=10,U.groupIndex=cc.Node.BuiltinGroupIndex.DEBUG,cc.Camera._setupDebugCamera(),U.zIndex=N.MAX_ZINDEX,cc.game.addPersistRootNode(U);var L=new cc.Node("LEFT-PANEL");L.anchorX=L.anchorY=0;var D=L.addComponent(cc.Label);D.fontSize=15,D.lineHeight=15,L.parent=U;var P=new cc.Node("RIGHT-PANEL");P.anchorX=1,P.anchorY=0,P.x=200;var F=P.addComponent(cc.Label);F.horizontalAlign=cc.Label.HorizontalAlign.RIGHT,F.fontSize=15,F.lineHeight=15,P.parent=U,cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_GAME_SUB&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(D.cacheMode=cc.Label.CacheMode.CHAR,F.cacheMode=cc.Label.CacheMode.CHAR),V={left:D,right:F}}}();var L=cc.director._lastUpdate;k.frame._counter.start(L),k.logic._counter.start(L)}function f(){var L=performance.now();cc.director.isPaused()?k.frame._counter.start(L):k.logic._counter.end(L),k.render._counter.start(L)}function _(){var L=performance.now();k.render._counter.end(L),k.draws._counter.value=cc.renderer.drawCalls,k.frame._counter.end(L),k.fps._counter.frame(L);var D="",P="";for(var N in k){var F=k[N];F._counter.sample(L),D+=F.desc+"\n",P+=F._counter.human()+"\n"}V&&(V.left.string=D,V.right.string=P)}cc.profiler=D.exports={isShowingStats:function(){return B},hideStats:function(){B&&(U&&(U.active=!1),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,d),cc.director.off(cc.Director.EVENT_AFTER_UPDATE,f),cc.director.off(cc.Director.EVENT_AFTER_DRAW,_),B=!1)},showStats:function(){B||(function(){if(!k){k={frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc.game.renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}};var L=performance.now();for(var D in k)k[D]._counter=new F(D,k[D],L)}}(),U&&(U.active=!0),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,d),cc.director.on(cc.Director.EVENT_AFTER_UPDATE,f),cc.director.on(cc.Director.EVENT_AFTER_DRAW,_),B=!0)}}},{"../../platform/CCMacro":142,"./perf-counter":216}],215:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.Counter",ctor:function(L,D,P){this._id=L,this._opts=D||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=P},properties:{value:{get:function(){return this._value},set:function(L){this._value=L}}},_average:function(L,D){if(this._opts.average){this._accumValue+=L,++this._accumSamples;var P=D;P-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=P,this._accumSamples=0)}},sample:function(L){this._average(this._value,L)},human:function(){var L=this._opts.average?this._averageValue:this._value;return Math.round(100*L)/100},alarm:function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over}});D.exports=N},{}],216:[function(L,D,P){"use strict";var N=L("./counter"),F=cc.Class({name:"cc.PerfCounter",extends:N,ctor:function(L,D,P){this._time=P},start:function(L){this._time=L},end:function(L){this._value=L-this._time,this._average(this._value)},tick:function(){this.end(),this.start()},frame:function(L){var D=L,P=D-this._time;this._total++,P>(this._opts.average||1e3)&&(this._value=1e3*this._total/P,this._total=0,this._time=D,this._average(this._value))}});D.exports=F},{"./counter":215}],217:[function(L,D,P){"use strict";var N=.26,F=new(function(L){return L&&L.__esModule?L:{default:L}}(L("../platform/js")).default.Pool)(2);function s(L){this.count=0,this.limit=L,this.datas={},this.head=null,this.tail=null}F.get=function(){return this._get()||{key:null,value:null,prev:null,next:null}},s.prototype.moveToHead=function(L){L.next=this.head,L.prev=null,null!==this.head&&(this.head.prev=L),this.head=L,null===this.tail&&(this.tail=L),this.count++,this.datas[L.key]=L},s.prototype.put=function(L,D){var P=F.get();if(P.key=L,P.value=D,this.count>=this.limit){var N=this.tail;delete this.datas[N.key],this.count--,this.tail=N.prev,this.tail.next=null,N.prev=null,N.next=null,F.put(N)}this.moveToHead(P)},s.prototype.remove=function(L){null!==L.prev?L.prev.next=L.next:this.head=L.next,null!==L.next?L.next.prev=L.prev:this.tail=L.prev,delete this.datas[L.key],this.count--},s.prototype.get=function(L){var D=this.datas[L];return D?(this.remove(D),this.moveToHead(D),D.value):null},s.prototype.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},s.prototype.has=function(L){return!!this.datas[L]},s.prototype.delete=function(L){var D=this.datas[L];this.remove(D)};var B=new s(100),k={BASELINE_RATIO:N,MIDDLE_RATIO:.37,label_wordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430-\u044f\u0410-\u042f\u0401\u0451]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/,label_lastWordRex:/([a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]+$/,label_firstEnglish:/^[a-zA-Z0-9\xc4\xd6\xdc\xe4\xf6\xfc\xdf\xe9\xe8\xe7\xe0\xf9\xea\xe2\xee\xf4\xfb\u0430\xed\xec\xcd\xcc\xef\xc1\xc0\xe1\xe0\xc9\xc8\xd2\xd3\xf2\xf3\u0150\u0151\xd9\xda\u0170\xfa\u0171\xf1\xd1\xe6\xc6\u0153\u0152\xc3\xc2\xe3\xd4\xf5\u011b\u0161\u010d\u0159\u017e\xfd\xe1\xed\xe9\xf3\xfa\u016f\u0165\u010f\u0148\u011a\u0160\u010c\u0158\u017d\xc1\xcd\xc9\xd3\xda\u0164\u017c\u017a\u015b\xf3\u0144\u0142\u0119\u0107\u0105\u017b\u0179\u015a\xd3\u0143\u0141\u0118\u0106\u0104-\u044f\u0410-\u042f\u0401\u0451]/,label_firstEmoji:/^[\uD83C\uDF00-\uDFFF\uDC00-\uDE4F]/,label_lastEmoji:/([\uDF00-\uDFFF\uDC00-\uDE4F]+|\S)$/,label_wrapinspection:!0,__CHINESE_REG:/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,__JAPANESE_REG:/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,__KOREAN_REG:/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,isUnicodeCJK:function(L){return this.__CHINESE_REG.test(L)||this.__JAPANESE_REG.test(L)||this.__KOREAN_REG.test(L)},isUnicodeSpace:function(L){return(L=L.charCodeAt(0))>=9&&L<=13||32===L||133===L||160===L||5760===L||L>=8192&&L<=8202||8232===L||8233===L||8239===L||8287===L||12288===L},safeMeasureText:function(L,D,P){var N=(P||L.font)+""+D,F=B.get(N);if(null!==F)return F;var k=L.measureText(D),U=k&&k.width||0;return B.put(N,U),U},fragmentText:function(L,D,P,N){var F=[];if(0===L.length||P<0)return F.push(""),F;for(var B=L;D>P&&B.length>1;){for(var k=B.length*(P/D)|0,U=B.substring(k),V=D-N(U),z=U,W=0,H=0;V>P&&H++<10;)k*=P/V,k|=0,V=D-N(U=B.substring(k));for(H=0;V<=P&&H++<10;){if(U){var G=this.label_wordRex.exec(U);W=G?G[0].length:1,z=U}k+=W,V=D-N(U=B.substring(k))}0==(k-=W)&&(k=1,z=z.substring(1));var X,nt=B.substring(0,0+k);this.label_wrapinspection&&this.label_symbolRex.test(z||U)&&(0==(k-=(X=this.label_lastWordRex.exec(nt))?X[0].length:0)&&(k=1),z=B.substring(k),nt=B.substring(0,0+k)),this.label_firstEmoji.test(z)&&(X=this.label_lastEmoji.exec(nt))&&nt!==X[0]&&(k-=X[0].length,z=B.substring(k),nt=B.substring(0,0+k)),this.label_firstEnglish.test(z)&&(X=this.label_lastEnglish.exec(nt))&&nt!==X[0]&&(k-=X[0].length,z=B.substring(k),nt=B.substring(0,0+k)),(0===F.length||(nt=nt.trimLeft()).length>0)&&F.push(nt),D=N(B=z||U)}return(0===F.length||(B=B.trimLeft()).length>0)&&F.push(B),F}};cc.textUtils=D.exports=k},{"../platform/js":157}],218:[function(L,D,P){"use strict";var N=L("../assets/CCTexture2D"),F={loadImage:function(L,D,P){cc.assertID(L,3103);var F=cc.loader.getRes(L);return F?F.loaded?(D&&D.call(P,null,F),F):(F.once("load",(function(){D&&D.call(P,null,F)}),P),F):((F=new N).url=L,cc.loader.load({url:L,texture:F},(function(L,N){if(L)return D&&D.call(P,L||new Error("Unknown error"));N.handleLoadedTexture(),D&&D.call(P,null,N)})),F)},cacheImage:function(L,D){if(L&&D){var P=new N;P.initWithElement(D);var F={id:L,url:L,error:null,content:P,complete:!1};return cc.loader.flowOut(F),P}},postLoadTexture:function(L,D){L.loaded?D&&D():L.url?cc.loader.load({url:L.url,skips:L._isCompressed()?void 0:["Loader"]},(function(P,N){N&&(L.loaded||(L._nativeAsset=N)),D&&D(P)})):D&&D()}};cc.textureUtil=D.exports=F},{"../assets/CCTexture2D":45}],219:[function(L,D,P){"use strict";var N=L("./node-unit"),F=L("./node-mem-pool");D.exports={NodeMemPool:new F(N)}},{"./node-mem-pool":221,"./node-unit":222}],220:[function(L,D,P){"use strict";var n=function(L){this._unitClass=L,this._pool=[],this._findOrder=[]},N=n.prototype;N._initNative=function(){this._nativeMemPool=new renderer.MemPool},N._buildUnit=function(L){return new this._unitClass(L,this)},N._destroyUnit=function(L){this._pool[L]=null;for(var D=0,P=this._findOrder.length;D<P;D++){var N=this._findOrder[D];if(N&&N.unitID==L){this._findOrder.splice(D,1);break}}},N._findUnitID=function(){for(var L=0,D=this._pool;D[L];)L++;return L},N.pop=function(){for(var L=null,D=0,P=this._findOrder,N=this._pool,F=P.length;D<F;D++){var B=P[D];if(B&&B.hasSpace()){L=B;break}}if(!L){var k=this._findUnitID();L=this._buildUnit(k),N[k]=L,P.push(L),D=P.length-1}var U=P[0];return U!==L&&(P[0]=L,P[D]=U),L.pop()},N.push=function(L){var D=this._pool[L.unitID];return D.push(L.index),this._findOrder.length>1&&D.isAllFree()&&this._destroyUnit(L.unitID),D},D.exports=n},{}],221:[function(L,D,P){"use strict";var N=L("./mem-pool"),r=function(L){N.call(this,L)};!function(){var t=function(){};t.prototype=N.prototype,r.prototype=new t}();var F=r.prototype;F._initNative=function(){this._nativeMemPool=new renderer.NodeMemPool},F._destroyUnit=function(L){N.prototype._destroyUnit.call(this,L)},D.exports=r},{"./mem-pool":220}],222:[function(L,D,P){"use strict";var N=L("../../value-types/utils"),F=(Uint32Array,10*N.FLOAT_BYTES),B=16*N.FLOAT_BYTES,k=16*N.FLOAT_BYTES,U=(Uint32Array,Uint32Array,Int32Array,Uint8Array,Uint8Array,Uint32Array,N.FLOAT_BYTES,L("./unit-base")),c=function(L,D){U.call(this,L,D);var P=this._contentNum;this.trsList=new N.FLOAT_ARRAY_TYPE(10*P),this.localMatList=new N.FLOAT_ARRAY_TYPE(16*P),this.worldMatList=new N.FLOAT_ARRAY_TYPE(16*P);for(var V=0;V<P;V++){var z=this._spacesData[V];z.trs=new N.FLOAT_ARRAY_TYPE(this.trsList.buffer,V*F,10),z.localMat=new N.FLOAT_ARRAY_TYPE(this.localMatList.buffer,V*B,16),z.worldMat=new N.FLOAT_ARRAY_TYPE(this.worldMatList.buffer,V*k,16)}};(function(){var t=function(){};t.prototype=U.prototype,c.prototype=new t})(),D.exports=c},{"../../value-types/utils":232,"./unit-base":223}],223:[function(L,D,P){"use strict";var n=function(L,D,P){P=P||128,this.unitID=L,this._memPool=D,this._data=new Uint16Array(2),this._data[0]=0,this._data[1]=0,this._contentNum=P,this._signData=new Uint16Array(2*this._contentNum),this._spacesData=[];for(var N=0;N<P;N++){var F=2*N;this._signData[F+0]=N+1,this._signData[F+1]=0,this._spacesData[N]={index:N,unitID:L}}this._signData[2*(P-1)]=65535},N=n.prototype;N.hasSpace=function(){return 65535!==this._data[0]},N.isAllFree=function(){return 0==this._data[1]},N.pop=function(){var L=this._data[0];if(65535===L)return null;var D=L,P=2*D,N=this._spacesData[D];return this._signData[P+1]=1,this._data[0]=this._signData[P+0],this._data[1]++,N},N.push=function(L){var D=2*L;this._signData[D+1]=0,this._signData[D+0]=this._data[0],this._data[0]=L,this._data[1]--},N.dump=function(){for(var L=0,D=this._data[0],P="";65535!=D;)L++,P+=D+"->",D=this._signData[2*D+0];for(var N=0,F="",B=this._contentNum,k=0;k<B;k++)1==this._signData[2*k+1]&&(N++,F+=k+"->");var U=L+N;console.log("unitID:",this.unitID,"spaceNum:",L,"calc using num:",N,"store using num:",this._data[1],"calc total num:",U,"actually total num:",this._contentNum),console.log("free info:",P),console.log("using info:",F),N!=this._data[1]&&cc.error("using num error","calc using num:",N,"store using num:",this._data[1]),L+N!=this._contentNum&&cc.error("total num error","calc total num:",U,"actually total num:",this._contentNum)},D.exports=n},{}],224:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=a(L("./value-type")),F=a(L("../platform/CCClass")),B=a(L("../utils/misc"));function a(L){return L&&L.__esModule?L:{default:L}}function o(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}function c(L,D,P){return D&&o(L.prototype,D),P&&o(L,P),L}var k=function(L){function e(D,P,N,F){var B;return void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),void 0===F&&(F=255),(B=L.call(this)||this)._val=0,"object"==typeof D&&(P=D.g,N=D.b,F=D.a,D=D.r),B._val=(F<<24>>>0)+(N<<16)+(P<<8)+D,B}(function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D})(e,L),e.copy=function(L,D){return L.r=D.r,L.g=D.g,L.b=D.b,L.a=D.a,L},e.clone=function(L){return new e(L.r,L.g,L.b,L.a)},e.set=function(L,D,P,N,F){return void 0===D&&(D=255),void 0===P&&(P=255),void 0===N&&(N=255),void 0===F&&(F=255),L.r=D,L.g=P,L.b=N,L.a=F,L},e.fromHex=function(L,D){var P=(D>>24)/255,N=(D>>16&255)/255,F=(D>>8&255)/255,B=(255&D)/255;return L.r=P,L.g=N,L.b=F,L.a=B,L},e.add=function(L,D,P){return L.r=D.r+P.r,L.g=D.g+P.g,L.b=D.b+P.b,L.a=D.a+P.a,L},e.subtract=function(L,D,P){return L.r=D.r-P.r,L.g=D.g-P.g,L.b=D.b-P.b,L.a=D.a-P.a,L},e.multiply=function(L,D,P){return L.r=D.r*P.r,L.g=D.g*P.g,L.b=D.b*P.b,L.a=D.a*P.a,L},e.divide=function(L,D,P){return L.r=D.r/P.r,L.g=D.g/P.g,L.b=D.b/P.b,L.a=D.a/P.a,L},e.scale=function(L,D,P){return L.r=D.r*P,L.g=D.g*P,L.b=D.b*P,L.a=D.a*P,L},e.lerp=function(L,D,P,N){var F=D.r,B=D.g,k=D.b,U=D.a;return L.r=F+N*(P.r-F),L.g=B+N*(P.g-B),L.b=k+N*(P.b-k),L.a=U+N*(P.a-U),L},e.toArray=function(L,D,P){void 0===P&&(P=0);var N=D instanceof e||D.a>1?1/255:1;return L[P+0]=D.r*N,L[P+1]=D.g*N,L[P+2]=D.b*N,L[P+3]=D.a*N,L},e.fromArray=function(L,D,P){return void 0===P&&(P=0),D.r=255*L[P+0],D.g=255*L[P+1],D.b=255*L[P+2],D.a=255*L[P+3],D},c(e,null,[{key:"WHITE",get:function(){return new e(255,255,255,255)}},{key:"BLACK",get:function(){return new e(0,0,0,255)}},{key:"TRANSPARENT",get:function(){return new e(0,0,0,0)}},{key:"GRAY",get:function(){return new e(127.5,127.5,127.5)}},{key:"RED",get:function(){return new e(255,0,0)}},{key:"GREEN",get:function(){return new e(0,255,0)}},{key:"BLUE",get:function(){return new e(0,0,255)}},{key:"YELLOW",get:function(){return new e(255,235,4)}},{key:"ORANGE",get:function(){return new e(255,127,0)}},{key:"CYAN",get:function(){return new e(0,255,255)}},{key:"MAGENTA",get:function(){return new e(255,0,255)}}]);var D=e.prototype;return D.clone=function(){var L=new e;return L._val=this._val,L},D.equals=function(L){return L&&this._val===L._val},D.lerp=function(L,D,P){P=P||new e;var N=this.r,F=this.g,B=this.b,k=this.a;return P.r=N+(L.r-N)*D,P.g=F+(L.g-F)*D,P.b=B+(L.b-B)*D,P.a=k+(L.a-k)*D,P},D.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},D.getR=function(){return 255&this._val},D.setR=function(L){return L=~~B.default.clampf(L,0,255),this._val=(4294967040&this._val|L)>>>0,this},D.getG=function(){return(65280&this._val)>>8},D.setG=function(L){return L=~~B.default.clampf(L,0,255),this._val=(4294902015&this._val|L<<8)>>>0,this},D.getB=function(){return(16711680&this._val)>>16},D.setB=function(L){return L=~~B.default.clampf(L,0,255),this._val=(4278255615&this._val|L<<16)>>>0,this},D.getA=function(){return(4278190080&this._val)>>>24},D.setA=function(L){return L=~~B.default.clampf(L,0,255),this._val=(16777215&this._val|L<<24)>>>0,this},D.toCSS=function(L){return L&&"rgba"!==L?"rgb"===L?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(L):"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")"},D.fromHEX=function(L){L=0===L.indexOf("#")?L.substring(1):L;var D=parseInt(L.substr(0,2),16)||0,P=parseInt(L.substr(2,2),16)||0,N=parseInt(L.substr(4,2),16)||0,F=parseInt(L.substr(6,2),16)||255;return this._val=(F<<24>>>0)+(N<<16)+(P<<8)+D,this},D.toHEX=function(L){var D=[(this.r<16?"0":"")+(0|this.r).toString(16),(this.g<16?"0":"")+(0|this.g).toString(16),(this.b<16?"0":"")+(0|this.b).toString(16)],P=-1;if("#rgb"===L)for(P=0;P<D.length;++P)D[P].length>1&&(D[P]=D[P][0]);else if("#rrggbb"===L)for(P=0;P<D.length;++P)1===D[P].length&&(D[P]="0"+D[P]);else"#rrggbbaa"===L&&D.push((this.a<16?"0":"")+(0|this.a).toString(16));return D.join("")},D.toRGBValue=function(){return 16777215&this._val},D.fromHSV=function(L,D,P){var N,F,B;if(0===D)N=F=B=P;else if(0===P)N=F=B=0;else{1===L&&(L=0),L*=6,D=D,P=P;var k=Math.floor(L),U=L-k,V=P*(1-D),z=P*(1-D*U),W=P*(1-D*(1-U));switch(k){case 0:N=P,F=W,B=V;break;case 1:N=z,F=P,B=V;break;case 2:N=V,F=P,B=W;break;case 3:N=V,F=z,B=P;break;case 4:N=W,F=V,B=P;break;case 5:N=P,F=V,B=z}}return N*=255,F*=255,B*=255,this._val=(this.a<<24>>>0)+(B<<16)+(F<<8)+N,this},D.toHSV=function(){var L=this.r/255,D=this.g/255,P=this.b/255,N={h:0,s:0,v:0},F=Math.max(L,D,P),B=Math.min(L,D,P),k=0;return N.v=F,N.s=F?(F-B)/F:0,N.s?(k=F-B,N.h=L===F?(D-P)/k:D===F?2+(P-L)/k:4+(L-D)/k,N.h/=6,N.h<0&&(N.h+=1)):N.h=0,N},D.set=function(L){return L._val?this._val=L._val:(this.r=L.r,this.g=L.g,this.b=L.b,this.a=L.a),this},D._fastSetA=function(L){this._val=(16777215&this._val|L<<24)>>>0},D.multiply=function(L){var D=(255&this._val)*L.r>>8,P=(65280&this._val)*L.g>>8,N=(16711680&this._val)*L.b>>8,F=((4278190080&this._val)>>>8)*L.a;return this._val=4278190080&F|16711680&N|65280&P|255&D,this},c(e,[{key:"r",get:function(){return this.getR()},set:function(L){this.setR(L)}},{key:"g",get:function(){return this.getG()},set:function(L){this.setG(L)}},{key:"b",get:function(){return this.getB()},set:function(L){this.setB(L)}},{key:"a",get:function(){return this.getA()},set:function(L){this.setA(L)}}]),e}(N.default);P.default=k,k.div=k.divide,k.sub=k.subtract,k.mul=k.multiply,k.WHITE_R=k.WHITE,k.BLACK_R=k.BLACK,k.TRANSPARENT_R=k.TRANSPARENT,k.GRAY_R=k.GRAY,k.RED_R=k.RED,k.GREEN_R=k.GREEN,k.BLUE_R=k.BLUE,k.YELLOW_R=k.YELLOW,k.ORANGE_R=k.ORANGE,k.CYAN_R=k.CYAN,k.MAGENTA_R=k.MAGENTA,F.default.fastDefine("cc.Color",k,{r:0,g:0,b:0,a:255}),cc.Color=k,cc.color=function(L,D,P,N){return"string"==typeof L?(new k).fromHEX(L):"object"==typeof L?new k(L.r,L.g,L.b,L.a):new k(L,D,P,N)},D.exports=P.default},{"../platform/CCClass":137,"../utils/misc":210,"./value-type":233}],225:[function(L,D,P){"use strict";P.__esModule=!0;var N={Vec2:!0,Vec3:!0,Vec4:!0,Mat4:!0,Mat3:!0,Rect:!0,Size:!0,Color:!0,Quat:!0,Trs:!0};P.Trs=P.Quat=P.Color=P.Size=P.Rect=P.Mat3=P.Mat4=P.Vec4=P.Vec3=P.Vec2=void 0;var F=p(L("./vec2"));P.Vec2=F.default;var B=p(L("./vec3"));P.Vec3=B.default;var k=p(L("./vec4"));P.Vec4=k.default;var U=p(L("./mat4"));P.Mat4=U.default;var V=p(L("./mat3"));P.Mat3=V.default;var z=p(L("./rect"));P.Rect=z.default;var W=p(L("./size"));P.Size=W.default;var H=p(L("./color"));P.Color=H.default;var G=p(L("./quat"));P.Quat=G.default;var X=p(L("./trs"));P.Trs=X.default;var nt=L("./utils");function p(L){return L&&L.__esModule?L:{default:L}}Object.keys(nt).forEach((function(L){"default"!==L&&"__esModule"!==L&&(Object.prototype.hasOwnProperty.call(N,L)||(P[L]=nt[L]))})),cc.math=D.exports},{"./color":224,"./mat3":226,"./mat4":227,"./quat":228,"./rect":229,"./size":230,"./trs":231,"./utils":232,"./vec2":234,"./vec3":235,"./vec4":236}],226:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../value-types/utils"),F=function(L){return L&&L.__esModule?L:{default:L}}(L("./vec3")),B=function(){function t(L,D,P,F,B,k,U,V,z){if(void 0===L&&(L=1),void 0===D&&(D=0),void 0===P&&(P=0),void 0===F&&(F=0),void 0===B&&(B=1),void 0===k&&(k=0),void 0===U&&(U=0),void 0===V&&(V=0),void 0===z&&(z=1),this.m=void 0,L instanceof N.FLOAT_ARRAY_TYPE)this.m=L;else{this.m=new N.FLOAT_ARRAY_TYPE(9);var W=this.m;W[0]=L,W[1]=D,W[2]=P,W[3]=F,W[4]=B,W[5]=k,W[6]=U,W[7]=V,W[8]=z}}return t.create=function(L,D,P,N,F,B,k,U,V){return void 0===L&&(L=1),void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),void 0===F&&(F=1),void 0===B&&(B=0),void 0===k&&(k=0),void 0===U&&(U=0),void 0===V&&(V=1),new t(L,D,P,N,F,B,k,U,V)},t.clone=function(L){var D=L.m;return new t(D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8])},t.copy=function(L,D){return L.m.set(D.m),L},t.set=function(L,D,P,N,F,B,k,U,V,z){var W=L.m;return W[0]=D,W[1]=P,W[2]=N,W[3]=F,W[4]=B,W[5]=k,W[6]=U,W[7]=V,W[8]=z,L},t.identity=function(L){var D=L.m;return D[0]=1,D[1]=0,D[2]=0,D[3]=0,D[4]=1,D[5]=0,D[6]=0,D[7]=0,D[8]=1,L},t.transpose=function(L,D){var P=D.m,N=L.m;if(L===D){var F=P[1],B=P[2],k=P[5];N[1]=P[3],N[2]=P[6],N[3]=F,N[5]=P[7],N[6]=B,N[7]=k}else N[0]=P[0],N[1]=P[3],N[2]=P[6],N[3]=P[1],N[4]=P[4],N[5]=P[7],N[6]=P[2],N[7]=P[5],N[8]=P[8];return L},t.invert=function(L,D){var P=D.m,N=L.m,F=P[0],B=P[1],k=P[2],U=P[3],V=P[4],z=P[5],W=P[6],H=P[7],G=P[8],X=G*V-z*H,nt=-G*U+z*W,ut=H*U-V*W,dt=F*X+B*nt+k*ut;return dt?(dt=1/dt,N[0]=X*dt,N[1]=(-G*B+k*H)*dt,N[2]=(z*B-k*V)*dt,N[3]=nt*dt,N[4]=(G*F-k*W)*dt,N[5]=(-z*F+k*U)*dt,N[6]=ut*dt,N[7]=(-H*F+B*W)*dt,N[8]=(V*F-B*U)*dt,L):L},t.adjoint=function(L,D){var P=D.m,N=L.m,F=P[0],B=P[1],k=P[2],U=P[3],V=P[4],z=P[5],W=P[6],H=P[7],G=P[8];return N[0]=V*G-z*H,N[1]=k*H-B*G,N[2]=B*z-k*V,N[3]=z*W-U*G,N[4]=F*G-k*W,N[5]=k*U-F*z,N[6]=U*H-V*W,N[7]=B*W-F*H,N[8]=F*V-B*U,L},t.determinant=function(L){var D=L.m,P=D[0],N=D[1],F=D[2],B=D[3],k=D[4],U=D[5],V=D[6],z=D[7],W=D[8];return P*(W*k-U*z)+N*(-W*B+U*V)+F*(z*B-k*V)},t.multiply=function(L,D,P){var N=D.m,F=P.m,B=L.m,k=N[0],U=N[1],V=N[2],z=N[3],W=N[4],H=N[5],G=N[6],X=N[7],nt=N[8],ut=F[0],dt=F[1],ft=F[2],_t=F[3],pt=F[4],vt=F[5],gt=F[6],mt=F[7],yt=F[8];return B[0]=ut*k+dt*z+ft*G,B[1]=ut*U+dt*W+ft*X,B[2]=ut*V+dt*H+ft*nt,B[3]=_t*k+pt*z+vt*G,B[4]=_t*U+pt*W+vt*X,B[5]=_t*V+pt*H+vt*nt,B[6]=gt*k+mt*z+yt*G,B[7]=gt*U+mt*W+yt*X,B[8]=gt*V+mt*H+yt*nt,L},t.multiplyMat4=function(L,D,P){var N=D.m,F=P.m,B=L.m,k=N[0],U=N[1],V=N[2],z=N[3],W=N[4],H=N[5],G=N[6],X=N[7],nt=N[8],ut=F[0],dt=F[1],ft=F[2],_t=F[4],pt=F[5],vt=F[6],gt=F[8],mt=F[9],yt=F[10];return B[0]=ut*k+dt*z+ft*G,B[1]=ut*U+dt*W+ft*X,B[2]=ut*V+dt*H+ft*nt,B[3]=_t*k+pt*z+vt*G,B[4]=_t*U+pt*W+vt*X,B[5]=_t*V+pt*H+vt*nt,B[6]=gt*k+mt*z+yt*G,B[7]=gt*U+mt*W+yt*X,B[8]=gt*V+mt*H+yt*nt,L},t.translate=function(L,D,P){var N=D.m,F=L.m,B=N[0],k=N[1],U=N[2],V=N[3],z=N[4],W=N[5],H=N[6],G=N[7],X=N[8],nt=P.x,ut=P.y;return F[0]=B,F[1]=k,F[2]=U,F[3]=V,F[4]=z,F[5]=W,F[6]=nt*B+ut*V+H,F[7]=nt*k+ut*z+G,F[8]=nt*U+ut*W+X,L},t.rotate=function(L,D,P){var N=D.m,F=L.m,B=N[0],k=N[1],U=N[2],V=N[3],z=N[4],W=N[5],H=N[6],G=N[7],X=N[8],nt=Math.sin(P),ut=Math.cos(P);return F[0]=ut*B+nt*V,F[1]=ut*k+nt*z,F[2]=ut*U+nt*W,F[3]=ut*V-nt*B,F[4]=ut*z-nt*k,F[5]=ut*W-nt*U,F[6]=H,F[7]=G,F[8]=X,L},t.scale=function(L,D,P){var N=P.x,F=P.y,B=D.m,k=L.m;return k[0]=N*B[0],k[1]=N*B[1],k[2]=N*B[2],k[3]=F*B[3],k[4]=F*B[4],k[5]=F*B[5],k[6]=B[6],k[7]=B[7],k[8]=B[8],L},t.fromMat4=function(L,D){var P=D.m,N=L.m;return N[0]=P[0],N[1]=P[1],N[2]=P[2],N[3]=P[4],N[4]=P[5],N[5]=P[6],N[6]=P[8],N[7]=P[9],N[8]=P[10],L},t.fromTranslation=function(L,D){var P=L.m;return P[0]=1,P[1]=0,P[2]=0,P[3]=0,P[4]=1,P[5]=0,P[6]=D.x,P[7]=D.y,P[8]=1,L},t.fromRotation=function(L,D){var P=Math.sin(D),N=Math.cos(D),F=L.m;return F[0]=N,F[1]=P,F[2]=0,F[3]=-P,F[4]=N,F[5]=0,F[6]=0,F[7]=0,F[8]=1,L},t.fromScaling=function(L,D){var P=L.m;return P[0]=D.x,P[1]=0,P[2]=0,P[3]=0,P[4]=D.y,P[5]=0,P[6]=0,P[7]=0,P[8]=1,L},t.fromQuat=function(L,D){var P=L.m,N=D.x,F=D.y,B=D.z,k=D.w,U=N+N,V=F+F,z=B+B,W=N*U,H=F*U,G=F*V,X=B*U,nt=B*V,ut=B*z,dt=k*U,ft=k*V,_t=k*z;return P[0]=1-G-ut,P[3]=H-_t,P[6]=X+ft,P[1]=H+_t,P[4]=1-W-ut,P[7]=nt-dt,P[2]=X-ft,P[5]=nt+dt,P[8]=1-W-G,L},t.fromViewUp=function(L,D,P){return function(){var L=new F.default(0,1,0),D=new F.default,P=new F.default;return function(B,k,U){return F.default.lengthSqr(k)<N.EPSILON*N.EPSILON?(t.identity(B),B):(U=U||L,F.default.normalize(D,F.default.cross(D,U,k)),F.default.lengthSqr(D)<N.EPSILON*N.EPSILON?(t.identity(B),B):(F.default.cross(P,k,D),t.set(B,D.x,D.y,D.z,P.x,P.y,P.z,k.x,k.y,k.z),B))}}()(L,D,P)},t.normalFromMat4=function(L,D){var P=D.m,N=L.m,F=P[0],B=P[1],k=P[2],U=P[3],V=P[4],z=P[5],W=P[6],H=P[7],G=P[8],X=P[9],nt=P[10],ut=P[11],dt=P[12],ft=P[13],_t=P[14],pt=P[15],vt=F*z-B*V,gt=F*W-k*V,mt=F*H-U*V,yt=B*W-k*z,Tt=B*H-U*z,xt=k*H-U*W,St=G*ft-X*dt,bt=G*_t-nt*dt,wt=G*pt-ut*dt,Rt=X*_t-nt*ft,It=X*pt-ut*ft,Mt=nt*pt-ut*_t,Ot=vt*Mt-gt*It+mt*Rt+yt*wt-Tt*bt+xt*St;return Ot?(Ot=1/Ot,N[0]=(z*Mt-W*It+H*Rt)*Ot,N[1]=(W*wt-V*Mt-H*bt)*Ot,N[2]=(V*It-z*wt+H*St)*Ot,N[3]=(k*It-B*Mt-U*Rt)*Ot,N[4]=(F*Mt-k*wt+U*bt)*Ot,N[5]=(B*wt-F*It-U*St)*Ot,N[6]=(ft*xt-_t*Tt+pt*yt)*Ot,N[7]=(_t*mt-dt*xt-pt*gt)*Ot,N[8]=(dt*Tt-ft*mt+pt*vt)*Ot,L):L},t.frob=function(L){var D=L.m;return Math.sqrt(Math.pow(D[0],2)+Math.pow(D[1],2)+Math.pow(D[2],2)+Math.pow(D[3],2)+Math.pow(D[4],2)+Math.pow(D[5],2)+Math.pow(D[6],2)+Math.pow(D[7],2)+Math.pow(D[8],2))},t.add=function(L,D,P){var N=D.m,F=P.m,B=L.m;return B[0]=N[0]+F[0],B[1]=N[1]+F[1],B[2]=N[2]+F[2],B[3]=N[3]+F[3],B[4]=N[4]+F[4],B[5]=N[5]+F[5],B[6]=N[6]+F[6],B[7]=N[7]+F[7],B[8]=N[8]+F[8],L},t.subtract=function(L,D,P){var N=D.m,F=P.m,B=L.m;return B[0]=N[0]-F[0],B[1]=N[1]-F[1],B[2]=N[2]-F[2],B[3]=N[3]-F[3],B[4]=N[4]-F[4],B[5]=N[5]-F[5],B[6]=N[6]-F[6],B[7]=N[7]-F[7],B[8]=N[8]-F[8],L},t.multiplyScalar=function(L,D,P){var N=D.m,F=L.m;return F[0]=N[0]*P,F[1]=N[1]*P,F[2]=N[2]*P,F[3]=N[3]*P,F[4]=N[4]*P,F[5]=N[5]*P,F[6]=N[6]*P,F[7]=N[7]*P,F[8]=N[8]*P,L},t.multiplyScalarAndAdd=function(L,D,P,N){var F=D.m,B=P.m,k=L.m;return k[0]=F[0]+B[0]*N,k[1]=F[1]+B[1]*N,k[2]=F[2]+B[2]*N,k[3]=F[3]+B[3]*N,k[4]=F[4]+B[4]*N,k[5]=F[5]+B[5]*N,k[6]=F[6]+B[6]*N,k[7]=F[7]+B[7]*N,k[8]=F[8]+B[8]*N,L},t.exactEquals=function(L,D){var P=L.m,N=D.m;return P[0]===N[0]&&P[1]===N[1]&&P[2]===N[2]&&P[3]===N[3]&&P[4]===N[4]&&P[5]===N[5]&&P[6]===N[6]&&P[7]===N[7]&&P[8]===N[8]},t.equals=function(L,D){var P=L.m,F=D.m,B=P[0],k=P[1],U=P[2],V=P[3],z=P[4],W=P[5],H=P[6],G=P[7],X=P[8],nt=F[0],ut=F[1],dt=F[2],ft=F[3],_t=F[4],pt=F[5],vt=F[6],gt=F[7],mt=F[8];return Math.abs(B-nt)<=N.EPSILON*Math.max(1,Math.abs(B),Math.abs(nt))&&Math.abs(k-ut)<=N.EPSILON*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(U-dt)<=N.EPSILON*Math.max(1,Math.abs(U),Math.abs(dt))&&Math.abs(V-ft)<=N.EPSILON*Math.max(1,Math.abs(V),Math.abs(ft))&&Math.abs(z-_t)<=N.EPSILON*Math.max(1,Math.abs(z),Math.abs(_t))&&Math.abs(W-pt)<=N.EPSILON*Math.max(1,Math.abs(W),Math.abs(pt))&&Math.abs(H-vt)<=N.EPSILON*Math.max(1,Math.abs(H),Math.abs(vt))&&Math.abs(G-gt)<=N.EPSILON*Math.max(1,Math.abs(G),Math.abs(gt))&&Math.abs(X-mt)<=N.EPSILON*Math.max(1,Math.abs(X),Math.abs(mt))},t.toArray=function(L,D,P){void 0===P&&(P=0);for(var N=D.m,F=0;F<9;F++)L[P+F]=N[F];return L},t.fromArray=function(L,D,P){void 0===P&&(P=0);for(var N=L.m,F=0;F<9;F++)N[F]=D[P+F];return L},t.prototype.toString=function(){var L=this.m;return"mat3("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+")"},t}();P.default=B,B.sub=B.subtract,B.mul=B.multiply,B.IDENTITY=Object.freeze(new B),cc.Mat3=B,D.exports=P.default},{"../value-types/utils":232,"./vec3":235}],227:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=l(L("./value-type")),F=l(L("../platform/CCClass")),B=l(L("./vec3")),k=l(L("./quat")),U=L("./utils"),V=l(L("./mat3"));function l(L){return L&&L.__esModule?L:{default:L}}var z=0,W=0,H=0,G=0,X=0,nt=0,ut=0,dt=0,ft=0,_t=0,pt=0,vt=0,gt=0,mt=0,yt=0,Tt=0,xt=function(L){!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(i,L);var D=i.prototype;function i(D,P,N,F,B,k,V,z,W,H,G,X,nt,ut,dt,ft){var _t;if(void 0===D&&(D=1),void 0===P&&(P=0),void 0===N&&(N=0),void 0===F&&(F=0),void 0===B&&(B=0),void 0===k&&(k=1),void 0===V&&(V=0),void 0===z&&(z=0),void 0===W&&(W=0),void 0===H&&(H=0),void 0===G&&(G=1),void 0===X&&(X=0),void 0===nt&&(nt=0),void 0===ut&&(ut=0),void 0===dt&&(dt=0),void 0===ft&&(ft=1),(_t=L.call(this)||this).m=void 0,D instanceof U.FLOAT_ARRAY_TYPE)_t.m=D;else{_t.m=new U.FLOAT_ARRAY_TYPE(16);var pt=_t.m;pt[0]=D,pt[1]=P,pt[2]=N,pt[3]=F,pt[4]=B,pt[5]=k,pt[6]=V,pt[7]=z,pt[8]=W,pt[9]=H,pt[10]=G,pt[11]=X,pt[12]=nt,pt[13]=ut,pt[14]=dt,pt[15]=ft}return _t}return D.mul=function(L,D){return i.multiply(D||new i,this,L)},D.mulScalar=function(L,D){i.multiplyScalar(D||new i,this,L)},D.sub=function(L,D){i.subtract(D||new i,this,L)},i.clone=function(L){var D=L.m;return new i(D[0],D[1],D[2],D[3],D[4],D[5],D[6],D[7],D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15])},i.copy=function(L,D){var P=L.m,N=D.m;return P[0]=N[0],P[1]=N[1],P[2]=N[2],P[3]=N[3],P[4]=N[4],P[5]=N[5],P[6]=N[6],P[7]=N[7],P[8]=N[8],P[9]=N[9],P[10]=N[10],P[11]=N[11],P[12]=N[12],P[13]=N[13],P[14]=N[14],P[15]=N[15],L},i.set=function(L,D,P,N,F,B,k,U,V,z,W,H,G,X,nt,ut,dt){var ft=L.m;return ft[0]=D,ft[1]=P,ft[2]=N,ft[3]=F,ft[4]=B,ft[5]=k,ft[6]=U,ft[7]=V,ft[8]=z,ft[9]=W,ft[10]=H,ft[11]=G,ft[12]=X,ft[13]=nt,ft[14]=ut,ft[15]=dt,L},i.identity=function(L){var D=L.m;return D[0]=1,D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[5]=1,D[6]=0,D[7]=0,D[8]=0,D[9]=0,D[10]=1,D[11]=0,D[12]=0,D[13]=0,D[14]=0,D[15]=1,L},i.transpose=function(L,D){var P=L.m,N=D.m;if(L===D){var F=N[1],B=N[2],k=N[3],U=N[6],V=N[7],z=N[11];P[1]=N[4],P[2]=N[8],P[3]=N[12],P[4]=F,P[6]=N[9],P[7]=N[13],P[8]=B,P[9]=U,P[11]=N[14],P[12]=k,P[13]=V,P[14]=z}else P[0]=N[0],P[1]=N[4],P[2]=N[8],P[3]=N[12],P[4]=N[1],P[5]=N[5],P[6]=N[9],P[7]=N[13],P[8]=N[2],P[9]=N[6],P[10]=N[10],P[11]=N[14],P[12]=N[3],P[13]=N[7],P[14]=N[11],P[15]=N[15];return L},i.invert=function(L,D){var P=D.m;z=P[0],W=P[1],H=P[2],G=P[3],X=P[4],nt=P[5],ut=P[6],dt=P[7],ft=P[8],_t=P[9],pt=P[10],vt=P[11],gt=P[12],mt=P[13],yt=P[14],Tt=P[15];var N=z*nt-W*X,F=z*ut-H*X,B=z*dt-G*X,k=W*ut-H*nt,U=W*dt-G*nt,V=H*dt-G*ut,xt=ft*mt-_t*gt,St=ft*yt-pt*gt,bt=ft*Tt-vt*gt,wt=_t*yt-pt*mt,Rt=_t*Tt-vt*mt,It=pt*Tt-vt*yt,Mt=N*It-F*Rt+B*wt+k*bt-U*St+V*xt;if(0===Mt)return null;Mt=1/Mt;var Ot=L.m;return Ot[0]=(nt*It-ut*Rt+dt*wt)*Mt,Ot[1]=(H*Rt-W*It-G*wt)*Mt,Ot[2]=(mt*V-yt*U+Tt*k)*Mt,Ot[3]=(pt*U-_t*V-vt*k)*Mt,Ot[4]=(ut*bt-X*It-dt*St)*Mt,Ot[5]=(z*It-H*bt+G*St)*Mt,Ot[6]=(yt*B-gt*V-Tt*F)*Mt,Ot[7]=(ft*V-pt*B+vt*F)*Mt,Ot[8]=(X*Rt-nt*bt+dt*xt)*Mt,Ot[9]=(W*bt-z*Rt-G*xt)*Mt,Ot[10]=(gt*U-mt*B+Tt*N)*Mt,Ot[11]=(_t*B-ft*U-vt*N)*Mt,Ot[12]=(nt*St-X*wt-ut*xt)*Mt,Ot[13]=(z*wt-W*St+H*xt)*Mt,Ot[14]=(mt*F-gt*k-yt*N)*Mt,Ot[15]=(ft*k-_t*F+pt*N)*Mt,L},i.determinant=function(L){var D=L.m;return z=D[0],W=D[1],H=D[2],G=D[3],X=D[4],nt=D[5],ut=D[6],dt=D[7],ft=D[8],_t=D[9],pt=D[10],vt=D[11],gt=D[12],mt=D[13],yt=D[14],Tt=D[15],(z*nt-W*X)*(pt*Tt-vt*yt)-(z*ut-H*X)*(_t*Tt-vt*mt)+(z*dt-G*X)*(_t*yt-pt*mt)+(W*ut-H*nt)*(ft*Tt-vt*gt)-(W*dt-G*nt)*(ft*yt-pt*gt)+(H*dt-G*ut)*(ft*mt-_t*gt)},i.multiply=function(L,D,P){var N=L.m,F=D.m,B=P.m;z=F[0],W=F[1],H=F[2],G=F[3],X=F[4],nt=F[5],ut=F[6],dt=F[7],ft=F[8],_t=F[9],pt=F[10],vt=F[11],gt=F[12],mt=F[13],yt=F[14],Tt=F[15];var k=B[0],U=B[1],V=B[2],xt=B[3];return N[0]=k*z+U*X+V*ft+xt*gt,N[1]=k*W+U*nt+V*_t+xt*mt,N[2]=k*H+U*ut+V*pt+xt*yt,N[3]=k*G+U*dt+V*vt+xt*Tt,k=B[4],U=B[5],V=B[6],xt=B[7],N[4]=k*z+U*X+V*ft+xt*gt,N[5]=k*W+U*nt+V*_t+xt*mt,N[6]=k*H+U*ut+V*pt+xt*yt,N[7]=k*G+U*dt+V*vt+xt*Tt,k=B[8],U=B[9],V=B[10],xt=B[11],N[8]=k*z+U*X+V*ft+xt*gt,N[9]=k*W+U*nt+V*_t+xt*mt,N[10]=k*H+U*ut+V*pt+xt*yt,N[11]=k*G+U*dt+V*vt+xt*Tt,k=B[12],U=B[13],V=B[14],xt=B[15],N[12]=k*z+U*X+V*ft+xt*gt,N[13]=k*W+U*nt+V*_t+xt*mt,N[14]=k*H+U*ut+V*pt+xt*yt,N[15]=k*G+U*dt+V*vt+xt*Tt,L},i.transform=function(L,D,P){var N=P.x,F=P.y,B=P.z,k=L.m,U=D.m;return D===L?(k[12]=U[0]*N+U[4]*F+U[8]*B+U[12],k[13]=U[1]*N+U[5]*F+U[9]*B+U[13],k[14]=U[2]*N+U[6]*F+U[10]*B+U[14],k[15]=U[3]*N+U[7]*F+U[11]*B+U[15]):(z=U[0],W=U[1],H=U[2],G=U[3],X=U[4],nt=U[5],ut=U[6],dt=U[7],ft=U[8],_t=U[9],pt=U[10],vt=U[11],gt=U[12],mt=U[13],yt=U[14],Tt=U[15],k[0]=z,k[1]=W,k[2]=H,k[3]=G,k[4]=X,k[5]=nt,k[6]=ut,k[7]=dt,k[8]=ft,k[9]=_t,k[10]=pt,k[11]=vt,k[12]=z*N+X*F+ft*B+U[12],k[13]=W*N+nt*F+_t*B+U[13],k[14]=H*N+ut*F+pt*B+U[14],k[15]=G*N+dt*F+vt*B+U[15]),L},i.translate=function(L,D,P){var N=L.m,F=D.m;return D===L?(N[12]+=P.x,N[13]+=P.y,N[14]+=P.y):(N[0]=F[0],N[1]=F[1],N[2]=F[2],N[3]=F[3],N[4]=F[4],N[5]=F[5],N[6]=F[6],N[7]=F[7],N[8]=F[8],N[9]=F[9],N[10]=F[10],N[11]=F[11],N[12]+=P.x,N[13]+=P.y,N[14]+=P.z,N[15]=F[15]),L},i.scale=function(L,D,P){var N=P.x,F=P.y,B=P.z,k=L.m,U=D.m;return k[0]=U[0]*N,k[1]=U[1]*N,k[2]=U[2]*N,k[3]=U[3]*N,k[4]=U[4]*F,k[5]=U[5]*F,k[6]=U[6]*F,k[7]=U[7]*F,k[8]=U[8]*B,k[9]=U[9]*B,k[10]=U[10]*B,k[11]=U[11]*B,k[12]=U[12],k[13]=U[13],k[14]=U[14],k[15]=U[15],L},i.rotate=function(L,D,P,N){var F=N.x,B=N.y,k=N.z,V=Math.sqrt(F*F+B*B+k*k);if(Math.abs(V)<U.EPSILON)return null;F*=V=1/V,B*=V,k*=V;var gt=Math.sin(P),mt=Math.cos(P),yt=1-mt,Tt=D.m;z=Tt[0],W=Tt[1],H=Tt[2],G=Tt[3],X=Tt[4],nt=Tt[5],ut=Tt[6],dt=Tt[7],ft=Tt[8],_t=Tt[9],pt=Tt[10],vt=Tt[11];var xt=F*F*yt+mt,St=B*F*yt+k*gt,bt=k*F*yt-B*gt,wt=F*B*yt-k*gt,Rt=B*B*yt+mt,It=k*B*yt+F*gt,Mt=F*k*yt+B*gt,Ot=B*k*yt-F*gt,Lt=k*k*yt+mt,Dt=L.m;return Dt[0]=z*xt+X*St+ft*bt,Dt[1]=W*xt+nt*St+_t*bt,Dt[2]=H*xt+ut*St+pt*bt,Dt[3]=G*xt+dt*St+vt*bt,Dt[4]=z*wt+X*Rt+ft*It,Dt[5]=W*wt+nt*Rt+_t*It,Dt[6]=H*wt+ut*Rt+pt*It,Dt[7]=G*wt+dt*Rt+vt*It,Dt[8]=z*Mt+X*Ot+ft*Lt,Dt[9]=W*Mt+nt*Ot+_t*Lt,Dt[10]=H*Mt+ut*Ot+pt*Lt,Dt[11]=G*Mt+dt*Ot+vt*Lt,D!==L&&(Dt[12]=Tt[12],Dt[13]=Tt[13],Dt[14]=Tt[14],Dt[15]=Tt[15]),L},i.rotateX=function(L,D,P){var N=L.m,F=D.m,B=Math.sin(P),k=Math.cos(P),U=F[4],V=F[5],z=F[6],W=F[7],H=F[8],G=F[9],X=F[10],nt=F[11];return D!==L&&(N[0]=F[0],N[1]=F[1],N[2]=F[2],N[3]=F[3],N[12]=F[12],N[13]=F[13],N[14]=F[14],N[15]=F[15]),N[4]=U*k+H*B,N[5]=V*k+G*B,N[6]=z*k+X*B,N[7]=W*k+nt*B,N[8]=H*k-U*B,N[9]=G*k-V*B,N[10]=X*k-z*B,N[11]=nt*k-W*B,L},i.rotateY=function(L,D,P){var N=L.m,F=D.m,B=Math.sin(P),k=Math.cos(P),U=F[0],V=F[1],z=F[2],W=F[3],H=F[8],G=F[9],X=F[10],nt=F[11];return D!==L&&(N[4]=F[4],N[5]=F[5],N[6]=F[6],N[7]=F[7],N[12]=F[12],N[13]=F[13],N[14]=F[14],N[15]=F[15]),N[0]=U*k-H*B,N[1]=V*k-G*B,N[2]=z*k-X*B,N[3]=W*k-nt*B,N[8]=U*B+H*k,N[9]=V*B+G*k,N[10]=z*B+X*k,N[11]=W*B+nt*k,L},i.rotateZ=function(L,D,P){var N=D.m,F=L.m,B=Math.sin(P),k=Math.cos(P),U=D.m[0],V=D.m[1],z=D.m[2],W=D.m[3],H=D.m[4],G=D.m[5],X=D.m[6],nt=D.m[7];return D!==L&&(F[8]=N[8],F[9]=N[9],F[10]=N[10],F[11]=N[11],F[12]=N[12],F[13]=N[13],F[14]=N[14],F[15]=N[15]),F[0]=U*k+H*B,F[1]=V*k+G*B,F[2]=z*k+X*B,F[3]=W*k+nt*B,F[4]=H*k-U*B,F[5]=G*k-V*B,F[6]=X*k-z*B,F[7]=nt*k-W*B,L},i.fromTranslation=function(L,D){var P=L.m;return P[0]=1,P[1]=0,P[2]=0,P[3]=0,P[4]=0,P[5]=1,P[6]=0,P[7]=0,P[8]=0,P[9]=0,P[10]=1,P[11]=0,P[12]=D.x,P[13]=D.y,P[14]=D.z,P[15]=1,L},i.fromScaling=function(L,D){var P=L.m;return P[0]=D.x,P[1]=0,P[2]=0,P[3]=0,P[4]=0,P[5]=D.y,P[6]=0,P[7]=0,P[8]=0,P[9]=0,P[10]=D.z,P[11]=0,P[12]=0,P[13]=0,P[14]=0,P[15]=1,L},i.fromRotation=function(L,D,P){var N=P.x,F=P.y,B=P.z,k=Math.sqrt(N*N+F*F+B*B);if(Math.abs(k)<U.EPSILON)return null;N*=k=1/k,F*=k,B*=k;var V=Math.sin(D),z=Math.cos(D),W=1-z,H=L.m;return H[0]=N*N*W+z,H[1]=F*N*W+B*V,H[2]=B*N*W-F*V,H[3]=0,H[4]=N*F*W-B*V,H[5]=F*F*W+z,H[6]=B*F*W+N*V,H[7]=0,H[8]=N*B*W+F*V,H[9]=F*B*W-N*V,H[10]=B*B*W+z,H[11]=0,H[12]=0,H[13]=0,H[14]=0,H[15]=1,L},i.fromXRotation=function(L,D){var P=Math.sin(D),N=Math.cos(D),F=L.m;return F[0]=1,F[1]=0,F[2]=0,F[3]=0,F[4]=0,F[5]=N,F[6]=P,F[7]=0,F[8]=0,F[9]=-P,F[10]=N,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,L},i.fromYRotation=function(L,D){var P=Math.sin(D),N=Math.cos(D),F=L.m;return F[0]=N,F[1]=0,F[2]=-P,F[3]=0,F[4]=0,F[5]=1,F[6]=0,F[7]=0,F[8]=P,F[9]=0,F[10]=N,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,L},i.fromZRotation=function(L,D){var P=Math.sin(D),N=Math.cos(D),F=L.m;return F[0]=N,F[1]=P,F[2]=0,F[3]=0,F[4]=-P,F[5]=N,F[6]=0,F[7]=0,F[8]=0,F[9]=0,F[10]=1,F[11]=0,F[12]=0,F[13]=0,F[14]=0,F[15]=1,L},i.fromRT=function(L,D,P){var N=D.x,F=D.y,B=D.z,k=D.w,U=N+N,V=F+F,z=B+B,W=N*U,H=N*V,G=N*z,X=F*V,nt=F*z,ut=B*z,dt=k*U,ft=k*V,_t=k*z,pt=L.m;return pt[0]=1-(X+ut),pt[1]=H+_t,pt[2]=G-ft,pt[3]=0,pt[4]=H-_t,pt[5]=1-(W+ut),pt[6]=nt+dt,pt[7]=0,pt[8]=G+ft,pt[9]=nt-dt,pt[10]=1-(W+X),pt[11]=0,pt[12]=P.x,pt[13]=P.y,pt[14]=P.z,pt[15]=1,L},i.getTranslation=function(L,D){var P=D.m;return L.x=P[12],L.y=P[13],L.z=P[14],L},i.getScaling=function(L,D){var P=D.m,N=bt.m,F=N[0]=P[0],B=N[1]=P[1],k=N[2]=P[2],U=N[3]=P[4],z=N[4]=P[5],W=N[5]=P[6],H=N[6]=P[8],G=N[7]=P[9],X=N[8]=P[10];return L.x=Math.sqrt(F*F+B*B+k*k),L.y=Math.sqrt(U*U+z*z+W*W),L.z=Math.sqrt(H*H+G*G+X*X),V.default.determinant(bt)<0&&(L.x*=-1),L},i.getRotation=function(L,D){var P=D.m,N=P[0]+P[5]+P[10],F=0;return N>0?(F=2*Math.sqrt(N+1),L.w=.25*F,L.x=(P[6]-P[9])/F,L.y=(P[8]-P[2])/F,L.z=(P[1]-P[4])/F):P[0]>P[5]&&P[0]>P[10]?(F=2*Math.sqrt(1+P[0]-P[5]-P[10]),L.w=(P[6]-P[9])/F,L.x=.25*F,L.y=(P[1]+P[4])/F,L.z=(P[8]+P[2])/F):P[5]>P[10]?(F=2*Math.sqrt(1+P[5]-P[0]-P[10]),L.w=(P[8]-P[2])/F,L.x=(P[1]+P[4])/F,L.y=.25*F,L.z=(P[6]+P[9])/F):(F=2*Math.sqrt(1+P[10]-P[0]-P[5]),L.w=(P[1]-P[4])/F,L.x=(P[8]+P[2])/F,L.y=(P[6]+P[9])/F,L.z=.25*F),L},i.toRTS=function(L,D,P,N){var F=L.m,U=bt.m;N.x=B.default.set(St,F[0],F[1],F[2]).mag(),U[0]=F[0]/N.x,U[1]=F[1]/N.x,U[2]=F[2]/N.x,N.y=B.default.set(St,F[4],F[5],F[6]).mag(),U[3]=F[4]/N.y,U[4]=F[5]/N.y,U[5]=F[6]/N.y,N.z=B.default.set(St,F[8],F[9],F[10]).mag(),U[6]=F[8]/N.z,U[7]=F[9]/N.z,U[8]=F[10]/N.z,V.default.determinant(bt)<0&&(N.x*=-1,U[0]*=-1,U[1]*=-1,U[2]*=-1),k.default.fromMat3(D,bt),B.default.set(P,F[12],F[13],F[14])},i.fromRTS=function(L,D,P,N){var F=D.x,B=D.y,k=D.z,U=D.w,V=F+F,z=B+B,W=k+k,H=F*V,G=F*z,X=F*W,nt=B*z,ut=B*W,dt=k*W,ft=U*V,_t=U*z,pt=U*W,vt=N.x,gt=N.y,mt=N.z,yt=L.m;return yt[0]=(1-(nt+dt))*vt,yt[1]=(G+pt)*vt,yt[2]=(X-_t)*vt,yt[3]=0,yt[4]=(G-pt)*gt,yt[5]=(1-(H+dt))*gt,yt[6]=(ut+ft)*gt,yt[7]=0,yt[8]=(X+_t)*mt,yt[9]=(ut-ft)*mt,yt[10]=(1-(H+nt))*mt,yt[11]=0,yt[12]=P.x,yt[13]=P.y,yt[14]=P.z,yt[15]=1,L},i.fromRTSOrigin=function(L,D,P,N,F){var B=D.x,k=D.y,U=D.z,V=D.w,z=B+B,W=k+k,H=U+U,G=B*z,X=B*W,nt=B*H,ut=k*W,dt=k*H,ft=U*H,_t=V*z,pt=V*W,vt=V*H,gt=N.x,mt=N.y,yt=N.z,Tt=F.x,xt=F.y,St=F.z,bt=L.m;return bt[0]=(1-(ut+ft))*gt,bt[1]=(X+vt)*gt,bt[2]=(nt-pt)*gt,bt[3]=0,bt[4]=(X-vt)*mt,bt[5]=(1-(G+ft))*mt,bt[6]=(dt+_t)*mt,bt[7]=0,bt[8]=(nt+pt)*yt,bt[9]=(dt-_t)*yt,bt[10]=(1-(G+ut))*yt,bt[11]=0,bt[12]=P.x+Tt-(bt[0]*Tt+bt[4]*xt+bt[8]*St),bt[13]=P.y+xt-(bt[1]*Tt+bt[5]*xt+bt[9]*St),bt[14]=P.z+St-(bt[2]*Tt+bt[6]*xt+bt[10]*St),bt[15]=1,L},i.fromQuat=function(L,D){var P=D.x,N=D.y,F=D.z,B=D.w,k=P+P,U=N+N,V=F+F,z=P*k,W=N*k,H=N*U,G=F*k,X=F*U,nt=F*V,ut=B*k,dt=B*U,ft=B*V,_t=L.m;return _t[0]=1-H-nt,_t[1]=W+ft,_t[2]=G-dt,_t[3]=0,_t[4]=W-ft,_t[5]=1-z-nt,_t[6]=X+ut,_t[7]=0,_t[8]=G+dt,_t[9]=X-ut,_t[10]=1-z-H,_t[11]=0,_t[12]=0,_t[13]=0,_t[14]=0,_t[15]=1,L},i.frustum=function(L,D,P,N,F,B,k){var U=1/(P-D),V=1/(F-N),z=1/(B-k),W=L.m;return W[0]=2*B*U,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=2*B*V,W[6]=0,W[7]=0,W[8]=(P+D)*U,W[9]=(F+N)*V,W[10]=(k+B)*z,W[11]=-1,W[12]=0,W[13]=0,W[14]=k*B*2*z,W[15]=0,L},i.perspective=function(L,D,P,N,F){var B=1/Math.tan(D/2),k=1/(N-F),U=L.m;return U[0]=B/P,U[1]=0,U[2]=0,U[3]=0,U[4]=0,U[5]=B,U[6]=0,U[7]=0,U[8]=0,U[9]=0,U[10]=(F+N)*k,U[11]=-1,U[12]=0,U[13]=0,U[14]=2*F*N*k,U[15]=0,L},i.ortho=function(L,D,P,N,F,B,k){var U=1/(D-P),V=1/(N-F),z=1/(B-k),W=L.m;return W[0]=-2*U,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=-2*V,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=2*z,W[11]=0,W[12]=(D+P)*U,W[13]=(F+N)*V,W[14]=(k+B)*z,W[15]=1,L},i.lookAt=function(L,D,P,N){var F=D.x,B=D.y,k=D.z,U=N.x,V=N.y,z=N.z,W=F-P.x,H=B-P.y,G=k-P.z,X=1/Math.sqrt(W*W+H*H+G*G),nt=V*(G*=X)-z*(H*=X),ut=z*(W*=X)-U*G,dt=U*H-V*W,ft=H*(dt*=X=1/Math.sqrt(nt*nt+ut*ut+dt*dt))-G*(ut*=X),_t=G*(nt*=X)-W*dt,pt=W*ut-H*nt,vt=L.m;return vt[0]=nt,vt[1]=ft,vt[2]=W,vt[3]=0,vt[4]=ut,vt[5]=_t,vt[6]=H,vt[7]=0,vt[8]=dt,vt[9]=pt,vt[10]=G,vt[11]=0,vt[12]=-(nt*F+ut*B+dt*k),vt[13]=-(ft*F+_t*B+pt*k),vt[14]=-(W*F+H*B+G*k),vt[15]=1,L},i.inverseTranspose=function(L,D){var P=D.m;z=P[0],W=P[1],H=P[2],G=P[3],X=P[4],nt=P[5],ut=P[6],dt=P[7],ft=P[8],_t=P[9],pt=P[10],vt=P[11],gt=P[12],mt=P[13],yt=P[14],Tt=P[15];var N=z*nt-W*X,F=z*ut-H*X,B=z*dt-G*X,k=W*ut-H*nt,U=W*dt-G*nt,V=H*dt-G*ut,xt=ft*mt-_t*gt,St=ft*yt-pt*gt,bt=ft*Tt-vt*gt,wt=_t*yt-pt*mt,Rt=_t*Tt-vt*mt,It=pt*Tt-vt*yt,Mt=N*It-F*Rt+B*wt+k*bt-U*St+V*xt;return Mt?(Mt=1/Mt,(P=L.m)[0]=(nt*It-ut*Rt+dt*wt)*Mt,P[1]=(ut*bt-X*It-dt*St)*Mt,P[2]=(X*Rt-nt*bt+dt*xt)*Mt,P[3]=0,P[4]=(H*Rt-W*It-G*wt)*Mt,P[5]=(z*It-H*bt+G*St)*Mt,P[6]=(W*bt-z*Rt-G*xt)*Mt,P[7]=0,P[8]=(mt*V-yt*U+Tt*k)*Mt,P[9]=(yt*B-gt*V-Tt*F)*Mt,P[10]=(gt*U-mt*B+Tt*N)*Mt,P[11]=0,P[12]=0,P[13]=0,P[14]=0,P[15]=1,L):null},i.add=function(L,D,P){var N=L.m,F=D.m,B=P.m;return N[0]=F[0]+B[0],N[1]=F[1]+B[1],N[2]=F[2]+B[2],N[3]=F[3]+B[3],N[4]=F[4]+B[4],N[5]=F[5]+B[5],N[6]=F[6]+B[6],N[7]=F[7]+B[7],N[8]=F[8]+B[8],N[9]=F[9]+B[9],N[10]=F[10]+B[10],N[11]=F[11]+B[11],N[12]=F[12]+B[12],N[13]=F[13]+B[13],N[14]=F[14]+B[14],N[15]=F[15]+B[15],L},i.subtract=function(L,D,P){var N=L.m,F=D.m,B=P.m;return N[0]=F[0]-B[0],N[1]=F[1]-B[1],N[2]=F[2]-B[2],N[3]=F[3]-B[3],N[4]=F[4]-B[4],N[5]=F[5]-B[5],N[6]=F[6]-B[6],N[7]=F[7]-B[7],N[8]=F[8]-B[8],N[9]=F[9]-B[9],N[10]=F[10]-B[10],N[11]=F[11]-B[11],N[12]=F[12]-B[12],N[13]=F[13]-B[13],N[14]=F[14]-B[14],N[15]=F[15]-B[15],L},i.multiplyScalar=function(L,D,P){var N=L.m,F=D.m;return N[0]=F[0]*P,N[1]=F[1]*P,N[2]=F[2]*P,N[3]=F[3]*P,N[4]=F[4]*P,N[5]=F[5]*P,N[6]=F[6]*P,N[7]=F[7]*P,N[8]=F[8]*P,N[9]=F[9]*P,N[10]=F[10]*P,N[11]=F[11]*P,N[12]=F[12]*P,N[13]=F[13]*P,N[14]=F[14]*P,N[15]=F[15]*P,L},i.multiplyScalarAndAdd=function(L,D,P,N){var F=L.m,B=D.m,k=P.m;return F[0]=B[0]+k[0]*N,F[1]=B[1]+k[1]*N,F[2]=B[2]+k[2]*N,F[3]=B[3]+k[3]*N,F[4]=B[4]+k[4]*N,F[5]=B[5]+k[5]*N,F[6]=B[6]+k[6]*N,F[7]=B[7]+k[7]*N,F[8]=B[8]+k[8]*N,F[9]=B[9]+k[9]*N,F[10]=B[10]+k[10]*N,F[11]=B[11]+k[11]*N,F[12]=B[12]+k[12]*N,F[13]=B[13]+k[13]*N,F[14]=B[14]+k[14]*N,F[15]=B[15]+k[15]*N,L},i.strictEquals=function(L,D){var P=L.m,N=D.m;return P[0]===N[0]&&P[1]===N[1]&&P[2]===N[2]&&P[3]===N[3]&&P[4]===N[4]&&P[5]===N[5]&&P[6]===N[6]&&P[7]===N[7]&&P[8]===N[8]&&P[9]===N[9]&&P[10]===N[10]&&P[11]===N[11]&&P[12]===N[12]&&P[13]===N[13]&&P[14]===N[14]&&P[15]===N[15]},i.equals=function(L,D,P){void 0===P&&(P=U.EPSILON);var N=L.m,F=D.m;return Math.abs(N[0]-F[0])<=P*Math.max(1,Math.abs(N[0]),Math.abs(F[0]))&&Math.abs(N[1]-F[1])<=P*Math.max(1,Math.abs(N[1]),Math.abs(F[1]))&&Math.abs(N[2]-F[2])<=P*Math.max(1,Math.abs(N[2]),Math.abs(F[2]))&&Math.abs(N[3]-F[3])<=P*Math.max(1,Math.abs(N[3]),Math.abs(F[3]))&&Math.abs(N[4]-F[4])<=P*Math.max(1,Math.abs(N[4]),Math.abs(F[4]))&&Math.abs(N[5]-F[5])<=P*Math.max(1,Math.abs(N[5]),Math.abs(F[5]))&&Math.abs(N[6]-F[6])<=P*Math.max(1,Math.abs(N[6]),Math.abs(F[6]))&&Math.abs(N[7]-F[7])<=P*Math.max(1,Math.abs(N[7]),Math.abs(F[7]))&&Math.abs(N[8]-F[8])<=P*Math.max(1,Math.abs(N[8]),Math.abs(F[8]))&&Math.abs(N[9]-F[9])<=P*Math.max(1,Math.abs(N[9]),Math.abs(F[9]))&&Math.abs(N[10]-F[10])<=P*Math.max(1,Math.abs(N[10]),Math.abs(F[10]))&&Math.abs(N[11]-F[11])<=P*Math.max(1,Math.abs(N[11]),Math.abs(F[11]))&&Math.abs(N[12]-F[12])<=P*Math.max(1,Math.abs(N[12]),Math.abs(F[12]))&&Math.abs(N[13]-F[13])<=P*Math.max(1,Math.abs(N[13]),Math.abs(F[13]))&&Math.abs(N[14]-F[14])<=P*Math.max(1,Math.abs(N[14]),Math.abs(F[14]))&&Math.abs(N[15]-F[15])<=P*Math.max(1,Math.abs(N[15]),Math.abs(F[15]))},i.adjoint=function(L,D){var P=D.m,N=L.m,F=P[0],B=P[1],k=P[2],U=P[3],V=P[4],z=P[5],W=P[6],H=P[7],G=P[8],X=P[9],nt=P[10],ut=P[11],dt=P[12],ft=P[13],_t=P[14],pt=P[15];return N[0]=z*(nt*pt-ut*_t)-X*(W*pt-H*_t)+ft*(W*ut-H*nt),N[1]=-(B*(nt*pt-ut*_t)-X*(k*pt-U*_t)+ft*(k*ut-U*nt)),N[2]=B*(W*pt-H*_t)-z*(k*pt-U*_t)+ft*(k*H-U*W),N[3]=-(B*(W*ut-H*nt)-z*(k*ut-U*nt)+X*(k*H-U*W)),N[4]=-(V*(nt*pt-ut*_t)-G*(W*pt-H*_t)+dt*(W*ut-H*nt)),N[5]=F*(nt*pt-ut*_t)-G*(k*pt-U*_t)+dt*(k*ut-U*nt),N[6]=-(F*(W*pt-H*_t)-V*(k*pt-U*_t)+dt*(k*H-U*W)),N[7]=F*(W*ut-H*nt)-V*(k*ut-U*nt)+G*(k*H-U*W),N[8]=V*(X*pt-ut*ft)-G*(z*pt-H*ft)+dt*(z*ut-H*X),N[9]=-(F*(X*pt-ut*ft)-G*(B*pt-U*ft)+dt*(B*ut-U*X)),N[10]=F*(z*pt-H*ft)-V*(B*pt-U*ft)+dt*(B*H-U*z),N[11]=-(F*(z*ut-H*X)-V*(B*ut-U*X)+G*(B*H-U*z)),N[12]=-(V*(X*_t-nt*ft)-G*(z*_t-W*ft)+dt*(z*nt-W*X)),N[13]=F*(X*_t-nt*ft)-G*(B*_t-k*ft)+dt*(B*nt-k*X),N[14]=-(F*(z*_t-W*ft)-V*(B*_t-k*ft)+dt*(B*W-k*z)),N[15]=F*(z*nt-W*X)-V*(B*nt-k*X)+G*(B*W-k*z),L},i.toArray=function(L,D,P){void 0===P&&(P=0);for(var N=D.m,F=0;F<16;F++)L[P+F]=N[F];return L},i.fromArray=function(L,D,P){void 0===P&&(P=0);for(var N=L.m,F=0;F<16;F++)N[F]=D[P+F];return L},D.clone=function(){var L=this.m;return new i(L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15])},D.set=function(L){var D=this.m,P=L.m;return D[0]=P[0],D[1]=P[1],D[2]=P[2],D[3]=P[3],D[4]=P[4],D[5]=P[5],D[6]=P[6],D[7]=P[7],D[8]=P[8],D[9]=P[9],D[10]=P[10],D[11]=P[11],D[12]=P[12],D[13]=P[13],D[14]=P[14],D[15]=P[15],this},D.equals=function(L){return i.strictEquals(this,L)},D.fuzzyEquals=function(L){return i.equals(this,L)},D.toString=function(){var L=this.m;return L?"[\n"+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+",\n"+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+",\n"+L[8]+", "+L[9]+", "+L[10]+", "+L[11]+",\n"+L[12]+", "+L[13]+", "+L[14]+", "+L[15]+"\n]":"[\n1, 0, 0, 0\n0, 1, 0, 0\n0, 0, 1, 0\n0, 0, 0, 1\n]"},D.identity=function(){return i.identity(this)},D.transpose=function(L){return L=L||new i,i.transpose(L,this)},D.invert=function(L){return L=L||new i,i.invert(L,this)},D.adjoint=function(L){return L=L||new i,i.adjoint(L,this)},D.determinant=function(){return i.determinant(this)},D.add=function(L,D){return D=D||new i,i.add(D,this,L)},D.subtract=function(L){return i.subtract(this,this,L)},D.multiply=function(L){return i.multiply(this,this,L)},D.multiplyScalar=function(L){return i.multiplyScalar(this,this,L)},D.translate=function(L,D){return D=D||new i,i.translate(D,this,L)},D.scale=function(L,D){return D=D||new i,i.scale(D,this,L)},D.rotate=function(L,D,P){return P=P||new i,i.rotate(P,this,L,D)},D.getTranslation=function(L){return L=L||new B.default,i.getTranslation(L,this)},D.getScale=function(L){return L=L||new B.default,i.getScaling(L,this)},D.getRotation=function(L){return L=L||new k.default,i.getRotation(L,this)},D.fromRTS=function(L,D,P){return i.fromRTS(this,L,D,P)},D.fromQuat=function(L){return i.fromQuat(this,L)},i}(N.default);P.default=xt,xt.mul=xt.multiply,xt.sub=xt.subtract,xt.IDENTITY=Object.freeze(new xt);var St=new B.default,bt=new V.default;F.default.fastDefine("cc.Mat4",xt,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1});for(var M=function(L){Object.defineProperty(xt.prototype,"m"+L,{get:function(){return this.m[L]},set:function(D){this.m[L]=D}})},wt=0;wt<16;wt++)M(wt);cc.mat4=function(L,D,P,N,F,B,k,U,V,z,W,H,G,X,nt,ut){var dt=new xt(L,D,P,N,F,B,k,U,V,z,W,H,G,X,nt,ut);return void 0===L&&xt.identity(dt),dt},cc.Mat4=xt,D.exports=P.default},{"../platform/CCClass":137,"./mat3":226,"./quat":228,"./utils":232,"./value-type":233,"./vec3":235}],228:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=c(L("./value-type")),F=c(L("../platform/CCClass")),B=c(L("./vec3")),k=c(L("./mat3")),U=L("./utils");function c(L){return L&&L.__esModule?L:{default:L}}var V=0,z=0,W=0,H=0,G=function(L){!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(i,L);var D=i.prototype;function i(D,P,N,F){var B;return void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),void 0===F&&(F=1),(B=L.call(this)||this).x=void 0,B.y=void 0,B.z=void 0,B.w=void 0,D&&"object"==typeof D?(B.z=D.z,B.y=D.y,B.w=D.w,B.x=D.x):(B.x=D,B.y=P,B.z=N,B.w=F),B}return D.mul=function(L,D){return i.multiply(D||new i,this,L)},i.clone=function(L){return new i(L.x,L.y,L.z,L.w)},i.copy=function(L,D){return L.x=D.x,L.y=D.y,L.z=D.z,L.w=D.w,L},i.set=function(L,D,P,N,F){return L.x=D,L.y=P,L.z=N,L.w=F,L},i.identity=function(L){return L.x=0,L.y=0,L.z=0,L.w=1,L},i.rotationTo=function(L,D,P){var N=B.default.dot(D,P);return N<-.999999?(B.default.cross(ut,B.default.RIGHT,D),ut.mag()<1e-6&&B.default.cross(ut,B.default.UP,D),B.default.normalize(ut,ut),i.fromAxisAngle(L,ut,Math.PI),L):N>.999999?(L.x=0,L.y=0,L.z=0,L.w=1,L):(B.default.cross(ut,D,P),L.x=ut.x,L.y=ut.y,L.z=ut.z,L.w=1+N,i.normalize(L,L))},i.getAxisAngle=function(L,D){var P=2*Math.acos(D.w),N=Math.sin(P/2);return 0!==N?(L.x=D.x/N,L.y=D.y/N,L.z=D.z/N):(L.x=1,L.y=0,L.z=0),P},i.multiply=function(L,D,P){return V=D.x*P.w+D.w*P.x+D.y*P.z-D.z*P.y,z=D.y*P.w+D.w*P.y+D.z*P.x-D.x*P.z,W=D.z*P.w+D.w*P.z+D.x*P.y-D.y*P.x,H=D.w*P.w-D.x*P.x-D.y*P.y-D.z*P.z,L.x=V,L.y=z,L.z=W,L.w=H,L},i.multiplyScalar=function(L,D,P){return L.x=D.x*P,L.y=D.y*P,L.z=D.z*P,L.w=D.w*P,L},i.scaleAndAdd=function(L,D,P,N){return L.x=D.x+P.x*N,L.y=D.y+P.y*N,L.z=D.z+P.z*N,L.w=D.w+P.w*N,L},i.rotateX=function(L,D,P){P*=.5;var N=Math.sin(P),F=Math.cos(P);return L.x=D.x*F+D.w*N,L.y=D.y*F+D.z*N,L.z=D.z*F-D.y*N,L.w=D.w*F-D.x*N,L},i.rotateY=function(L,D,P){P*=.5;var N=Math.sin(P),F=Math.cos(P);return L.x=D.x*F-D.z*N,L.y=D.y*F+D.w*N,L.z=D.z*F+D.x*N,L.w=D.w*F-D.y*N,L},i.rotateZ=function(L,D,P){P*=.5;var N=Math.sin(P),F=Math.cos(P);return L.x=D.x*F+D.y*N,L.y=D.y*F-D.x*N,L.z=D.z*F+D.w*N,L.w=D.w*F-D.z*N,L},i.rotateAround=function(L,D,P,N){return i.invert(X,D),B.default.transformQuat(ut,P,X),i.fromAxisAngle(X,ut,N),i.multiply(L,D,X),L},i.rotateAroundLocal=function(L,D,P,N){return i.fromAxisAngle(X,P,N),i.multiply(L,D,X),L},i.calculateW=function(L,D){return L.x=D.x,L.y=D.y,L.z=D.z,L.w=Math.sqrt(Math.abs(1-D.x*D.x-D.y*D.y-D.z*D.z)),L},i.dot=function(L,D){return L.x*D.x+L.y*D.y+L.z*D.z+L.w*D.w},i.lerp=function(L,D,P,N){return L.x=D.x+N*(P.x-D.x),L.y=D.y+N*(P.y-D.y),L.z=D.z+N*(P.z-D.z),L.w=D.w+N*(P.w-D.w),L},i.slerp=function(L,D,P,N){var F=0,B=0,k=D.x*P.x+D.y*P.y+D.z*P.z+D.w*P.w;if(k<0&&(k=-k,P.x=-P.x,P.y=-P.y,P.z=-P.z,P.w=-P.w),1-k>1e-6){var U=Math.acos(k),V=Math.sin(U);F=Math.sin((1-N)*U)/V,B=Math.sin(N*U)/V}else F=1-N,B=N;return L.x=F*D.x+B*P.x,L.y=F*D.y+B*P.y,L.z=F*D.z+B*P.z,L.w=F*D.w+B*P.w,L},i.sqlerp=function(L,D,P,N,F,B){return i.slerp(X,D,F,B),i.slerp(nt,P,N,B),i.slerp(L,X,nt,2*B*(1-B)),L},i.invert=function(L,D){var P=D.x*D.x+D.y*D.y+D.z*D.z+D.w*D.w,N=P?1/P:0;return L.x=-D.x*N,L.y=-D.y*N,L.z=-D.z*N,L.w=D.w*N,L},i.conjugate=function(L,D){return L.x=-D.x,L.y=-D.y,L.z=-D.z,L.w=D.w,L},i.len=function(L){return Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z+L.w*L.w)},i.lengthSqr=function(L){return L.x*L.x+L.y*L.y+L.z*L.z+L.w*L.w},i.normalize=function(L,D){var P=D.x*D.x+D.y*D.y+D.z*D.z+D.w*D.w;return P>0&&(P=1/Math.sqrt(P),L.x=D.x*P,L.y=D.y*P,L.z=D.z*P,L.w=D.w*P),L},i.fromAxes=function(L,D,P,N){return k.default.set(dt,D.x,D.y,D.z,P.x,P.y,P.z,N.x,N.y,N.z),i.normalize(L,i.fromMat3(L,dt))},i.fromViewUp=function(L,D,P){return k.default.fromViewUp(dt,D,P),i.normalize(L,i.fromMat3(L,dt))},i.fromAxisAngle=function(L,D,P){P*=.5;var N=Math.sin(P);return L.x=N*D.x,L.y=N*D.y,L.z=N*D.z,L.w=Math.cos(P),L},i.fromAngleZ=function(L,D){return D*=ft,L.x=L.y=0,L.z=Math.sin(D),L.w=Math.cos(D),L},i.fromMat3=function(L,D){var P=D.m,N=P[0],F=P[1],B=P[2],k=P[3],U=P[4],V=P[5],z=P[6],W=P[7],H=P[8],G=N+U+H;if(G>0){var X=.5/Math.sqrt(G+1);L.w=.25/X,L.x=(V-W)*X,L.y=(z-B)*X,L.z=(F-k)*X}else if(N>U&&N>H){var nt=2*Math.sqrt(1+N-U-H);L.w=(V-W)/nt,L.x=.25*nt,L.y=(k+F)/nt,L.z=(z+B)/nt}else if(U>H){var ut=2*Math.sqrt(1+U-N-H);L.w=(z-B)/ut,L.x=(k+F)/ut,L.y=.25*ut,L.z=(W+V)/ut}else{var dt=2*Math.sqrt(1+H-N-U);L.w=(F-k)/dt,L.x=(z+B)/dt,L.y=(W+V)/dt,L.z=.25*dt}return L},i.fromEuler=function(L,D,P,N){D*=ft,P*=ft,N*=ft;var F=Math.sin(D),B=Math.cos(D),k=Math.sin(P),U=Math.cos(P),V=Math.sin(N),z=Math.cos(N);return L.x=F*U*z+B*k*V,L.y=B*k*z+F*U*V,L.z=B*U*V-F*k*z,L.w=B*U*z-F*k*V,L},i.toAxisX=function(L,D){var P=2*D.y,N=2*D.z;return L.x=1-P*D.y-N*D.z,L.y=P*D.x+N*D.w,L.z=N*D.x+P*D.w,L},i.toAxisY=function(L,D){var P=2*D.x,N=2*D.y,F=2*D.z;return L.x=N*D.x-F*D.w,L.y=1-P*D.x-F*D.z,L.z=F*D.y+P*D.w,L},i.toAxisZ=function(L,D){var P=2*D.x,N=2*D.y,F=2*D.z;return L.x=F*D.x-N*D.w,L.y=F*D.y-P*D.w,L.z=1-P*D.x-N*D.y,L},i.toEuler=function(L,D,P){var N=D.x,F=D.y,B=D.z,k=D.w,V=0,z=0,W=0,H=N*F+B*k;if(H>.499999)V=0,z=(0,U.toDegree)(2*Math.atan2(N,k)),W=90;else if(H<-.499999)V=0,z=-(0,U.toDegree)(2*Math.atan2(N,k)),W=-90;else{var G=N*N,X=F*F,nt=B*B;V=(0,U.toDegree)(Math.atan2(2*N*k-2*F*B,1-2*G-2*nt)),z=(0,U.toDegree)(Math.atan2(2*F*k-2*N*B,1-2*X-2*nt)),W=(0,U.toDegree)(Math.asin(2*H)),P&&(V=-180*Math.sign(V+1e-6)+V,z=-180*Math.sign(z+1e-6)+z,W=180*Math.sign(W+1e-6)-W)}return L.x=V,L.y=z,L.z=W,L},i.strictEquals=function(L,D){return L.x===D.x&&L.y===D.y&&L.z===D.z&&L.w===D.w},i.equals=function(L,D,P){return void 0===P&&(P=U.EPSILON),Math.abs(L.x-D.x)<=P*Math.max(1,Math.abs(L.x),Math.abs(D.x))&&Math.abs(L.y-D.y)<=P*Math.max(1,Math.abs(L.y),Math.abs(D.y))&&Math.abs(L.z-D.z)<=P*Math.max(1,Math.abs(L.z),Math.abs(D.z))&&Math.abs(L.w-D.w)<=P*Math.max(1,Math.abs(L.w),Math.abs(D.w))},i.toArray=function(L,D,P){return void 0===P&&(P=0),L[P+0]=D.x,L[P+1]=D.y,L[P+2]=D.z,L[P+3]=D.w,L},i.fromArray=function(L,D,P){return void 0===P&&(P=0),L.x=D[P+0],L.y=D[P+1],L.z=D[P+2],L.w=D[P+3],L},D.clone=function(){return new i(this.x,this.y,this.z,this.w)},D.set=function(L){return this.x=L.x,this.y=L.y,this.z=L.z,this.w=L.w,this},D.equals=function(L){return L&&this.x===L.x&&this.y===L.y&&this.z===L.z&&this.w===L.w},D.toEuler=function(L){return i.toEuler(L,this)},D.fromEuler=function(L){return i.fromEuler(this,L.x,L.y,L.z)},D.lerp=function(L,D,P){return P=P||new i,i.slerp(P,this,L,D),P},D.multiply=function(L){return i.multiply(this,this,L)},D.rotateAround=function(L,D,P,N){return N=N||new i,i.rotateAround(N,L,D,P)},i}(N.default);P.default=G,G.mul=G.multiply,G.scale=G.multiplyScalar,G.mag=G.len,G.IDENTITY=Object.freeze(new G);var X=new G,nt=new G,ut=new B.default,dt=new k.default,ft=.5*Math.PI/180;F.default.fastDefine("cc.Quat",G,{x:0,y:0,z:0,w:1}),cc.quat=function(L,D,P,N){return new G(L,D,P,N)},cc.Quat=G,D.exports=P.default},{"../platform/CCClass":137,"./mat3":226,"./utils":232,"./value-type":233,"./vec3":235}],229:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=o(L("./value-type")),F=o(L("../platform/CCClass")),B=o(L("./vec2")),k=o(L("./size"));function o(L){return L&&L.__esModule?L:{default:L}}function c(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var U=function(L){function e(D,P,N,F){var B;return void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),void 0===F&&(F=0),(B=L.call(this)||this).x=void 0,B.y=void 0,B.width=void 0,B.height=void 0,D&&"object"==typeof D&&(P=D.y,N=D.width,F=D.height,D=D.x),B.x=D||0,B.y=P||0,B.width=N||0,B.height=F||0,B}(function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D})(e,L),e.fromMinMax=function(L,D){var P=Math.min(L.x,D.x),N=Math.min(L.y,D.y);return new e(P,N,Math.max(L.x,D.x)-P,Math.max(L.y,D.y)-N)};var D=e.prototype;return D.clone=function(){return new e(this.x,this.y,this.width,this.height)},D.equals=function(L){return L&&this.x===L.x&&this.y===L.y&&this.width===L.width&&this.height===L.height},D.lerp=function(L,D,P){P=P||new e;var N=this.x,F=this.y,B=this.width,k=this.height;return P.x=N+(L.x-N)*D,P.y=F+(L.y-F)*D,P.width=B+(L.width-B)*D,P.height=k+(L.height-k)*D,P},D.set=function(L){return this.x=L.x,this.y=L.y,this.width=L.width,this.height=L.height,this},D.intersects=function(L){var D=this.x+this.width,P=this.y+this.height,N=L.x+L.width,F=L.y+L.height;return!(D<L.x||N<this.x||P<L.y||F<this.y)},D.intersection=function(L,D){var P=this.x,N=this.y,F=this.x+this.width,B=this.y+this.height,k=D.x,U=D.y,V=D.x+D.width,z=D.y+D.height;return L.x=Math.max(P,k),L.y=Math.max(N,U),L.width=Math.min(F,V)-L.x,L.height=Math.min(B,z)-L.y,L},D.contains=function(L){return this.x<=L.x&&this.x+this.width>=L.x&&this.y<=L.y&&this.y+this.height>=L.y},D.containsRect=function(L){return this.x<=L.x&&this.x+this.width>=L.x+L.width&&this.y<=L.y&&this.y+this.height>=L.y+L.height},D.union=function(L,D){var P=this.x,N=this.y,F=this.width,B=this.height,k=D.x,U=D.y,V=D.width,z=D.height;return L.x=Math.min(P,k),L.y=Math.min(N,U),L.width=Math.max(P+F,k+V)-L.x,L.height=Math.max(N+B,U+z)-L.y,L},D.transformMat4=function(L,D){var P=this.x,N=this.y,F=P+this.width,B=N+this.height,k=D.m,U=k[0]*P+k[4]*N+k[12],V=k[1]*P+k[5]*N+k[13],z=k[0]*F+k[4]*N+k[12],W=k[1]*F+k[5]*N+k[13],H=k[0]*P+k[4]*B+k[12],G=k[1]*P+k[5]*B+k[13],X=k[0]*F+k[4]*B+k[12],nt=k[1]*F+k[5]*B+k[13],ut=Math.min(U,z,H,X),dt=Math.max(U,z,H,X),ft=Math.min(V,W,G,nt),_t=Math.max(V,W,G,nt);return L.x=ut,L.y=ft,L.width=dt-ut,L.height=_t-ft,L},D.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},function(L,D,P){D&&c(L.prototype,D),P&&c(L,P)}(e,[{key:"xMin",get:function(){return this.x},set:function(L){this.width+=this.x-L,this.x=L}},{key:"yMin",get:function(){return this.y},set:function(L){this.height+=this.y-L,this.y=L}},{key:"xMax",get:function(){return this.x+this.width},set:function(L){this.width=L-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(L){this.height=L-this.y}},{key:"center",get:function(){return new B.default(this.x+.5*this.width,this.y+.5*this.height)},set:function(L){this.x=L.x-.5*this.width,this.y=L.y-.5*this.height}},{key:"origin",get:function(){return new B.default(this.x,this.y)},set:function(L){this.x=L.x,this.y=L.y}},{key:"size",get:function(){return new k.default(this.width,this.height)},set:function(L){this.width=L.width,this.height=L.height}}]),e}(N.default);P.default=U,F.default.fastDefine("cc.Rect",U,{x:0,y:0,width:0,height:0}),cc.Rect=U,cc.rect=function(L,D,P,N){return new U(L,D,P,N)},D.exports=P.default},{"../platform/CCClass":137,"./size":230,"./value-type":233,"./vec2":234}],230:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=s(L("./value-type")),F=s(L("../platform/CCClass"));function s(L){return L&&L.__esModule?L:{default:L}}function a(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var B=function(L){function e(D,P){var N;return void 0===D&&(D=0),void 0===P&&(P=0),(N=L.call(this)||this).width=void 0,N.height=void 0,D&&"object"==typeof D?(N.height=D.height,N.width=D.width):(N.width=D||0,N.height=P||0),N}(function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D})(e,L),function(L,D,P){D&&a(L.prototype,D),P&&a(L,P)}(e,null,[{key:"ZERO",get:function(){return new e}}]);var D=e.prototype;return D.clone=function(){return new e(this.width,this.height)},D.equals=function(L){return L&&this.width===L.width&&this.height===L.height},D.lerp=function(L,D,P){P=P||new e;var N=this.width,F=this.height;return P.width=N+(L.width-N)*D,P.height=F+(L.height-F)*D,P},D.set=function(L){return this.width=L.width,this.height=L.height,this},D.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},e}(N.default);P.default=B,B.ZERO_R=B.ZERO,F.default.fastDefine("cc.Size",B,{width:0,height:0}),cc.size=function(L,D){return new B(L,D)},cc.Size=B,D.exports=P.default},{"../platform/CCClass":137,"./value-type":233}],231:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./quat")),F=new N.default,B=function(){function t(){}return t.toRotation=function(L,D){return L.x=D[3],L.y=D[4],L.z=D[5],L.w=D[6],L},t.fromRotation=function(L,D){return L[3]=D.x,L[4]=D.y,L[5]=D.z,L[6]=D.w,L},t.toEuler=function(L,D){return t.toRotation(F,D),N.default.toEuler(L,F),L},t.fromEuler=function(L,D){return N.default.fromEuler(F,D.x,D.y,D.z),t.fromRotation(L,F),L},t.fromEulerNumber=function(L,D,P,B){return N.default.fromEuler(F,D,P,B),t.fromRotation(L,F),L},t.toScale=function(L,D){return L.x=D[7],L.y=D[8],L.z=D[9],L},t.fromScale=function(L,D){return L[7]=D.x,L[8]=D.y,L[9]=D.z,L},t.toPosition=function(L,D){return L.x=D[0],L.y=D[1],L.z=D[2],L},t.fromPosition=function(L,D){return L[0]=D.x,L[1]=D.y,L[2]=D.z,L},t.fromAngleZ=function(L,D){return N.default.fromAngleZ(F,D),t.fromRotation(L,F),L},t.toMat4=function(L,D){var P=D[3],N=D[4],F=D[5],B=D[6],k=P+P,U=N+N,V=F+F,z=P*k,W=P*U,H=P*V,G=N*U,X=N*V,nt=F*V,ut=B*k,dt=B*U,ft=B*V,_t=D[7],pt=D[8],vt=D[9],gt=L.m;return gt[0]=(1-(G+nt))*_t,gt[1]=(W+ft)*_t,gt[2]=(H-dt)*_t,gt[3]=0,gt[4]=(W-ft)*pt,gt[5]=(1-(z+nt))*pt,gt[6]=(X+ut)*pt,gt[7]=0,gt[8]=(H+dt)*vt,gt[9]=(X-ut)*vt,gt[10]=(1-(z+G))*vt,gt[11]=0,gt[12]=D[0],gt[13]=D[1],gt[14]=D[2],gt[15]=1,L},t}();P.default=B,cc.Trs=B,D.exports=P.default},{"./quat":228}],232:[function(L,D,P){"use strict";P.__esModule=!0,P.equals=function(L,D){return Math.abs(L-D)<=B*Math.max(1,Math.abs(L),Math.abs(D))},P.approx=function(L,D,P){return P=P||B,Math.abs(L-D)<=P},P.clamp=function(L,D,P){return L<D?D:L>P?P:L},P.clamp01=function(L){return L<0?0:L>1?1:L},P.lerp=function(L,D,P){return L+(D-L)*P},P.toRadian=function(L){return L*N},P.toDegree=function(L){return L*F},P.randomRange=c,P.randomRangeInt=function(L,D){return Math.floor(c(L,D))},P.pseudoRandom=l,P.pseudoRandomRange=h,P.pseudoRandomRangeInt=function(L,D,P){return Math.floor(h(L,D,P))},P.nextPow2=function(L){return--L,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,L|=L>>16,++L},P.repeat=u,P.pingPong=function(L,D){return L=u(L,2*D),D-Math.abs(L-D)},P.inverseLerp=function(L,D,P){return(P-L)/(D-L)},P.sign=function(L){return(L>0)-(L<0)},P.random=P.FLOAT_BYTES=P.FLOAT_ARRAY_TYPE=P.INT_MIN=P.INT_MAX=P.INT_BITS=P.EPSILON=void 0;var N=Math.PI/180,F=180/Math.PI,B=1e-6;P.EPSILON=B,P.INT_BITS=32,P.INT_MAX=2147483647,P.INT_MIN=-1<<31;var k=Float64Array;P.FLOAT_ARRAY_TYPE=k,P.FLOAT_BYTES=8;var U=Math.random;function c(L,D){return Math.random()*(D-L)+L}function l(L){return(L=(9301*L+49297)%233280)/233280}function h(L,D,P){return l(L)*(P-D)+D}function u(L,D){return L-Math.floor(L/D)*D}P.random=U},{}],233:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../platform/js")),F=function(){function t(){}var L=t.prototype;return L.clone=function(){return cc.errorID("0100",N.default.getClassName(this)+".clone"),null},L.equals=function(L){return cc.errorID("0100",N.default.getClassName(this)+".equals"),!1},L.lerp=function(L,D){return cc.errorID("0100",N.default.getClassName(this)+".lerp"),this.clone()},L.set=function(L){cc.errorID("0100",N.default.getClassName(this)+".set")},L.toString=function(){return""+{}},t}();P.default=F,N.default.setClassName("cc.ValueType",F),cc.ValueType=F,D.exports=P.default},{"../platform/js":157}],234:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=o(L("./value-type")),F=o(L("../platform/CCClass")),B=o(L("../utils/misc")),k=L("./utils");function o(L){return L&&L.__esModule?L:{default:L}}function c(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var U=0,V=0,z=function(L){!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(i,L);var D=i.prototype;function i(D,P){var N;return void 0===D&&(D=0),void 0===P&&(P=0),(N=L.call(this)||this).mag=i.prototype.len,N.magSqr=i.prototype.lengthSqr,N.subSelf=i.prototype.subtract,N.mulSelf=i.prototype.multiplyScalar,N.divSelf=i.prototype.divide,N.scaleSelf=i.prototype.multiply,N.negSelf=i.prototype.negate,N.x=void 0,N.y=void 0,N.z=0,D&&"object"==typeof D?(N.y=D.y||0,N.x=D.x||0):(N.x=D||0,N.y=P||0),N}return D.sub=function(L,D){return i.subtract(D||new i,this,L)},D.mul=function(L,D){return i.multiplyScalar(D||new i,this,L)},D.div=function(L,D){return i.multiplyScalar(D||new i,this,1/L)},D.scale=function(L,D){return i.multiply(D||new i,this,L)},D.neg=function(L){return i.negate(L||new i,this)},i.clone=function(L){return new i(L.x,L.y)},i.copy=function(L,D){return L.x=D.x,L.y=D.y,L},i.set=function(L,D,P){return L.x=D,L.y=P,L},i.add=function(L,D,P){return L.x=D.x+P.x,L.y=D.y+P.y,L},i.subtract=function(L,D,P){return L.x=D.x-P.x,L.y=D.y-P.y,L},i.multiply=function(L,D,P){return L.x=D.x*P.x,L.y=D.y*P.y,L},i.divide=function(L,D,P){return L.x=D.x/P.x,L.y=D.y/P.y,L},i.ceil=function(L,D){return L.x=Math.ceil(D.x),L.y=Math.ceil(D.y),L},i.floor=function(L,D){return L.x=Math.floor(D.x),L.y=Math.floor(D.y),L},i.min=function(L,D,P){return L.x=Math.min(D.x,P.x),L.y=Math.min(D.y,P.y),L},i.max=function(L,D,P){return L.x=Math.max(D.x,P.x),L.y=Math.max(D.y,P.y),L},i.round=function(L,D){return L.x=Math.round(D.x),L.y=Math.round(D.y),L},i.multiplyScalar=function(L,D,P){return L.x=D.x*P,L.y=D.y*P,L},i.scaleAndAdd=function(L,D,P,N){return L.x=D.x+P.x*N,L.y=D.y+P.y*N,L},i.distance=function(L,D){return U=D.x-L.x,V=D.y-L.y,Math.sqrt(U*U+V*V)},i.squaredDistance=function(L,D){return U=D.x-L.x,V=D.y-L.y,U*U+V*V},i.len=function(L){return U=L.x,V=L.y,Math.sqrt(U*U+V*V)},i.lengthSqr=function(L){return U=L.x,V=L.y,U*U+V*V},i.negate=function(L,D){return L.x=-D.x,L.y=-D.y,L},i.inverse=function(L,D){return L.x=1/D.x,L.y=1/D.y,L},i.inverseSafe=function(L,D){return U=D.x,V=D.y,Math.abs(U)<k.EPSILON?L.x=0:L.x=1/U,Math.abs(V)<k.EPSILON?L.y=0:L.y=1/V,L},i.normalize=function(L,D){U=D.x,V=D.y;var P=U*U+V*V;return P>0&&(P=1/Math.sqrt(P),L.x=U*P,L.y=V*P),L},i.dot=function(L,D){return L.x*D.x+L.y*D.y},i.cross=function(L,D,P){return L.x=L.y=0,L.z=D.x*P.y-D.y*P.x,L},i.lerp=function(L,D,P,N){return U=D.x,V=D.y,L.x=U+N*(P.x-U),L.y=V+N*(P.y-V),L},i.random=function(L,D){D=D||1;var P=2*(0,k.random)()*Math.PI;return L.x=Math.cos(P)*D,L.y=Math.sin(P)*D,L},i.transformMat3=function(L,D,P){U=D.x,V=D.y;var N=P.m;return L.x=N[0]*U+N[3]*V+N[6],L.y=N[1]*U+N[4]*V+N[7],L},i.transformMat4=function(L,D,P){U=D.x,V=D.y;var N=P.m;return L.x=N[0]*U+N[4]*V+N[12],L.y=N[1]*U+N[5]*V+N[13],L},i.strictEquals=function(L,D){return L.x===D.x&&L.y===D.y},i.equals=function(L,D,P){return void 0===P&&(P=k.EPSILON),Math.abs(L.x-D.x)<=P*Math.max(1,Math.abs(L.x),Math.abs(D.x))&&Math.abs(L.y-D.y)<=P*Math.max(1,Math.abs(L.y),Math.abs(D.y))},i.angle=function(L,D){i.normalize(W,L),i.normalize(H,D);var P=i.dot(W,H);return P>1?0:P<-1?Math.PI:Math.acos(P)},i.toArray=function(L,D,P){return void 0===P&&(P=0),L[P+0]=D.x,L[P+1]=D.y,L},i.fromArray=function(L,D,P){return void 0===P&&(P=0),L.x=D[P+0],L.y=D[P+1],L},function(L,D,P){D&&c(L.prototype,D),P&&c(L,P)}(i,null,[{key:"ONE",get:function(){return new i(1,1)}},{key:"ZERO",get:function(){return new i(0,0)}},{key:"UP",get:function(){return new i(0,1)}},{key:"RIGHT",get:function(){return new i(1,0)}}]),D.clone=function(){return new i(this.x,this.y)},D.set=function(L){return this.x=L.x,this.y=L.y,this},D.equals=function(L){return L&&this.x===L.x&&this.y===L.y},D.fuzzyEquals=function(L,D){return this.x-D<=L.x&&L.x<=this.x+D&&this.y-D<=L.y&&L.y<=this.y+D},D.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},D.lerp=function(L,D,P){P=P||new i;var N=this.x,F=this.y;return P.x=N+(L.x-N)*D,P.y=F+(L.y-F)*D,P},D.clampf=function(L,D){return this.x=B.default.clampf(this.x,L.x,D.x),this.y=B.default.clampf(this.y,L.y,D.y),this},D.add=function(L,D){return(D=D||new i).x=this.x+L.x,D.y=this.y+L.y,D},D.addSelf=function(L){return this.x+=L.x,this.y+=L.y,this},D.subtract=function(L){return this.x-=L.x,this.y-=L.y,this},D.multiplyScalar=function(L){return this.x*=L,this.y*=L,this},D.multiply=function(L){return this.x*=L.x,this.y*=L.y,this},D.divide=function(L){return this.x/=L,this.y/=L,this},D.negate=function(){return this.x=-this.x,this.y=-this.y,this},D.dot=function(L){return this.x*L.x+this.y*L.y},D.cross=function(L){return this.x*L.y-this.y*L.x},D.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},D.lengthSqr=function(){return this.x*this.x+this.y*this.y},D.normalizeSelf=function(){var L=this.x*this.x+this.y*this.y;if(1===L)return this;if(0===L)return this;var D=1/Math.sqrt(L);return this.x*=D,this.y*=D,this},D.normalize=function(L){return(L=L||new i).x=this.x,L.y=this.y,L.normalizeSelf(),L},D.angle=function(L){var D=this.magSqr(),P=L.magSqr();if(0===D||0===P)return console.warn("Can't get angle between zero vector"),0;var N=this.dot(L)/Math.sqrt(D*P);return N=B.default.clampf(N,-1,1),Math.acos(N)},D.signAngle=function(L){var D=this.angle(L);return this.cross(L)<0?-D:D},D.rotate=function(L,D){return(D=D||new i).x=this.x,D.y=this.y,D.rotateSelf(L)},D.rotateSelf=function(L){var D=Math.sin(L),P=Math.cos(L),N=this.x;return this.x=P*N-D*this.y,this.y=D*N+P*this.y,this},D.project=function(L){return L.multiplyScalar(this.dot(L)/L.dot(L))},D.transformMat4=function(L,D){return D=D||new i,i.transformMat4(D,this,L),D},D.maxAxis=function(){return Math.max(this.x,this.y)},i}(N.default);P.default=z,z.sub=z.subtract,z.mul=z.multiply,z.scale=z.multiplyScalar,z.mag=z.len,z.squaredMagnitude=z.lengthSqr,z.div=z.divide,z.ONE_R=z.ONE,z.ZERO_R=z.ZERO,z.UP_R=z.UP,z.RIGHT_R=z.RIGHT;var W=new z,H=new z;F.default.fastDefine("cc.Vec2",z,{x:0,y:0}),cc.v2=function(L,D){return new z(L,D)},cc.Vec2=z,D.exports=P.default},{"../platform/CCClass":137,"../utils/misc":210,"./utils":232,"./value-type":233}],235:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=c(L("./value-type")),F=c(L("../platform/CCClass")),B=c(L("../utils/misc")),k=c(L("./vec2")),U=L("./utils");function c(L){return L&&L.__esModule?L:{default:L}}function l(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var V=0,z=0,W=0,H=function(L){!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(i,L);var D=i.prototype;function i(D,P,N){var F;return void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),(F=L.call(this)||this).mag=i.prototype.len,F.magSqr=i.prototype.lengthSqr,F.subSelf=i.prototype.subtract,F.mulSelf=i.prototype.multiplyScalar,F.divSelf=i.prototype.divide,F.scaleSelf=i.prototype.multiply,F.negSelf=i.prototype.negate,F.x=void 0,F.y=void 0,F.z=void 0,F.angle=k.default.prototype.angle,F.project=k.default.prototype.project,D&&"object"==typeof D?(F.z=D.z,F.y=D.y,F.x=D.x):(F.x=D,F.y=P,F.z=N),F}return D.sub=function(L,D){return i.subtract(D||new i,this,L)},D.mul=function(L,D){return i.multiplyScalar(D||new i,this,L)},D.div=function(L,D){return i.multiplyScalar(D||new i,this,1/L)},D.scale=function(L,D){return i.multiply(D||new i,this,L)},D.neg=function(L){return i.negate(L||new i,this)},i.zero=function(L){return L.x=0,L.y=0,L.z=0,L},i.clone=function(L){return new i(L.x,L.y,L.z)},i.copy=function(L,D){return L.x=D.x,L.y=D.y,L.z=D.z,L},i.set=function(L,D,P,N){return L.x=D,L.y=P,L.z=N,L},i.add=function(L,D,P){return L.x=D.x+P.x,L.y=D.y+P.y,L.z=D.z+P.z,L},i.subtract=function(L,D,P){return L.x=D.x-P.x,L.y=D.y-P.y,L.z=D.z-P.z,L},i.multiply=function(L,D,P){return L.x=D.x*P.x,L.y=D.y*P.y,L.z=D.z*P.z,L},i.divide=function(L,D,P){return L.x=D.x/P.x,L.y=D.y/P.y,L.z=D.z/P.z,L},i.ceil=function(L,D){return L.x=Math.ceil(D.x),L.y=Math.ceil(D.y),L.z=Math.ceil(D.z),L},i.floor=function(L,D){return L.x=Math.floor(D.x),L.y=Math.floor(D.y),L.z=Math.floor(D.z),L},i.min=function(L,D,P){return L.x=Math.min(D.x,P.x),L.y=Math.min(D.y,P.y),L.z=Math.min(D.z,P.z),L},i.max=function(L,D,P){return L.x=Math.max(D.x,P.x),L.y=Math.max(D.y,P.y),L.z=Math.max(D.z,P.z),L},i.round=function(L,D){return L.x=Math.round(D.x),L.y=Math.round(D.y),L.z=Math.round(D.z),L},i.multiplyScalar=function(L,D,P){return L.x=D.x*P,L.y=D.y*P,L.z=D.z*P,L},i.scaleAndAdd=function(L,D,P,N){return L.x=D.x+P.x*N,L.y=D.y+P.y*N,L.z=D.z+P.z*N,L},i.distance=function(L,D){return V=D.x-L.x,z=D.y-L.y,W=D.z-L.z,Math.sqrt(V*V+z*z+W*W)},i.squaredDistance=function(L,D){return V=D.x-L.x,z=D.y-L.y,W=D.z-L.z,V*V+z*z+W*W},i.len=function(L){return V=L.x,z=L.y,W=L.z,Math.sqrt(V*V+z*z+W*W)},i.lengthSqr=function(L){return V=L.x,z=L.y,W=L.z,V*V+z*z+W*W},i.negate=function(L,D){return L.x=-D.x,L.y=-D.y,L.z=-D.z,L},i.inverse=function(L,D){return L.x=1/D.x,L.y=1/D.y,L.z=1/D.z,L},i.inverseSafe=function(L,D){return V=D.x,z=D.y,W=D.z,Math.abs(V)<U.EPSILON?L.x=0:L.x=1/V,Math.abs(z)<U.EPSILON?L.y=0:L.y=1/z,Math.abs(W)<U.EPSILON?L.z=0:L.z=1/W,L},i.normalize=function(L,D){V=D.x,z=D.y,W=D.z;var P=V*V+z*z+W*W;return P>0&&(P=1/Math.sqrt(P),L.x=V*P,L.y=z*P,L.z=W*P),L},i.dot=function(L,D){return L.x*D.x+L.y*D.y+L.z*D.z},i.cross=function(L,D,P){var N=D.x,F=D.y,B=D.z,k=P.x,U=P.y,V=P.z;return L.x=F*V-B*U,L.y=B*k-N*V,L.z=N*U-F*k,L},i.lerp=function(L,D,P,N){return L.x=D.x+N*(P.x-D.x),L.y=D.y+N*(P.y-D.y),L.z=D.z+N*(P.z-D.z),L},i.random=function(L,D){D=D||1;var P=2*(0,U.random)()*Math.PI,N=2*(0,U.random)()-1,F=Math.sqrt(1-N*N);return L.x=F*Math.cos(P)*D,L.y=F*Math.sin(P)*D,L.z=N*D,L},i.transformMat4=function(L,D,P){V=D.x,z=D.y,W=D.z;var N=P.m,F=N[3]*V+N[7]*z+N[11]*W+N[15];return F=F?1/F:1,L.x=(N[0]*V+N[4]*z+N[8]*W+N[12])*F,L.y=(N[1]*V+N[5]*z+N[9]*W+N[13])*F,L.z=(N[2]*V+N[6]*z+N[10]*W+N[14])*F,L},i.transformMat4Normal=function(L,D,P){V=D.x,z=D.y,W=D.z;var N=P.m,F=N[3]*V+N[7]*z+N[11]*W;return F=F?1/F:1,L.x=(N[0]*V+N[4]*z+N[8]*W)*F,L.y=(N[1]*V+N[5]*z+N[9]*W)*F,L.z=(N[2]*V+N[6]*z+N[10]*W)*F,L},i.transformMat3=function(L,D,P){V=D.x,z=D.y,W=D.z;var N=P.m;return L.x=V*N[0]+z*N[3]+W*N[6],L.y=V*N[1]+z*N[4]+W*N[7],L.z=V*N[2]+z*N[5]+W*N[8],L},i.transformAffine=function(L,D,P){V=D.x,z=D.y,W=D.z;var N=P.m;return L.x=N[0]*V+N[1]*z+N[2]*W+N[3],L.y=N[4]*V+N[5]*z+N[6]*W+N[7],L.x=N[8]*V+N[9]*z+N[10]*W+N[11],L},i.transformQuat=function(L,D,P){var N=P.w*D.x+P.y*D.z-P.z*D.y,F=P.w*D.y+P.z*D.x-P.x*D.z,B=P.w*D.z+P.x*D.y-P.y*D.x,k=-P.x*D.x-P.y*D.y-P.z*D.z;return L.x=N*P.w+k*-P.x+F*-P.z-B*-P.y,L.y=F*P.w+k*-P.y+B*-P.x-N*-P.z,L.z=B*P.w+k*-P.z+N*-P.y-F*-P.x,L},i.transformRTS=function(L,D,P,N,F){var B=D.x*F.x,k=D.y*F.y,U=D.z*F.z,V=P.w*B+P.y*U-P.z*k,z=P.w*k+P.z*B-P.x*U,W=P.w*U+P.x*k-P.y*B,H=-P.x*B-P.y*k-P.z*U;return L.x=V*P.w+H*-P.x+z*-P.z-W*-P.y+N.x,L.y=z*P.w+H*-P.y+W*-P.x-V*-P.z+N.y,L.z=W*P.w+H*-P.z+V*-P.y-z*-P.x+N.z,L},i.transformInverseRTS=function(L,D,P,N,F){var B=D.x-N.x,k=D.y-N.y,U=D.z-N.z,V=P.w*B-P.y*U+P.z*k,z=P.w*k-P.z*B+P.x*U,W=P.w*U-P.x*k+P.y*B,H=P.x*B+P.y*k+P.z*U;return L.x=(V*P.w+H*P.x+z*P.z-W*P.y)/F.x,L.y=(z*P.w+H*P.y+W*P.x-V*P.z)/F.y,L.z=(W*P.w+H*P.z+V*P.y-z*P.x)/F.z,L},i.rotateX=function(L,D,P,N){V=D.x-P.x,z=D.y-P.y,W=D.z-P.z;var F=Math.cos(N),B=Math.sin(N),k=V,U=z*F-W*B,H=z*B+W*F;return L.x=k+P.x,L.y=U+P.y,L.z=H+P.z,L},i.rotateY=function(L,D,P,N){V=D.x-P.x,z=D.y-P.y,W=D.z-P.z;var F=Math.cos(N),B=Math.sin(N),k=W*B+V*F,U=z,H=W*F-V*B;return L.x=k+P.x,L.y=U+P.y,L.z=H+P.z,L},i.rotateZ=function(L,D,P,N){V=D.x-P.x,z=D.y-P.y,W=D.z-P.z;var F=Math.cos(N),B=Math.sin(N),k=V*F-z*B,U=V*B+z*F,H=W;return L.x=k+P.x,L.y=U+P.y,L.z=H+P.z,L},i.strictEquals=function(L,D){return L.x===D.x&&L.y===D.y&&L.z===D.z},i.equals=function(L,D,P){void 0===P&&(P=U.EPSILON);var N=L.x,F=L.y,B=L.z,k=D.x,V=D.y,z=D.z;return Math.abs(N-k)<=P*Math.max(1,Math.abs(N),Math.abs(k))&&Math.abs(F-V)<=P*Math.max(1,Math.abs(F),Math.abs(V))&&Math.abs(B-z)<=P*Math.max(1,Math.abs(B),Math.abs(z))},i.angle=function(L,D){i.normalize(G,L),i.normalize(X,D);var P=i.dot(G,X);return P>1?0:P<-1?Math.PI:Math.acos(P)},i.projectOnPlane=function(L,D,P){return i.subtract(L,D,i.project(L,D,P))},i.project=function(L,D,P){var N=i.lengthSqr(P);return N<1e-6?i.set(L,0,0,0):i.multiplyScalar(L,P,i.dot(D,P)/N)},i.toArray=function(L,D,P){return void 0===P&&(P=0),L[P+0]=D.x,L[P+1]=D.y,L[P+2]=D.z,L},i.fromArray=function(L,D,P){return void 0===P&&(P=0),L.x=D[P+0],L.y=D[P+1],L.z=D[P+2],L},function(L,D,P){D&&l(L.prototype,D),P&&l(L,P)}(i,null,[{key:"ONE",get:function(){return new i(1,1,1)}},{key:"ZERO",get:function(){return new i}},{key:"UP",get:function(){return new i(0,1,0)}},{key:"RIGHT",get:function(){return new i(1,0,0)}},{key:"FRONT",get:function(){return new i(0,0,1)}}]),D.clone=function(){return new i(this.x,this.y,this.z)},D.set=function(L){return this.x=L.x,this.y=L.y,this.z=L.z,this},D.equals=function(L){return L&&this.x===L.x&&this.y===L.y&&this.z===L.z},D.fuzzyEquals=function(L,D){return this.x-D<=L.x&&L.x<=this.x+D&&this.y-D<=L.y&&L.y<=this.y+D&&this.z-D<=L.z&&L.z<=this.z+D},D.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},D.lerp=function(L,D,P){return P=P||new i,i.lerp(P,this,L,D),P},D.clampf=function(L,D){return this.x=B.default.clampf(this.x,L.x,D.x),this.y=B.default.clampf(this.y,L.y,D.y),this.z=B.default.clampf(this.z,L.z,D.z),this},D.addSelf=function(L){return this.x+=L.x,this.y+=L.y,this.z+=L.z,this},D.add=function(L,D){return(D=D||new i).x=this.x+L.x,D.y=this.y+L.y,D.z=this.z+L.z,D},D.subtract=function(L){return this.x-=L.x,this.y-=L.y,this.z-=L.z,this},D.multiplyScalar=function(L){return this.x*=L,this.y*=L,this.z*=L,this},D.multiply=function(L){return this.x*=L.x,this.y*=L.y,this.z*=L.z,this},D.divide=function(L){return this.x/=L,this.y/=L,this.z/=L,this},D.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},D.dot=function(L){return this.x*L.x+this.y*L.y+this.z*L.z},D.cross=function(L,D){return D=D||new i,i.cross(D,this,L),D},D.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},D.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},D.normalizeSelf=function(){return i.normalize(this,this),this},D.normalize=function(L){return L=L||new i,i.normalize(L,this),L},D.transformMat4=function(L,D){return D=D||new i,i.transformMat4(D,this,L),D},D.maxAxis=function(){return Math.max(this.x,this.y,this.z)},D.signAngle=function(L){cc.warnID(1408,"vec3.signAngle","v2.1","cc.v2(selfVector).signAngle(vector)");var D=new k.default(this.x,this.y),P=new k.default(L.x,L.y);return D.signAngle(P)},D.rotate=function(L,D){return cc.warnID(1408,"vec3.rotate","v2.1","cc.v2(selfVector).rotate(radians, out)"),k.default.prototype.rotate.call(this,L,D)},D.rotateSelf=function(L){return cc.warnID(1408,"vec3.rotateSelf","v2.1","cc.v2(selfVector).rotateSelf(radians)"),k.default.prototype.rotateSelf.call(this,L)},i}(N.default);P.default=H,H.sub=H.subtract,H.mul=H.multiply,H.scale=H.multiplyScalar,H.mag=H.len,H.squaredMagnitude=H.lengthSqr,H.div=H.divide,H.ONE_R=H.ONE,H.ZERO_R=H.ZERO,H.UP_R=H.UP,H.RIGHT_R=H.RIGHT,H.FRONT_R=H.FRONT;var G=new H,X=new H;F.default.fastDefine("cc.Vec3",H,{x:0,y:0,z:0}),cc.v3=function(L,D,P){return new H(L,D,P)},cc.Vec3=H,D.exports=P.default},{"../platform/CCClass":137,"../utils/misc":210,"./utils":232,"./value-type":233,"./vec2":234}],236:[function(L,D,P){"use strict";P.__esModule=!0,P.v4=p,P.default=void 0;var N=a(L("../platform/CCClass")),F=a(L("./value-type")),B=L("./utils");function a(L){return L&&L.__esModule?L:{default:L}}function o(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var k=0,U=0,V=0,z=0,W=function(L){!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(i,L);var D=i.prototype;function i(D,P,N,F){var B;return void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),void 0===F&&(F=0),(B=L.call(this)||this).mag=i.prototype.len,B.magSqr=i.prototype.lengthSqr,B.subSelf=i.prototype.subtract,B.mulSelf=i.prototype.multiplyScalar,B.divSelf=i.prototype.divide,B.scaleSelf=i.prototype.multiply,B.negSelf=i.prototype.negate,B.x=void 0,B.y=void 0,B.z=void 0,B.w=void 0,D&&"object"==typeof D?(B.w=D.w,B.z=D.z,B.y=D.y,B.x=D.x):(B.x=D,B.y=P,B.z=N,B.w=F),B}return D.sub=function(L,D){return i.subtract(D||new i,this,L)},D.mul=function(L,D){return i.multiplyScalar(D||new i,this,L)},D.div=function(L,D){return i.multiplyScalar(D||new i,this,1/L)},D.scale=function(L,D){return i.multiply(D||new i,this,L)},D.neg=function(L){return i.negate(L||new i,this)},i.clone=function(L){return new i(L.x,L.y,L.z,L.w)},i.copy=function(L,D){return L.x=D.x,L.y=D.y,L.z=D.z,L.w=D.w,L},i.set=function(L,D,P,N,F){return L.x=D,L.y=P,L.z=N,L.w=F,L},i.add=function(L,D,P){return L.x=D.x+P.x,L.y=D.y+P.y,L.z=D.z+P.z,L.w=D.w+P.w,L},i.subtract=function(L,D,P){return L.x=D.x-P.x,L.y=D.y-P.y,L.z=D.z-P.z,L.w=D.w-P.w,L},i.multiply=function(L,D,P){return L.x=D.x*P.x,L.y=D.y*P.y,L.z=D.z*P.z,L.w=D.w*P.w,L},i.divide=function(L,D,P){return L.x=D.x/P.x,L.y=D.y/P.y,L.z=D.z/P.z,L.w=D.w/P.w,L},i.ceil=function(L,D){return L.x=Math.ceil(D.x),L.y=Math.ceil(D.y),L.z=Math.ceil(D.z),L.w=Math.ceil(D.w),L},i.floor=function(L,D){return L.x=Math.floor(D.x),L.y=Math.floor(D.y),L.z=Math.floor(D.z),L.w=Math.floor(D.w),L},i.min=function(L,D,P){return L.x=Math.min(D.x,P.x),L.y=Math.min(D.y,P.y),L.z=Math.min(D.z,P.z),L.w=Math.min(D.w,P.w),L},i.max=function(L,D,P){return L.x=Math.max(D.x,P.x),L.y=Math.max(D.y,P.y),L.z=Math.max(D.z,P.z),L.w=Math.max(D.w,P.w),L},i.round=function(L,D){return L.x=Math.round(D.x),L.y=Math.round(D.y),L.z=Math.round(D.z),L.w=Math.round(D.w),L},i.multiplyScalar=function(L,D,P){return L.x=D.x*P,L.y=D.y*P,L.z=D.z*P,L.w=D.w*P,L},i.scaleAndAdd=function(L,D,P,N){return L.x=D.x+P.x*N,L.y=D.y+P.y*N,L.z=D.z+P.z*N,L.w=D.w+P.w*N,L},i.distance=function(L,D){var P=D.x-L.x,N=D.y-L.y,F=D.z-L.z,B=D.w-L.w;return Math.sqrt(P*P+N*N+F*F+B*B)},i.squaredDistance=function(L,D){var P=D.x-L.x,N=D.y-L.y,F=D.z-L.z,B=D.w-L.w;return P*P+N*N+F*F+B*B},i.len=function(L){return k=L.x,U=L.y,V=L.z,z=L.w,Math.sqrt(k*k+U*U+V*V+z*z)},i.lengthSqr=function(L){return k=L.x,U=L.y,V=L.z,z=L.w,k*k+U*U+V*V+z*z},i.negate=function(L,D){return L.x=-D.x,L.y=-D.y,L.z=-D.z,L.w=-D.w,L},i.inverse=function(L,D){return L.x=1/D.x,L.y=1/D.y,L.z=1/D.z,L.w=1/D.w,L},i.inverseSafe=function(L,D){return k=D.x,U=D.y,V=D.z,z=D.w,Math.abs(k)<B.EPSILON?L.x=0:L.x=1/k,Math.abs(U)<B.EPSILON?L.y=0:L.y=1/U,Math.abs(V)<B.EPSILON?L.z=0:L.z=1/V,Math.abs(z)<B.EPSILON?L.w=0:L.w=1/z,L},i.normalize=function(L,D){k=D.x,U=D.y,V=D.z,z=D.w;var P=k*k+U*U+V*V+z*z;return P>0&&(P=1/Math.sqrt(P),L.x=k*P,L.y=U*P,L.z=V*P,L.w=z*P),L},i.dot=function(L,D){return L.x*D.x+L.y*D.y+L.z*D.z+L.w*D.w},i.lerp=function(L,D,P,N){return L.x=D.x+N*(P.x-D.x),L.y=D.y+N*(P.y-D.y),L.z=D.z+N*(P.z-D.z),L.w=D.w+N*(P.w-D.w),L},i.random=function(L,D){D=D||1;var P=2*(0,B.random)()*Math.PI,N=2*(0,B.random)()-1,F=Math.sqrt(1-N*N);return L.x=F*Math.cos(P)*D,L.y=F*Math.sin(P)*D,L.z=N*D,L.w=0,L},i.transformMat4=function(L,D,P){k=D.x,U=D.y,V=D.z,z=D.w;var N=P.m;return L.x=N[0]*k+N[4]*U+N[8]*V+N[12]*z,L.y=N[1]*k+N[5]*U+N[9]*V+N[13]*z,L.z=N[2]*k+N[6]*U+N[10]*V+N[14]*z,L.w=N[3]*k+N[7]*U+N[11]*V+N[15]*z,L},i.transformAffine=function(L,D,P){k=D.x,U=D.y,V=D.z,z=D.w;var N=P.m;return L.x=N[0]*k+N[1]*U+N[2]*V+N[3]*z,L.y=N[4]*k+N[5]*U+N[6]*V+N[7]*z,L.x=N[8]*k+N[9]*U+N[10]*V+N[11]*z,L.w=D.w,L},i.transformQuat=function(L,D,P){var N=D.x,F=D.y,B=D.z;k=P.x,U=P.y,V=P.z;var W=(z=P.w)*N+U*B-V*F,H=z*F+V*N-k*B,G=z*B+k*F-U*N,X=-k*N-U*F-V*B;return L.x=W*z+X*-k+H*-V-G*-U,L.y=H*z+X*-U+G*-k-W*-V,L.z=G*z+X*-V+W*-U-H*-k,L.w=D.w,L},i.strictEquals=function(L,D){return L.x===D.x&&L.y===D.y&&L.z===D.z&&L.w===D.w},i.equals=function(L,D,P){return void 0===P&&(P=B.EPSILON),Math.abs(L.x-D.x)<=P*Math.max(1,Math.abs(L.x),Math.abs(D.x))&&Math.abs(L.y-D.y)<=P*Math.max(1,Math.abs(L.y),Math.abs(D.y))&&Math.abs(L.z-D.z)<=P*Math.max(1,Math.abs(L.z),Math.abs(D.z))&&Math.abs(L.w-D.w)<=P*Math.max(1,Math.abs(L.w),Math.abs(D.w))},i.toArray=function(L,D,P){return void 0===P&&(P=0),L[P+0]=D.x,L[P+1]=D.y,L[P+2]=D.z,L[P+3]=D.w,L},i.fromArray=function(L,D,P){return void 0===P&&(P=0),L.x=D[P+0],L.y=D[P+1],L.z=D[P+2],L.w=D[P+3],L},function(L,D,P){D&&o(L.prototype,D),P&&o(L,P)}(i,null,[{key:"ZERO",get:function(){return new i(0,0,0,0)}},{key:"ONE",get:function(){return new i(1,1,1,1)}},{key:"NEG_ONE",get:function(){return new i(-1,-1,-1,-1)}}]),D.clone=function(){return new i(this.x,this.y,this.z,this.w)},D.set=function(L,D,P,N){return L&&"object"==typeof L?(this.x=L.x,this.y=L.y,this.z=L.z,this.w=L.w):(this.x=L||0,this.y=D||0,this.z=P||0,this.w=N||0),this},D.equals=function(L,D){return void 0===D&&(D=B.EPSILON),Math.abs(this.x-L.x)<=D*Math.max(1,Math.abs(this.x),Math.abs(L.x))&&Math.abs(this.y-L.y)<=D*Math.max(1,Math.abs(this.y),Math.abs(L.y))&&Math.abs(this.z-L.z)<=D*Math.max(1,Math.abs(this.z),Math.abs(L.z))&&Math.abs(this.w-L.w)<=D*Math.max(1,Math.abs(this.w),Math.abs(L.w))},D.equals4f=function(L,D,P,N,F){return void 0===F&&(F=B.EPSILON),Math.abs(this.x-L)<=F*Math.max(1,Math.abs(this.x),Math.abs(L))&&Math.abs(this.y-D)<=F*Math.max(1,Math.abs(this.y),Math.abs(D))&&Math.abs(this.z-P)<=F*Math.max(1,Math.abs(this.z),Math.abs(P))&&Math.abs(this.w-N)<=F*Math.max(1,Math.abs(this.w),Math.abs(N))},D.strictEquals=function(L){return this.x===L.x&&this.y===L.y&&this.z===L.z&&this.w===L.w},D.strictEquals4f=function(L,D,P,N){return this.x===L&&this.y===D&&this.z===P&&this.w===N},D.lerp=function(L,D){return k=this.x,U=this.y,V=this.z,z=this.w,this.x=k+D*(L.x-k),this.y=U+D*(L.y-U),this.z=V+D*(L.z-V),this.w=z+D*(L.w-z),this},D.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},D.clampf=function(L,D){return this.x=(0,B.clamp)(this.x,L.x,D.x),this.y=(0,B.clamp)(this.y,L.y,D.y),this.z=(0,B.clamp)(this.z,L.z,D.z),this.w=(0,B.clamp)(this.w,L.w,D.w),this},D.addSelf=function(L){return this.x+=L.x,this.y+=L.y,this.z+=L.z,this.w+=L.w,this},D.add=function(L,D){return(D=D||new i).x=this.x+L.x,D.y=this.y+L.y,D.z=this.z+L.z,D.w=this.w+L.w,D},D.subtract=function(L,D){return(D=D||new i).x=this.x-L.x,D.y=this.y-L.y,D.z=this.z-L.z,D.w=this.w-L.w,D},D.multiplyScalar=function(L){return this.x*=L,this.y*=L,this.z*=L,this.w*=L,this},D.multiply=function(L){return this.x*=L.x,this.y*=L.y,this.z*=L.z,this.w*=L.w,this},D.divide=function(L){return this.x/=L,this.y/=L,this.z/=L,this.w/=L,this},D.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},D.dot=function(L){return this.x*L.x+this.y*L.y+this.z*L.z+this.w*L.w},D.cross=function(L,D){D=D||new i;var P=this.x,N=this.y,F=this.z,B=L.x,k=L.y,U=L.z;return D.x=N*U-F*k,D.y=F*B-P*U,D.z=P*k-N*B,D},D.len=function(){var L=this.x,D=this.y,P=this.z,N=this.w;return Math.sqrt(L*L+D*D+P*P+N*N)},D.lengthSqr=function(){var L=this.x,D=this.y,P=this.z,N=this.w;return L*L+D*D+P*P+N*N},D.normalizeSelf=function(){return this.normalize(this),this},D.normalize=function(L){L=L||new i,k=this.x,U=this.y,V=this.z,z=this.w;var D=k*k+U*U+V*V+z*z;return D>0&&(D=1/Math.sqrt(D),L.x=k*D,L.y=U*D,L.z=V*D,L.w=z*D),L},D.transformMat4=function(L,D){D=D||new i,k=this.x,U=this.y,V=this.z,z=this.w;var P=L.m;return D.x=P[0]*k+P[4]*U+P[8]*V+P[12]*z,D.y=P[1]*k+P[5]*U+P[9]*V+P[13]*z,D.z=P[2]*k+P[6]*U+P[10]*V+P[14]*z,D.w=P[3]*k+P[7]*U+P[11]*V+P[15]*z,D},D.maxAxis=function(){return Math.max(this.x,this.y,this.z,this.w)},i}(F.default);function p(L,D,P,N){return new W(L,D,P,N)}P.default=W,W.sub=W.subtract,W.mul=W.multiply,W.div=W.divide,W.scale=W.multiplyScalar,W.mag=W.len,W.squaredMagnitude=W.lengthSqr,W.ZERO_R=W.ZERO,W.ONE_R=W.ONE,W.NEG_ONE_R=W.NEG_ONE,N.default.fastDefine("cc.Vec4",W,{x:0,y:0,z:0,w:0}),cc.v4=p,cc.Vec4=W},{"../platform/CCClass":137,"./utils":232,"./value-type":233}],237:[function(L,D,P){"use strict";cc.js},{}],238:[function(L,D,P){"use strict";L("./core/CCGame"),L("./actions")},{"./actions":7,"./core/CCGame":24}],239:[function(L,D,P){"use strict";var N=L("../core/assets/CCAsset"),F=L("../core/assets/CCSpriteFrame"),B=cc.Class({name:"cc.ParticleAsset",extends:N,properties:{spriteFrame:{default:null,type:F}}});cc.ParticleAsset=D.exports=B},{"../core/assets/CCAsset":29,"../core/assets/CCSpriteFrame":42}],240:[function(L,D,P){"use strict";var N,F,B,k,U,V,z,W,H,G,X,nt,ut,dt,ft,_t,pt,vt,gt,mt,yt,Tt,xt,St,bt,wt,Rt,It,Mt,Ot,Lt,Dt,Pt,Nt,Ft,Bt,kt,Ut,Vt,zt,Wt,Ht;(function(L){L[L.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",L[L.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",L[L.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",L[L.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",L[L.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",L[L.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",L[L.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",L[L.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",L[L.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",L[L.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",L[L.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",L[L.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",L[L.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL"})(N||(N={})),function(L){L[L.UNKNOWN=0]="UNKNOWN",L[L.BUFFER=1]="BUFFER",L[L.TEXTURE=2]="TEXTURE",L[L.TEXTURE_VIEW=3]="TEXTURE_VIEW",L[L.RENDER_PASS=4]="RENDER_PASS",L[L.FRAMEBUFFER=5]="FRAMEBUFFER",L[L.SAMPLER=6]="SAMPLER",L[L.SHADER=7]="SHADER",L[L.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",L[L.PIPELINE_STATE=9]="PIPELINE_STATE",L[L.BINDING_LAYOUT=10]="BINDING_LAYOUT",L[L.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",L[L.COMMAND_ALLOCATOR=12]="COMMAND_ALLOCATOR",L[L.COMMAND_BUFFER=13]="COMMAND_BUFFER",L[L.QUEUE=14]="QUEUE",L[L.WINDOW=15]="WINDOW"}(F||(F={})),function(L){L[L.UNREADY=0]="UNREADY",L[L.FAILED=1]="FAILED",L[L.SUCCESS=2]="SUCCESS"}(B||(B={})),function(){function t(L){this._gfxType=F.UNKNOWN,this._status=B.UNREADY,this._gfxType=L}Object.defineProperty(t.prototype,"gfxType",{get:function(){return this._gfxType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0})}(),function(L){L.ATTR_POSITION="a_position",L.ATTR_NORMAL="a_normal",L.ATTR_TANGENT="a_tangent",L.ATTR_BITANGENT="a_bitangent",L.ATTR_WEIGHTS="a_weights",L.ATTR_JOINTS="a_joints",L.ATTR_COLOR="a_color",L.ATTR_COLOR1="a_color1",L.ATTR_COLOR2="a_color2",L.ATTR_TEX_COORD="a_texCoord",L.ATTR_TEX_COORD1="a_texCoord1",L.ATTR_TEX_COORD2="a_texCoord2",L.ATTR_TEX_COORD3="a_texCoord3",L.ATTR_TEX_COORD4="a_texCoord4",L.ATTR_TEX_COORD5="a_texCoord5",L.ATTR_TEX_COORD6="a_texCoord6",L.ATTR_TEX_COORD7="a_texCoord7",L.ATTR_TEX_COORD8="a_texCoord8"}(k||(k={})),function(L){L[L.UNKNOWN=0]="UNKNOWN",L[L.BOOL=1]="BOOL",L[L.BOOL2=2]="BOOL2",L[L.BOOL3=3]="BOOL3",L[L.BOOL4=4]="BOOL4",L[L.INT=5]="INT",L[L.INT2=6]="INT2",L[L.INT3=7]="INT3",L[L.INT4=8]="INT4",L[L.UINT=9]="UINT",L[L.UINT2=10]="UINT2",L[L.UINT3=11]="UINT3",L[L.UINT4=12]="UINT4",L[L.FLOAT=13]="FLOAT",L[L.FLOAT2=14]="FLOAT2",L[L.FLOAT3=15]="FLOAT3",L[L.FLOAT4=16]="FLOAT4",L[L.COLOR4=17]="COLOR4",L[L.MAT2=18]="MAT2",L[L.MAT2X3=19]="MAT2X3",L[L.MAT2X4=20]="MAT2X4",L[L.MAT3X2=21]="MAT3X2",L[L.MAT3=22]="MAT3",L[L.MAT3X4=23]="MAT3X4",L[L.MAT4X2=24]="MAT4X2",L[L.MAT4X3=25]="MAT4X3",L[L.MAT4=26]="MAT4",L[L.SAMPLER1D=27]="SAMPLER1D",L[L.SAMPLER1D_ARRAY=28]="SAMPLER1D_ARRAY",L[L.SAMPLER2D=29]="SAMPLER2D",L[L.SAMPLER2D_ARRAY=30]="SAMPLER2D_ARRAY",L[L.SAMPLER3D=31]="SAMPLER3D",L[L.SAMPLER_CUBE=32]="SAMPLER_CUBE",L[L.COUNT=33]="COUNT"}(U||(U={})),function(L){L[L.UNKNOWN=0]="UNKNOWN",L[L.A8=1]="A8",L[L.L8=2]="L8",L[L.LA8=3]="LA8",L[L.R8=4]="R8",L[L.R8SN=5]="R8SN",L[L.R8UI=6]="R8UI",L[L.R8I=7]="R8I",L[L.R16F=8]="R16F",L[L.R16UI=9]="R16UI",L[L.R16I=10]="R16I",L[L.R32F=11]="R32F",L[L.R32UI=12]="R32UI",L[L.R32I=13]="R32I",L[L.RG8=14]="RG8",L[L.RG8SN=15]="RG8SN",L[L.RG8UI=16]="RG8UI",L[L.RG8I=17]="RG8I",L[L.RG16F=18]="RG16F",L[L.RG16UI=19]="RG16UI",L[L.RG16I=20]="RG16I",L[L.RG32F=21]="RG32F",L[L.RG32UI=22]="RG32UI",L[L.RG32I=23]="RG32I",L[L.RGB8=24]="RGB8",L[L.SRGB8=25]="SRGB8",L[L.RGB8SN=26]="RGB8SN",L[L.RGB8UI=27]="RGB8UI",L[L.RGB8I=28]="RGB8I",L[L.RGB16F=29]="RGB16F",L[L.RGB16UI=30]="RGB16UI",L[L.RGB16I=31]="RGB16I",L[L.RGB32F=32]="RGB32F",L[L.RGB32UI=33]="RGB32UI",L[L.RGB32I=34]="RGB32I",L[L.RGBA8=35]="RGBA8",L[L.SRGB8_A8=36]="SRGB8_A8",L[L.RGBA8SN=37]="RGBA8SN",L[L.RGBA8UI=38]="RGBA8UI",L[L.RGBA8I=39]="RGBA8I",L[L.RGBA16F=40]="RGBA16F",L[L.RGBA16UI=41]="RGBA16UI",L[L.RGBA16I=42]="RGBA16I",L[L.RGBA32F=43]="RGBA32F",L[L.RGBA32UI=44]="RGBA32UI",L[L.RGBA32I=45]="RGBA32I",L[L.R5G6B5=46]="R5G6B5",L[L.R11G11B10F=47]="R11G11B10F",L[L.RGB5A1=48]="RGB5A1",L[L.RGBA4=49]="RGBA4",L[L.RGB10A2=50]="RGB10A2",L[L.RGB10A2UI=51]="RGB10A2UI",L[L.RGB9E5=52]="RGB9E5",L[L.D16=53]="D16",L[L.D16S8=54]="D16S8",L[L.D24=55]="D24",L[L.D24S8=56]="D24S8",L[L.D32F=57]="D32F",L[L.D32F_S8=58]="D32F_S8",L[L.BC1=59]="BC1",L[L.BC1_ALPHA=60]="BC1_ALPHA",L[L.BC1_SRGB=61]="BC1_SRGB",L[L.BC1_SRGB_ALPHA=62]="BC1_SRGB_ALPHA",L[L.BC2=63]="BC2",L[L.BC2_SRGB=64]="BC2_SRGB",L[L.BC3=65]="BC3",L[L.BC3_SRGB=66]="BC3_SRGB",L[L.BC4=67]="BC4",L[L.BC4_SNORM=68]="BC4_SNORM",L[L.BC5=69]="BC5",L[L.BC5_SNORM=70]="BC5_SNORM",L[L.BC6H_UF16=71]="BC6H_UF16",L[L.BC6H_SF16=72]="BC6H_SF16",L[L.BC7=73]="BC7",L[L.BC7_SRGB=74]="BC7_SRGB",L[L.ETC_RGB8=75]="ETC_RGB8",L[L.ETC2_RGB8=76]="ETC2_RGB8",L[L.ETC2_SRGB8=77]="ETC2_SRGB8",L[L.ETC2_RGB8_A1=78]="ETC2_RGB8_A1",L[L.ETC2_SRGB8_A1=79]="ETC2_SRGB8_A1",L[L.ETC2_RGBA8=80]="ETC2_RGBA8",L[L.ETC2_SRGB8_A8=81]="ETC2_SRGB8_A8",L[L.EAC_R11=82]="EAC_R11",L[L.EAC_R11SN=83]="EAC_R11SN",L[L.EAC_RG11=84]="EAC_RG11",L[L.EAC_RG11SN=85]="EAC_RG11SN",L[L.PVRTC_RGB2=86]="PVRTC_RGB2",L[L.PVRTC_RGBA2=87]="PVRTC_RGBA2",L[L.PVRTC_RGB4=88]="PVRTC_RGB4",L[L.PVRTC_RGBA4=89]="PVRTC_RGBA4",L[L.PVRTC2_2BPP=90]="PVRTC2_2BPP",L[L.PVRTC2_4BPP=91]="PVRTC2_4BPP"}(V||(V={})),function(L){L[L.NONE=0]="NONE",L[L.TRANSFER_SRC=1]="TRANSFER_SRC",L[L.TRANSFER_DST=2]="TRANSFER_DST",L[L.INDEX=4]="INDEX",L[L.VERTEX=8]="VERTEX",L[L.UNIFORM=16]="UNIFORM",L[L.STORAGE=32]="STORAGE",L[L.INDIRECT=64]="INDIRECT"}(z||(z={})),function(L){L[L.NONE=0]="NONE",L[L.DEVICE=1]="DEVICE",L[L.HOST=2]="HOST"}(W||(W={})),function(L){L[L.NONE=0]="NONE",L[L.READ=1]="READ",L[L.WRITE=2]="WRITE"}(H||(H={})),function(L){L[L.POINT_LIST=0]="POINT_LIST",L[L.LINE_LIST=1]="LINE_LIST",L[L.LINE_STRIP=2]="LINE_STRIP",L[L.LINE_LOOP=3]="LINE_LOOP",L[L.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",L[L.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",L[L.ISO_LINE_LIST=6]="ISO_LINE_LIST",L[L.TRIANGLE_LIST=7]="TRIANGLE_LIST",L[L.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",L[L.TRIANGLE_FAN=9]="TRIANGLE_FAN",L[L.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",L[L.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",L[L.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",L[L.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(G||(G={})),function(L){L[L.FILL=0]="FILL",L[L.POINT=1]="POINT",L[L.LINE=2]="LINE"}(X||(X={})),function(L){L[L.GOURAND=0]="GOURAND",L[L.FLAT=1]="FLAT"}(nt||(nt={})),function(L){L[L.NONE=0]="NONE",L[L.FRONT=1]="FRONT",L[L.BACK=2]="BACK"}(ut||(ut={})),function(L){L[L.NEVER=0]="NEVER",L[L.LESS=1]="LESS",L[L.EQUAL=2]="EQUAL",L[L.LESS_EQUAL=3]="LESS_EQUAL",L[L.GREATER=4]="GREATER",L[L.NOT_EQUAL=5]="NOT_EQUAL",L[L.GREATER_EQUAL=6]="GREATER_EQUAL",L[L.ALWAYS=7]="ALWAYS"}(dt||(dt={})),function(L){L[L.ZERO=0]="ZERO",L[L.KEEP=1]="KEEP",L[L.REPLACE=2]="REPLACE",L[L.INCR=3]="INCR",L[L.DECR=4]="DECR",L[L.INVERT=5]="INVERT",L[L.INCR_WRAP=6]="INCR_WRAP",L[L.DECR_WRAP=7]="DECR_WRAP"}(ft||(ft={})),function(L){L[L.ADD=0]="ADD",L[L.SUB=1]="SUB",L[L.REV_SUB=2]="REV_SUB",L[L.MIN=3]="MIN",L[L.MAX=4]="MAX"}(_t||(_t={})),function(L){L[L.ZERO=0]="ZERO",L[L.ONE=1]="ONE",L[L.SRC_ALPHA=2]="SRC_ALPHA",L[L.DST_ALPHA=3]="DST_ALPHA",L[L.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",L[L.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",L[L.SRC_COLOR=6]="SRC_COLOR",L[L.DST_COLOR=7]="DST_COLOR",L[L.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",L[L.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",L[L.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",L[L.CONSTANT_COLOR=11]="CONSTANT_COLOR",L[L.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",L[L.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",L[L.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(pt||(pt={})),function(L){L[L.NONE=0]="NONE",L[L.R=1]="R",L[L.G=2]="G",L[L.B=4]="B",L[L.A=8]="A",L[L.ALL=15]="ALL"}(vt||(vt={})),function(L){L[L.NONE=0]="NONE",L[L.POINT=1]="POINT",L[L.LINEAR=2]="LINEAR",L[L.ANISOTROPIC=3]="ANISOTROPIC"}(gt||(gt={})),function(L){L[L.WRAP=0]="WRAP",L[L.MIRROR=1]="MIRROR",L[L.CLAMP=2]="CLAMP",L[L.BORDER=3]="BORDER"}(mt||(mt={})),function(L){L[L.TEX1D=0]="TEX1D",L[L.TEX2D=1]="TEX2D",L[L.TEX3D=2]="TEX3D"}(yt||(yt={})),function(L){L[L.NONE=0]="NONE",L[L.TRANSFER_SRC=1]="TRANSFER_SRC",L[L.TRANSFER_DST=2]="TRANSFER_DST",L[L.SAMPLED=4]="SAMPLED",L[L.STORAGE=8]="STORAGE",L[L.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",L[L.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",L[L.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",L[L.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(Tt||(Tt={})),function(L){L[L.X1=0]="X1",L[L.X2=1]="X2",L[L.X4=2]="X4",L[L.X8=3]="X8",L[L.X16=4]="X16",L[L.X32=5]="X32",L[L.X64=6]="X64"}(xt||(xt={})),function(L){L[L.NONE=0]="NONE",L[L.GEN_MIPMAP=1]="GEN_MIPMAP",L[L.CUBEMAP=2]="CUBEMAP",L[L.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(St||(St={})),function(L){L[L.TV1D=0]="TV1D",L[L.TV2D=1]="TV2D",L[L.TV3D=2]="TV3D",L[L.CUBE=3]="CUBE",L[L.TV1D_ARRAY=4]="TV1D_ARRAY",L[L.TV2D_ARRAY=5]="TV2D_ARRAY"}(bt||(bt={})),function(L){L[L.VERTEX=0]="VERTEX",L[L.HULL=1]="HULL",L[L.DOMAIN=2]="DOMAIN",L[L.GEOMETRY=3]="GEOMETRY",L[L.FRAGMENT=4]="FRAGMENT",L[L.COMPUTE=5]="COMPUTE",L[L.COUNT=6]="COUNT"}(wt||(wt={})),function(L){L[L.UNKNOWN=0]="UNKNOWN",L[L.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",L[L.SAMPLER=2]="SAMPLER",L[L.STORAGE_BUFFER=3]="STORAGE_BUFFER"}(Rt||(Rt={})),function(L){L[L.PRIMARY=0]="PRIMARY",L[L.SECONDARY=1]="SECONDARY"}(It||(It={})),function(L){L[L.LOAD=0]="LOAD",L[L.CLEAR=1]="CLEAR",L[L.DISCARD=2]="DISCARD"}(Mt||(Mt={})),function(L){L[L.STORE=0]="STORE",L[L.DISCARD=1]="DISCARD"}(Ot||(Ot={})),function(L){L[L.UNDEFINED=0]="UNDEFINED",L[L.GENERAL=1]="GENERAL",L[L.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",L[L.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",L[L.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",L[L.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",L[L.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",L[L.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",L[L.PREINITIALIZED=8]="PREINITIALIZED",L[L.PRESENT_SRC=9]="PRESENT_SRC"}(Lt||(Lt={})),function(L){L[L.GRAPHICS=0]="GRAPHICS",L[L.COMPUTE=1]="COMPUTE",L[L.RAY_TRACING=2]="RAY_TRACING"}(Dt||(Dt={})),function(L){L[L.VIEWPORT=0]="VIEWPORT",L[L.SCISSOR=1]="SCISSOR",L[L.LINE_WIDTH=2]="LINE_WIDTH",L[L.DEPTH_BIAS=3]="DEPTH_BIAS",L[L.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",L[L.DEPTH_BOUNDS=5]="DEPTH_BOUNDS",L[L.STENCIL_WRITE_MASK=6]="STENCIL_WRITE_MASK",L[L.STENCIL_COMPARE_MASK=7]="STENCIL_COMPARE_MASK"}(Pt||(Pt={})),function(L){L[L.FRONT=0]="FRONT",L[L.BACK=1]="BACK",L[L.ALL=2]="ALL"}(Nt||(Nt={})),function(L){L[L.GRAPHICS=0]="GRAPHICS",L[L.COMPUTE=1]="COMPUTE",L[L.TRANSFER=2]="TRANSFER"}(Ft||(Ft={})),function(L){L[L.NONE=0]="NONE",L[L.COLOR=1]="COLOR",L[L.DEPTH=2]="DEPTH",L[L.STENCIL=4]="STENCIL",L[L.DEPTH_STENCIL=6]="DEPTH_STENCIL",L[L.ALL=7]="ALL"}(Bt||(Bt={})),function(L){L[L.DEFAULT=100]="DEFAULT"}(kt||(kt={})),function(L){L[L.MIN=0]="MIN",L[L.MAX=255]="MAX",L[L.DEFAULT=128]="DEFAULT"}(Ut||(Ut={})),function(L){L[L.UBO_GLOBAL=23]="UBO_GLOBAL",L[L.UBO_SHADOW=22]="UBO_SHADOW",L[L.UBO_LOCAL=21]="UBO_LOCAL",L[L.UBO_FORWARD_LIGHTS=20]="UBO_FORWARD_LIGHTS",L[L.UBO_SKINNING=19]="UBO_SKINNING",L[L.UBO_SKINNING_TEXTURE=18]="UBO_SKINNING_TEXTURE",L[L.UBO_UI=17]="UBO_UI",L[L.SAMPLER_JOINTS=25]="SAMPLER_JOINTS",L[L.SAMPLER_ENVIRONMENT=26]="SAMPLER_ENVIRONMENT",L[L.CUSTUM_UBO_BINDING_END_POINT=17]="CUSTUM_UBO_BINDING_END_POINT",L[L.CUSTOM_SAMPLER_BINDING_START_POINT=30]="CUSTOM_SAMPLER_BINDING_START_POINT"}(Vt||(Vt={})),function(L){L[L.minFilter=0]="minFilter",L[L.magFilter=1]="magFilter",L[L.mipFilter=2]="mipFilter",L[L.addressU=3]="addressU",L[L.addressV=4]="addressV",L[L.addressW=5]="addressW",L[L.maxAnisotropy=6]="maxAnisotropy",L[L.cmpFunc=7]="cmpFunc",L[L.minLOD=8]="minLOD",L[L.maxLOD=9]="maxLOD",L[L.mipLODBias=10]="mipLODBias",L[L.borderColor=11]="borderColor",L[L.total=15]="total"}(Ht||(Ht={}));var Gt={};Gt[Gt.bool=U.BOOL]="bool",Gt[Gt.int=U.INT]="int",Gt[Gt.ivec2=U.INT2]="ivec2invTypeParams",Gt[Gt.ivec3=U.INT3]="ivec3",Gt[Gt.ivec4=U.INT4]="ivec4",Gt[Gt.float=U.FLOAT]="float",Gt[Gt.vec2=U.FLOAT2]="vec2",Gt[Gt.vec3=U.FLOAT3]="vec3",Gt[Gt.vec4=U.FLOAT4]="vec4",Gt[Gt.mat2=U.MAT2]="mat2",Gt[Gt.mat3=U.MAT3]="mat3",Gt[Gt.mat4=U.MAT4]="mat4",Gt[Gt.sampler2D=U.SAMPLER2D]="sampler2D",Gt[Gt.samplerCube=U.SAMPLER_CUBE]="samplerCube";var Yt=((zt={})[U.BOOL]=4,zt[U.INT]=4,zt[U.INT2]=8,zt[U.INT3]=12,zt[U.INT4]=16,zt[U.FLOAT]=4,zt[U.FLOAT2]=8,zt[U.FLOAT3]=12,zt[U.FLOAT4]=16,zt[U.MAT2]=16,zt[U.MAT3]=36,zt[U.MAT4]=64,zt[U.SAMPLER2D]=4,zt[U.SAMPLER_CUBE]=4,zt),Xt=((Wt={})[U.BOOL]=V.R32I,Wt[U.INT]=V.R32I,Wt[U.INT2]=V.RG32I,Wt[U.INT3]=V.RGB32I,Wt[U.INT4]=V.RGBA32I,Wt[U.FLOAT]=V.R32F,Wt[U.FLOAT2]=V.RG32F,Wt[U.FLOAT3]=V.RGB32F,Wt[U.FLOAT4]=V.RGBA32F,Wt),jt={BACK:1029,FRONT:1028,NONE:0,ADD:32774,SUB:32778,REV_SUB:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,SRC_ALPHA_SATURATE:776,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,INCR_WRAP:34055,DECR:7683,DECR_WRAP:34056,INVERT:5386};Object.assign(jt,kt);var qt={murmurhash2_32_gc:function(L,D){for(var P,N=L.length,F=D^N,B=0;N>=4;)P=1540483477*(65535&(P=255&L.charCodeAt(B)|(255&L.charCodeAt(++B))<<8|(255&L.charCodeAt(++B))<<16|(255&L.charCodeAt(++B))<<24))+((1540483477*(P>>>16)&65535)<<16),F=1540483477*(65535&F)+((1540483477*(F>>>16)&65535)<<16)^(P=1540483477*(65535&(P^=P>>>24))+((1540483477*(P>>>16)&65535)<<16)),N-=4,++B;switch(N){case 3:F^=(255&L.charCodeAt(B+2))<<16;case 2:F^=(255&L.charCodeAt(B+1))<<8;case 1:F=1540483477*(65535&(F^=255&L.charCodeAt(B)))+((1540483477*(F>>>16)&65535)<<16)}return F=1540483477*(65535&(F^=F>>>13))+((1540483477*(F>>>16)&65535)<<16),(F^=F>>>15)>>>0},SamplerInfoIndex:Ht,effectStructure:{$techniques:[{$passes:[{depthStencilState:{},rasterizerState:{},blendState:{targets:[{}]},properties:{any:{sampler:{},inspector:{}}}}]}]},typeMap:Gt,sizeMap:Yt,formatMap:Xt,passParams:jt,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderPriority:Ut,GFXGetTypeSize:function(L){switch(L){case U.BOOL:case U.INT:case U.UINT:case U.FLOAT:return 4;case U.BOOL2:case U.INT2:case U.UINT2:case U.FLOAT2:return 8;case U.BOOL3:case U.INT3:case U.UINT3:case U.FLOAT3:return 12;case U.BOOL4:case U.INT4:case U.UINT4:case U.FLOAT4:case U.MAT2:return 16;case U.MAT2X3:return 24;case U.MAT2X4:return 32;case U.MAT3X2:return 24;case U.MAT3:return 36;case U.MAT3X4:return 48;case U.MAT4X2:case U.MAT4X2:return 32;case U.MAT4:return 64;case U.SAMPLER1D:case U.SAMPLER1D_ARRAY:case U.SAMPLER2D:case U.SAMPLER2D_ARRAY:case U.SAMPLER3D:case U.SAMPLER_CUBE:return 4;default:return 0}},UniformBinding:Vt};D.exports=qt},{}],241:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../memop"),F=l(L("../enums")),B=L("../../core/value-types"),k=l(L("./program-lib")),U=l(L("./view")),V=l(L("../gfx"));function l(L){return L&&L.__esModule?L:{default:L}}var z=new B.Mat4,W=new N.RecyclePool((function(){return{stage:null,items:null}}),8),H=new N.RecyclePool((function(){return new Float32Array(2)}),8),G=new N.RecyclePool((function(){return new Float32Array(3)}),8),X=new N.RecyclePool((function(){return new Float32Array(4)}),8),nt=new N.RecyclePool((function(){return new Float32Array(9)}),8),ut=new N.RecyclePool((function(){return new Float32Array(16)}),8),dt=new N.RecyclePool((function(){return new Float32Array(64)}),8),ft=new N.RecyclePool((function(){return new Int32Array(2)}),8),_t=new N.RecyclePool((function(){return new Int32Array(3)}),8),pt=new N.RecyclePool((function(){return new Int32Array(4)}),8),vt=new N.RecyclePool((function(){return new Int32Array(64)}),8),gt=function(){function t(L,D){var P;this._device=L,this._programLib=new k.default(L),this._opts=D,this._type2defaultValue=((P={})[F.default.PARAM_INT]=0,P[F.default.PARAM_INT2]=new B.Vec2(0,0),P[F.default.PARAM_INT3]=new B.Vec3(0,0,0),P[F.default.PARAM_INT4]=new B.Vec4(0,0,0,0),P[F.default.PARAM_FLOAT]=0,P[F.default.PARAM_FLOAT2]=new B.Vec2(0,0),P[F.default.PARAM_FLOAT3]=new B.Vec3(0,0,0),P[F.default.PARAM_FLOAT4]=new B.Vec4(0,0,0,0),P[F.default.PARAM_COLOR4]=new B.Color(0,0,0,1),P[F.default.PARAM_MAT3]=new B.Mat3,P[F.default.PARAM_MAT4]=new B.Mat4,P[F.default.PARAM_TEXTURE_2D]=D.defaultTexture,P[F.default.PARAM_TEXTURE_CUBE]=D.defaultTextureCube,P),this._stage2fn={},this._usedTextureUnits=0,this._viewPools=new N.RecyclePool((function(){return new U.default}),8),this._drawItemsPools=new N.RecyclePool((function(){return{model:null,node:null,ia:null,effect:null,defines:null,uniforms:null}}),100),this._stageItemsPools=new N.RecyclePool((function(){return new N.RecyclePool((function(){return{model:null,node:null,ia:null,effect:null,defines:null,passes:[],sortKey:-1,uniforms:null}}),100)}),16)}var L=t.prototype;return L._resetTextuerUnit=function(){this._usedTextureUnits=0},L._allocTextureUnit=function(){var L=this._device,D=this._usedTextureUnits;return D>=L._caps.maxTextureUnits&&console.warn("Trying to use "+D+" texture units while this GPU supports only "+L._caps.maxTextureUnits),this._usedTextureUnits+=1,D},L._registerStage=function(L,D){this._stage2fn[L]=D},L.clear=function(){this._programLib.clear(),this.reset()},L.reset=function(){this._viewPools.reset(),this._stageItemsPools.reset()},L._requestView=function(){return this._viewPools.add()},L._render=function(L,D){var P=this._device;P.setFrameBuffer(L._framebuffer),P.setViewport(L._rect.x,L._rect.y,L._rect.w,L._rect.h);var N={};L._clearFlags&F.default.CLEAR_COLOR&&(N.color=B.Vec4.toArray([],L._color)),L._clearFlags&F.default.CLEAR_DEPTH&&(N.depth=L._depth),L._clearFlags&F.default.CLEAR_STENCIL&&(N.stencil=L._stencil),P.clear(N),this._drawItemsPools.reset();for(var k=0;k<D._models.length;++k){var U=D._models.data[k];if(0!=(U._cullingMask&L._cullingMask)){var V=this._drawItemsPools.add();U.extractDrawItem(V)}}W.reset();for(var z=0;z<L._stages.length;++z){var H=L._stages[z],G=this._stageItemsPools.add();G.reset();for(var X=0;X<this._drawItemsPools.length;++X){var nt=this._drawItemsPools.data[X],ut=nt.effect.stagePasses[H];if(ut&&0!==ut.length){var dt=G.add();dt.passes=ut,dt.model=nt.model,dt.node=nt.node,dt.ia=nt.ia,dt.effect=nt.effect,dt.defines=nt.defines,dt.sortKey=-1,dt.uniforms=nt.uniforms}}var ft=W.add();ft.stage=H,ft.items=G}for(var _t=0;_t<W.length;++_t){var pt=W.data[_t];(0,this._stage2fn[pt.stage])(L,pt.items)}},L._setProperty=function(L){var D=this._device,P=L.value;if(void 0===P&&(P=L.val),void 0===P&&(P=this._type2defaultValue[L.type]),void 0!==P)if(L.type===F.default.PARAM_TEXTURE_2D||L.type===F.default.PARAM_TEXTURE_CUBE)if(Array.isArray(P)){if(P.length>L.count)return void console.error("Failed to set property ["+L.name+"] : The length of texture array ["+P.length+"] is bigger than ["+L.count+"].");for(var N=vt.add(),B=0;B<P.length;++B)N[B]=this._allocTextureUnit();D.setTextureArray(L.name,P,N)}else D.setTexture(L.name,P,this._allocTextureUnit());else L.directly?D.setUniformDirectly(L.name,P):D.setUniform(L.name,P);else console.warn("Failed to set technique property "+L.name+", value not found.")},L._draw=function(L){var D=this._device,P=this._programLib,N=L.node,F=L.ia,k=L.passes,U=L.effect;H.reset(),G.reset(),X.reset(),nt.reset(),ut.reset(),dt.reset(),ft.reset(),_t.reset(),pt.reset(),vt.reset(),N.getWorldMatrix(z),D.setUniform("cc_matWorld",B.Mat4.toArray(ut.add(),z)),B.Mat4.invert(z,z),B.Mat4.transpose(z,z),D.setUniform("cc_matWorldIT",B.Mat4.toArray(ut.add(),z));for(var W=this._defines,gt=0;gt<k.length;++gt){var mt=k[gt],yt=F.count;F._vertexBuffer&&D.setVertexBuffer(0,F._vertexBuffer),F._indexBuffer&&D.setIndexBuffer(F._indexBuffer),D.setPrimitiveType(F._primitiveType),Object.setPrototypeOf(W,mt._defines);var Tt=P.getProgram(mt._programName,W,U.name);D.setProgram(Tt);for(var xt=Tt._uniforms,St=mt._properties,bt=0;bt<xt.length;bt++){var wt=St[xt[bt].name];void 0!==wt&&this._setProperty(wt)}D.setCullMode(mt._cullMode),mt._blend&&(D.enableBlend(),D.setBlendFuncSep(mt._blendSrc,mt._blendDst,mt._blendSrcAlpha,mt._blendDstAlpha),D.setBlendEqSep(mt._blendEq,mt._blendAlphaEq),D.setBlendColor32(mt._blendColor)),mt._depthTest&&(D.enableDepthTest(),D.setDepthFunc(mt._depthFunc)),mt._depthWrite&&D.enableDepthWrite(),D.setStencilTest(mt._stencilTest),mt._stencilTest===V.default.STENCIL_ENABLE&&(D.setStencilFuncFront(mt._stencilFuncFront,mt._stencilRefFront,mt._stencilMaskFront),D.setStencilOpFront(mt._stencilFailOpFront,mt._stencilZFailOpFront,mt._stencilZPassOpFront,mt._stencilWriteMaskFront),D.setStencilFuncBack(mt._stencilFuncBack,mt._stencilRefBack,mt._stencilMaskBack),D.setStencilOpBack(mt._stencilFailOpBack,mt._stencilZFailOpBack,mt._stencilZPassOpBack,mt._stencilWriteMaskBack)),D.draw(F._start,yt),this._resetTextuerUnit()}},t}();P.default=gt,D.exports=P.default},{"../../core/value-types":225,"../enums":247,"../gfx":252,"../memop":264,"./program-lib":244,"./view":246}],242:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../gfx"));function r(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var F=function(){function t(L,D,P){void 0===P&&(P=N.default.PT_TRIANGLES),this._vertexBuffer=L,this._indexBuffer=D,this._primitiveType=P,this._start=0,this._count=-1}return function(L,D,P){D&&r(L.prototype,D),P&&r(L,P)}(t,[{key:"count",get:function(){return-1!==this._count?this._count:this._indexBuffer?this._indexBuffer.count:this._vertexBuffer?this._vertexBuffer.count:0}}]),t}();P.default=F,D.exports=P.default},{"../gfx":252}],243:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=a(L("../gfx")),F=a(L("../enums")),B=a(L("../../core/value-types/value-type"));function a(L){return L&&L.__esModule?L:{default:L}}var k=function(){function t(L,D,P,F,B,k){void 0===B&&(B={}),void 0===k&&(k={}),this._name=L,this._detailName=D,this._programName=P,this._stage=F,this._properties=B,this._defines=k,this._cullMode=N.default.CULL_BACK,this._blend=!1,this._blendEq=N.default.BLEND_FUNC_ADD,this._blendAlphaEq=N.default.BLEND_FUNC_ADD,this._blendSrc=N.default.BLEND_SRC_ALPHA,this._blendDst=N.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendSrcAlpha=N.default.BLEND_SRC_ALPHA,this._blendDstAlpha=N.default.BLEND_ONE_MINUS_SRC_ALPHA,this._blendColor=4294967295,this._depthTest=!1,this._depthWrite=!1,this._depthFunc=N.default.DS_FUNC_LESS,this._stencilTest=N.default.STENCIL_INHERIT,this._stencilFuncFront=N.default.DS_FUNC_ALWAYS,this._stencilRefFront=0,this._stencilMaskFront=255,this._stencilFailOpFront=N.default.STENCIL_OP_KEEP,this._stencilZFailOpFront=N.default.STENCIL_OP_KEEP,this._stencilZPassOpFront=N.default.STENCIL_OP_KEEP,this._stencilWriteMaskFront=255,this._stencilFuncBack=N.default.DS_FUNC_ALWAYS,this._stencilRefBack=0,this._stencilMaskBack=255,this._stencilFailOpBack=N.default.STENCIL_OP_KEEP,this._stencilZFailOpBack=N.default.STENCIL_OP_KEEP,this._stencilZPassOpBack=N.default.STENCIL_OP_KEEP,this._stencilWriteMaskBack=255}var L=t.prototype;return L.setCullMode=function(L){void 0===L&&(L=N.default.CULL_BACK),this._cullMode=L},L.setBlend=function(L,D,P,F,B,k,U,V){void 0===L&&(L=!1),void 0===D&&(D=N.default.BLEND_FUNC_ADD),void 0===P&&(P=N.default.BLEND_SRC_ALPHA),void 0===F&&(F=N.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===B&&(B=N.default.BLEND_FUNC_ADD),void 0===k&&(k=N.default.BLEND_SRC_ALPHA),void 0===U&&(U=N.default.BLEND_ONE_MINUS_SRC_ALPHA),void 0===V&&(V=4294967295),this._blend=L,this._blendEq=D,this._blendSrc=P,this._blendDst=F,this._blendAlphaEq=B,this._blendSrcAlpha=k,this._blendDstAlpha=U,this._blendColor=V},L.setDepth=function(L,D,P){void 0===L&&(L=!1),void 0===D&&(D=!1),void 0===P&&(P=N.default.DS_FUNC_LESS),this._depthTest=L,this._depthWrite=D,this._depthFunc=P},L.setStencilFront=function(L,D,P,F,B,k,U,V){void 0===L&&(L=N.default.STENCIL_INHERIT),void 0===D&&(D=N.default.DS_FUNC_ALWAYS),void 0===P&&(P=0),void 0===F&&(F=255),void 0===B&&(B=N.default.STENCIL_OP_KEEP),void 0===k&&(k=N.default.STENCIL_OP_KEEP),void 0===U&&(U=N.default.STENCIL_OP_KEEP),void 0===V&&(V=255),this._stencilTest=L,this._stencilFuncFront=D,this._stencilRefFront=P,this._stencilMaskFront=F,this._stencilFailOpFront=B,this._stencilZFailOpFront=k,this._stencilZPassOpFront=U,this._stencilWriteMaskFront=V},L.setStencilEnabled=function(L){void 0===L&&(L=N.default.STENCIL_INHERIT),this._stencilTest=L},L.setStencilBack=function(L,D,P,F,B,k,U,V){void 0===L&&(L=N.default.STENCIL_INHERIT),void 0===D&&(D=N.default.DS_FUNC_ALWAYS),void 0===P&&(P=0),void 0===F&&(F=255),void 0===B&&(B=N.default.STENCIL_OP_KEEP),void 0===k&&(k=N.default.STENCIL_OP_KEEP),void 0===U&&(U=N.default.STENCIL_OP_KEEP),void 0===V&&(V=255),this._stencilTest=L,this._stencilFuncBack=D,this._stencilRefBack=P,this._stencilMaskBack=F,this._stencilFailOpBack=B,this._stencilZFailOpBack=k,this._stencilZPassOpBack=U,this._stencilWriteMaskBack=V},L.setStage=function(L){this._stage=L},L.setProperties=function(L){this._properties=L},L.getProperty=function(L){if(this._properties[L])return this._properties[L].value},L.setProperty=function(L,D,P){var N=this._properties[L];if(!N)return!1;if(N.directly=P,Array.isArray(D)){var k=N.value;if(k.length!==D.length)return void cc.warnID(9105,this._name,L);for(var U=0;U<D.length;U++)k[U]=D[U]}else D&&!ArrayBuffer.isView(D)?N.type===F.default.PARAM_TEXTURE_2D?N.value=D.getImpl():D instanceof B.default?D.constructor.toArray(N.value,D):("object"==typeof D&&cc.warnID(9106,this._name,L),N.value=D):N.value=D;return!0},L.getDefine=function(L){return this._defines[L]},L.define=function(L,D,P){return!(!P&&void 0===this._defines[L])&&(this._defines[L]=D,!0)},L.clone=function(){var L=new t(this._programName);Object.assign(L,this);var D={},P=this._properties;for(var N in P){var F=P[N],B=D[N]={},k=F.value;for(var U in Array.isArray(k)?B.value=k.concat():ArrayBuffer.isView(k)?B.value=new k.__proto__.constructor(k):B.value=k,F)"value"!==U&&(B[U]=F[U])}return L._properties=D,L._defines=Object.assign({},this._defines),L},t}();P.default=k,D.exports=P.default},{"../../core/value-types/value-type":233,"../enums":247,"../gfx":252}],244:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../gfx")),F=0;function a(L,D,P){for(var N=L,F=0;F<D.length;F++){var B=D[F].name,k=P[B];if(Number.isInteger(k)){var U=new RegExp(B,"g");N=N.replace(U,k)}}return N}function o(L){return L.replace(/#pragma for (\w+) in range\(\s*(\d+)\s*,\s*(\d+)\s*\)([\s\S]+?)#pragma endFor/g,(function(L,D,P,N,F){var B="",k=parseInt(P),U=parseInt(N);(k.isNaN||U.isNaN)&&console.error("Unroll For Loops Error: begin and end of range must be an int num.");for(var V=k;V<U;++V)B+=F.replace(new RegExp("{"+D+"}","g"),V);return B}))}function c(L){return L.replace(/\bhighp\b/g,"mediump")}var B=function(){function t(L){this._device=L,this._templates={},this._cache={},this._checkPrecision()}var L=t.prototype;return L.clear=function(){this._templates={},this._cache={}},L.define=function(L){var D=L.name,P=L.defines,N=L.glsl1||L,B=N.vert,k=N.frag;if(!this._templates[D]){for(var U=++F,V=0,z=0;z<P.length;++z){var W=P[z],H=1;if("number"===W.type){var G=W.range||[];W.min=G[0]||0,W.max=G[1]||4,H=Math.ceil(Math.log2(W.max-W.min)),W._map=function(L){return L-this.min<<this._offset}.bind(W)}else W._map=function(L){return L?1<<this._offset:0}.bind(W);W._offset=V,V+=H}var X=L.uniforms||[];if(L.samplers)for(var nt=0;nt<L.samplers.length;nt++)X.push(L.samplers[nt]);if(L.blocks)for(var ut=0;ut<L.blocks.length;ut++)for(var dt=L.blocks[ut].defines,ft=L.blocks[ut].members,_t=0;_t<ft.length;_t++)X.push({defines:dt,name:ft[_t].name,type:ft[_t].type});this._templates[D]={id:U,name:D,vert:B,frag:k,defines:P,attributes:L.attributes,uniforms:X,extensions:L.extensions}}},L.getTemplate=function(L){return this._templates[L]},L.hasProgram=function(L){return void 0!==this._templates[L]},L.getKey=function(L,D){for(var P=this._templates[L],N=0,F=0;F<P.defines.length;++F){var B=P.defines[F],k=D[B.name];void 0!==k&&(N|=B._map(k))}return P.id+":"+N},L.getProgram=function(L,D,P){var F=this.getKey(L,D),B=this._cache[F];if(B)return B;var k=this._templates[L],U=function(L,D){for(var P=[],N=0;N<L.length;N++){var F=L[N].name,B=D[F];"number"!=typeof B&&(B=B?1:0),P.push("#define "+F+" "+B)}return P.join("\n")+"\n"}(k.defines,D),V=a(k.vert,k.defines,D);V=U+o(V),this._highpSupported||(V=c(V));var z=a(k.frag,k.defines,D);z=U+o(z),this._highpSupported||(z=c(z));var W=(B=new N.default.Program(this._device,{vert:V,frag:z})).link();if(W){var H=V.split("\n"),G=z.split("\n"),X=k.defines.length;W.forEach((function(L){var D=L.line-1,N=L.line-X,F=("vs"===L.type?H:G)[D],B=L.info||"Failed to compile "+L.type+" "+L.fileID+" (ln "+N+"): \n "+L.message+": \n  "+F;cc.error(P+" : "+B)}))}return this._cache[F]=B,B},L._checkPrecision=function(){var L=this._device._gl,D=!1;if(L.getShaderPrecisionFormat){var P=L.getShaderPrecisionFormat(L.VERTEX_SHADER,L.HIGH_FLOAT),N=L.getShaderPrecisionFormat(L.FRAGMENT_SHADER,L.HIGH_FLOAT);D=P&&P.precision>0&&N&&N.precision>0}D||cc.warnID(9102),this._highpSupported=D},t}();P.default=B,D.exports=P.default},{"../gfx":252}],245:[function(L,D,P){"use strict";function n(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}P.__esModule=!0,P.default=void 0;var N=function(){function t(L,D){this._name=L,this._passes=D}return t.prototype.clone=function(){for(var L=[],D=0;D<this._passes.length;D++)L.push(this._passes[D].clone());return new t(this._name,L)},function(L,D,P){D&&n(L.prototype,D),P&&n(L,P)}(t,[{key:"name",get:function(){return this._name}},{key:"passes",get:function(){return this._passes}}]),t}();P.default=N,D.exports=P.default},{}],246:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../../core/value-types"),F=function(L){return L&&L.__esModule?L:{default:L}}(L("../enums")),B=new N.Mat4,k=0,U=function(){function t(){this._id=k++,this._priority=0,this._rect={x:0,y:0,w:1,h:1},this._color=new N.Vec4(.3,.3,.3,1),this._depth=1,this._stencil=0,this._clearFlags=F.default.CLEAR_COLOR|F.default.CLEAR_DEPTH,this._clearModel=null,this._matView=cc.mat4(),this._matViewInv=cc.mat4(),this._matProj=cc.mat4(),this._matViewProj=cc.mat4(),this._matInvViewProj=cc.mat4(),this._stages=[],this._cullingByID=!1,this._framebuffer=null,this._shadowLight=null,this._cullingMask=4294967295}var L=t.prototype;return L.getForward=function(L){var D=this._matView.m;return N.Vec3.set(L,-D[2],-D[6],-D[10])},L.getPosition=function(L){return N.Mat4.invert(B,this._matView),N.Mat4.getTranslation(L,B)},t}();P.default=U,D.exports=P.default},{"../../core/value-types":225,"../enums":247}],247:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("./build/mappings"),F={PROJ_PERSPECTIVE:0,PROJ_ORTHO:1,LIGHT_DIRECTIONAL:0,LIGHT_POINT:1,LIGHT_SPOT:2,LIGHT_AMBIENT:3,SHADOW_NONE:0,SHADOW_HARD:1,SHADOW_SOFT:2,PARAM_INT:N.typeMap.int,PARAM_INT2:N.typeMap.ivec2,PARAM_INT3:N.typeMap.ivec3,PARAM_INT4:N.typeMap.ivec4,PARAM_FLOAT:N.typeMap.float,PARAM_FLOAT2:N.typeMap.vec2,PARAM_FLOAT3:N.typeMap.vec3,PARAM_FLOAT4:N.typeMap.vec4,PARAM_MAT2:N.typeMap.mat2,PARAM_MAT3:N.typeMap.mat3,PARAM_MAT4:N.typeMap.mat4,PARAM_TEXTURE_2D:N.typeMap.sampler2D,PARAM_TEXTURE_CUBE:N.typeMap.samplerCube,CLEAR_COLOR:1,CLEAR_DEPTH:2,CLEAR_STENCIL:4,CLEAR_SKYBOX:8,BUFFER_VIEW_INT8:0,BUFFER_VIEW_UINT8:1,BUFFER_VIEW_INT16:2,BUFFER_VIEW_UINT16:3,BUFFER_VIEW_INT32:4,BUFFER_VIEW_UINT32:5,BUFFER_VIEW_FLOAT32:6};P.default=F,D.exports=P.default},{"./build/mappings":240}],248:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N,F,B=l(L("./state")),k=L("./enums"),U=l(L("./texture-2d")),V=l(L("./texture-cube"));function l(L){return L&&L.__esModule?L:{default:L}}function h(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var z=((N={})[5124]=function(L,D,P){L.uniform1i(D,P)},N[5126]=function(L,D,P){L.uniform1f(D,P)},N[35664]=function(L,D,P){L.uniform2fv(D,P)},N[35665]=function(L,D,P){L.uniform3fv(D,P)},N[35666]=function(L,D,P){L.uniform4fv(D,P)},N[35667]=function(L,D,P){L.uniform2iv(D,P)},N[35668]=function(L,D,P){L.uniform3iv(D,P)},N[35669]=function(L,D,P){L.uniform4iv(D,P)},N[35670]=function(L,D,P){L.uniform1i(D,P)},N[35671]=function(L,D,P){L.uniform2iv(D,P)},N[35672]=function(L,D,P){L.uniform3iv(D,P)},N[35673]=function(L,D,P){L.uniform4iv(D,P)},N[35674]=function(L,D,P){L.uniformMatrix2fv(D,!1,P)},N[35675]=function(L,D,P){L.uniformMatrix3fv(D,!1,P)},N[35676]=function(L,D,P){L.uniformMatrix4fv(D,!1,P)},N[35678]=function(L,D,P){L.uniform1i(D,P)},N[35680]=function(L,D,P){L.uniform1i(D,P)},N),W=((F={})[5124]=function(L,D,P){L.uniform1iv(D,P)},F[5126]=function(L,D,P){L.uniform1fv(D,P)},F[35664]=function(L,D,P){L.uniform2fv(D,P)},F[35665]=function(L,D,P){L.uniform3fv(D,P)},F[35666]=function(L,D,P){L.uniform4fv(D,P)},F[35667]=function(L,D,P){L.uniform2iv(D,P)},F[35668]=function(L,D,P){L.uniform3iv(D,P)},F[35669]=function(L,D,P){L.uniform4iv(D,P)},F[35670]=function(L,D,P){L.uniform1iv(D,P)},F[35671]=function(L,D,P){L.uniform2iv(D,P)},F[35672]=function(L,D,P){L.uniform3iv(D,P)},F[35673]=function(L,D,P){L.uniform4iv(D,P)},F[35674]=function(L,D,P){L.uniformMatrix2fv(D,!1,P)},F[35675]=function(L,D,P){L.uniformMatrix3fv(D,!1,P)},F[35676]=function(L,D,P){L.uniformMatrix4fv(D,!1,P)},F[35678]=function(L,D,P){L.uniform1iv(D,P)},F[35680]=function(L,D,P){L.uniform1iv(D,P)},F);function _(L,D,P){if(D.blend!==P.blend)return P.blend?(L.enable(L.BLEND),P.blendSrc!==k.enums.BLEND_CONSTANT_COLOR&&P.blendSrc!==k.enums.BLEND_ONE_MINUS_CONSTANT_COLOR&&P.blendDst!==k.enums.BLEND_CONSTANT_COLOR&&P.blendDst!==k.enums.BLEND_ONE_MINUS_CONSTANT_COLOR||L.blendColor((P.blendColor>>24)/255,(P.blendColor>>16&255)/255,(P.blendColor>>8&255)/255,(255&P.blendColor)/255),void(P.blendSep?(L.blendFuncSeparate(P.blendSrc,P.blendDst,P.blendSrcAlpha,P.blendDstAlpha),L.blendEquationSeparate(P.blendEq,P.blendAlphaEq)):(L.blendFunc(P.blendSrc,P.blendDst),L.blendEquation(P.blendEq)))):void L.disable(L.BLEND);!1!==P.blend&&(D.blendColor!==P.blendColor&&L.blendColor((P.blendColor>>24)/255,(P.blendColor>>16&255)/255,(P.blendColor>>8&255)/255,(255&P.blendColor)/255),D.blendSep===P.blendSep?P.blendSep?(D.blendSrc===P.blendSrc&&D.blendDst===P.blendDst&&D.blendSrcAlpha===P.blendSrcAlpha&&D.blendDstAlpha===P.blendDstAlpha||L.blendFuncSeparate(P.blendSrc,P.blendDst,P.blendSrcAlpha,P.blendDstAlpha),D.blendEq===P.blendEq&&D.blendAlphaEq===P.blendAlphaEq||L.blendEquationSeparate(P.blendEq,P.blendAlphaEq)):(D.blendSrc===P.blendSrc&&D.blendDst===P.blendDst||L.blendFunc(P.blendSrc,P.blendDst),D.blendEq!==P.blendEq&&L.blendEquation(P.blendEq)):P.blendSep?(L.blendFuncSeparate(P.blendSrc,P.blendDst,P.blendSrcAlpha,P.blendDstAlpha),L.blendEquationSeparate(P.blendEq,P.blendAlphaEq)):(L.blendFunc(P.blendSrc,P.blendDst),L.blendEquation(P.blendEq)))}function p(L,D,P){if(D.depthTest!==P.depthTest)return P.depthTest?(L.enable(L.DEPTH_TEST),L.depthFunc(P.depthFunc),void L.depthMask(P.depthWrite)):void L.disable(L.DEPTH_TEST);D.depthWrite!==P.depthWrite&&L.depthMask(P.depthWrite),!1!==P.depthTest?D.depthFunc!==P.depthFunc&&L.depthFunc(P.depthFunc):P.depthWrite&&(P.depthTest=!0,P.depthFunc=k.enums.DS_FUNC_ALWAYS,L.enable(L.DEPTH_TEST),L.depthFunc(P.depthFunc))}function v(L,D,P){if(P.stencilTest!==k.enums.STENCIL_INHERIT)return P.stencilTest!==D.stencilTest?P.stencilTest===k.enums.STENCIL_DISABLE?void L.disable(L.STENCIL_TEST):(L.enable(L.STENCIL_TEST),void(P.stencilSep?(L.stencilFuncSeparate(L.FRONT,P.stencilFuncFront,P.stencilRefFront,P.stencilMaskFront),L.stencilMaskSeparate(L.FRONT,P.stencilWriteMaskFront),L.stencilOpSeparate(L.FRONT,P.stencilFailOpFront,P.stencilZFailOpFront,P.stencilZPassOpFront),L.stencilFuncSeparate(L.BACK,P.stencilFuncBack,P.stencilRefBack,P.stencilMaskBack),L.stencilMaskSeparate(L.BACK,P.stencilWriteMaskBack),L.stencilOpSeparate(L.BACK,P.stencilFailOpBack,P.stencilZFailOpBack,P.stencilZPassOpBack)):(L.stencilFunc(P.stencilFuncFront,P.stencilRefFront,P.stencilMaskFront),L.stencilMask(P.stencilWriteMaskFront),L.stencilOp(P.stencilFailOpFront,P.stencilZFailOpFront,P.stencilZPassOpFront)))):void(P.stencilTest!==k.enums.STENCIL_DISABLE&&(D.stencilSep===P.stencilSep?P.stencilSep?(D.stencilFuncFront===P.stencilFuncFront&&D.stencilRefFront===P.stencilRefFront&&D.stencilMaskFront===P.stencilMaskFront||L.stencilFuncSeparate(L.FRONT,P.stencilFuncFront,P.stencilRefFront,P.stencilMaskFront),D.stencilWriteMaskFront!==P.stencilWriteMaskFront&&L.stencilMaskSeparate(L.FRONT,P.stencilWriteMaskFront),D.stencilFailOpFront===P.stencilFailOpFront&&D.stencilZFailOpFront===P.stencilZFailOpFront&&D.stencilZPassOpFront===P.stencilZPassOpFront||L.stencilOpSeparate(L.FRONT,P.stencilFailOpFront,P.stencilZFailOpFront,P.stencilZPassOpFront),D.stencilFuncBack===P.stencilFuncBack&&D.stencilRefBack===P.stencilRefBack&&D.stencilMaskBack===P.stencilMaskBack||L.stencilFuncSeparate(L.BACK,P.stencilFuncBack,P.stencilRefBack,P.stencilMaskBack),D.stencilWriteMaskBack!==P.stencilWriteMaskBack&&L.stencilMaskSeparate(L.BACK,P.stencilWriteMaskBack),D.stencilFailOpBack===P.stencilFailOpBack&&D.stencilZFailOpBack===P.stencilZFailOpBack&&D.stencilZPassOpBack===P.stencilZPassOpBack||L.stencilOpSeparate(L.BACK,P.stencilFailOpBack,P.stencilZFailOpBack,P.stencilZPassOpBack)):(D.stencilFuncFront===P.stencilFuncFront&&D.stencilRefFront===P.stencilRefFront&&D.stencilMaskFront===P.stencilMaskFront||L.stencilFunc(P.stencilFuncFront,P.stencilRefFront,P.stencilMaskFront),D.stencilWriteMaskFront!==P.stencilWriteMaskFront&&L.stencilMask(P.stencilWriteMaskFront),D.stencilFailOpFront===P.stencilFailOpFront&&D.stencilZFailOpFront===P.stencilZFailOpFront&&D.stencilZPassOpFront===P.stencilZPassOpFront||L.stencilOp(P.stencilFailOpFront,P.stencilZFailOpFront,P.stencilZPassOpFront)):P.stencilSep?(L.stencilFuncSeparate(L.FRONT,P.stencilFuncFront,P.stencilRefFront,P.stencilMaskFront),L.stencilMaskSeparate(L.FRONT,P.stencilWriteMaskFront),L.stencilOpSeparate(L.FRONT,P.stencilFailOpFront,P.stencilZFailOpFront,P.stencilZPassOpFront),L.stencilFuncSeparate(L.BACK,P.stencilFuncBack,P.stencilRefBack,P.stencilMaskBack),L.stencilMaskSeparate(L.BACK,P.stencilWriteMaskBack),L.stencilOpSeparate(L.BACK,P.stencilFailOpBack,P.stencilZFailOpBack,P.stencilZPassOpBack)):(L.stencilFunc(P.stencilFuncFront,P.stencilRefFront,P.stencilMaskFront),L.stencilMask(P.stencilWriteMaskFront),L.stencilOp(P.stencilFailOpFront,P.stencilZFailOpFront,P.stencilZPassOpFront))))}function g(L,D,P){D.cullMode!==P.cullMode&&(P.cullMode!==k.enums.CULL_NONE?(L.enable(L.CULL_FACE),L.cullFace(P.cullMode)):L.disable(L.CULL_FACE))}function T(L,D,P,N){void 0===N&&(N=0),P instanceof U.default?L.framebufferTexture2D(L.FRAMEBUFFER,D,L.TEXTURE_2D,P._glID,0):P instanceof V.default?L.framebufferTexture2D(L.FRAMEBUFFER,D,L.TEXTURE_CUBE_MAP_POSITIVE_X+N,P._glID,0):L.framebufferRenderbuffer(L.FRAMEBUFFER,D,L.RENDERBUFFER,P._glID)}var H=function(){function t(L,D){var P;void 0===(D=D||{}).alpha&&(D.alpha=!1),void 0===D.stencil&&(D.stencil=!0),void 0===D.depth&&(D.depth=!0),void 0===D.antialias&&(D.antialias=!1),void 0===D.preserveDrawingBuffer&&(D.preserveDrawingBuffer=!1);try{P=L.getContext("webgl",D)||L.getContext("experimental-webgl",D)||L.getContext("webkit-3d",D)||L.getContext("moz-webgl",D)}catch(L){return void console.error(L)}P||console.error("This device does not support webgl"),this._gl=P,this._extensions={},this._caps={},this._stats={texture:0,vb:0,ib:0,drawcalls:0},this._initExtensions(["EXT_texture_filter_anisotropic","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","WEBGL_draw_buffers"]),this._initCaps(),this._initStates(),B.default.initDefault(this),this._current=new B.default(this),this._next=new B.default(this),this._uniforms={},this._vx=this._vy=this._vw=this._vh=0,this._sx=this._sy=this._sw=this._sh=0,this._framebuffer=null,this._enabledAttributes=new Array(this._caps.maxVertexAttribs),this._newAttributes=new Array(this._caps.maxVertexAttribs);for(var N=0;N<this._caps.maxVertexAttribs;++N)this._enabledAttributes[N]=0,this._newAttributes[N]=0}!function(L,D,P){D&&h(L.prototype,D),P&&h(L,P)}(t,[{key:"caps",get:function(){return this._caps}}]);var L=t.prototype;return L._initExtensions=function(L){for(var D=this._gl,P=0;P<L.length;++P)for(var N=L[P],F=["","WEBKIT_","MOZ_"],B=0;B<F.length;B++)try{var k=D.getExtension(F[B]+N);if(k){this._extensions[N]=k;break}}catch(L){console.error(L)}},L._initCaps=function(){var L=this._gl,D=this.ext("WEBGL_draw_buffers");this._caps.maxVertexStreams=4,this._caps.maxVertexTextures=L.getParameter(L.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxFragUniforms=L.getParameter(L.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=L.getParameter(L.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexAttribs=L.getParameter(L.MAX_VERTEX_ATTRIBS),this._caps.maxTextureSize=L.getParameter(L.MAX_TEXTURE_SIZE),this._caps.maxDrawBuffers=D?L.getParameter(D.MAX_DRAW_BUFFERS_WEBGL):1,this._caps.maxColorAttachments=D?L.getParameter(D.MAX_COLOR_ATTACHMENTS_WEBGL):1},L._initStates=function(){var L=this._gl;L.disable(L.BLEND),L.blendFunc(L.ONE,L.ZERO),L.blendEquation(L.FUNC_ADD),L.blendColor(1,1,1,1),L.colorMask(!0,!0,!0,!0),L.enable(L.CULL_FACE),L.cullFace(L.BACK),L.disable(L.DEPTH_TEST),L.depthFunc(L.LESS),L.depthMask(!1),L.disable(L.POLYGON_OFFSET_FILL),L.depthRange(0,1),L.disable(L.STENCIL_TEST),L.stencilFunc(L.ALWAYS,0,255),L.stencilMask(255),L.stencilOp(L.KEEP,L.KEEP,L.KEEP),L.clearDepth(1),L.clearColor(0,0,0,0),L.clearStencil(0),L.disable(L.SCISSOR_TEST)},L._restoreTexture=function(L){var D=this._gl,P=this._current.textureUnits[L];P&&-1!==P._glID?D.bindTexture(P._target,P._glID):D.bindTexture(D.TEXTURE_2D,null)},L._restoreIndexBuffer=function(){var L=this._gl,D=this._current.indexBuffer;D&&-1!==D._glID?L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,D._glID):L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,null)},L.ext=function(L){return this._extensions[L]},L.allowFloatTexture=function(){return null!=this.ext("OES_texture_float")},L.setFrameBuffer=function(L){if(this._framebuffer!==L){this._framebuffer=L;var D=this._gl;if(L){D.bindFramebuffer(D.FRAMEBUFFER,L._glID);for(var P=L._colors.length,N=0;N<P;++N){var F=L._colors[N];T(D,D.COLOR_ATTACHMENT0+N,F)}for(var B=P;B<this._caps.maxColorAttachments;++B)D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0+B,D.TEXTURE_2D,null,0);L._depth&&T(D,D.DEPTH_ATTACHMENT,L._depth),L._stencil&&T(D,D.STENCIL_ATTACHMENT,L._stencil),L._depthStencil&&T(D,D.DEPTH_STENCIL_ATTACHMENT,L._depthStencil)}else D.bindFramebuffer(D.FRAMEBUFFER,null)}},L.setViewport=function(L,D,P,N){this._vx===L&&this._vy===D&&this._vw===P&&this._vh===N||(this._gl.viewport(L,D,P,N),this._vx=L,this._vy=D,this._vw=P,this._vh=N)},L.setScissor=function(L,D,P,N){this._sx===L&&this._sy===D&&this._sw===P&&this._sh===N||(this._gl.scissor(L,D,P,N),this._sx=L,this._sy=D,this._sw=P,this._sh=N)},L.clear=function(L){if(void 0!==L.color||void 0!==L.depth||void 0!==L.stencil){var D=this._gl,P=0;void 0!==L.color&&(P|=D.COLOR_BUFFER_BIT,D.clearColor(L.color[0],L.color[1],L.color[2],L.color[3])),void 0!==L.depth&&(P|=D.DEPTH_BUFFER_BIT,D.clearDepth(L.depth),D.enable(D.DEPTH_TEST),D.depthMask(!0),D.depthFunc(D.ALWAYS)),void 0!==L.stencil&&(P|=D.STENCIL_BUFFER_BIT,D.clearStencil(L.stencil)),D.clear(P),void 0!==L.depth&&(!1===this._current.depthTest?D.disable(D.DEPTH_TEST):(!1===this._current.depthWrite&&D.depthMask(!1),this._current.depthFunc!==k.enums.DS_FUNC_ALWAYS&&D.depthFunc(this._current.depthFunc)))}},L.enableBlend=function(){this._next.blend=!0},L.enableDepthTest=function(){this._next.depthTest=!0},L.enableDepthWrite=function(){this._next.depthWrite=!0},L.setStencilTest=function(L){this._next.stencilTest=L},L.setStencilFunc=function(L,D,P){this._next.stencilSep=!1,this._next.stencilFuncFront=this._next.stencilFuncBack=L,this._next.stencilRefFront=this._next.stencilRefBack=D,this._next.stencilMaskFront=this._next.stencilMaskBack=P},L.setStencilFuncFront=function(L,D,P){this._next.stencilSep=!0,this._next.stencilFuncFront=L,this._next.stencilRefFront=D,this._next.stencilMaskFront=P},L.setStencilFuncBack=function(L,D,P){this._next.stencilSep=!0,this._next.stencilFuncBack=L,this._next.stencilRefBack=D,this._next.stencilMaskBack=P},L.setStencilOp=function(L,D,P,N){this._next.stencilFailOpFront=this._next.stencilFailOpBack=L,this._next.stencilZFailOpFront=this._next.stencilZFailOpBack=D,this._next.stencilZPassOpFront=this._next.stencilZPassOpBack=P,this._next.stencilWriteMaskFront=this._next.stencilWriteMaskBack=N},L.setStencilOpFront=function(L,D,P,N){this._next.stencilSep=!0,this._next.stencilFailOpFront=L,this._next.stencilZFailOpFront=D,this._next.stencilZPassOpFront=P,this._next.stencilWriteMaskFront=N},L.setStencilOpBack=function(L,D,P,N){this._next.stencilSep=!0,this._next.stencilFailOpBack=L,this._next.stencilZFailOpBack=D,this._next.stencilZPassOpBack=P,this._next.stencilWriteMaskBack=N},L.setDepthFunc=function(L){this._next.depthFunc=L},L.setBlendColor32=function(L){this._next.blendColor=L},L.setBlendColor=function(L,D,P,N){this._next.blendColor=(255*L<<24|255*D<<16|255*P<<8|255*N)>>>0},L.setBlendFunc=function(L,D){this._next.blendSep=!1,this._next.blendSrc=L,this._next.blendDst=D},L.setBlendFuncSep=function(L,D,P,N){this._next.blendSep=!0,this._next.blendSrc=L,this._next.blendDst=D,this._next.blendSrcAlpha=P,this._next.blendDstAlpha=N},L.setBlendEq=function(L){this._next.blendSep=!1,this._next.blendEq=L},L.setBlendEqSep=function(L,D){this._next.blendSep=!0,this._next.blendEq=L,this._next.blendAlphaEq=D},L.setCullMode=function(L){this._next.cullMode=L},L.setVertexBuffer=function(L,D,P){void 0===P&&(P=0),this._next.vertexBuffers[L]=D,this._next.vertexBufferOffsets[L]=P,this._next.maxStream<L&&(this._next.maxStream=L)},L.setIndexBuffer=function(L){this._next.indexBuffer=L},L.setProgram=function(L){this._next.program=L},L.setTexture=function(L,D,P){P>=this._caps.maxTextureUnits?console.warn("Can not set texture "+L+" at stage "+P+", max texture exceed: "+this._caps.maxTextureUnits):(this._next.textureUnits[P]=D,this.setUniform(L,P),this._next.maxTextureSlot<P&&(this._next.maxTextureSlot=P))},L.setTextureArray=function(L,D,P){var N=D.length;if(N>=this._caps.maxTextureUnits)console.warn("Can not set "+N+" textures for "+L+", max texture exceed: "+this._caps.maxTextureUnits);else{for(var F=0;F<N;++F){var B=P[F];this._next.textureUnits[B]=D[F],this._next.maxTextureSlot<B&&(this._next.maxTextureSlot=B)}this.setUniform(L,P)}},L.setUniform=function(L,D){var P=this._uniforms[L],N=!1,F=!1,B=!1,k=!1;do{if(!P)break;if(B=Array.isArray(D)||D instanceof Float32Array,k=D instanceof Int32Array,F=B||k,P.isArray!==F)break;if(P.isArray&&P.value.length!==D.length)break;N=!0}while(0);if(N){var U=P.value,V=!1;if(P.isArray)for(var z=0,W=U.length;z<W;z++)U[z]!==D[z]&&(V=!0,U[z]=D[z]);else U!==D&&(V=!0,P.value=D);V&&(P.dirty=!0)}else{var H=D;B?H=new Float32Array(D):k&&(H=new Int32Array(D)),P={dirty:!0,value:H,isArray:F}}this._uniforms[L]=P},L.setUniformDirectly=function(L,D){var P=this._uniforms[L];P||(this._uniforms[L]=P={}),P.dirty=!0,P.value=D},L.setPrimitiveType=function(L){this._next.primitiveType=L},L.resetDrawCalls=function(){this._stats.drawcalls=0},L.getDrawCalls=function(){return this._stats.drawcalls},L.draw=function(L,D){var P=this._gl,N=this._current,F=this._next;_(P,N,F),p(P,N,F),v(P,N,F),g(P,N,F),function(L,D,P,N){var F=!1;if(-1!==N.maxStream){if(P.maxStream!==N.maxStream)F=!0;else if(P.program!==N.program)F=!0;else for(var B=0;B<N.maxStream+1;++B)if(P.vertexBuffers[B]!==N.vertexBuffers[B]||P.vertexBufferOffsets[B]!==N.vertexBufferOffsets[B]){F=!0;break}if(F){for(var k=0;k<L._caps.maxVertexAttribs;++k)L._newAttributes[k]=0;for(var U=0;U<N.maxStream+1;++U){var V=N.vertexBuffers[U],z=N.vertexBufferOffsets[U];if(V&&-1!==V._glID){D.bindBuffer(D.ARRAY_BUFFER,V._glID);for(var W=0;W<N.program._attributes.length;++W){var H=N.program._attributes[W],G=V._format.element(H.name);G?(0===L._enabledAttributes[H.location]&&(D.enableVertexAttribArray(H.location),L._enabledAttributes[H.location]=1),L._newAttributes[H.location]=1,D.vertexAttribPointer(H.location,G.num,G.type,G.normalize,G.stride,G.offset+z*G.stride)):console.warn("Can not find vertex attribute: "+H.name)}}}for(var X=0;X<L._caps.maxVertexAttribs;++X)L._enabledAttributes[X]!==L._newAttributes[X]&&(D.disableVertexAttribArray(X),L._enabledAttributes[X]=0)}}}(this,P,N,F),N.indexBuffer!==F.indexBuffer&&P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,F.indexBuffer&&-1!==F.indexBuffer._glID?F.indexBuffer._glID:null);var B=!1;N.program!==F.program&&(F.program._linked?P.useProgram(F.program._glID):console.warn("Failed to use program: has not linked yet."),B=!0),function(L,D,P){for(var N=0;N<P.maxTextureSlot+1;++N)if(D.textureUnits[N]!==P.textureUnits[N]){var F=P.textureUnits[N];F&&-1!==F._glID&&(L.activeTexture(L.TEXTURE0+N),L.bindTexture(F._target,F._glID))}}(P,N,F);for(var k=0;k<F.program._uniforms.length;++k){var U=F.program._uniforms[k],V=this._uniforms[U.name];if(V&&(B||V.dirty)){V.dirty=!1;var H=void 0===U.size?z[U.type]:W[U.type];H?H(P,U.location,V.value):console.warn("Can not find commit function for uniform "+U.name)}}D&&(F.indexBuffer?P.drawElements(this._next.primitiveType,D,F.indexBuffer._format,L*F.indexBuffer._bytesPerIndex):P.drawArrays(this._next.primitiveType,L,D),this._stats.drawcalls++),N.set(F),F.reset()},t}();P.default=H,D.exports=P.default},{"./enums":249,"./state":256,"./texture-2d":257,"./texture-cube":258}],249:[function(L,D,P){"use strict";P.__esModule=!0,P.attrTypeBytes=function(L){return L===B.ATTR_TYPE_INT8||L===B.ATTR_TYPE_UINT8?1:L===B.ATTR_TYPE_INT16||L===B.ATTR_TYPE_UINT16?2:L===B.ATTR_TYPE_INT32||L===B.ATTR_TYPE_UINT32||L===B.ATTR_TYPE_FLOAT32?4:(console.warn("Unknown ATTR_TYPE: "+L),0)},P.glFilter=function(L,D,P){void 0===P&&(P=-1);var F=N[D][P+1];return void 0===F?(console.warn("Unknown FILTER: "+D),-1===P?L.LINEAR:L.LINEAR_MIPMAP_LINEAR):F},P.glTextureFmt=function(L){var D=F[L];return void 0===D?(console.warn("Unknown TEXTURE_FMT: "+L),F[B.TEXTURE_FMT_RGBA8]):D},P.enums=void 0;var N=[[9728,9984,9986],[9729,9985,9987]],F=[{format:6407,internalFormat:33776,pixelType:null},{format:6408,internalFormat:33777,pixelType:null},{format:6408,internalFormat:33778,pixelType:null},{format:6408,internalFormat:33779,pixelType:null},{format:6407,internalFormat:36196,pixelType:null},{format:6407,internalFormat:35841,pixelType:null},{format:6408,internalFormat:35843,pixelType:null},{format:6407,internalFormat:35840,pixelType:null},{format:6408,internalFormat:35842,pixelType:null},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121},{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6407,internalFormat:6407,pixelType:36193},{format:6408,internalFormat:6408,pixelType:36193},{format:6407,internalFormat:6407,pixelType:5126},{format:6408,internalFormat:6408,pixelType:5126},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:null,internalFormat:null,pixelType:null},{format:6402,internalFormat:6402,pixelType:5123},{format:6402,internalFormat:6402,pixelType:5125},{format:6402,internalFormat:6402,pixelType:5125},{format:6407,internalFormat:37492,pixelType:null},{format:6408,internalFormat:37496,pixelType:null}],B={USAGE_STATIC:35044,USAGE_DYNAMIC:35048,USAGE_STREAM:35040,INDEX_FMT_UINT8:5121,INDEX_FMT_UINT16:5123,INDEX_FMT_UINT32:5125,ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR0:"a_color0",ATTR_COLOR1:"a_color1",ATTR_UV:"a_uv",ATTR_UV0:"a_uv0",ATTR_UV1:"a_uv1",ATTR_UV2:"a_uv2",ATTR_UV3:"a_uv3",ATTR_UV4:"a_uv4",ATTR_UV5:"a_uv5",ATTR_UV6:"a_uv6",ATTR_UV7:"a_uv7",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_TYPE_INT8:5120,ATTR_TYPE_UINT8:5121,ATTR_TYPE_INT16:5122,ATTR_TYPE_UINT16:5123,ATTR_TYPE_INT32:5124,ATTR_TYPE_UINT32:5125,ATTR_TYPE_FLOAT32:5126,FILTER_NEAREST:0,FILTER_LINEAR:1,WRAP_REPEAT:10497,WRAP_CLAMP:33071,WRAP_MIRROR:33648,TEXTURE_FMT_RGB_DXT1:0,TEXTURE_FMT_RGBA_DXT1:1,TEXTURE_FMT_RGBA_DXT3:2,TEXTURE_FMT_RGBA_DXT5:3,TEXTURE_FMT_RGB_ETC1:4,TEXTURE_FMT_RGB_PVRTC_2BPPV1:5,TEXTURE_FMT_RGBA_PVRTC_2BPPV1:6,TEXTURE_FMT_RGB_PVRTC_4BPPV1:7,TEXTURE_FMT_RGBA_PVRTC_4BPPV1:8,TEXTURE_FMT_A8:9,TEXTURE_FMT_L8:10,TEXTURE_FMT_L8_A8:11,TEXTURE_FMT_R5_G6_B5:12,TEXTURE_FMT_R5_G5_B5_A1:13,TEXTURE_FMT_R4_G4_B4_A4:14,TEXTURE_FMT_RGB8:15,TEXTURE_FMT_RGBA8:16,TEXTURE_FMT_RGB16F:17,TEXTURE_FMT_RGBA16F:18,TEXTURE_FMT_RGB32F:19,TEXTURE_FMT_RGBA32F:20,TEXTURE_FMT_R32F:21,TEXTURE_FMT_111110F:22,TEXTURE_FMT_SRGB:23,TEXTURE_FMT_SRGBA:24,TEXTURE_FMT_D16:25,TEXTURE_FMT_D32:26,TEXTURE_FMT_D24S8:27,TEXTURE_FMT_RGB_ETC2:28,TEXTURE_FMT_RGBA_ETC2:29,DS_FUNC_NEVER:512,DS_FUNC_LESS:513,DS_FUNC_EQUAL:514,DS_FUNC_LEQUAL:515,DS_FUNC_GREATER:516,DS_FUNC_NOTEQUAL:517,DS_FUNC_GEQUAL:518,DS_FUNC_ALWAYS:519,RB_FMT_RGBA4:32854,RB_FMT_RGB5_A1:32855,RB_FMT_RGB565:36194,RB_FMT_D16:33189,RB_FMT_S8:36168,RB_FMT_D24S8:34041,BLEND_FUNC_ADD:32774,BLEND_FUNC_SUBTRACT:32778,BLEND_FUNC_REVERSE_SUBTRACT:32779,BLEND_ZERO:0,BLEND_ONE:1,BLEND_SRC_COLOR:768,BLEND_ONE_MINUS_SRC_COLOR:769,BLEND_DST_COLOR:774,BLEND_ONE_MINUS_DST_COLOR:775,BLEND_SRC_ALPHA:770,BLEND_ONE_MINUS_SRC_ALPHA:771,BLEND_DST_ALPHA:772,BLEND_ONE_MINUS_DST_ALPHA:773,BLEND_CONSTANT_COLOR:32769,BLEND_ONE_MINUS_CONSTANT_COLOR:32770,BLEND_CONSTANT_ALPHA:32771,BLEND_ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_SRC_ALPHA_SATURATE:776,STENCIL_DISABLE:0,STENCIL_ENABLE:1,STENCIL_INHERIT:2,STENCIL_OP_KEEP:7680,STENCIL_OP_ZERO:0,STENCIL_OP_REPLACE:7681,STENCIL_OP_INCR:7682,STENCIL_OP_INCR_WRAP:34055,STENCIL_OP_DECR:7683,STENCIL_OP_DECR_WRAP:34056,STENCIL_OP_INVERT:5386,CULL_NONE:0,CULL_FRONT:1028,CULL_BACK:1029,CULL_FRONT_AND_BACK:1032,PT_POINTS:0,PT_LINES:1,PT_LINE_LOOP:2,PT_LINE_STRIP:3,PT_TRIANGLES:4,PT_TRIANGLE_STRIP:5,PT_TRIANGLE_FAN:6};P.enums=B},{}],250:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(L,D,P,N){this._device=L,this._width=D,this._height=P,this._colors=N.colors||[],this._depth=N.depth||null,this._stencil=N.stencil||null,this._depthStencil=N.depthStencil||null,this._glID=L._gl.createFramebuffer()}var L=t.prototype;return L.destroy=function(){null!==this._glID?(this._device._gl.deleteFramebuffer(this._glID),this._glID=null):console.error("The frame-buffer already destroyed")},L.getHandle=function(){return this._glID},t}();P.default=N,D.exports=P.default},{}],251:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N,F=L("./enums");function s(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var B=((N={})[F.enums.INDEX_FMT_UINT8]=1,N[F.enums.INDEX_FMT_UINT16]=2,N[F.enums.INDEX_FMT_UINT32]=4,N),k=function(){function t(L,D,P,N){this._device=L,this._format=D,this._usage=P,this._bytesPerIndex=B[D],this._bytes=N.byteLength,this._numIndices=this._bytes/this._bytesPerIndex,this._needExpandDataStore=!0,this._glID=L._gl.createBuffer(),this.update(0,N),L._stats.ib+=this._bytes}var L=t.prototype;return L.destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.ib-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},L.update=function(L,D){if(-1!==this._glID){if(0!==D.byteLength){if(L+D.byteLength>this._bytes){if(L)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=L+D.byteLength,this._numIndices=this._bytes/this._bytesPerIndex}var P=this._device._gl,N=this._usage;P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,this._glID),this._needExpandDataStore?(P.bufferData(P.ELEMENT_ARRAY_BUFFER,D,N),this._needExpandDataStore=!1):P.bufferSubData(P.ELEMENT_ARRAY_BUFFER,L,D),this._device._restoreIndexBuffer()}}else console.error("The buffer is destroyed")},L.setUsage=function(L){this._usage=L},function(L,D,P){D&&s(L.prototype,D),P&&s(L,P)}(t,[{key:"count",get:function(){return this._numIndices}}]),t}();k.BYTES_PER_INDEX=B;var U=k;P.default=U,D.exports=P.default},{"./enums":249}],252:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N,F=L("./enums");N={VertexFormat:L("./vertex-format"),IndexBuffer:L("./index-buffer"),VertexBuffer:L("./vertex-buffer"),Program:L("./program"),Texture:L("./texture"),Texture2D:L("./texture-2d"),TextureCube:L("./texture-cube"),RenderBuffer:L("./render-buffer"),FrameBuffer:L("./frame-buffer"),Device:L("./device"),attrTypeBytes:F.attrTypeBytes,glFilter:F.glFilter,glTextureFmt:F.glTextureFmt},Object.assign(N,F.enums);var B=N;P.default=B,cc.gfx=N,D.exports=P.default},{"./device":248,"./enums":249,"./frame-buffer":250,"./index-buffer":251,"./program":254,"./render-buffer":255,"./texture":259,"./texture-2d":257,"./texture-cube":258,"./vertex-buffer":260,"./vertex-format":261}],253:[function(L,D,P){"use strict";P.__esModule=!0,P.isPow2=function(L){return!(L&L-1||!L)}},{}],254:[function(L,D,P){"use strict";function n(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}P.__esModule=!0,P.default=void 0;var N=0;function a(L,D,P){P.split("\n").forEach((function(P){if(!(P.length<5)){var N=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(P);N?L.push({type:D,fileID:0|N[1],line:0|N[2],message:N[3].trim()}):P.length>0&&L.push({type:D,fileID:-1,line:0,message:P})}}))}var F=function(){function t(L,D){this._device=L,this._attributes=[],this._uniforms=[],this._samplers=[],this._errors=[],this._linked=!1,this._vertSource=D.vert,this._fragSource=D.frag,this._glID=null,this._id=N++}var L=t.prototype;return L.link=function(){if(!this._linked){var L=this._device._gl,D=c(L,L.VERTEX_SHADER,this._vertSource),P=c(L,L.FRAGMENT_SHADER,this._fragSource),N=L.createProgram();L.attachShader(N,D),L.attachShader(N,P),L.linkProgram(N);var F=!1,B=this._errors;if(L.getShaderParameter(D,L.COMPILE_STATUS)||(a(B,"vs",L.getShaderInfoLog(D)),F=!0),L.getShaderParameter(P,L.COMPILE_STATUS)||(a(B,"fs",L.getShaderInfoLog(P)),F=!0),L.deleteShader(D),L.deleteShader(P),F)return B;if(!L.getProgramParameter(N,L.LINK_STATUS))return B.push({info:"Failed to link shader program: "+L.getProgramInfoLog(N)}),B;this._glID=N;for(var k=L.getProgramParameter(N,L.ACTIVE_ATTRIBUTES),U=0;U<k;++U){var V=L.getActiveAttrib(N,U),z=L.getAttribLocation(N,V.name);this._attributes.push({name:V.name,location:z,type:V.type})}for(var W=L.getProgramParameter(N,L.ACTIVE_UNIFORMS),H=0;H<W;++H){var G=L.getActiveUniform(N,H),X=G.name,nt=L.getUniformLocation(N,X),ut="[0]"===X.substr(X.length-3);ut&&(X=X.substr(0,X.length-3));var dt={name:X,location:nt,type:G.type,size:ut?G.size:void 0};this._uniforms.push(dt)}this._linked=!0}},L.destroy=function(){this._device._gl.deleteProgram(this._glID),this._linked=!1,this._glID=null,this._attributes=[],this._uniforms=[],this._samplers=[]},function(L,D,P){D&&n(L.prototype,D),P&&n(L,P)}(t,[{key:"id",get:function(){return this._id}}]),t}();function c(L,D,P){var N=L.createShader(D);return L.shaderSource(N,P),L.compileShader(N),N}P.default=F,D.exports=P.default},{}],255:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(L,D,P,N){this._device=L,this._format=D,this._glID=L._gl.createRenderbuffer(),this.update(P,N)}var L=t.prototype;return L.update=function(L,D){this._width=L,this._height=D;var P=this._device._gl;P.bindRenderbuffer(P.RENDERBUFFER,this._glID),P.renderbufferStorage(P.RENDERBUFFER,this._format,L,D),P.bindRenderbuffer(P.RENDERBUFFER,null)},L.destroy=function(){if(null!==this._glID){var L=this._device._gl;L.bindRenderbuffer(L.RENDERBUFFER,null),L.deleteRenderbuffer(this._glID),this._glID=null}else console.error("The render-buffer already destroyed")},t}();P.default=N,D.exports=P.default},{}],256:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("./enums"),F={blend:!1,blendSep:!1,blendColor:4294967295,blendEq:N.enums.BLEND_FUNC_ADD,blendAlphaEq:N.enums.BLEND_FUNC_ADD,blendSrc:N.enums.BLEND_ONE,blendDst:N.enums.BLEND_ZERO,blendSrcAlpha:N.enums.BLEND_ONE,blendDstAlpha:N.enums.BLEND_ZERO,depthTest:!1,depthWrite:!1,depthFunc:N.enums.DS_FUNC_LESS,stencilTest:!1,stencilSep:!1,stencilFuncFront:N.enums.DS_FUNC_ALWAYS,stencilRefFront:0,stencilMaskFront:255,stencilFailOpFront:N.enums.STENCIL_OP_KEEP,stencilZFailOpFront:N.enums.STENCIL_OP_KEEP,stencilZPassOpFront:N.enums.STENCIL_OP_KEEP,stencilWriteMaskFront:255,stencilFuncBack:N.enums.DS_FUNC_ALWAYS,stencilRefBack:0,stencilMaskBack:255,stencilFailOpBack:N.enums.STENCIL_OP_KEEP,stencilZFailOpBack:N.enums.STENCIL_OP_KEEP,stencilZPassOpBack:N.enums.STENCIL_OP_KEEP,stencilWriteMaskBack:255,cullMode:N.enums.CULL_BACK,primitiveType:N.enums.PT_TRIANGLES,maxStream:-1,vertexBuffers:[],vertexBufferOffsets:[],indexBuffer:null,maxTextureSlot:-1,textureUnits:[],program:null},B=function(){function t(L){this.vertexBuffers=new Array(L._caps.maxVertexStreams),this.vertexBufferOffsets=new Array(L._caps.maxVertexStreams),this.textureUnits=new Array(L._caps.maxTextureUnits),this.set(F)}t.initDefault=function(L){F.vertexBuffers=new Array(L._caps.maxVertexStreams),F.vertexBufferOffsets=new Array(L._caps.maxVertexStreams),F.textureUnits=new Array(L._caps.maxTextureUnits)};var L=t.prototype;return L.reset=function(){this.set(F)},L.set=function(L){this.blend=L.blend,this.blendSep=L.blendSep,this.blendColor=L.blendColor,this.blendEq=L.blendEq,this.blendAlphaEq=L.blendAlphaEq,this.blendSrc=L.blendSrc,this.blendDst=L.blendDst,this.blendSrcAlpha=L.blendSrcAlpha,this.blendDstAlpha=L.blendDstAlpha,this.depthTest=L.depthTest,this.depthWrite=L.depthWrite,this.depthFunc=L.depthFunc,this.stencilTest=L.stencilTest,this.stencilSep=L.stencilSep,this.stencilFuncFront=L.stencilFuncFront,this.stencilRefFront=L.stencilRefFront,this.stencilMaskFront=L.stencilMaskFront,this.stencilFailOpFront=L.stencilFailOpFront,this.stencilZFailOpFront=L.stencilZFailOpFront,this.stencilZPassOpFront=L.stencilZPassOpFront,this.stencilWriteMaskFront=L.stencilWriteMaskFront,this.stencilFuncBack=L.stencilFuncBack,this.stencilRefBack=L.stencilRefBack,this.stencilMaskBack=L.stencilMaskBack,this.stencilFailOpBack=L.stencilFailOpBack,this.stencilZFailOpBack=L.stencilZFailOpBack,this.stencilZPassOpBack=L.stencilZPassOpBack,this.stencilWriteMaskBack=L.stencilWriteMaskBack,this.cullMode=L.cullMode,this.primitiveType=L.primitiveType,this.maxStream=L.maxStream;for(var D=0;D<L.vertexBuffers.length;++D)this.vertexBuffers[D]=L.vertexBuffers[D];for(var P=0;P<L.vertexBufferOffsets.length;++P)this.vertexBufferOffsets[P]=L.vertexBufferOffsets[P];this.indexBuffer=L.indexBuffer,this.maxTextureSlot=L.maxTextureSlot;for(var N=0;N<L.textureUnits.length;++N)this.textureUnits[N]=L.textureUnits[N];this.program=L.program},t}();P.default=B,D.exports=P.default},{"./enums":249}],257:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./texture")),F=L("./enums"),B=L("./misc");var k=function(L){function e(D,P){var N,F=(N=L.call(this,D)||this)._device._gl;return N._target=F.TEXTURE_2D,N._glID=F.createTexture(),P.images=P.images||[null],N.update(P),N}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.update=function(L){var D=this._device._gl,P=this._genMipmap;if(L){void 0!==L.width&&(this._width=L.width),void 0!==L.height&&(this._height=L.height),void 0!==L.anisotropy&&(this._anisotropy=L.anisotropy),void 0!==L.minFilter&&(this._minFilter=L.minFilter),void 0!==L.magFilter&&(this._magFilter=L.magFilter),void 0!==L.mipFilter&&(this._mipFilter=L.mipFilter),void 0!==L.wrapS&&(this._wrapS=L.wrapS),void 0!==L.wrapT&&(this._wrapT=L.wrapT),void 0!==L.format&&(this._format=L.format,this._compressed=this._format>=F.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=F.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=F.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=F.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==L.genMipmaps&&(this._genMipmap=L.genMipmaps,P=L.genMipmaps);var N=this._device.caps.maxTextureSize||Number.MAX_VALUE,k=Math.max(L.width||0,L.height||0);N<k&&console.warn("The current texture size "+k+" exceeds the maximum size ["+N+"] supported on the device."),void 0!==L.images&&L.images.length>1&&(P=!1,(L.width>L.height?L.width:L.height)>>L.images.length-1!=1&&console.error("texture-2d mipmap is invalid, should have a 1x1 mipmap."))}(0,B.isPow2)(this._width)&&(0,B.isPow2)(this._height)||(P=!1),D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,this._glID),void 0!==L.images&&L.images.length>0&&(this._setMipmap(L.images,L.flipY,L.premultiplyAlpha),L.images.length>1&&(this._genMipmap=!0)),P&&(D.hint(D.GENERATE_MIPMAP_HINT,D.NICEST),D.generateMipmap(D.TEXTURE_2D),this._genMipmap=!0),this._setTexInfo(),this._device._restoreTexture(0)},D.updateSubImage=function(L){var D=this._device._gl,P=(0,F.glTextureFmt)(this._format);D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,this._glID),this._setSubImage(P,L),this._device._restoreTexture(0)},D.updateImage=function(L){var D=this._device._gl,P=(0,F.glTextureFmt)(this._format);D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,this._glID),this._setImage(P,L),this._device._restoreTexture(0)},D._setSubImage=function(L,D){var P=this._device._gl,N=D.flipY,F=D.premultiplyAlpha,B=D.image;!B||ArrayBuffer.isView(B)||B instanceof ArrayBuffer?(void 0===N?P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,!1):P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,N),void 0===F?P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F),this._compressed?P.compressedTexSubImage2D(P.TEXTURE_2D,D.level,D.x,D.y,D.width,D.height,L.format,B):P.texSubImage2D(P.TEXTURE_2D,D.level,D.x,D.y,D.width,D.height,L.format,L.pixelType,B)):(void 0===N?P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,!0):P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,N),void 0===F?P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F),P.texSubImage2D(P.TEXTURE_2D,D.level,D.x,D.y,L.format,L.pixelType,B))},D._setImage=function(L,D){var P=this._device._gl,N=D.flipY,F=D.premultiplyAlpha,B=D.image;!B||ArrayBuffer.isView(B)||B instanceof ArrayBuffer?(void 0===N?P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,!1):P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,N),void 0===F?P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F),this._compressed?P.compressedTexImage2D(P.TEXTURE_2D,D.level,L.internalFormat,D.width,D.height,0,B):P.texImage2D(P.TEXTURE_2D,D.level,L.internalFormat,D.width,D.height,0,L.format,L.pixelType,B)):(void 0===N?P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,!0):P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,N),void 0===F?P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F),P.texImage2D(P.TEXTURE_2D,D.level,L.internalFormat,L.format,L.pixelType,B))},D._setMipmap=function(L,D,P){for(var N=(0,F.glTextureFmt)(this._format),B={width:this._width,height:this._height,flipY:D,premultiplyAlpha:P,level:0,image:null},k=0;k<L.length;++k)B.level=k,B.width=this._width>>k,B.height=this._height>>k,B.image=L[k],this._setImage(N,B)},D._setTexInfo=function(){var L=this._device._gl,D=(0,B.isPow2)(this._width)&&(0,B.isPow2)(this._height);D||this._wrapS===F.enums.WRAP_CLAMP&&this._wrapT===F.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=F.enums.WRAP_CLAMP,this._wrapT=F.enums.WRAP_CLAMP);var P=this._genMipmap?this._mipFilter:-1;D||-1===P||(console.warn("NPOT textures do not support mipmap filter"),P=-1),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,(0,F.glFilter)(L,this._minFilter,P)),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,(0,F.glFilter)(L,this._magFilter,-1)),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,this._wrapS),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,this._wrapT);var N=this._device.ext("EXT_texture_filter_anisotropic");N&&L.texParameteri(L.TEXTURE_2D,N.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)},e}(N.default);P.default=k,D.exports=P.default},{"./enums":249,"./misc":253,"./texture":259}],258:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./texture")),F=L("./enums"),B=L("./misc");var k=function(L){function e(D,P){var N,F=(N=L.call(this,D)||this)._device._gl;return N._target=F.TEXTURE_CUBE_MAP,N._glID=F.createTexture(),N.update(P),N}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.update=function(L){var D=this._device._gl,P=this._genMipmaps;L&&(void 0!==L.width&&(this._width=L.width),void 0!==L.height&&(this._height=L.height),void 0!==L.anisotropy&&(this._anisotropy=L.anisotropy),void 0!==L.minFilter&&(this._minFilter=L.minFilter),void 0!==L.magFilter&&(this._magFilter=L.magFilter),void 0!==L.mipFilter&&(this._mipFilter=L.mipFilter),void 0!==L.wrapS&&(this._wrapS=L.wrapS),void 0!==L.wrapT&&(this._wrapT=L.wrapT),void 0!==L.format&&(this._format=L.format,this._compressed=this._format>=F.enums.TEXTURE_FMT_RGB_DXT1&&this._format<=F.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1||this._format>=F.enums.TEXTURE_FMT_RGB_ETC2&&this._format<=F.enums.TEXTURE_FMT_RGBA_ETC2),void 0!==L.genMipmaps&&(this._genMipmaps=L.genMipmaps,P=L.genMipmaps),void 0!==L.images&&L.images.length>1&&(P=!1,L.width!==L.height&&console.warn("texture-cube width and height should be identical."),L.width>>L.images.length-1!=1&&console.error("texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn"))),(0,B.isPow2)(this._width)&&(0,B.isPow2)(this._height)||(P=!1),D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_CUBE_MAP,this._glID),void 0!==L.images&&L.images.length>0&&(this._setMipmap(L.images,L.flipY,L.premultiplyAlpha),L.images.length>1&&(this._genMipmaps=!0)),P&&(D.hint(D.GENERATE_MIPMAP_HINT,D.NICEST),D.generateMipmap(D.TEXTURE_CUBE_MAP),this._genMipmaps=!0),this._setTexInfo(),this._device._restoreTexture(0)},D.updateSubImage=function(L){var D=this._device._gl,P=(0,F.glTextureFmt)(this._format);D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_CUBE_MAP,this._glID),this._setSubImage(P,L),this._device._restoreTexture(0)},D.updateImage=function(L){var D=this._device._gl,P=(0,F.glTextureFmt)(this._format);D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_CUBE_MAP,this._glID),this._setImage(P,L),this._device._restoreTexture(0)},D._setSubImage=function(L,D){var P=this._device._gl,N=D.flipY,F=D.premultiplyAlpha,B=D.faceIndex,k=D.image;void 0===N?P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,!1):P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,N),void 0===F?P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F),!k||ArrayBuffer.isView(k)||k instanceof ArrayBuffer?this._compressed?P.compressedTexSubImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,D.level,D.x,D.y,D.width,D.height,L.format,k):P.texSubImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,D.level,D.x,D.y,D.width,D.height,L.format,L.pixelType,k):P.texSubImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,D.level,D.x,D.y,L.format,L.pixelType,k)},D._setImage=function(L,D){var P=this._device._gl,N=D.flipY,F=D.premultiplyAlpha,B=D.faceIndex,k=D.image;void 0===N?P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,!1):P.pixelStorei(P.UNPACK_FLIP_Y_WEBGL,N),void 0===F?P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1):P.pixelStorei(P.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F),!k||ArrayBuffer.isView(k)||k instanceof ArrayBuffer?this._compressed?P.compressedTexImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,D.level,L.internalFormat,D.width,D.height,0,k):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,D.level,L.internalFormat,D.width,D.height,0,L.format,L.pixelType,k):P.texImage2D(P.TEXTURE_CUBE_MAP_POSITIVE_X+B,D.level,L.internalFormat,L.format,L.pixelType,k)},D._setMipmap=function(L,D,P){for(var N=(0,F.glTextureFmt)(this._format),B={width:this._width,height:this._height,faceIndex:0,flipY:D,premultiplyAlpha:P,level:0,image:null},k=0;k<L.length;++k){var U=L[k];B.level=k,B.width=this._width>>k,B.height=this._height>>k;for(var V=0;V<6;++V)B.faceIndex=V,B.image=U[V],this._setImage(N,B)}},D._setTexInfo=function(){var L=this._device._gl,D=(0,B.isPow2)(this._width)&&(0,B.isPow2)(this._height);D||this._wrapS===F.enums.WRAP_CLAMP&&this._wrapT===F.enums.WRAP_CLAMP||(console.warn("WebGL1 doesn't support all wrap modes with NPOT textures"),this._wrapS=F.enums.WRAP_CLAMP,this._wrapT=F.enums.WRAP_CLAMP);var P=this._genMipmaps?this._mipFilter:-1;D||-1===P||(console.warn("NPOT textures do not support mipmap filter"),P=-1),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MIN_FILTER,(0,F.glFilter)(L,this._minFilter,P)),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_MAG_FILTER,(0,F.glFilter)(L,this._magFilter,-1)),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_S,this._wrapS),L.texParameteri(L.TEXTURE_CUBE_MAP,L.TEXTURE_WRAP_T,this._wrapT);var N=this._device.ext("EXT_texture_filter_anisotropic");N&&L.texParameteri(L.TEXTURE_CUBE_MAP,N.TEXTURE_MAX_ANISOTROPY_EXT,this._anisotropy)},e}(N.default);P.default=k,D.exports=P.default},{"./enums":249,"./misc":253,"./texture":259}],259:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("./enums"),F=0,B=function(){function t(L){this._device=L,this._width=4,this._height=4,this._genMipmaps=!1,this._compressed=!1,this._anisotropy=1,this._minFilter=N.enums.FILTER_LINEAR,this._magFilter=N.enums.FILTER_LINEAR,this._mipFilter=N.enums.FILTER_LINEAR,this._wrapS=N.enums.WRAP_REPEAT,this._wrapT=N.enums.WRAP_REPEAT,this._format=N.enums.TEXTURE_FMT_RGBA8,this._target=-1,this._id=F++}return t.prototype.destroy=function(){null!==this._glID?(this._device._gl.deleteTexture(this._glID),this._device._stats.tex-=this.bytes,this._glID=null):console.error("The texture already destroyed")},t}();P.default=B,D.exports=P.default},{"./enums":249}],260:[function(L,D,P){"use strict";function n(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}P.__esModule=!0,P.default=void 0,L("./enums");var N=function(){function t(L,D,P,N){this._device=L,this._format=D,this._usage=P,this._bytesPerVertex=this._format._bytes,this._bytes=N.byteLength,this._numVertices=this._bytes/this._bytesPerVertex,this._needExpandDataStore=!0,this._glID=L._gl.createBuffer(),this.update(0,N),L._stats.vb+=this._bytes}var L=t.prototype;return L.destroy=function(){-1!==this._glID?(this._device._gl.deleteBuffer(this._glID),this._device._stats.vb-=this.bytes,this._glID=-1):console.error("The buffer already destroyed")},L.update=function(L,D){if(-1!==this._glID){if(0!==D.byteLength){if(L+D.byteLength>this._bytes){if(L)return void console.error("Failed to update data, bytes exceed.");this._needExpandDataStore=!0,this._bytes=L+D.byteLength,this._numVertices=this._bytes/this._bytesPerVertex}var P=this._device._gl,N=this._usage;P.bindBuffer(P.ARRAY_BUFFER,this._glID),this._needExpandDataStore?(P.bufferData(P.ARRAY_BUFFER,D,N),this._needExpandDataStore=!1):P.bufferSubData(P.ARRAY_BUFFER,L,D),P.bindBuffer(P.ARRAY_BUFFER,null)}}else console.error("The buffer is destroyed")},L.getFormat=function(L){return this._format.element(L)},L.setUsage=function(L){this._usage=L},function(L,D,P){D&&n(L.prototype,D),P&&n(L,P)}(t,[{key:"count",get:function(){return this._numVertices}}]),t}();P.default=N,D.exports=P.default},{"./enums":249}],261:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("./enums"),F=function(L){return L&&L.__esModule?L:{default:L}}(L("../murmurhash2_gc")),B=function(){function t(L){this._attr2el={},this._elements=[],this._bytes=0;for(var D="",P=0,B=L.length;P<B;++P){var k=L[P],U={name:k.name,offset:this._bytes,stride:0,stream:-1,type:k.type,num:k.num,normalize:void 0!==k.normalize&&k.normalize,bytes:k.num*(0,N.attrTypeBytes)(k.type)};this._attr2el[U.name]=U,this._elements.push(U),this._bytes+=U.bytes,D+=U.name+":"+U.num+":"+U.type+":"+U.normalize}for(var V=0,z=this._elements.length;V<z;++V)this._elements[V].stride=this._bytes;this._hash=(0,F.default)(D,666)}var L=t.prototype;return L.element=function(L){return this._attr2el[L]},L.getHash=function(){return this._hash},t}();P.default=B,D.exports=P.default},{"../murmurhash2_gc":270,"./enums":249}],262:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(L,D){this._cursor=0,this._data=new Array(D);for(var P=0;P<D;++P)this._data[P]=L()}return t.prototype.request=function(){var L=this._data[this._cursor];return this._cursor=(this._cursor+1)%this._data.length,L},t}();P.default=N,D.exports=P.default},{}],263:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./timsort"));function r(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var F=function(){function t(L){this._count=0,this._data=new Array(L)}var L=t.prototype;return L._resize=function(L){if(L>this._data.length)for(var D=this._data.length;D<L;++D)this._data[D]=void 0},L.reset=function(){for(var L=0;L<this._count;++L)this._data[L]=void 0;this._count=0},L.push=function(L){this._count>=this._data.length&&this._resize(2*this._data.length),this._data[this._count]=L,++this._count},L.pop=function(){--this._count,this._count<0&&(this._count=0);var L=this._data[this._count];return this._data[this._count]=void 0,L},L.fastRemove=function(L){if(!(L>=this._count||L<0)){var D=this._count-1;this._data[L]=this._data[D],this._data[D]=void 0,this._count-=1}},L.indexOf=function(L){return this._data.indexOf(L)},L.sort=function(L){return(0,N.default)(this._data,0,this._count,L)},function(L,D,P){D&&r(L.prototype,D),P&&r(L,P)}(t,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),t}();P.default=F,D.exports=P.default},{"./timsort":268}],264:[function(L,D,P){"use strict";P.__esModule=!0,P.TypedArrayPool=P.RecyclePool=P.Pool=P.LinkedArray=P.FixedArray=P.CircularPool=void 0;var N=l(L("./circular-pool"));P.CircularPool=N.default;var F=l(L("./fixed-array"));P.FixedArray=F.default;var B=l(L("./linked-array"));P.LinkedArray=B.default;var k=l(L("./pool"));P.Pool=k.default;var U=l(L("./recycle-pool"));P.RecyclePool=U.default;var V=l(L("./typed-array-pool"));function l(L){return L&&L.__esModule?L:{default:L}}P.TypedArrayPool=V.default},{"./circular-pool":262,"./fixed-array":263,"./linked-array":265,"./pool":266,"./recycle-pool":267,"./typed-array-pool":269}],265:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./pool"));function r(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var F=function(){function t(L,D){this._fn=L,this._count=0,this._head=null,this._tail=null,this._pool=new N.default(L,D)}var L=t.prototype;return L.add=function(){var L=this._pool.alloc();return this._tail?(this._tail._next=L,L._prev=this._tail):this._head=L,this._tail=L,this._count+=1,L},L.remove=function(L){L._prev?L._prev._next=L._next:this._head=L._next,L._next?L._next._prev=L._prev:this._tail=L._prev,L._next=null,L._prev=null,this._pool.free(L),this._count-=1},L.forEach=function(L,D){var P=this._head;if(P){D&&(L=L.bind(D));for(var N=0,F=P;P;)F=P._next,L(P,N,this),P=F,++N}},function(L,D,P){D&&r(L.prototype,D),P&&r(L,P)}(t,[{key:"head",get:function(){return this._head}},{key:"tail",get:function(){return this._tail}},{key:"length",get:function(){return this._count}}]),t}();P.default=F,D.exports=P.default},{"./pool":266}],266:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(L,D){this._fn=L,this._idx=D-1,this._frees=new Array(D);for(var P=0;P<D;++P)this._frees[P]=L()}var L=t.prototype;return L._expand=function(L){var D=this._frees;this._frees=new Array(L);for(var P=L-D.length,N=0;N<P;++N)this._frees[N]=this._fn();for(var F=P,B=0;F<L;++F,++B)this._frees[F]=D[B];this._idx+=P},L.alloc=function(){this._idx<0&&this._expand(Math.round(1.2*this._frees.length)+1);var L=this._frees[this._idx];return this._frees[this._idx]=null,--this._idx,L},L.free=function(L){++this._idx,this._frees[this._idx]=L},L.clear=function(L){for(var D=0;D<=this._idx;D++)L&&L(this._frees[D]);this._frees.length=0,this._idx=-1},t}();P.default=N,D.exports=P.default},{}],267:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("./timsort"));function r(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var F=function(){function t(L,D){this._fn=L,this._count=0,this._data=new Array(D);for(var P=0;P<D;++P)this._data[P]=L()}var L=t.prototype;return L.reset=function(){this._count=0},L.resize=function(L){if(L>this._data.length)for(var D=this._data.length;D<L;++D)this._data[D]=this._fn()},L.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},L.remove=function(L){if(!(L>=this._count)){var D=this._count-1,P=this._data[L];this._data[L]=this._data[D],this._data[D]=P,this._count-=1}},L.sort=function(L){return(0,N.default)(this._data,0,this._count,L)},function(L,D,P){D&&r(L.prototype,D),P&&r(L,P)}(t,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),t}();P.default=F,cc.RecyclePool=F,D.exports=P.default},{"./timsort":268}],268:[function(L,D,P){"use strict";P.__esModule=!0,P.default=function(L,D,P,F){if(!Array.isArray(L))throw new TypeError("Can only sort arrays");void 0===D&&(D=0),void 0===P&&(P=L.length),void 0===F&&(F=c);var k=P-D;if(!(k<2)){var U=0;if(k<N)return void d(L,D,P,D+(U=h(L,D,P,F)),F);var V=new B(L,F),z=function(L){for(var D=0;L>=N;)D|=1&L,L>>=1;return L+D}(k);do{if((U=h(L,D,P,F))<z){var W=k;W>z&&(W=z),d(L,D,D+W,D+U,F),U=W}V.pushRun(D,U),V.mergeRuns(),k-=U,D+=U}while(0!==k);V.forceMergeRuns()}};var N=32,F=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function o(L){return L<1e5?L<100?L<10?0:1:L<1e4?L<1e3?2:3:4:L<1e7?L<1e6?5:6:L<1e9?L<1e8?7:8:9}function c(L,D){if(L===D)return 0;if(~~L===L&&~~D===D){if(0===L||0===D)return L<D?-1:1;if(L<0||D<0){if(D>=0)return-1;if(L>=0)return 1;L=-L,D=-D}var P=o(L),N=o(D),B=0;return P<N?(L*=F[N-P-1],D/=10,B=-1):P>N&&(D*=F[P-N-1],L/=10,B=1),L===D?B:L<D?-1:1}var k=String(L),U=String(D);return k===U?0:k<U?-1:1}function h(L,D,P,N){var F=D+1;if(F===P)return 1;if(N(L[F++],L[D])<0){for(;F<P&&N(L[F],L[F-1])<0;)F++;!function(L,D,P){for(P--;D<P;){var N=L[D];L[D++]=L[P],L[P--]=N}}(L,D,F)}else for(;F<P&&N(L[F],L[F-1])>=0;)F++;return F-D}function d(L,D,P,N,F){for(N===D&&N++;N<P;N++){for(var B=L[N],k=D,U=N;k<U;){var V=k+U>>>1;F(B,L[V])<0?U=V:k=V+1}var z=N-k;switch(z){case 3:L[k+3]=L[k+2];case 2:L[k+2]=L[k+1];case 1:L[k+1]=L[k];break;default:for(;z>0;)L[k+z]=L[k+z-1],z--}L[k]=B}}function f(L,D,P,N,F,B){var k=0,U=0,V=1;if(B(L,D[P+F])>0){for(U=N-F;V<U&&B(L,D[P+F+V])>0;)k=V,(V=1+(V<<1))<=0&&(V=U);V>U&&(V=U),k+=F,V+=F}else{for(U=F+1;V<U&&B(L,D[P+F-V])<=0;)k=V,(V=1+(V<<1))<=0&&(V=U);V>U&&(V=U);var z=k;k=F-V,V=F-z}for(k++;k<V;){var W=k+(V-k>>>1);B(L,D[P+W])>0?k=W+1:V=W}return V}function _(L,D,P,N,F,B){var k=0,U=0,V=1;if(B(L,D[P+F])<0){for(U=F+1;V<U&&B(L,D[P+F-V])<0;)k=V,(V=1+(V<<1))<=0&&(V=U);V>U&&(V=U);var z=k;k=F-V,V=F-z}else{for(U=N-F;V<U&&B(L,D[P+F+V])>=0;)k=V,(V=1+(V<<1))<=0&&(V=U);V>U&&(V=U),k+=F,V+=F}for(k++;k<V;){var W=k+(V-k>>>1);B(L,D[P+W])<0?V=W:k=W+1}return V}var B=function(){function t(L,D){this.array=L,this.compare=D,this.minGallop=7,this.length=L.length,this.tmpStorageLength=256,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength),this.stackSize=0}var L=t.prototype;return L.pushRun=function(L,D){this.runStart[this.stackSize]=L,this.runLength[this.stackSize]=D,this.stackSize+=1},L.mergeRuns=function(){for(;this.stackSize>1;){var L=this.stackSize-2;if(L>=1&&this.runLength[L-1]<=this.runLength[L]+this.runLength[L+1]||L>=2&&this.runLength[L-2]<=this.runLength[L]+this.runLength[L-1])this.runLength[L-1]<this.runLength[L+1]&&L--;else if(this.runLength[L]>this.runLength[L+1])break;this.mergeAt(L)}},L.forceMergeRuns=function(){for(;this.stackSize>1;){var L=this.stackSize-2;L>0&&this.runLength[L-1]<this.runLength[L+1]&&L--,this.mergeAt(L)}},L.mergeAt=function(L){var D=this.compare,P=this.array,N=this.runStart[L],F=this.runLength[L],B=this.runStart[L+1],k=this.runLength[L+1];this.runLength[L]=F+k,L===this.stackSize-3&&(this.runStart[L+1]=this.runStart[L+2],this.runLength[L+1]=this.runLength[L+2]),this.stackSize--;var U=_(P[B],P,N,F,0,D);N+=U,0!=(F-=U)&&0!==(k=f(P[N+F-1],P,B,k,k-1,D))&&(F<=k?this.mergeLow(N,F,B,k):this.mergeHigh(N,F,B,k))},L.mergeLow=function(L,D,P,N){var F=this.compare,B=this.array,k=this.tmp,U=0;for(U=0;U<D;U++)k[U]=B[L+U];var V=0,z=P,W=L;if(B[W++]=B[z++],0!=--N)if(1!==D){for(var H=this.minGallop;;){var G=0,X=0,nt=!1;do{if(F(B[z],k[V])<0){if(B[W++]=B[z++],X++,G=0,0==--N){nt=!0;break}}else if(B[W++]=k[V++],G++,X=0,1==--D){nt=!0;break}}while((G|X)<H);if(nt)break;do{if(0!==(G=_(B[z],k,V,D,0,F))){for(U=0;U<G;U++)B[W+U]=k[V+U];if(W+=G,V+=G,(D-=G)<=1){nt=!0;break}}if(B[W++]=B[z++],0==--N){nt=!0;break}if(0!==(X=f(k[V],B,z,N,0,F))){for(U=0;U<X;U++)B[W+U]=B[z+U];if(W+=X,z+=X,0==(N-=X)){nt=!0;break}}if(B[W++]=k[V++],1==--D){nt=!0;break}H--}while(G>=7||X>=7);if(nt)break;H<0&&(H=0),H+=2}if(this.minGallop=H,H<1&&(this.minGallop=1),1===D){for(U=0;U<N;U++)B[W+U]=B[z+U];B[W+N]=k[V]}else{if(0===D)throw new Error("mergeLow preconditions were not respected");for(U=0;U<D;U++)B[W+U]=k[V+U]}}else{for(U=0;U<N;U++)B[W+U]=B[z+U];B[W+N]=k[V]}else for(U=0;U<D;U++)B[W+U]=k[V+U]},L.mergeHigh=function(L,D,P,N){var F=this.compare,B=this.array,k=this.tmp,U=0;for(U=0;U<N;U++)k[U]=B[P+U];var V=L+D-1,z=N-1,W=P+N-1,H=0,G=0;if(B[W--]=B[V--],0!=--D)if(1!==N){for(var X=this.minGallop;;){var nt=0,ut=0,dt=!1;do{if(F(k[z],B[V])<0){if(B[W--]=B[V--],nt++,ut=0,0==--D){dt=!0;break}}else if(B[W--]=k[z--],ut++,nt=0,1==--N){dt=!0;break}}while((nt|ut)<X);if(dt)break;do{if(0!=(nt=D-_(k[z],B,L,D,D-1,F))){for(D-=nt,G=1+(W-=nt),H=1+(V-=nt),U=nt-1;U>=0;U--)B[G+U]=B[H+U];if(0===D){dt=!0;break}}if(B[W--]=k[z--],1==--N){dt=!0;break}if(0!=(ut=N-f(B[V],k,0,N,N-1,F))){for(N-=ut,G=1+(W-=ut),H=1+(z-=ut),U=0;U<ut;U++)B[G+U]=k[H+U];if(N<=1){dt=!0;break}}if(B[W--]=B[V--],0==--D){dt=!0;break}X--}while(nt>=7||ut>=7);if(dt)break;X<0&&(X=0),X+=2}if(this.minGallop=X,X<1&&(this.minGallop=1),1===N){for(G=1+(W-=D),H=1+(V-=D),U=D-1;U>=0;U--)B[G+U]=B[H+U];B[W]=k[z]}else{if(0===N)throw new Error("mergeHigh preconditions were not respected");for(H=W-(N-1),U=0;U<N;U++)B[H+U]=k[U]}}else{for(G=1+(W-=D),H=1+(V-=D),U=D-1;U>=0;U--)B[G+U]=B[H+U];B[W]=k[z]}else for(H=W-(N-1),U=0;U<N;U++)B[H+U]=k[U]},t}();D.exports=P.default},{}],269:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;for(var N=Array(8),F=0;F<8;++F)N[F]=[];function a(L){var D,P;return D=(L>65535)<<4,D|=P=((L>>>=D)>255)<<3,D|=P=((L>>>=P)>15)<<2,(D|=P=((L>>>=P)>3)<<1)|(L>>>=P)>>1}function o(L){var D=function(L){for(var D=16;D<=1<<28;D*=16)if(L<=D)return D;return 0}(L),P=N[a(D)>>2];return P.length>0?P.pop():new ArrayBuffer(D)}var B={alloc_int8:function(L){var D=new Int8Array(o(L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_uint8:function(L){var D=new Uint8Array(o(L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_int16:function(L){var D=new Int16Array(o(2*L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_uint16:function(L){var D=new Uint16Array(o(2*L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_int32:function(L){var D=new Int32Array(o(4*L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_uint32:function(L){var D=new Uint32Array(o(4*L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_float32:function(L){var D=new Float32Array(o(4*L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_float64:function(L){var D=new Float64Array(o(8*L),0,L);return D.length!==L?D.subarray(0,L):D},alloc_dataview:function(L){var D=new DataView(o(L),0,L);return D.length!==L?D.subarray(0,L):D},free:function(L){!function(L){N[a(L.byteLength)>>2].push(L)}(L.buffer)},reset:function(){for(var L=Array(8),D=0;D<8;++D)L[D]=[]}};P.default=B,D.exports=P.default},{}],270:[function(L,D,P){"use strict";P.__esModule=!0,P.default=function(L,D){for(var P,N=L.length,F=D^N,B=0;N>=4;)P=1540483477*(65535&(P=255&L.charCodeAt(B)|(255&L.charCodeAt(++B))<<8|(255&L.charCodeAt(++B))<<16|(255&L.charCodeAt(++B))<<24))+((1540483477*(P>>>16)&65535)<<16),F=1540483477*(65535&F)+((1540483477*(F>>>16)&65535)<<16)^(P=1540483477*(65535&(P^=P>>>24))+((1540483477*(P>>>16)&65535)<<16)),N-=4,++B;switch(N){case 3:F^=(255&L.charCodeAt(B+2))<<16;case 2:F^=(255&L.charCodeAt(B+1))<<8;case 1:F=1540483477*(65535&(F^=255&L.charCodeAt(B)))+((1540483477*(F>>>16)&65535)<<16)}return F=1540483477*(65535&(F^=F>>>13))+((1540483477*(F>>>16)&65535)<<16),(F^=F>>>15)>>>0},D.exports=P.default},{}],271:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../../core/value-types"),F=o(L("../core/base-renderer")),B=o(L("../enums")),k=L("../memop");function o(L){return L&&L.__esModule?L:{default:L}}function c(L){if(void 0===L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L}var U=new Float32Array(16),V=new Float32Array(16),z=new Float32Array(16),W=new Float32Array(16),H=new Float32Array(4),G=new Float32Array(64),X=[],nt=new Float32Array(4),ut=new N.Vec4(0,0,0,0),dt=new N.Vec3(0,0,0),ft=new N.Vec3(0,0,0),_t=new k.RecyclePool((function(){return new Float32Array(16)}),8),pt=function(L){function e(D,P){var N;return(N=L.call(this,D,P)||this)._time=new Float32Array(4),N._directionalLights=[],N._pointLights=[],N._spotLights=[],N._shadowLights=[],N._ambientLights=[],N._numLights=0,N._defines={},N._registerStage("shadowcast",N._shadowStage.bind(c(N))),N._registerStage("opaque",N._opaqueStage.bind(c(N))),N._registerStage("transparent",N._transparentStage.bind(c(N))),N}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.reset=function(){_t.reset(),L.prototype.reset.call(this)},D.render=function(L,D){this.reset(),this._time[0]+=D,this._device.setUniform("cc_time",this._time),this._updateLights(L);for(var P=this._device._gl.canvas,N=0;N<L._cameras.length;++N){var F=this._requestView(),B=P.width,k=P.height;L._cameras.data[N].extractView(F,B,k)}this._viewPools.sort((function(L,D){return L._priority-D._priority}));for(var U=0;U<this._viewPools.length;++U){var V=this._viewPools.data[U];this._render(V,L)}},D.renderCamera=function(L,D){this.reset();var P=this._device._gl.canvas,N=P.width,F=P.height,B=this._requestView();L.extractView(B,N,F),this._render(B,D)},D._updateLights=function(L){this._directionalLights.length=0,this._pointLights.length=0,this._spotLights.length=0,this._shadowLights.length=0,this._ambientLights.length=0;for(var D=L._lights,P=0;P<D.length;++P){var N=D.data[P];if(N.update(this._device),N.shadowType!==B.default.SHADOW_NONE){this._shadowLights.length<2&&this._shadowLights.push(N);var F=this._requestView();N.extractView(F,["shadowcast"])}N._type===B.default.LIGHT_DIRECTIONAL?this._directionalLights.push(N):N._type===B.default.LIGHT_POINT?this._pointLights.push(N):N._type===B.default.LIGHT_SPOT?this._spotLights.push(N):this._ambientLights.push(N)}this._updateDefines(),this._numLights=D._count},D._updateDefines=function(){var L=this._defines;L.CC_NUM_DIR_LIGHTS=Math.min(4,this._directionalLights.length),L.CC_NUM_POINT_LIGHTS=Math.min(4,this._pointLights.length),L.CC_NUM_SPOT_LIGHTS=Math.min(4,this._spotLights.length),L.CC_NUM_AMBIENT_LIGHTS=Math.min(4,this._ambientLights.length),L.CC_NUM_SHADOW_LIGHTS=Math.min(4,this._shadowLights.length)},D._submitLightsUniforms=function(){var L=this._device;if(this._directionalLights.length>0){for(var D=_t.add(),P=_t.add(),N=Math.min(4,this._directionalLights.length),F=0;F<N;++F){var B=this._directionalLights[F],k=4*F;D.set(B._directionUniform,k),P.set(B._colorUniform,k)}L.setUniform("cc_dirLightDirection",D),L.setUniform("cc_dirLightColor",P)}if(this._pointLights.length>0){for(var U=_t.add(),V=_t.add(),z=Math.min(4,this._pointLights.length),W=0;W<z;++W){var H=this._pointLights[W],G=4*W;U.set(H._positionUniform,G),U[G+3]=H._range,V.set(H._colorUniform,G)}L.setUniform("cc_pointLightPositionAndRange",U),L.setUniform("cc_pointLightColor",V)}if(this._spotLights.length>0){for(var X=_t.add(),nt=_t.add(),ut=_t.add(),dt=Math.min(4,this._spotLights.length),ft=0;ft<dt;++ft){var pt=this._spotLights[ft],vt=4*ft;X.set(pt._positionUniform,vt),X[vt+3]=pt._range,nt.set(pt._directionUniform,vt),nt[vt+3]=pt._spotUniform[0],ut.set(pt._colorUniform,vt),ut[vt+3]=pt._spotUniform[1]}L.setUniform("cc_spotLightPositionAndRange",X),L.setUniform("cc_spotLightDirection",nt),L.setUniform("cc_spotLightColor",ut)}if(this._ambientLights.length>0){for(var gt=_t.add(),mt=Math.min(4,this._ambientLights.length),yt=0;yt<mt;++yt){var Tt=this._ambientLights[yt],xt=4*yt;gt.set(Tt._colorUniform,xt)}L.setUniform("cc_ambientColor",gt)}},D._submitShadowStageUniforms=function(L){var D=L._shadowLight,P=nt;P[0]=D.shadowMinDepth,P[1]=D.shadowMaxDepth,P[2]=D.shadowDepthScale,P[3]=D.shadowDarkness,this._device.setUniform("cc_shadow_map_lightViewProjMatrix",N.Mat4.toArray(W,L._matViewProj)),this._device.setUniform("cc_shadow_map_info",P),this._device.setUniform("cc_shadow_map_bias",D.shadowBias)},D._submitOtherStagesUniforms=function(){for(var L=_t.add(),D=0;D<this._shadowLights.length;++D){var P=this._shadowLights[D],F=X[D];F||(F=X[D]=new Float32Array(G.buffer,64*D,16)),N.Mat4.toArray(F,P.viewProjMatrix);var B=4*D;L[B]=P.shadowMinDepth,L[B+1]=P.shadowMaxDepth,L[B+2]=P.shadowDepthScale,L[B+3]=P.shadowDarkness}this._device.setUniform("cc_shadow_lightViewProjMatrix",G),this._device.setUniform("cc_shadow_info",L)},D._sortItems=function(L){L.sort((function(L,D){return L.passes.length!==D.passes.length?L.passes.length-D.passes.length:L.sortKey-D.sortKey}))},D._shadowStage=function(L,D){this._submitShadowStageUniforms(L);for(var P=0;P<D.length;++P){var N=D.data[P];N.effect.getDefine("CC_CASTING_SHADOW")&&this._draw(N)}},D._drawItems=function(L,D){var P=this._shadowLights;if(0===P.length&&0===this._numLights)for(var N=0;N<D.length;++N){var F=D.data[N];this._draw(F)}else for(var B=0;B<D.length;++B){for(var k=D.data[B],U=0;U<P.length;++U)this._device.setTexture("cc_shadow_map_"+U,P[U].shadowMap,this._allocTextureUnit());this._draw(k)}},D._opaqueStage=function(L,D){L.getPosition(ut),this._device.setUniform("cc_matView",N.Mat4.toArray(U,L._matView)),this._device.setUniform("cc_matViewInv",N.Mat4.toArray(V,L._matViewInv)),this._device.setUniform("cc_matpProj",N.Mat4.toArray(z,L._matProj)),this._device.setUniform("cc_matViewProj",N.Mat4.toArray(W,L._matViewProj)),this._device.setUniform("cc_cameraPos",N.Vec4.toArray(H,ut)),this._submitLightsUniforms(),this._submitOtherStagesUniforms(),this._drawItems(L,D)},D._transparentStage=function(L,D){L.getPosition(ut),L.getForward(dt),this._device.setUniform("cc_matView",N.Mat4.toArray(U,L._matView)),this._device.setUniform("cc_matViewInv",N.Mat4.toArray(V,L._matViewInv)),this._device.setUniform("cc_matpProj",N.Mat4.toArray(z,L._matProj)),this._device.setUniform("cc_matViewProj",N.Mat4.toArray(W,L._matViewProj)),this._device.setUniform("cc_cameraPos",N.Vec4.toArray(H,ut)),this._submitLightsUniforms(),this._submitOtherStagesUniforms();for(var P=0;P<D.length;++P){var F=D.data[P];F.node.getWorldPosition(ft),N.Vec3.sub(ft,ft,ut),F.sortKey=-N.Vec3.dot(ft,dt)}this._sortItems(D),this._drawItems(L,D)},e}(F.default);P.default=pt,D.exports=P.default},{"../../core/value-types":225,"../core/base-renderer":241,"../enums":247,"../memop":264}],272:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../../core/value-types"),F=L("../../core/geom-utils"),B=function(L){return L&&L.__esModule?L:{default:L}}(L("../enums"));function a(L,D){for(var P=0;P<D.length;P++){var N=D[P];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(L,N.key,N)}}var k=new N.Mat4,U=new N.Mat4,V=new N.Mat4,z=new N.Mat4,W=new N.Mat4,H=new N.Mat4,G=new N.Vec3,X=new N.Vec3,nt=function(){function t(){this._poolID=-1,this._node=null,this._projection=B.default.PROJ_PERSPECTIVE,this._priority=0,this._color=new N.Vec4(.2,.3,.47,1),this._depth=1,this._stencil=0,this._clearFlags=B.default.CLEAR_COLOR|B.default.CLEAR_DEPTH,this._clearModel=null,this._stages=[],this._framebuffer=null,this._near=.01,this._far=1e3,this._fov=Math.PI/4,this._rect={x:0,y:0,w:1,h:1},this._orthoHeight=10,this._cullingMask=4294967295}var L=t.prototype;return L.setCullingMask=function(L){this._cullingMask=L},L.getNode=function(){return this._node},L.setNode=function(L){this._node=L},L.getType=function(){return this._projection},L.setType=function(L){this._projection=L},L.getPriority=function(){return this._priority},L.setPriority=function(L){this._priority=L},L.getOrthoHeight=function(){return this._orthoHeight},L.setOrthoHeight=function(L){this._orthoHeight=L},L.getFov=function(){return this._fov},L.setFov=function(L){this._fov=L},L.getNear=function(){return this._near},L.setNear=function(L){this._near=L},L.getFar=function(){return this._far},L.setFar=function(L){this._far=L},L.getColor=function(L){return N.Vec4.copy(L,this._color)},L.setColor=function(L,D,P,F){N.Vec4.set(this._color,L,D,P,F)},L.getDepth=function(){return this._depth},L.setDepth=function(L){this._depth=L},L.getStencil=function(){return this._stencil},L.setStencil=function(L){this._stencil=L},L.getClearFlags=function(){return this._clearFlags},L.setClearFlags=function(L){this._clearFlags=L},L.getRect=function(L){return L.x=this._rect.x,L.y=this._rect.y,L.w=this._rect.w,L.h=this._rect.h,L},L.setRect=function(L,D,P,N){this._rect.x=L,this._rect.y=D,this._rect.w=P,this._rect.h=N},L.getStages=function(){return this._stages},L.setStages=function(L){this._stages=L},L.getFramebuffer=function(){return this._framebuffer},L.setFrameBuffer=function(L){this._framebuffer=L},L._calcMatrices=function(L,D){this._node.getWorldRT(V),N.Mat4.invert(U,V);var P=L/D;if(this._projection===B.default.PROJ_PERSPECTIVE)N.Mat4.perspective(z,this._fov,P,this._near,this._far);else{var F=this._orthoHeight*P,k=this._orthoHeight;N.Mat4.ortho(z,-F,F,-k,k,this._near,this._far)}N.Mat4.mul(W,z,U),N.Mat4.invert(H,W)},L.extractView=function(L,D,P){this._framebuffer&&(D=this._framebuffer._width,P=this._framebuffer._height),L._priority=this._priority,L._rect.x=this._rect.x*D,L._rect.y=this._rect.y*P,L._rect.w=this._rect.w*D,L._rect.h=this._rect.h*P,this.getColor(L._color),L._depth=this._depth,L._stencil=this._stencil,L._clearFlags=this._clearFlags,L._clearModel=this._clearModel,L._stages=this._stages,L._framebuffer=this._framebuffer,this._calcMatrices(D,P),N.Mat4.copy(L._matView,U),N.Mat4.copy(L._matViewInv,V),N.Mat4.copy(L._matProj,z),N.Mat4.copy(L._matViewProj,W),N.Mat4.copy(L._matInvViewProj,H),L._cullingMask=this._cullingMask},L.screenPointToRay=function(L,D,P,k,U){if(!cc.geomUtils)return U;U=U||new F.Ray,this._calcMatrices(P,k);var V=this._rect.x*P,z=this._rect.y*k,W=this._rect.w*P,nt=this._rect.h*k;return N.Vec3.set(X,(L-V)/W*2-1,(D-z)/nt*2-1,1),N.Vec3.transformMat4(X,X,H),this._projection===B.default.PROJ_PERSPECTIVE?this._node.getWorldPosition(G):(N.Vec3.set(G,(L-V)/W*2-1,(D-z)/nt*2-1,-1),N.Vec3.transformMat4(G,G,H)),F.Ray.fromPoints(U,G,X)},L.screenToWorld=function(L,D,P,F){this._calcMatrices(P,F);var k=this._rect.x*P,U=this._rect.y*F,V=this._rect.w*P,z=this._rect.h*F;return this._projection===B.default.PROJ_PERSPECTIVE?(N.Vec3.set(L,(D.x-k)/V*2-1,(D.y-U)/z*2-1,.9999),N.Vec3.transformMat4(L,L,H),this._node.getWorldPosition(G),N.Vec3.lerp(L,G,L,(0,N.lerp)(this._near/this._far,1,D.z))):(N.Vec3.set(L,(D.x-k)/V*2-1,(D.y-U)/z*2-1,2*D.z-1),N.Vec3.transformMat4(L,L,H)),L},L.worldToScreen=function(L,D,P,F){this._calcMatrices(P,F);var B=this._rect.x*P,k=this._rect.y*F,U=this._rect.w*P,V=this._rect.h*F;return N.Vec3.transformMat4(L,D,W),L.x=B+.5*(L.x+1)*U,L.y=k+.5*(L.y+1)*V,L.z=.5*L.z+.5,L},L.worldMatrixToScreen=function(L,D,P,F){this._calcMatrices(P,F),N.Mat4.mul(L,W,D);var B=P/2,U=F/2;return N.Mat4.identity(k),N.Mat4.transform(k,k,N.Vec3.set(G,B,U,0)),N.Mat4.scale(k,k,N.Vec3.set(G,B,U,1)),N.Mat4.mul(L,k,L),L},function(L,D,P){D&&a(L.prototype,D),P&&a(L,P)}(t,[{key:"cullingMask",get:function(){return this._cullingMask},set:function(L){this._cullingMask=L}}]),t}();P.default=nt,D.exports=P.default},{"../../core/geom-utils":void 0,"../../core/value-types":225,"../enums":247}],273:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(){function t(){this._type="default",this._poolID=-1,this._node=null,this._inputAssembler=null,this._effect=null,this._viewID=-1,this._cameraID=-1,this._userKey=-1,this._castShadow=!1,this._boundingShape=null}var L=t.prototype;return L.setNode=function(L){this._node=L},L.setInputAssembler=function(L){this._inputAssembler=L},L.setEffect=function(L){this._effect=L},L.setUserKey=function(L){this._userKey=L},L.extractDrawItem=function(L){L.model=this,L.node=this._node,L.ia=this._inputAssembler,L.effect=this._effect},t}();P.default=N,D.exports=P.default},{}],274:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=L("../memop"),F=function(){function t(L){this._lights=new N.FixedArray(16),this._models=new N.FixedArray(16),this._cameras=new N.FixedArray(16),this._debugCamera=null,this._app=L,this._views=[]}var L=t.prototype;return L._add=function(L,D){-1===D._poolID&&(L.push(D),D._poolID=L.length-1)},L._remove=function(L,D){-1!==D._poolID&&(L.data[L.length-1]._poolID=D._poolID,L.fastRemove(D._poolID),D._poolID=-1)},L.reset=function(){for(var L=0;L<this._models.length;++L)this._models.data[L]._viewID=-1},L.setDebugCamera=function(L){this._debugCamera=L},L.getCameraCount=function(){return this._cameras.length},L.getCamera=function(L){return this._cameras.data[L]},L.addCamera=function(L){this._add(this._cameras,L)},L.removeCamera=function(L){this._remove(this._cameras,L)},L.getModelCount=function(){return this._models.length},L.getModel=function(L){return this._models.data[L]},L.addModel=function(L){this._add(this._models,L)},L.removeModel=function(L){this._remove(this._models,L)},L.getLightCount=function(){return this._lights.length},L.getLight=function(L){return this._lights.data[L]},L.addLight=function(L){this._add(this._lights,L)},L.removeLight=function(L){this._remove(this._lights,L)},L.addView=function(L){-1===this._views.indexOf(L)&&this._views.push(L)},L.removeView=function(L){var D=this._views.indexOf(L);-1!==D&&this._views.splice(D,1)},t}();P.default=F,D.exports=P.default},{"../memop":264}],275:[function(L,D,P){"use strict";P.__esModule=!0,P.getInspectorProps=function(L){var D={type:L.type};Object.assign(D,L.editor||L.inspector),D.defines=L.defines,D.value=m(D.type)(L.value);var P=y(D.type);return D.typeName=dt[P]||P,D.valueCtor=X[D.type],"cc.Texture2D"==D.typeName&&(D.typeName="cc.Asset",D.assetType="cc.Texture2D"),D},P.getClassName=P.getInstanceCtor=P.getInstanceType=P.enums2default=P.ctor2enums=void 0;var N,F,B,k,U=h(L("./enums")),V=L("../core/value-types"),z=h(L("../core/assets/CCTexture2D"));function h(L){return L&&L.__esModule?L:{default:L}}var W;W=L("./gfx/texture-2d");var H=cc.Object,G=((N={})[Boolean]=function(L){return L||!1},N[Number]=function(L){return L?ArrayBuffer.isView(L)?L[0]:L:0},N[V.Vec2]=function(L){return L?cc.v2(L[0],L[1]):cc.v2()},N[V.Vec3]=function(L){return L?cc.v3(L[0],L[1],L[2]):cc.v3()},N[V.Vec4]=function(L){return L?cc.v4(L[0],L[1],L[2],L[3]):cc.v4()},N[V.Color]=function(L){return L?cc.color(255*L[0],255*L[1],255*L[2],255*(L[3]||1)):cc.color()},N[V.Mat4]=function(L){return L?cc.mat4(L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15]):cc.mat4()},N[z.default]=function(){return null},N[H]=function(){return null},N),X=((F={})[U.default.PARAM_INT]=Number,F[U.default.PARAM_INT2]=V.Vec2,F[U.default.PARAM_INT3]=V.Vec3,F[U.default.PARAM_INT4]=V.Vec4,F[U.default.PARAM_FLOAT]=Number,F[U.default.PARAM_FLOAT2]=V.Vec2,F[U.default.PARAM_FLOAT3]=V.Vec3,F[U.default.PARAM_FLOAT4]=V.Vec4,F[U.default.PARAM_MAT4]=V.Mat4,F[U.default.PARAM_TEXTURE_2D]=z.default,F.color=V.Color,F.number=Number,F.boolean=Boolean,F.default=H,F),nt=((B={})[Number]=U.default.PARAM_FLOAT,B[V.Vec2]=U.default.PARAM_FLOAT2,B[V.Vec3]=U.default.PARAM_FLOAT3,B[V.Vec4]=U.default.PARAM_FLOAT4,B[V.Color]=U.default.PARAM_COLOR3,B[V.Color]=U.default.PARAM_COLOR4,B[V.Mat4]=U.default.PARAM_MAT4,B[z.default]=U.default.PARAM_TEXTURE_2D,B[W]=U.default.PARAM_TEXTURE_2D,B);P.ctor2enums=nt;var ut=((k={})[U.default.PARAM_INT]=new Uint32Array([0]),k[U.default.PARAM_INT2]=new Uint32Array([0,0]),k[U.default.PARAM_INT3]=new Uint32Array([0,0,0]),k[U.default.PARAM_INT4]=new Uint32Array([0,0,0,0]),k[U.default.PARAM_FLOAT]=new Float32Array([0]),k[U.default.PARAM_FLOAT2]=new Float32Array([0,0]),k[U.default.PARAM_FLOAT3]=new Float32Array([0,0,0]),k[U.default.PARAM_FLOAT4]=new Float32Array([0,0,0,0]),k[U.default.PARAM_MAT4]=cc.mat4().m,k[U.default.PARAM_TEXTURE_2D]=null,k.number=0,k.boolean=!1,k);P.enums2default=ut;var g=function(L){return X[L]||X.default};P.getInstanceType=g;var m=function(L){return G[g(L)]};P.getInstanceCtor=m;var y=function(L){return cc.js.getClassName(g(L))};P.getClassName=y;var dt={Number:"number",Boolean:"boolean"}},{"../core/assets/CCTexture2D":45,"../core/value-types":225,"./enums":247,"./gfx/texture-2d":257}],276:[function(L,D,P){"use strict";var N=cc.Class({name:"cc.TiledMapAsset",extends:cc.Asset,properties:{tmxXmlStr:"",textures:{default:[],type:[cc.Texture2D]},textureNames:[cc.String],textureSizes:{default:[],type:[cc.Size]},imageLayerTextures:{default:[],type:[cc.Texture2D]},imageLayerTextureNames:[cc.String],tsxFiles:[cc.TextAsset],tsxFileNames:[cc.String]},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=N,D.exports=N},{}],277:[function(L,D,P){"use strict";L("./cocos2d/core"),L("./cocos2d/animation"),L("./cocos2d/particle"),L("./cocos2d/tilemap"),L("./cocos2d/videoplayer/CCVideoPlayer"),L("./cocos2d/webview/CCWebView"),L("./cocos2d/core/components/CCStudioComponent"),L("./extensions/ccpool/CCNodePool"),L("./cocos2d/actions"),L("./extensions/spine"),L("./extensions/dragonbones"),L("./cocos2d/deprecated")},{"./cocos2d/actions":7,"./cocos2d/animation":16,"./cocos2d/core":114,"./cocos2d/core/components/CCStudioComponent":87,"./cocos2d/deprecated":237,"./cocos2d/particle":void 0,"./cocos2d/particle/CCParticleAsset":239,"./cocos2d/tilemap":void 0,"./cocos2d/tilemap/CCTiledMapAsset":276,"./cocos2d/videoplayer/CCVideoPlayer":void 0,"./cocos2d/webview/CCWebView":void 0,"./extensions/ccpool/CCNodePool":278,"./extensions/dragonbones":void 0,"./extensions/spine":281}],278:[function(L,D,P){"use strict";cc.NodePool=function(L){this.poolHandlerComp=L,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var L=this._pool.length,D=0;D<L;++D)this._pool[D].destroy();this._pool.length=0},put:function(L){if(L&&-1===this._pool.indexOf(L)){L.removeFromParent(!1);var D=this.poolHandlerComp?L.getComponent(this.poolHandlerComp):null;D&&D.unuse&&D.unuse(),this._pool.push(L)}},get:function(){var L=this._pool.length-1;if(L<0)return null;var D=this._pool[L];this._pool.length=L;var P=this.poolHandlerComp?D.getComponent(this.poolHandlerComp):null;return P&&P.reuse&&P.reuse.apply(P,arguments),D}},D.exports=cc.NodePool},{}],279:[function(L,D,P){"use strict";var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../cocos2d/core/value-types/mat4")),F=L("../../cocos2d/core/renderer/render-flow").FLAG_TRANSFORM,s=function(){},a=function(L){Object.defineProperty(L,"_worldMatDirty",{get:function(){return!0},set:function(L){}}),L._calculWorldMatrix=s,L._mulMat=s},B=new N.default,k=cc.Class({name:"sp.AttachUtil",ctor:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._attachedRootNode=null,this._attachedNodeArray=[],this._boneIndexToNode={}},init:function(L){this._inited=!0,this._skeleton=L._skeleton,this._skeletonNode=L.node,this._skeletonComp=L},reset:function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},_prepareAttachNode:function(){if(this._skeleton){var L=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");return L&&L.isValid||(L=new cc.Node("ATTACHED_NODE_TREE"),a(L),this._skeletonNode.addChild(L)),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo(),this._attachedRootNode=L,L}},_buildBoneAttachedNode:function(L,D){var P="ATTACHED_NODE:"+L.data.name,N=new cc.Node(P);return this._buildBoneRelation(N,L,D),N},_buildBoneRelation:function(L,D,P){a(L),L._bone=D,L._boneIndex=P,this._attachedNodeArray.push(L),this._boneIndexToNode[P]=L},getAttachedRootNode:function(){return this._attachedRootNode},getAttachedNodes:function(L){var D=this._attachedNodeArray,P=[];if(!this._inited)return P;for(var N=0,F=D.length;N<F;N++){var B=D[N];B&&B.isValid&&B.name==="ATTACHED_NODE:"+L&&P.push(B)}return P},_rebuildNodeArray:function(){for(var L=this._boneIndexToNode={},D=this._attachedNodeArray,P=this._attachedNodeArray=[],N=0,F=D.length;N<F;N++){var B=D[N];B&&B.isValid&&!B._toRemove&&(P.push(B),L[B._boneIndex]=B)}},_sortNodeArray:function(){this._attachedNodeArray.sort((function(L,D){return L._boneIndex<D._boneIndex?-1:1}))},_getNodeByBoneIndex:function(L){var D=this._boneIndexToNode[L];return D&&D.isValid?D:null},destroyAttachedNodes:function(L){if(this._inited){for(var D=this._attachedNodeArray,P=function t(L){for(var D=L.children,P=0,N=D.length;P<N;P++){var F=D[P];F&&t(F)}L._toRemove=!0},N=0,F=D.length;N<F;N++){var B=D[N];B&&B.isValid&&B.name.split("ATTACHED_NODE:")[1]===L&&(P(B),B.removeFromParent(!0),B.destroy(),D[N]=null)}this._rebuildNodeArray()}},generateAttachedNodes:function(L){var D=[];if(!this._inited)return D;var P=this._prepareAttachNode();if(!P)return D;for(var N=[],F=this._skeleton.bones,B=0,k=F.length;B<k;B++){var U=F[B];U.data.name==L&&N.push(U)}for(var V=function(L){if(L){var D=L.data,N=this._getNodeByBoneIndex(D.index);if(N)return N;N=this._buildBoneAttachedNode(L,D.index);var F=V(L.parent)||P;return N.parent=F,N}}.bind(this),z=0,W=N.length;z<W;z++){var H=V(N[z]);D.push(H)}return this._sortNodeArray(),D},destroyAllAttachedNodes:function(){if(this._attachedRootNode=null,this._attachedNodeArray.length=0,this._boneIndexToNode={},this._inited){var L=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");L&&(L.removeFromParent(!0),L.destroy(),L=null)}},generateAllAttachedNodes:function(){if(this._inited){this._boneIndexToNode={},this._attachedNodeArray.length=0;var L=this._prepareAttachNode();if(L){for(var D=this._skeleton.bones,P=0,N=D.length;P<N;P++){var F=D[P],B=F.data,k=null;if(F.parent){var U=F.parent.data.index;k=this._boneIndexToNode[U]}else k=L;if(k){var V=k.getChildByName("ATTACHED_NODE:"+B.name);V&&V.isValid?this._buildBoneRelation(V,F,B.index):(V=this._buildBoneAttachedNode(F,B.index),k.addChild(V))}}return L}}},_hasAttachedNode:function(){return!!this._inited&&!!this._skeletonNode.getChildByName("ATTACHED_NODE_TREE")},_associateAttachedNode:function(){if(this._inited){var L=this._skeletonNode.getChildByName("ATTACHED_NODE_TREE");if(L&&L.isValid){this._attachedRootNode=L,this._boneIndexToNode={},this._attachedNodeArray.length=0,a(L),this._skeletonComp.isAnimationCached()&&this._skeletonComp._frameCache&&this._skeletonComp._frameCache.enableCacheAttachedInfo();for(var D=this._skeleton.bones,P=0,N=D.length;P<N;P++){var F=D[P],B=F.data,k=null;if(F.parent){var U=F.parent.data.index;k=this._boneIndexToNode[U]}else k=L;if(k){var V=k.getChildByName("ATTACHED_NODE:"+B.name);V&&V.isValid&&this._buildBoneRelation(V,F,B.index)}}}}},_syncAttachedNode:function(){if(this._inited){var L=this._attachedRootNode,D=this._attachedNodeArray;if(!L||!L.isValid)return this._attachedRootNode=null,void(D.length=0);var P=this._skeletonNode._worldMatrix;N.default.copy(L._worldMatrix,P),L._renderFlag&=~F;var k;if(k=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones){for(var U=this._skeletonNode._mulMat,c=function(L,D,P){var N=B.m;N[0]=P.a,N[1]=P.c,N[4]=P.b,N[5]=P.d,N[12]=P.worldX,N[13]=P.worldY,U(L,D,B)},V=!1,z=0,W=D.length;z<W;z++){var H=D[z];if(H&&H.isValid){var G=k[H._boneIndex];G?(c(H._worldMatrix,L._worldMatrix,G),H._renderFlag&=~F):(H.removeFromParent(!0),H.destroy(),D[z]=null,V=!0)}else D[z]=null,V=!0}V&&this._rebuildNodeArray()}}}});D.exports=sp.AttachUtil=k},{"../../cocos2d/core/renderer/render-flow":169,"../../cocos2d/core/value-types/mat4":227}],280:[function(L,D,P){"use strict";var N=L("./track-entry-listeners"),F=L("../../cocos2d/core/components/CCRenderComponent"),B=L("./lib/spine"),k=L("../../cocos2d/core/graphics/graphics"),U=L("../../cocos2d/core/renderer/render-flow").FLAG_POST_RENDER,V=L("./skeleton-cache"),z=L("./AttachUtil"),W=cc.Enum({default:-1}),H=cc.Enum({"<None>":0}),G=cc.Enum({REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2});sp.Skeleton=cc.Class({name:"sp.Skeleton",extends:F,editor:!1,statics:{AnimationCacheMode:G},properties:{paused:{default:!1,visible:!1},skeletonData:{default:null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData()},tooltip:!1},defaultSkin:{default:"",visible:!1},defaultAnimation:{default:"",visible:!1},animation:{get:function(){if(this.isAnimationCached())return this._animationName;var L=this.getCurrent(0);return L&&L.animation.name||""},set:function(L){this.defaultAnimation=L,L?this.setAnimation(0,L,this.loop):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData&&this.defaultSkin){var L=this.skeletonData.getSkinsEnum();if(L){var D=L[this.defaultSkin];if(void 0!==D)return D}}return 0},set:function(L){var D;if(this.skeletonData&&(D=this.skeletonData.getSkinsEnum()),!D)return cc.errorID("",this.name);var P=D[L];void 0!==P?(this.defaultSkin=P,this.setSkin(this.defaultSkin)):cc.errorID(7501,this.name)},type:W,visible:!0,displayName:"Default Skin",tooltip:!1},_animationIndex:{get:function(){var L=this.animation;if(this.skeletonData&&L){var D=this.skeletonData.getAnimsEnum();if(D){var P=D[L];if(void 0!==P)return P}}return 0},set:function(L){if(0!==L){var D;if(this.skeletonData&&(D=this.skeletonData.getAnimsEnum()),!D)return cc.errorID(7502,this.name);var P=D[L];void 0!==P?this.animation=P:cc.errorID(7503,this.name)}else this.animation=""},type:H,visible:!0,displayName:"Animation",tooltip:!1},_preCacheMode:-1,_cacheMode:G.REALTIME,_defaultCacheMode:{default:0,type:G,notify:function(){this.setAnimationCacheMode(this._defaultCacheMode)},editorOnly:!0,visible:!0,animatable:!1,displayName:"Animation Cache Mode",tooltip:!1},loop:{default:!0,tooltip:!1},premultipliedAlpha:{default:!0,tooltip:!1},timeScale:{default:1,tooltip:!1},debugSlots:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugBones:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},debugMesh:{default:!1,editorOnly:!0,tooltip:!1,notify:function(){this._updateDebugDraw()}},useTint:{default:!1,tooltip:!1,notify:function(){this._updateUseTint()}},enableBatch:{default:!1,notify:function(){this._updateBatch()},tooltip:!1},_accTime:0,_playCount:0,_frameCache:null,_curFrame:null,_skeletonCache:null,_animationName:"",_animationQueue:[],_headAniInfo:null,_playTimes:0,_isAniComplete:!0},ctor:function(){this._effectDelegate=null,this._skeleton=null,this._rootBone=null,this._listener=null,this._materialCache={},this._debugRenderer=null,this._startSlotIndex=-1,this._endSlotIndex=-1,this._startEntry={animation:{name:""},trackIndex:0},this._endEntry={animation:{name:""},trackIndex:0},this.attachUtil=new z},_getDefaultMaterial:function(){return cc.Material.getBuiltinMaterial("2d-spine")},_updateMaterial:function(){var L=this.useTint||this.isAnimationCached()&&!0,D=this.getMaterial(0);D&&(D.define("USE_TINT",L),D.define("CC_USE_MODEL",!this.enableBatch)),this._materialCache={}},disableRender:function(){this._super(),this.node._renderFlag&=~U},markForRender:function(L){this._super(L),L?this.node._renderFlag|=U:this.node._renderFlag&=~U},_updateUseTint:function(){var L=this.getMaterial(0);if(L){var D=this.useTint||this.isAnimationCached()&&!0;L.define("USE_TINT",D)}this._materialCache={}},_updateBatch:function(){var L=this.getMaterial(0);L&&L.define("CC_USE_MODEL",!this.enableBatch),this._materialCache={}},_validateRender:function(){var L=this.skeletonData;L&&L.isTexturesLoaded()?this._super():this.disableRender()},setSkeletonData:function(L){if(null!=L.width&&null!=L.height&&this.node.setContentSize(L.width,L.height),this._cacheMode===G.SHARED_CACHE?this._skeletonCache=V.sharedCache:this._cacheMode===G.PRIVATE_CACHE&&(this._skeletonCache=new V,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&cc.warn("Debug bones or slots is invalid in cached mode");var D=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,L);this._skeleton=D.skeleton,this._clipper=D.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new B.Skeleton(L),this._clipper=new B.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this.markForRender(!0)},setSlotsRange:function(L,D){this.isAnimationCached()?cc.warn("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=L,this._endSlotIndex=D)},setAnimationStateData:function(L){if(this.isAnimationCached())cc.warn("'setAnimationStateData' interface can not be invoked in cached mode.");else{var D=new B.AnimationState(L);this._listener&&(this._state&&this._state.removeListener(this._listener),D.addListener(this._listener)),this._state=D}},__preload:function(){this._super();for(var L=this.node.children,D=0,P=L.length;D<P;D++){var N=L[D];N&&"DEBUG_DRAW_NODE"===N._name&&N.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._updateBatch()},setAnimationCacheMode:function(L){this._preCacheMode!==L&&(this._cacheMode=L,this._updateSkeletonData(),this._updateUseTint())},isAnimationCached:function(){return this._cacheMode!==G.REALTIME},update:function(L){if(!this.paused)if(L*=this.timeScale*sp.timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var D=this._frameCache;if(D&&D.isInvalid()){D.updateToFrame();var P=D.frames;this._curFrame=P[P.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=L,this._accTime>this._headAniInfo.delay){var N=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,N.animationName,N.loop)}return}this._updateCache(L)}else this._updateRealtime(L)},_emitCacheCompleteEvent:function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},_updateCache:function(L){var D=this._frameCache;if(D.isInited()){var P=D.frames,N=V.FrameTime;0==this._accTime&&0==this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=L;var F=Math.floor(this._accTime/N);if(D.isCompleted||D.updateToFrame(F),D.isCompleted&&F>=P.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=P[P.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,F=0,this._emitCacheCompleteEvent()}this._curFrame=P[F]}},_updateRealtime:function(L){var D=this._skeleton,P=this._state;D&&(D.update(L),P&&(P.update(L),P.apply(D)))},setVertexEffectDelegate:function(L){this._effectDelegate=L},updateWorldTransform:function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton&&this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},updateAnimationCache:function(L){if(this.isAnimationCached()){var D=this.skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(D,L)}},invalidAnimationCache:function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this.skeletonData._uuid)},findBone:function(L){return this._skeleton?this._skeleton.findBone(L):null},findSlot:function(L){return this._skeleton?this._skeleton.findSlot(L):null},setSkin:function(L){this._skeleton&&(this._skeleton.setSkinByName(L),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},getAttachment:function(L,D){return this._skeleton?this._skeleton.getAttachmentByName(L,D):null},setAttachment:function(L,D){this._skeleton&&this._skeleton.setAttachment(L,D),this.invalidAnimationCache()},getTextureAtlas:function(L){return L.region},setMix:function(L,D,P){this._state&&this._state.data.setMix(L,D,P)},setAnimation:function(L,D,P){if(this._playTimes=P?0:1,this._animationName=D,this.isAnimationCached()){if(0!==L&&cc.warn("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var N=this._skeletonCache.getAnimationCache(this.skeletonData._uuid,D);N||(N=this._skeletonCache.initAnimationCache(this.skeletonData._uuid,D)),N&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=N,this.attachUtil._hasAttachedNode()&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var F=this._skeleton.data.findAnimation(D);if(!F)return cc.logID(7509,D),null;var B=this._state.setAnimationWith(L,F,P);return this._state.apply(this._skeleton),B}return null},addAnimation:function(L,D,P,N){if(N=N||0,this.isAnimationCached())0!==L&&cc.warn("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:D,loop:P,delay:N});else if(this._skeleton){var F=this._skeleton.data.findAnimation(D);return F?this._state.addAnimationWith(L,F,P,N):(cc.logID(7510,D),null)}return null},findAnimation:function(L){return this._skeleton?this._skeleton.data.findAnimation(L):null},getCurrent:function(L){if(this.isAnimationCached())cc.warn("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(L);return null},clearTracks:function(){this.isAnimationCached()?cc.warn("'clearTracks' interface can not be invoked in cached mode."):this._state&&this._state.clearTracks()},clearTrack:function(L){this.isAnimationCached()?cc.warn("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(L)},setStartListener:function(L){this._ensureListener(),this._listener.start=L},setInterruptListener:function(L){this._ensureListener(),this._listener.interrupt=L},setEndListener:function(L){this._ensureListener(),this._listener.end=L},setDisposeListener:function(L){this._ensureListener(),this._listener.dispose=L},setCompleteListener:function(L){this._ensureListener(),this._listener.complete=L},setEventListener:function(L){this._ensureListener(),this._listener.event=L},setTrackStartListener:function(L,D){N.getListeners(L).start=D},setTrackInterruptListener:function(L,D){N.getListeners(L).interrupt=D},setTrackEndListener:function(L,D){N.getListeners(L).end=D},setTrackDisposeListener:function(L,D){N.getListeners(L).dispose=D},setTrackCompleteListener:function(L,D){N.getListeners(L).complete=function(L){var P=Math.floor(L.trackTime/L.animationEnd);D(L,P)}},setTrackEventListener:function(L,D){N.getListeners(L).event=D},getState:function(){return this._state},_updateAnimEnum:!1,_updateSkinEnum:!1,_ensureListener:function(){this._listener||(this._listener=new N,this._state&&this._state.addListener(this._listener))},_updateSkeletonData:function(){if(this.skeletonData){var L=this.skeletonData.getRuntimeData();if(L){try{this.setSkeletonData(L),this.isAnimationCached()||this.setAnimationStateData(new B.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(L){cc.warn(L)}this.attachUtil.init(this),this.attachUtil._associateAttachedNode(),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},_refreshInspector:function(){this._updateAnimEnum(),this._updateSkinEnum(),Editor.Utils.refreshSelectedInspector("node",this.node.uuid)},_updateDebugDraw:function(){if(this.debugBones||this.debugSlots){if(!this._debugRenderer){var L=new cc.PrivateNode;L.name="DEBUG_DRAW_NODE";var D=L.addComponent(k);D.lineWidth=1,D.strokeColor=cc.color(255,0,0,255),this._debugRenderer=D}this._debugRenderer.node.parent=this.node,this.isAnimationCached()&&cc.warn("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.parent=null)}}),D.exports=sp.Skeleton},{"../../cocos2d/core/components/CCRenderComponent":84,"../../cocos2d/core/graphics/graphics":110,"../../cocos2d/core/renderer/render-flow":169,"./AttachUtil":279,"./lib/spine":282,"./skeleton-cache":283,"./track-entry-listeners":287}],281:[function(L,D,P){"use strict";var N="undefined"==typeof window?global:window;N.spine=L("./lib/spine"),N.sp={},sp._timeScale=1,Object.defineProperty(sp,"timeScale",{get:function(){return this._timeScale},set:function(L){this._timeScale=L},configurable:!0}),sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,INTERRUPT:1,END:2,DISPOSE:3,COMPLETE:4,EVENT:5}),sp.spine=N.spine,L("./skeleton-texture"),L("./skeleton-data"),L("./vertex-effect-delegate"),L("./Skeleton"),L("./spine-assembler")},{"./Skeleton":280,"./lib/spine":282,"./skeleton-data":284,"./skeleton-texture":285,"./spine-assembler":286,"./vertex-effect-delegate":288}],282:[function(L,D,P){"use strict";var N,F=function(){var t=function(L,D){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,D){L.__proto__=D}||function(L,D){for(var P in D)D.hasOwnProperty(P)&&(L[P]=D[P])})(L,D)};return function(L,D){function n(){this.constructor=L}t(L,D),L.prototype=null===D?Object.create(D):(n.prototype=D.prototype,new n)}}();(function(L){var D,P,N,B=function(){function t(L,D,P){if(null==L)throw new Error("name cannot be null.");if(null==D)throw new Error("timelines cannot be null.");this.name=L,this.timelines=D,this.timelineIds=[];for(var N=0;N<D.length;N++)this.timelineIds[D[N].getPropertyId()]=!0;this.duration=P}return t.prototype.hasTimeline=function(L){return 1==this.timelineIds[L]},t.prototype.apply=function(L,D,P,N,F,B,k,U){if(null==L)throw new Error("skeleton cannot be null.");N&&0!=this.duration&&(P%=this.duration,D>0&&(D%=this.duration));for(var V=this.timelines,z=0,W=V.length;z<W;z++)V[z].apply(L,D,P,F,B,k,U)},t.binarySearch=function(L,D,P){void 0===P&&(P=1);var N=0,F=L.length/P-2;if(0==F)return P;for(var B=F>>>1;;){if(L[(B+1)*P]<=D?N=B+1:F=B,N==F)return(N+1)*P;B=N+F>>>1}},t.linearSearch=function(L,D,P){for(var N=0,F=L.length-P;N<=F;N+=P)if(L[N]>D)return N;return-1},t}();L.Animation=B,function(L){L[L.setup=0]="setup",L[L.first=1]="first",L[L.replace=2]="replace",L[L.add=3]="add"}(D=L.MixBlend||(L.MixBlend={})),function(L){L[L.mixIn=0]="mixIn",L[L.mixOut=1]="mixOut"}(P=L.MixDirection||(L.MixDirection={})),function(L){L[L.rotate=0]="rotate",L[L.translate=1]="translate",L[L.scale=2]="scale",L[L.shear=3]="shear",L[L.attachment=4]="attachment",L[L.color=5]="color",L[L.deform=6]="deform",L[L.event=7]="event",L[L.drawOrder=8]="drawOrder",L[L.ikConstraint=9]="ikConstraint",L[L.transformConstraint=10]="transformConstraint",L[L.pathConstraintPosition=11]="pathConstraintPosition",L[L.pathConstraintSpacing=12]="pathConstraintSpacing",L[L.pathConstraintMix=13]="pathConstraintMix",L[L.twoColor=14]="twoColor"}(N=L.TimelineType||(L.TimelineType={}));var k=function(){function e(D){if(D<=0)throw new Error("frameCount must be > 0: "+D);this.curves=L.Utils.newFloatArray((D-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(L){this.curves[L*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(L){this.curves[L*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(L){var D=L*e.BEZIER_SIZE;if(D==this.curves.length)return e.LINEAR;var P=this.curves[D];return P==e.LINEAR?e.LINEAR:P==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(L,D,P,N,F){var B=.03*(2*-D+N),k=.03*(2*-P+F),U=.006*(3*(D-N)+1),V=.006*(3*(P-F)+1),z=2*B+U,W=2*k+V,H=.3*D+B+.16666667*U,G=.3*P+k+.16666667*V,X=L*e.BEZIER_SIZE,nt=this.curves;nt[X++]=e.BEZIER;for(var ut=H,dt=G,ft=X+e.BEZIER_SIZE-1;X<ft;X+=2)nt[X]=ut,nt[X+1]=dt,H+=z,G+=W,z+=U,W+=V,ut+=H,dt+=G},e.prototype.getCurvePercent=function(D,P){P=L.MathUtils.clamp(P,0,1);var N=this.curves,F=D*e.BEZIER_SIZE,B=N[F];if(B==e.LINEAR)return P;if(B==e.STEPPED)return 0;for(var k=0,U=++F,V=F+e.BEZIER_SIZE-1;F<V;F+=2)if((k=N[F])>=P){var z=void 0,W=void 0;return F==U?(z=0,W=0):(z=N[F-2],W=N[F-1]),W+(N[F+1]-W)*(P-z)/(k-z)}var H=N[F-1];return H+(1-H)*(P-k)/(1-k)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();L.CurveTimeline=k;var U=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D<<1),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.rotate<<24)+this.boneIndex},a.prototype.setFrame=function(L,D,P){L<<=1,this.frames[L]=D,this.frames[L+a.ROTATION]=P},a.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.bones[this.boneIndex];if(W.active)if(N<z[0])switch(U){case D.setup:return void(W.rotation=W.data.rotation);case D.first:var H=W.data.rotation-W.rotation;W.rotation+=(H-360*(16384-(16384.499999999996-H/360|0)))*k}else if(N>=z[z.length-a.ENTRIES]){var G=z[z.length+a.PREV_ROTATION];switch(U){case D.setup:W.rotation=W.data.rotation+G*k;break;case D.first:case D.replace:G+=W.data.rotation-W.rotation,G-=360*(16384-(16384.499999999996-G/360|0));case D.add:W.rotation+=G*k}}else{var X=B.binarySearch(z,N,a.ENTRIES),nt=z[X+a.PREV_ROTATION],ut=z[X],dt=this.getCurvePercent((X>>1)-1,1-(N-ut)/(z[X+a.PREV_TIME]-ut)),ft=z[X+a.ROTATION]-nt;switch(ft=nt+(ft-360*(16384-(16384.499999999996-ft/360|0)))*dt,U){case D.setup:W.rotation=W.data.rotation+(ft-360*(16384-(16384.499999999996-ft/360|0)))*k;break;case D.first:case D.replace:ft+=W.data.rotation-W.rotation;case D.add:W.rotation+=(ft-360*(16384-(16384.499999999996-ft/360|0)))*k}}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_ROTATION=-1,a.ROTATION=1,a}(k);L.RotateTimeline=U;var V=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D*a.ENTRIES),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.translate<<24)+this.boneIndex},a.prototype.setFrame=function(L,D,P,N){L*=a.ENTRIES,this.frames[L]=D,this.frames[L+a.X]=P,this.frames[L+a.Y]=N},a.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.bones[this.boneIndex];if(W.active)if(N<z[0])switch(U){case D.setup:return W.x=W.data.x,void(W.y=W.data.y);case D.first:W.x+=(W.data.x-W.x)*k,W.y+=(W.data.y-W.y)*k}else{var H=0,G=0;if(N>=z[z.length-a.ENTRIES])H=z[z.length+a.PREV_X],G=z[z.length+a.PREV_Y];else{var X=B.binarySearch(z,N,a.ENTRIES);H=z[X+a.PREV_X],G=z[X+a.PREV_Y];var nt=z[X],ut=this.getCurvePercent(X/a.ENTRIES-1,1-(N-nt)/(z[X+a.PREV_TIME]-nt));H+=(z[X+a.X]-H)*ut,G+=(z[X+a.Y]-G)*ut}switch(U){case D.setup:W.x=W.data.x+H*k,W.y=W.data.y+G*k;break;case D.first:case D.replace:W.x+=(W.data.x+H-W.x)*k,W.y+=(W.data.y+G-W.y)*k;break;case D.add:W.x+=H*k,W.y+=G*k}}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_X=-2,a.PREV_Y=-1,a.X=1,a.Y=2,a}(k);L.TranslateTimeline=V;var z=function(k){function o(L){return k.call(this,L)||this}return F(o,k),o.prototype.getPropertyId=function(){return(N.scale<<24)+this.boneIndex},o.prototype.apply=function(N,F,k,U,V,z,W){var H=this.frames,G=N.bones[this.boneIndex];if(G.active)if(k<H[0])switch(z){case D.setup:return G.scaleX=G.data.scaleX,void(G.scaleY=G.data.scaleY);case D.first:G.scaleX+=(G.data.scaleX-G.scaleX)*V,G.scaleY+=(G.data.scaleY-G.scaleY)*V}else{var X=0,nt=0;if(k>=H[H.length-o.ENTRIES])X=H[H.length+o.PREV_X]*G.data.scaleX,nt=H[H.length+o.PREV_Y]*G.data.scaleY;else{var ut=B.binarySearch(H,k,o.ENTRIES);X=H[ut+o.PREV_X],nt=H[ut+o.PREV_Y];var dt=H[ut],ft=this.getCurvePercent(ut/o.ENTRIES-1,1-(k-dt)/(H[ut+o.PREV_TIME]-dt));X=(X+(H[ut+o.X]-X)*ft)*G.data.scaleX,nt=(nt+(H[ut+o.Y]-nt)*ft)*G.data.scaleY}if(1==V)z==D.add?(G.scaleX+=X-G.data.scaleX,G.scaleY+=nt-G.data.scaleY):(G.scaleX=X,G.scaleY=nt);else{var _t=0,pt=0;if(W==P.mixOut)switch(z){case D.setup:_t=G.data.scaleX,pt=G.data.scaleY,G.scaleX=_t+(Math.abs(X)*L.MathUtils.signum(_t)-_t)*V,G.scaleY=pt+(Math.abs(nt)*L.MathUtils.signum(pt)-pt)*V;break;case D.first:case D.replace:_t=G.scaleX,pt=G.scaleY,G.scaleX=_t+(Math.abs(X)*L.MathUtils.signum(_t)-_t)*V,G.scaleY=pt+(Math.abs(nt)*L.MathUtils.signum(pt)-pt)*V;break;case D.add:_t=G.scaleX,pt=G.scaleY,G.scaleX=_t+(Math.abs(X)*L.MathUtils.signum(_t)-G.data.scaleX)*V,G.scaleY=pt+(Math.abs(nt)*L.MathUtils.signum(pt)-G.data.scaleY)*V}else switch(z){case D.setup:_t=Math.abs(G.data.scaleX)*L.MathUtils.signum(X),pt=Math.abs(G.data.scaleY)*L.MathUtils.signum(nt),G.scaleX=_t+(X-_t)*V,G.scaleY=pt+(nt-pt)*V;break;case D.first:case D.replace:_t=Math.abs(G.scaleX)*L.MathUtils.signum(X),pt=Math.abs(G.scaleY)*L.MathUtils.signum(nt),G.scaleX=_t+(X-_t)*V,G.scaleY=pt+(nt-pt)*V;break;case D.add:_t=L.MathUtils.signum(X),pt=L.MathUtils.signum(nt),G.scaleX=Math.abs(G.scaleX)*_t+(X-Math.abs(G.data.scaleX)*_t)*V,G.scaleY=Math.abs(G.scaleY)*pt+(nt-Math.abs(G.data.scaleY)*pt)*V}}}},o}(V);L.ScaleTimeline=z;var W=function(L){function i(D){return L.call(this,D)||this}return F(i,L),i.prototype.getPropertyId=function(){return(N.shear<<24)+this.boneIndex},i.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.bones[this.boneIndex];if(W.active)if(N<z[0])switch(U){case D.setup:return W.shearX=W.data.shearX,void(W.shearY=W.data.shearY);case D.first:W.shearX+=(W.data.shearX-W.shearX)*k,W.shearY+=(W.data.shearY-W.shearY)*k}else{var H=0,G=0;if(N>=z[z.length-i.ENTRIES])H=z[z.length+i.PREV_X],G=z[z.length+i.PREV_Y];else{var X=B.binarySearch(z,N,i.ENTRIES);H=z[X+i.PREV_X],G=z[X+i.PREV_Y];var nt=z[X],ut=this.getCurvePercent(X/i.ENTRIES-1,1-(N-nt)/(z[X+i.PREV_TIME]-nt));H+=(z[X+i.X]-H)*ut,G+=(z[X+i.Y]-G)*ut}switch(U){case D.setup:W.shearX=W.data.shearX+H*k,W.shearY=W.data.shearY+G*k;break;case D.first:case D.replace:W.shearX+=(W.data.shearX+H-W.shearX)*k,W.shearY+=(W.data.shearY+G-W.shearY)*k;break;case D.add:W.shearX+=H*k,W.shearY+=G*k}}},i}(V);L.ShearTimeline=W;var H=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D*a.ENTRIES),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.color<<24)+this.slotIndex},a.prototype.setFrame=function(L,D,P,N,F,B){L*=a.ENTRIES,this.frames[L]=D,this.frames[L+a.R]=P,this.frames[L+a.G]=N,this.frames[L+a.B]=F,this.frames[L+a.A]=B},a.prototype.apply=function(L,P,N,F,k,U,V){var z=L.slots[this.slotIndex];if(z.bone.active){var W=this.frames;if(N<W[0])switch(U){case D.setup:return void z.color.setFromColor(z.data.color);case D.first:var H=z.color,G=z.data.color;H.add((G.r-H.r)*k,(G.g-H.g)*k,(G.b-H.b)*k,(G.a-H.a)*k)}else{var X=0,nt=0,ut=0,dt=0;if(N>=W[W.length-a.ENTRIES]){var ft=W.length;X=W[ft+a.PREV_R],nt=W[ft+a.PREV_G],ut=W[ft+a.PREV_B],dt=W[ft+a.PREV_A]}else{var _t=B.binarySearch(W,N,a.ENTRIES);X=W[_t+a.PREV_R],nt=W[_t+a.PREV_G],ut=W[_t+a.PREV_B],dt=W[_t+a.PREV_A];var pt=W[_t],vt=this.getCurvePercent(_t/a.ENTRIES-1,1-(N-pt)/(W[_t+a.PREV_TIME]-pt));X+=(W[_t+a.R]-X)*vt,nt+=(W[_t+a.G]-nt)*vt,ut+=(W[_t+a.B]-ut)*vt,dt+=(W[_t+a.A]-dt)*vt}1==k?z.color.set(X,nt,ut,dt):(H=z.color,U==D.setup&&H.setFromColor(z.data.color),H.add((X-H.r)*k,(nt-H.g)*k,(ut-H.b)*k,(dt-H.a)*k))}}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_R=-4,a.PREV_G=-3,a.PREV_B=-2,a.PREV_A=-1,a.R=1,a.G=2,a.B=3,a.A=4,a}(k);L.ColorTimeline=H;var G=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D*a.ENTRIES),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.twoColor<<24)+this.slotIndex},a.prototype.setFrame=function(L,D,P,N,F,B,k,U,V){L*=a.ENTRIES,this.frames[L]=D,this.frames[L+a.R]=P,this.frames[L+a.G]=N,this.frames[L+a.B]=F,this.frames[L+a.A]=B,this.frames[L+a.R2]=k,this.frames[L+a.G2]=U,this.frames[L+a.B2]=V},a.prototype.apply=function(L,P,N,F,k,U,V){var z=L.slots[this.slotIndex];if(z.bone.active){var W=this.frames;if(N<W[0])switch(U){case D.setup:return z.color.setFromColor(z.data.color),void z.darkColor.setFromColor(z.data.darkColor);case D.first:var H=z.color,G=z.darkColor,X=z.data.color,nt=z.data.darkColor;H.add((X.r-H.r)*k,(X.g-H.g)*k,(X.b-H.b)*k,(X.a-H.a)*k),G.add((nt.r-G.r)*k,(nt.g-G.g)*k,(nt.b-G.b)*k,0)}else{var ut=0,dt=0,ft=0,_t=0,pt=0,vt=0,gt=0;if(N>=W[W.length-a.ENTRIES]){var mt=W.length;ut=W[mt+a.PREV_R],dt=W[mt+a.PREV_G],ft=W[mt+a.PREV_B],_t=W[mt+a.PREV_A],pt=W[mt+a.PREV_R2],vt=W[mt+a.PREV_G2],gt=W[mt+a.PREV_B2]}else{var yt=B.binarySearch(W,N,a.ENTRIES);ut=W[yt+a.PREV_R],dt=W[yt+a.PREV_G],ft=W[yt+a.PREV_B],_t=W[yt+a.PREV_A],pt=W[yt+a.PREV_R2],vt=W[yt+a.PREV_G2],gt=W[yt+a.PREV_B2];var Tt=W[yt],xt=this.getCurvePercent(yt/a.ENTRIES-1,1-(N-Tt)/(W[yt+a.PREV_TIME]-Tt));ut+=(W[yt+a.R]-ut)*xt,dt+=(W[yt+a.G]-dt)*xt,ft+=(W[yt+a.B]-ft)*xt,_t+=(W[yt+a.A]-_t)*xt,pt+=(W[yt+a.R2]-pt)*xt,vt+=(W[yt+a.G2]-vt)*xt,gt+=(W[yt+a.B2]-gt)*xt}1==k?(z.color.set(ut,dt,ft,_t),z.darkColor.set(pt,vt,gt,1)):(H=z.color,G=z.darkColor,U==D.setup&&(H.setFromColor(z.data.color),G.setFromColor(z.data.darkColor)),H.add((ut-H.r)*k,(dt-H.g)*k,(ft-H.b)*k,(_t-H.a)*k),G.add((pt-G.r)*k,(vt-G.g)*k,(gt-G.b)*k,0))}}},a.ENTRIES=8,a.PREV_TIME=-8,a.PREV_R=-7,a.PREV_G=-6,a.PREV_B=-5,a.PREV_A=-4,a.PREV_R2=-3,a.PREV_G2=-2,a.PREV_B2=-1,a.R=1,a.G=2,a.B=3,a.A=4,a.R2=5,a.G2=6,a.B2=7,a}(k);L.TwoColorTimeline=G;var X=function(){function r(D){this.frames=L.Utils.newFloatArray(D),this.attachmentNames=new Array(D)}return r.prototype.getPropertyId=function(){return(N.attachment<<24)+this.slotIndex},r.prototype.getFrameCount=function(){return this.frames.length},r.prototype.setFrame=function(L,D,P){this.frames[L]=D,this.attachmentNames[L]=P},r.prototype.apply=function(L,N,F,k,U,V,z){var W=L.slots[this.slotIndex];if(W.bone.active)if(z!=P.mixOut||V!=D.setup){var H=this.frames;if(F<H[0]){if(V==D.setup||V==D.first){var G=W.data.attachmentName;W.setAttachment(null==G?null:L.getAttachment(this.slotIndex,G))}}else{var X;X=F>=H[H.length-1]?H.length-1:B.binarySearch(H,F,1)-1;var nt=this.attachmentNames[X];L.slots[this.slotIndex].setAttachment(null==nt?null:L.getAttachment(this.slotIndex,nt))}}else{var ut=W.data.attachmentName;W.setAttachment(null==ut?null:L.getAttachment(this.slotIndex,ut))}},r}();L.AttachmentTimeline=X;var nt=null,ut=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D),N.frameVertices=new Array(D),null==nt&&(nt=L.Utils.newFloatArray(64)),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.deform<<27)+ +this.attachment.id+this.slotIndex},a.prototype.setFrame=function(L,D,P){this.frames[L]=D,this.frameVertices[L]=P},a.prototype.apply=function(P,N,F,k,U,V,z){var W=P.slots[this.slotIndex];if(W.bone.active){var H=W.getAttachment();if(H instanceof L.VertexAttachment&&H.deformAttachment==this.attachment){var G=W.deform;0==G.length&&(V=D.setup);var X=this.frameVertices,nt=X[0].length,ut=this.frames;if(F<ut[0]){var dt=H;switch(V){case D.setup:return void(G.length=0);case D.first:if(1==U){G.length=0;break}var ft=L.Utils.setArraySize(G,nt);if(null==dt.bones)for(var _t=dt.vertices,pt=0;pt<nt;pt++)ft[pt]+=(_t[pt]-ft[pt])*U;else for(U=1-U,pt=0;pt<nt;pt++)ft[pt]*=U}}else{var vt=L.Utils.setArraySize(G,nt);if(F>=ut[ut.length-1]){var gt=X[ut.length-1];if(1==U)if(V==D.add)if(null==(dt=H).bones){_t=dt.vertices;for(var mt=0;mt<nt;mt++)vt[mt]+=gt[mt]-_t[mt]}else for(var yt=0;yt<nt;yt++)vt[yt]+=gt[yt];else L.Utils.arrayCopy(gt,0,vt,0,nt);else switch(V){case D.setup:var Tt=H;if(null==Tt.bones){_t=Tt.vertices;for(var xt=0;xt<nt;xt++){var St=_t[xt];vt[xt]=St+(gt[xt]-St)*U}}else for(var bt=0;bt<nt;bt++)vt[bt]=gt[bt]*U;break;case D.first:case D.replace:for(var wt=0;wt<nt;wt++)vt[wt]+=(gt[wt]-vt[wt])*U;case D.add:if(null==(dt=H).bones){_t=dt.vertices;for(var Rt=0;Rt<nt;Rt++)vt[Rt]+=(gt[Rt]-_t[Rt])*U}else for(var It=0;It<nt;It++)vt[It]+=gt[It]*U}}else{var Mt=B.binarySearch(ut,F),Ot=X[Mt-1],Lt=X[Mt],Dt=ut[Mt],Pt=this.getCurvePercent(Mt-1,1-(F-Dt)/(ut[Mt-1]-Dt));if(1==U)if(V==D.add)if(null==(dt=H).bones){_t=dt.vertices;for(var Nt=0;Nt<nt;Nt++){var Ft=Ot[Nt];vt[Nt]+=Ft+(Lt[Nt]-Ft)*Pt-_t[Nt]}}else for(var Bt=0;Bt<nt;Bt++)Ft=Ot[Bt],vt[Bt]+=Ft+(Lt[Bt]-Ft)*Pt;else for(var kt=0;kt<nt;kt++)Ft=Ot[kt],vt[kt]=Ft+(Lt[kt]-Ft)*Pt;else switch(V){case D.setup:var Ut=H;if(null==Ut.bones){_t=Ut.vertices;for(var Vt=0;Vt<nt;Vt++)Ft=Ot[Vt],St=_t[Vt],vt[Vt]=St+(Ft+(Lt[Vt]-Ft)*Pt-St)*U}else for(var zt=0;zt<nt;zt++)Ft=Ot[zt],vt[zt]=(Ft+(Lt[zt]-Ft)*Pt)*U;break;case D.first:case D.replace:for(var Wt=0;Wt<nt;Wt++)Ft=Ot[Wt],vt[Wt]+=(Ft+(Lt[Wt]-Ft)*Pt-vt[Wt])*U;break;case D.add:if(null==(dt=H).bones){_t=dt.vertices;for(var Ht=0;Ht<nt;Ht++)Ft=Ot[Ht],vt[Ht]+=(Ft+(Lt[Ht]-Ft)*Pt-_t[Ht])*U}else for(var Gt=0;Gt<nt;Gt++)Ft=Ot[Gt],vt[Gt]+=(Ft+(Lt[Gt]-Ft)*Pt)*U}}}}}},a}(k);L.DeformTimeline=ut;var dt=function(){function e(D){this.frames=L.Utils.newFloatArray(D),this.events=new Array(D)}return e.prototype.getPropertyId=function(){return N.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(L,D){this.frames[L]=D.time,this.events[L]=D},e.prototype.apply=function(L,D,P,N,F,k,U){if(null!=N){var V=this.frames,z=this.frames.length;if(D>P)this.apply(L,D,Number.MAX_VALUE,N,F,k,U),D=-1;else if(D>=V[z-1])return;if(!(P<V[0])){var W=0;if(D<V[0])W=0;else for(var H=V[W=B.binarySearch(V,D)];W>0&&V[W-1]==H;)W--;for(;W<z&&P>=V[W];W++)N.push(this.events[W])}}},e}();L.EventTimeline=dt;var ft=function(){function r(D){this.frames=L.Utils.newFloatArray(D),this.drawOrders=new Array(D)}return r.prototype.getPropertyId=function(){return N.drawOrder<<24},r.prototype.getFrameCount=function(){return this.frames.length},r.prototype.setFrame=function(L,D,P){this.frames[L]=D,this.drawOrders[L]=P},r.prototype.apply=function(N,F,k,U,V,z,W){var H=N.drawOrder,G=N.slots;if(W!=P.mixOut||z!=D.setup){var X=this.frames;if(k<X[0])z!=D.setup&&z!=D.first||L.Utils.arrayCopy(N.slots,0,N.drawOrder,0,N.slots.length);else{var nt;nt=k>=X[X.length-1]?X.length-1:B.binarySearch(X,k)-1;var ut=this.drawOrders[nt];if(null==ut)L.Utils.arrayCopy(G,0,H,0,G.length);else for(var dt=0,ft=ut.length;dt<ft;dt++)H[dt]=G[ut[dt]]}}else L.Utils.arrayCopy(N.slots,0,N.drawOrder,0,N.slots.length)},r}();L.DrawOrderTimeline=ft;var _t=function(k){function o(D){var P=k.call(this,D)||this;return P.frames=L.Utils.newFloatArray(D*o.ENTRIES),P}return F(o,k),o.prototype.getPropertyId=function(){return(N.ikConstraint<<24)+this.ikConstraintIndex},o.prototype.setFrame=function(L,D,P,N,F,B,k){L*=o.ENTRIES,this.frames[L]=D,this.frames[L+o.MIX]=P,this.frames[L+o.SOFTNESS]=N,this.frames[L+o.BEND_DIRECTION]=F,this.frames[L+o.COMPRESS]=B?1:0,this.frames[L+o.STRETCH]=k?1:0},o.prototype.apply=function(L,N,F,k,U,V,z){var W=this.frames,H=L.ikConstraints[this.ikConstraintIndex];if(H.active)if(F<W[0])switch(V){case D.setup:return H.mix=H.data.mix,H.softness=H.data.softness,H.bendDirection=H.data.bendDirection,H.compress=H.data.compress,void(H.stretch=H.data.stretch);case D.first:H.mix+=(H.data.mix-H.mix)*U,H.softness+=(H.data.softness-H.softness)*U,H.bendDirection=H.data.bendDirection,H.compress=H.data.compress,H.stretch=H.data.stretch}else if(F>=W[W.length-o.ENTRIES])V==D.setup?(H.mix=H.data.mix+(W[W.length+o.PREV_MIX]-H.data.mix)*U,H.softness=H.data.softness+(W[W.length+o.PREV_SOFTNESS]-H.data.softness)*U,z==P.mixOut?(H.bendDirection=H.data.bendDirection,H.compress=H.data.compress,H.stretch=H.data.stretch):(H.bendDirection=W[W.length+o.PREV_BEND_DIRECTION],H.compress=0!=W[W.length+o.PREV_COMPRESS],H.stretch=0!=W[W.length+o.PREV_STRETCH])):(H.mix+=(W[W.length+o.PREV_MIX]-H.mix)*U,H.softness+=(W[W.length+o.PREV_SOFTNESS]-H.softness)*U,z==P.mixIn&&(H.bendDirection=W[W.length+o.PREV_BEND_DIRECTION],H.compress=0!=W[W.length+o.PREV_COMPRESS],H.stretch=0!=W[W.length+o.PREV_STRETCH]));else{var G=B.binarySearch(W,F,o.ENTRIES),X=W[G+o.PREV_MIX],nt=W[G+o.PREV_SOFTNESS],ut=W[G],dt=this.getCurvePercent(G/o.ENTRIES-1,1-(F-ut)/(W[G+o.PREV_TIME]-ut));V==D.setup?(H.mix=H.data.mix+(X+(W[G+o.MIX]-X)*dt-H.data.mix)*U,H.softness=H.data.softness+(nt+(W[G+o.SOFTNESS]-nt)*dt-H.data.softness)*U,z==P.mixOut?(H.bendDirection=H.data.bendDirection,H.compress=H.data.compress,H.stretch=H.data.stretch):(H.bendDirection=W[G+o.PREV_BEND_DIRECTION],H.compress=0!=W[G+o.PREV_COMPRESS],H.stretch=0!=W[G+o.PREV_STRETCH])):(H.mix+=(X+(W[G+o.MIX]-X)*dt-H.mix)*U,H.softness+=(nt+(W[G+o.SOFTNESS]-nt)*dt-H.softness)*U,z==P.mixIn&&(H.bendDirection=W[G+o.PREV_BEND_DIRECTION],H.compress=0!=W[G+o.PREV_COMPRESS],H.stretch=0!=W[G+o.PREV_STRETCH]))}},o.ENTRIES=6,o.PREV_TIME=-6,o.PREV_MIX=-5,o.PREV_SOFTNESS=-4,o.PREV_BEND_DIRECTION=-3,o.PREV_COMPRESS=-2,o.PREV_STRETCH=-1,o.MIX=1,o.SOFTNESS=2,o.BEND_DIRECTION=3,o.COMPRESS=4,o.STRETCH=5,o}(k);L.IkConstraintTimeline=_t;var pt=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D*a.ENTRIES),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.transformConstraint<<24)+this.transformConstraintIndex},a.prototype.setFrame=function(L,D,P,N,F,B){L*=a.ENTRIES,this.frames[L]=D,this.frames[L+a.ROTATE]=P,this.frames[L+a.TRANSLATE]=N,this.frames[L+a.SCALE]=F,this.frames[L+a.SHEAR]=B},a.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.transformConstraints[this.transformConstraintIndex];if(W.active)if(N<z[0]){var H=W.data;switch(U){case D.setup:return W.rotateMix=H.rotateMix,W.translateMix=H.translateMix,W.scaleMix=H.scaleMix,void(W.shearMix=H.shearMix);case D.first:W.rotateMix+=(H.rotateMix-W.rotateMix)*k,W.translateMix+=(H.translateMix-W.translateMix)*k,W.scaleMix+=(H.scaleMix-W.scaleMix)*k,W.shearMix+=(H.shearMix-W.shearMix)*k}}else{var G=0,X=0,nt=0,ut=0;if(N>=z[z.length-a.ENTRIES]){var dt=z.length;G=z[dt+a.PREV_ROTATE],X=z[dt+a.PREV_TRANSLATE],nt=z[dt+a.PREV_SCALE],ut=z[dt+a.PREV_SHEAR]}else{var ft=B.binarySearch(z,N,a.ENTRIES);G=z[ft+a.PREV_ROTATE],X=z[ft+a.PREV_TRANSLATE],nt=z[ft+a.PREV_SCALE],ut=z[ft+a.PREV_SHEAR];var _t=z[ft],pt=this.getCurvePercent(ft/a.ENTRIES-1,1-(N-_t)/(z[ft+a.PREV_TIME]-_t));G+=(z[ft+a.ROTATE]-G)*pt,X+=(z[ft+a.TRANSLATE]-X)*pt,nt+=(z[ft+a.SCALE]-nt)*pt,ut+=(z[ft+a.SHEAR]-ut)*pt}U==D.setup?(H=W.data,W.rotateMix=H.rotateMix+(G-H.rotateMix)*k,W.translateMix=H.translateMix+(X-H.translateMix)*k,W.scaleMix=H.scaleMix+(nt-H.scaleMix)*k,W.shearMix=H.shearMix+(ut-H.shearMix)*k):(W.rotateMix+=(G-W.rotateMix)*k,W.translateMix+=(X-W.translateMix)*k,W.scaleMix+=(nt-W.scaleMix)*k,W.shearMix+=(ut-W.shearMix)*k)}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_ROTATE=-4,a.PREV_TRANSLATE=-3,a.PREV_SCALE=-2,a.PREV_SHEAR=-1,a.ROTATE=1,a.TRANSLATE=2,a.SCALE=3,a.SHEAR=4,a}(k);L.TransformConstraintTimeline=pt;var vt=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D*a.ENTRIES),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.pathConstraintPosition<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(L,D,P){L*=a.ENTRIES,this.frames[L]=D,this.frames[L+a.VALUE]=P},a.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.pathConstraints[this.pathConstraintIndex];if(W.active)if(N<z[0])switch(U){case D.setup:return void(W.position=W.data.position);case D.first:W.position+=(W.data.position-W.position)*k}else{var H=0;if(N>=z[z.length-a.ENTRIES])H=z[z.length+a.PREV_VALUE];else{var G=B.binarySearch(z,N,a.ENTRIES);H=z[G+a.PREV_VALUE];var X=z[G],nt=this.getCurvePercent(G/a.ENTRIES-1,1-(N-X)/(z[G+a.PREV_TIME]-X));H+=(z[G+a.VALUE]-H)*nt}U==D.setup?W.position=W.data.position+(H-W.data.position)*k:W.position+=(H-W.position)*k}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_VALUE=-1,a.VALUE=1,a}(k);L.PathConstraintPositionTimeline=vt;var gt=function(L){function i(D){return L.call(this,D)||this}return F(i,L),i.prototype.getPropertyId=function(){return(N.pathConstraintSpacing<<24)+this.pathConstraintIndex},i.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.pathConstraints[this.pathConstraintIndex];if(W.active)if(N<z[0])switch(U){case D.setup:return void(W.spacing=W.data.spacing);case D.first:W.spacing+=(W.data.spacing-W.spacing)*k}else{var H=0;if(N>=z[z.length-i.ENTRIES])H=z[z.length+i.PREV_VALUE];else{var G=B.binarySearch(z,N,i.ENTRIES);H=z[G+i.PREV_VALUE];var X=z[G],nt=this.getCurvePercent(G/i.ENTRIES-1,1-(N-X)/(z[G+i.PREV_TIME]-X));H+=(z[G+i.VALUE]-H)*nt}U==D.setup?W.spacing=W.data.spacing+(H-W.data.spacing)*k:W.spacing+=(H-W.spacing)*k}},i}(vt);L.PathConstraintSpacingTimeline=gt;var mt=function(P){function a(D){var N=P.call(this,D)||this;return N.frames=L.Utils.newFloatArray(D*a.ENTRIES),N}return F(a,P),a.prototype.getPropertyId=function(){return(N.pathConstraintMix<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(L,D,P,N){L*=a.ENTRIES,this.frames[L]=D,this.frames[L+a.ROTATE]=P,this.frames[L+a.TRANSLATE]=N},a.prototype.apply=function(L,P,N,F,k,U,V){var z=this.frames,W=L.pathConstraints[this.pathConstraintIndex];if(W.active)if(N<z[0])switch(U){case D.setup:return W.rotateMix=W.data.rotateMix,void(W.translateMix=W.data.translateMix);case D.first:W.rotateMix+=(W.data.rotateMix-W.rotateMix)*k,W.translateMix+=(W.data.translateMix-W.translateMix)*k}else{var H=0,G=0;if(N>=z[z.length-a.ENTRIES])H=z[z.length+a.PREV_ROTATE],G=z[z.length+a.PREV_TRANSLATE];else{var X=B.binarySearch(z,N,a.ENTRIES);H=z[X+a.PREV_ROTATE],G=z[X+a.PREV_TRANSLATE];var nt=z[X],ut=this.getCurvePercent(X/a.ENTRIES-1,1-(N-nt)/(z[X+a.PREV_TIME]-nt));H+=(z[X+a.ROTATE]-H)*ut,G+=(z[X+a.TRANSLATE]-G)*ut}U==D.setup?(W.rotateMix=W.data.rotateMix+(H-W.data.rotateMix)*k,W.translateMix=W.data.translateMix+(G-W.data.translateMix)*k):(W.rotateMix+=(H-W.rotateMix)*k,W.translateMix+=(G-W.translateMix)*k)}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_ROTATE=-2,a.PREV_TRANSLATE=-1,a.ROTATE=1,a.TRANSLATE=2,a}(k);L.PathConstraintMixTimeline=mt})(N||(N={})),function(L){var D=function(){function e(D){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new F(this),this.propertyIDs=new L.IntSet,this.animationsChanged=!1,this.trackEntryPool=new L.Pool((function(){return new P})),this.data=D}return e.prototype.update=function(L){L*=this.timeScale;for(var D=this.tracks,P=0,N=D.length;P<N;P++){var F=D[P];if(null!=F){F.animationLast=F.nextAnimationLast,F.trackLast=F.nextTrackLast;var B=L*F.timeScale;if(F.delay>0){if(F.delay-=B,F.delay>0)continue;B=-F.delay,F.delay=0}var k=F.next;if(null!=k){var U=F.trackLast-k.delay;if(U>=0){for(k.delay=0,k.trackTime+=0==F.timeScale?0:(U/F.timeScale+L)*k.timeScale,F.trackTime+=B,this.setCurrent(P,k,!0);null!=k.mixingFrom;)k.mixTime+=L,k=k.mixingFrom;continue}}else if(F.trackLast>=F.trackEnd&&null==F.mixingFrom){D[P]=null,this.queue.end(F),this.disposeNext(F);continue}if(null!=F.mixingFrom&&this.updateMixingFrom(F,L)){var V=F.mixingFrom;for(F.mixingFrom=null,null!=V&&(V.mixingTo=null);null!=V;)this.queue.end(V),V=V.mixingFrom}F.trackTime+=B}}this.queue.drain()},e.prototype.updateMixingFrom=function(L,D){var P=L.mixingFrom;if(null==P)return!0;var N=this.updateMixingFrom(P,D);return P.animationLast=P.nextAnimationLast,P.trackLast=P.nextTrackLast,L.mixTime>0&&L.mixTime>=L.mixDuration?(0!=P.totalAlpha&&0!=L.mixDuration||(L.mixingFrom=P.mixingFrom,null!=P.mixingFrom&&(P.mixingFrom.mixingTo=L),L.interruptAlpha=P.interruptAlpha,this.queue.end(P)),N):(P.trackTime+=D*P.timeScale,L.mixTime+=D,!1)},e.prototype.apply=function(D){if(null==D)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var P=this.events,N=this.tracks,F=!1,B=0,k=N.length;B<k;B++){var U=N[B];if(!(null==U||U.delay>0)){F=!0;var V=0==B?L.MixBlend.first:U.mixBlend,z=U.alpha;null!=U.mixingFrom?z*=this.applyMixingFrom(U,D,V):U.trackTime>=U.trackEnd&&null==U.next&&(z=0);var W=U.animationLast,H=U.getAnimationTime(),G=U.animation.timelines.length,X=U.animation.timelines;if(0==B&&1==z||V==L.MixBlend.add)for(var nt=0;nt<G;nt++)L.Utils.webkit602BugfixHelper(z,V),X[nt].apply(D,W,H,P,z,V,L.MixDirection.mixIn);else{var ut=U.timelineMode,dt=0==U.timelinesRotation.length;dt&&L.Utils.setArraySize(U.timelinesRotation,G<<1,null);var ft=U.timelinesRotation;for(nt=0;nt<G;nt++){var _t=X[nt],pt=(ut[nt]&e.NOT_LAST-1)==e.SUBSEQUENT?V:L.MixBlend.setup;_t instanceof L.RotateTimeline?this.applyRotateTimeline(_t,D,H,z,pt,ft,nt<<1,dt):(L.Utils.webkit602BugfixHelper(z,V),_t.apply(D,W,H,P,z,pt,L.MixDirection.mixIn))}}this.queueEvents(U,H),P.length=0,U.nextAnimationLast=H,U.nextTrackLast=U.trackTime}}return this.queue.drain(),F},e.prototype.applyMixingFrom=function(D,P,N){var F=D.mixingFrom;null!=F.mixingFrom&&this.applyMixingFrom(F,P,N);var B=0;0==D.mixDuration?(B=1,N==L.MixBlend.first&&(N=L.MixBlend.setup)):((B=D.mixTime/D.mixDuration)>1&&(B=1),N!=L.MixBlend.first&&(N=F.mixBlend));var k=B<F.eventThreshold?this.events:null,U=B<F.attachmentThreshold,V=B<F.drawOrderThreshold,z=F.animationLast,W=F.getAnimationTime(),H=F.animation.timelines.length,G=F.animation.timelines,X=F.alpha*D.interruptAlpha,nt=X*(1-B);if(N==L.MixBlend.add)for(var ut=0;ut<H;ut++)G[ut].apply(P,z,W,k,nt,N,L.MixDirection.mixOut);else{var dt=F.timelineMode,ft=F.timelineHoldMix,_t=0==F.timelinesRotation.length;_t&&L.Utils.setArraySize(F.timelinesRotation,H<<1,null);var pt=F.timelinesRotation;for(F.totalAlpha=0,ut=0;ut<H;ut++){var vt=G[ut],gt=L.MixDirection.mixOut,mt=void 0,yt=0;switch(dt[ut]&e.NOT_LAST-1){case e.SUBSEQUENT:if(mt=N,!U&&vt instanceof L.AttachmentTimeline){if((dt[ut]&e.NOT_LAST)==e.NOT_LAST)continue;mt=L.MixBlend.setup}if(!V&&vt instanceof L.DrawOrderTimeline)continue;yt=nt;break;case e.FIRST:mt=L.MixBlend.setup,yt=nt;break;case e.HOLD:mt=L.MixBlend.setup,yt=X;break;default:mt=L.MixBlend.setup;var Tt=ft[ut];yt=X*Math.max(0,1-Tt.mixTime/Tt.mixDuration)}F.totalAlpha+=yt,vt instanceof L.RotateTimeline?this.applyRotateTimeline(vt,P,W,yt,mt,pt,ut<<1,_t):(L.Utils.webkit602BugfixHelper(yt,N),mt==L.MixBlend.setup&&(vt instanceof L.AttachmentTimeline?(U||(dt[ut]&e.NOT_LAST)==e.NOT_LAST)&&(gt=L.MixDirection.mixIn):vt instanceof L.DrawOrderTimeline&&V&&(gt=L.MixDirection.mixIn)),vt.apply(P,z,W,k,yt,mt,gt))}}return D.mixDuration>0&&this.queueEvents(F,W),this.events.length=0,F.nextAnimationLast=W,F.nextTrackLast=F.trackTime,B},e.prototype.applyRotateTimeline=function(D,P,N,F,B,k,U,V){if(V&&(k[U]=0),1!=F){var z=D,W=z.frames,H=P.bones[z.boneIndex];if(H.active){var G=0,X=0;if(N<W[0])switch(B){case L.MixBlend.setup:H.rotation=H.data.rotation;default:return;case L.MixBlend.first:G=H.rotation,X=H.data.rotation}else if(G=B==L.MixBlend.setup?H.data.rotation:H.rotation,N>=W[W.length-L.RotateTimeline.ENTRIES])X=H.data.rotation+W[W.length+L.RotateTimeline.PREV_ROTATION];else{var nt=L.Animation.binarySearch(W,N,L.RotateTimeline.ENTRIES),ut=W[nt+L.RotateTimeline.PREV_ROTATION],dt=W[nt],ft=z.getCurvePercent((nt>>1)-1,1-(N-dt)/(W[nt+L.RotateTimeline.PREV_TIME]-dt));X=W[nt+L.RotateTimeline.ROTATION]-ut,X=ut+(X-=360*(16384-(16384.499999999996-X/360|0)))*ft+H.data.rotation,X-=360*(16384-(16384.499999999996-X/360|0))}var _t=0,pt=X-G;if(0==(pt-=360*(16384-(16384.499999999996-pt/360|0))))_t=k[U];else{var vt=0,gt=0;V?(vt=0,gt=pt):(vt=k[U],gt=k[U+1]);var mt=pt>0,yt=vt>=0;L.MathUtils.signum(gt)!=L.MathUtils.signum(pt)&&Math.abs(gt)<=90&&(Math.abs(vt)>180&&(vt+=360*L.MathUtils.signum(vt)),yt=mt),_t=pt+vt-vt%360,yt!=mt&&(_t+=360*L.MathUtils.signum(vt)),k[U]=_t}k[U+1]=pt,G+=_t*F,H.rotation=G-360*(16384-(16384.499999999996-G/360|0))}}else D.apply(P,0,N,null,1,B,L.MixDirection.mixIn)},e.prototype.queueEvents=function(L,D){for(var P=L.animationStart,N=L.animationEnd,F=N-P,B=L.trackLast%F,k=this.events,U=0,V=k.length;U<V;U++){var z=k[U];if(z.time<B)break;z.time>N||this.queue.event(L,z)}for((L.loop?0==F||B>L.trackTime%F:D>=N&&L.animationLast<N)&&this.queue.complete(L);U<V;U++)k[U].time<P||this.queue.event(L,k[U])},e.prototype.clearTracks=function(){var L=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var D=0,P=this.tracks.length;D<P;D++)this.clearTrack(D);this.tracks.length=0,this.queue.drainDisabled=L,this.queue.drain()},e.prototype.clearTrack=function(L){if(!(L>=this.tracks.length)){var D=this.tracks[L];if(null!=D){this.queue.end(D),this.disposeNext(D);for(var P=D;;){var N=P.mixingFrom;if(null==N)break;this.queue.end(N),P.mixingFrom=null,P.mixingTo=null,P=N}this.tracks[D.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(L,D,P){var N=this.expandToIndex(L);this.tracks[L]=D,null!=N&&(P&&this.queue.interrupt(N),D.mixingFrom=N,N.mixingTo=D,D.mixTime=0,null!=N.mixingFrom&&N.mixDuration>0&&(D.interruptAlpha*=Math.min(1,N.mixTime/N.mixDuration)),N.timelinesRotation.length=0),this.queue.start(D)},e.prototype.setAnimation=function(L,D,P){var N=this.data.skeletonData.findAnimation(D);if(null==N)throw new Error("Animation not found: "+D);return this.setAnimationWith(L,N,P)},e.prototype.setAnimationWith=function(L,D,P){if(null==D)throw new Error("animation cannot be null.");var N=!0,F=this.expandToIndex(L);null!=F&&(-1==F.nextTrackLast?(this.tracks[L]=F.mixingFrom,this.queue.interrupt(F),this.queue.end(F),this.disposeNext(F),F=F.mixingFrom,N=!1):this.disposeNext(F));var B=this.trackEntry(L,D,P,F);return this.setCurrent(L,B,N),this.queue.drain(),B},e.prototype.addAnimation=function(L,D,P,N){var F=this.data.skeletonData.findAnimation(D);if(null==F)throw new Error("Animation not found: "+D);return this.addAnimationWith(L,F,P,N)},e.prototype.addAnimationWith=function(L,D,P,N){if(null==D)throw new Error("animation cannot be null.");var F=this.expandToIndex(L);if(null!=F)for(;null!=F.next;)F=F.next;var B=this.trackEntry(L,D,P,F);if(null==F)this.setCurrent(L,B,!0),this.queue.drain();else if(F.next=B,N<=0){var k=F.animationEnd-F.animationStart;0!=k?(F.loop?N+=k*(1+(F.trackTime/k|0)):N+=Math.max(k,F.trackTime),N-=this.data.getMix(F.animation,D)):N=F.trackTime}return B.delay=N,B},e.prototype.setEmptyAnimation=function(L,D){var P=this.setAnimationWith(L,e.emptyAnimation,!1);return P.mixDuration=D,P.trackEnd=D,P},e.prototype.addEmptyAnimation=function(L,D,P){P<=0&&(P-=D);var N=this.addAnimationWith(L,e.emptyAnimation,!1,P);return N.mixDuration=D,N.trackEnd=D,N},e.prototype.setEmptyAnimations=function(L){var D=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var P=0,N=this.tracks.length;P<N;P++){var F=this.tracks[P];null!=F&&this.setEmptyAnimation(F.trackIndex,L)}this.queue.drainDisabled=D,this.queue.drain()},e.prototype.expandToIndex=function(D){return D<this.tracks.length?this.tracks[D]:(L.Utils.ensureArrayCapacity(this.tracks,D+1,null),this.tracks.length=D+1,null)},e.prototype.trackEntry=function(L,D,P,N){var F=this.trackEntryPool.obtain();return F.trackIndex=L,F.animation=D,F.loop=P,F.holdPrevious=!1,F.eventThreshold=0,F.attachmentThreshold=0,F.drawOrderThreshold=0,F.animationStart=0,F.animationEnd=D.duration,F.animationLast=-1,F.nextAnimationLast=-1,F.delay=0,F.trackTime=0,F.trackLast=-1,F.nextTrackLast=-1,F.trackEnd=Number.MAX_VALUE,F.timeScale=1,F.alpha=1,F.interruptAlpha=1,F.mixTime=0,F.mixDuration=null==N?0:this.data.getMix(N.animation,D),F},e.prototype.disposeNext=function(L){for(var D=L.next;null!=D;)this.queue.dispose(D),D=D.next;L.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var D=0,P=this.tracks.length;D<P;D++)if(null!=(N=this.tracks[D])){for(;null!=N.mixingFrom;)N=N.mixingFrom;do{null!=N.mixingFrom&&N.mixBlend==L.MixBlend.add||this.computeHold(N),N=N.mixingTo}while(null!=N)}for(this.propertyIDs.clear(),D=this.tracks.length-1;D>=0;D--)for(var N=this.tracks[D];null!=N;)this.computeNotLast(N),N=N.mixingFrom},e.prototype.computeHold=function(D){var P=D.mixingTo,N=D.animation.timelines,F=D.animation.timelines.length,B=L.Utils.setArraySize(D.timelineMode,F);D.timelineHoldMix.length=0;var k=L.Utils.setArraySize(D.timelineHoldMix,F),U=this.propertyIDs;if(null!=P&&P.holdPrevious)for(var V=0;V<F;V++)U.add(N[V].getPropertyId()),B[V]=e.HOLD;else t:for(V=0;V<F;V++){var z=N[V],W=z.getPropertyId();if(U.add(W))if(null==P||z instanceof L.AttachmentTimeline||z instanceof L.DrawOrderTimeline||z instanceof L.EventTimeline||!P.animation.hasTimeline(W))B[V]=e.FIRST;else{for(var H=P.mixingTo;null!=H;H=H.mixingTo)if(!H.animation.hasTimeline(W)){if(D.mixDuration>0){B[V]=e.HOLD_MIX,k[V]=H;continue t}break}B[V]=e.HOLD}else B[V]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(D){for(var P=D.animation.timelines,N=D.animation.timelines.length,F=D.timelineMode,B=this.propertyIDs,k=0;k<N;k++)if(P[k]instanceof L.AttachmentTimeline){var U=P[k];B.add(U.slotIndex)||(F[k]|=e.NOT_LAST)}},e.prototype.getCurrent=function(L){return L>=this.tracks.length?null:this.tracks[L]},e.prototype.addListener=function(L){if(null==L)throw new Error("listener cannot be null.");this.listeners.push(L)},e.prototype.removeListener=function(L){var D=this.listeners.indexOf(L);D>=0&&this.listeners.splice(D,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new L.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();L.AnimationState=D;var P=function(){function e(){this.mixBlend=L.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var L=this.animationEnd-this.animationStart;return 0==L?this.animationStart:this.trackTime%L+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(L){this.animationLast=L,this.nextAnimationLast=L},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();L.TrackEntry=P;var N,F=function(){function t(L){this.objects=[],this.drainDisabled=!1,this.animState=L}return t.prototype.start=function(L){this.objects.push(N.start),this.objects.push(L),this.animState.animationsChanged=!0},t.prototype.interrupt=function(L){this.objects.push(N.interrupt),this.objects.push(L)},t.prototype.end=function(L){this.objects.push(N.end),this.objects.push(L),this.animState.animationsChanged=!0},t.prototype.dispose=function(L){this.objects.push(N.dispose),this.objects.push(L)},t.prototype.complete=function(L){this.objects.push(N.complete),this.objects.push(L)},t.prototype.event=function(L,D){this.objects.push(N.event),this.objects.push(L),this.objects.push(D)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var L=this.objects,D=this.animState.listeners,P=0;P<L.length;P+=2){var F=L[P],B=L[P+1];switch(F){case N.start:null!=B.listener&&B.listener.start&&B.listener.start(B);for(var k=0;k<D.length;k++)D[k].start&&D[k].start(B);break;case N.interrupt:for(null!=B.listener&&B.listener.interrupt&&B.listener.interrupt(B),k=0;k<D.length;k++)D[k].interrupt&&D[k].interrupt(B);break;case N.end:for(null!=B.listener&&B.listener.end&&B.listener.end(B),k=0;k<D.length;k++)D[k].end&&D[k].end(B);case N.dispose:for(null!=B.listener&&B.listener.dispose&&B.listener.dispose(B),k=0;k<D.length;k++)D[k].dispose&&D[k].dispose(B);this.animState.trackEntryPool.free(B);break;case N.complete:for(null!=B.listener&&B.listener.complete&&B.listener.complete(B),k=0;k<D.length;k++)D[k].complete&&D[k].complete(B);break;case N.event:var U=L[2+P++];for(null!=B.listener&&B.listener.event&&B.listener.event(B,U),k=0;k<D.length;k++)D[k].event&&D[k].event(B,U)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();L.EventQueue=F,function(L){L[L.start=0]="start",L[L.interrupt=1]="interrupt",L[L.end=2]="end",L[L.dispose=3]="dispose",L[L.complete=4]="complete",L[L.event=5]="event"}(N=L.EventType||(L.EventType={}));var B=function(){function t(){}return t.prototype.start=function(L){},t.prototype.interrupt=function(L){},t.prototype.end=function(L){},t.prototype.dispose=function(L){},t.prototype.complete=function(L){},t.prototype.event=function(L,D){},t}();L.AnimationStateAdapter=B}(N||(N={})),function(L){var D=function(){function t(L){if(this.animationToMixTime={},this.defaultMix=0,null==L)throw new Error("skeletonData cannot be null.");this.skeletonData=L}return t.prototype.setMix=function(L,D,P){var N=this.skeletonData.findAnimation(L);if(null==N)throw new Error("Animation not found: "+L);var F=this.skeletonData.findAnimation(D);if(null==F)throw new Error("Animation not found: "+D);this.setMixWith(N,F,P)},t.prototype.setMixWith=function(L,D,P){if(null==L)throw new Error("from cannot be null.");if(null==D)throw new Error("to cannot be null.");var N=L.name+"."+D.name;this.animationToMixTime[N]=P},t.prototype.getMix=function(L,D){var P=L.name+"."+D.name,N=this.animationToMixTime[P];return void 0===N?this.defaultMix:N},t}();L.AnimationStateData=D}(N||(N={})),function(L){var D=function(){function e(L,D){void 0===D&&(D=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=L,this.pathPrefix=D}return e.downloadText=function(L,D,P){var N=new XMLHttpRequest;N.open("GET",L,!0),N.onload=function(){200==N.status?D(N.responseText):P(N.status,N.responseText)},N.onerror=function(){P(N.status,N.responseText)},N.send()},e.downloadBinary=function(L,D,P){var N=new XMLHttpRequest;N.open("GET",L,!0),N.responseType="arraybuffer",N.onload=function(){200==N.status?D(new Uint8Array(N.response)):P(N.status,N.responseText)},N.onerror=function(){P(N.status,N.responseText)},N.send()},e.prototype.loadBinary=function(L,D,P){var N=this;void 0===D&&(D=null),void 0===P&&(P=null),L=this.pathPrefix+L,this.toLoad++,e.downloadBinary(L,(function(P){N.assets[L]=P,D&&D(L,P),N.toLoad--,N.loaded++}),(function(D,F){N.errors[L]="Couldn't load binary "+L+": status "+status+", "+F,P&&P(L,"Couldn't load binary "+L+": status "+status+", "+F),N.toLoad--,N.loaded++}))},e.prototype.loadText=function(L,D,P){var N=this;void 0===D&&(D=null),void 0===P&&(P=null),L=this.pathPrefix+L,this.toLoad++,e.downloadText(L,(function(P){N.assets[L]=P,D&&D(L,P),N.toLoad--,N.loaded++}),(function(D,F){N.errors[L]="Couldn't load text "+L+": status "+status+", "+F,P&&P(L,"Couldn't load text "+L+": status "+status+", "+F),N.toLoad--,N.loaded++}))},e.prototype.loadTexture=function(L,D,P){var N=this;void 0===D&&(D=null),void 0===P&&(P=null),L=this.pathPrefix+L,this.toLoad++;var F=new Image;F.crossOrigin="anonymous",F.onload=function(P){var B=N.textureLoader(F);N.assets[L]=B,N.toLoad--,N.loaded++,D&&D(L,F)},F.onerror=function(D){N.errors[L]="Couldn't load image "+L,N.toLoad--,N.loaded++,P&&P(L,"Couldn't load image "+L)},F.src=L},e.prototype.loadTextureData=function(L,D,P,N){var F=this;void 0===P&&(P=null),void 0===N&&(N=null),L=this.pathPrefix+L,this.toLoad++;var B=new Image;B.onload=function(D){var N=F.textureLoader(B);F.assets[L]=N,F.toLoad--,F.loaded++,P&&P(L,B)},B.onerror=function(D){F.errors[L]="Couldn't load image "+L,F.toLoad--,F.loaded++,N&&N(L,"Couldn't load image "+L)},B.src=D},e.prototype.loadTextureAtlas=function(D,P,N){var F=this;void 0===P&&(P=null),void 0===N&&(N=null);var B=D.lastIndexOf("/")>=0?D.substring(0,D.lastIndexOf("/")):"";D=this.pathPrefix+D,this.toLoad++,e.downloadText(D,(function(k){var U={count:0},V=new Array;try{new L.TextureAtlas(k,(function(D){V.push(B+"/"+D);var P=document.createElement("img");return P.width=16,P.height=16,new L.FakeTexture(P)}))}catch(L){var z=L;return F.errors[D]="Couldn't load texture atlas "+D+": "+z.message,N&&N(D,"Couldn't load texture atlas "+D+": "+z.message),F.toLoad--,void F.loaded++}for(var h=function(z){var W=!1;F.loadTexture(z,(function(z,H){if(U.count++,U.count==V.length)if(W)F.errors[D]="Couldn't load texture atlas page "+z+"} of atlas "+D,N&&N(D,"Couldn't load texture atlas page "+z+" of atlas "+D),F.toLoad--,F.loaded++;else try{var G=new L.TextureAtlas(k,(function(L){return F.get(B+"/"+L)}));F.assets[D]=G,P&&P(D,G),F.toLoad--,F.loaded++}catch(L){var X=L;F.errors[D]="Couldn't load texture atlas "+D+": "+X.message,N&&N(D,"Couldn't load texture atlas "+D+": "+X.message),F.toLoad--,F.loaded++}}),(function(L,P){W=!0,U.count++,U.count==V.length&&(F.errors[D]="Couldn't load texture atlas page "+L+"} of atlas "+D,N&&N(D,"Couldn't load texture atlas page "+L+" of atlas "+D),F.toLoad--,F.loaded++)}))},W=0,H=V;W<H.length;W++)h(H[W])}),(function(L,P){F.errors[D]="Couldn't load texture atlas "+D+": status "+status+", "+P,N&&N(D,"Couldn't load texture atlas "+D+": status "+status+", "+P),F.toLoad--,F.loaded++}))},e.prototype.get=function(L){return L=this.pathPrefix+L,this.assets[L]},e.prototype.remove=function(L){L=this.pathPrefix+L;var D=this.assets[L];D.dispose&&D.dispose(),this.assets[L]=null},e.prototype.removeAll=function(){for(var L in this.assets){var D=this.assets[L];D.dispose&&D.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();L.AssetManager=D}(N||(N={})),function(L){var D=function(){function e(L){this.atlas=L}return e.prototype.newRegionAttachment=function(D,P,N){var F=this.atlas.findRegion(N);if(null==F)return null;F.renderObject=F;var B=new L.RegionAttachment(P);return B.setRegion(F),B},e.prototype.newMeshAttachment=function(D,P,N){var F=this.atlas.findRegion(N);if(null==F)return null;F.renderObject=F;var B=new L.MeshAttachment(P);return B.region=F,B},e.prototype.newBoundingBoxAttachment=function(D,P){return new L.BoundingBoxAttachment(P)},e.prototype.newPathAttachment=function(D,P){return new L.PathAttachment(P)},e.prototype.newPointAttachment=function(D,P){return new L.PointAttachment(P)},e.prototype.newClippingAttachment=function(D,P){return new L.ClippingAttachment(P)},e}();L.AtlasAttachmentLoader=D}(N||(N={})),function(L){!function(L){L[L.Normal=0]="Normal",L[L.Additive=1]="Additive",L[L.Multiply=2]="Multiply",L[L.Screen=3]="Screen"}(L.BlendMode||(L.BlendMode={}))}(N||(N={})),function(L){var D=function(){function e(L,D,P){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==L)throw new Error("data cannot be null.");if(null==D)throw new Error("skeleton cannot be null.");this.data=L,this.skeleton=D,this.parent=P,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(D,P,N,F,B,k,U){this.ax=D,this.ay=P,this.arotation=N,this.ascaleX=F,this.ascaleY=B,this.ashearX=k,this.ashearY=U,this.appliedValid=!0;var V=this.parent;if(null==V){var z=this.skeleton,W=N+90+U,H=z.scaleX,G=z.scaleY;return this.a=L.MathUtils.cosDeg(N+k)*F*H,this.b=L.MathUtils.cosDeg(W)*B*H,this.c=L.MathUtils.sinDeg(N+k)*F*G,this.d=L.MathUtils.sinDeg(W)*B*G,this.worldX=D*H+z.x,void(this.worldY=P*G+z.y)}var X=V.a,nt=V.b,ut=V.c,dt=V.d;switch(this.worldX=X*D+nt*P+V.worldX,this.worldY=ut*D+dt*P+V.worldY,this.data.transformMode){case L.TransformMode.Normal:W=N+90+U;var ft=L.MathUtils.cosDeg(N+k)*F,_t=L.MathUtils.cosDeg(W)*B,pt=L.MathUtils.sinDeg(N+k)*F,vt=L.MathUtils.sinDeg(W)*B;return this.a=X*ft+nt*pt,this.b=X*_t+nt*vt,this.c=ut*ft+dt*pt,void(this.d=ut*_t+dt*vt);case L.TransformMode.OnlyTranslation:W=N+90+U,this.a=L.MathUtils.cosDeg(N+k)*F,this.b=L.MathUtils.cosDeg(W)*B,this.c=L.MathUtils.sinDeg(N+k)*F,this.d=L.MathUtils.sinDeg(W)*B;break;case L.TransformMode.NoRotationOrReflection:var gt=0;(Tt=X*X+ut*ut)>1e-4?(nt=ut*(Tt=Math.abs(X*dt-nt*ut)/Tt),dt=X*Tt,gt=Math.atan2(ut,X)*L.MathUtils.radDeg):(X=0,ut=0,gt=90-Math.atan2(dt,nt)*L.MathUtils.radDeg);var mt=N+k-gt,yt=N+U-gt+90;ft=L.MathUtils.cosDeg(mt)*F,_t=L.MathUtils.cosDeg(yt)*B,pt=L.MathUtils.sinDeg(mt)*F,vt=L.MathUtils.sinDeg(yt)*B,this.a=X*ft-nt*pt,this.b=X*_t-nt*vt,this.c=ut*ft+dt*pt,this.d=ut*_t+dt*vt;break;case L.TransformMode.NoScale:case L.TransformMode.NoScaleOrReflection:var Tt,xt=L.MathUtils.cosDeg(N),St=L.MathUtils.sinDeg(N),bt=(X*xt+nt*St)/this.skeleton.scaleX,wt=(ut*xt+dt*St)/this.skeleton.scaleY;(Tt=Math.sqrt(bt*bt+wt*wt))>1e-5&&(Tt=1/Tt),bt*=Tt,wt*=Tt,Tt=Math.sqrt(bt*bt+wt*wt),this.data.transformMode==L.TransformMode.NoScale&&X*dt-nt*ut<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(Tt=-Tt);var Rt=Math.PI/2+Math.atan2(wt,bt),It=Math.cos(Rt)*Tt,Mt=Math.sin(Rt)*Tt;ft=L.MathUtils.cosDeg(k)*F,_t=L.MathUtils.cosDeg(90+U)*B,pt=L.MathUtils.sinDeg(k)*F,vt=L.MathUtils.sinDeg(90+U)*B,this.a=bt*ft+It*pt,this.b=bt*_t+It*vt,this.c=wt*ft+Mt*pt,this.d=wt*_t+Mt*vt}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var L=this.data;this.x=L.x,this.y=L.y,this.rotation=L.rotation,this.scaleX=L.scaleX,this.scaleY=L.scaleY,this.shearX=L.shearX,this.shearY=L.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*L.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*L.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var D=this.parent;if(null==D)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*L.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*L.MathUtils.radDeg);var P=D.a,N=D.b,F=D.c,B=D.d,k=1/(P*B-N*F),U=this.worldX-D.worldX,V=this.worldY-D.worldY;this.ax=U*B*k-V*N*k,this.ay=V*P*k-U*F*k;var z=k*B,W=k*P,H=k*N,G=k*F,X=z*this.a-H*this.c,nt=z*this.b-H*this.d,ut=W*this.c-G*this.a,dt=W*this.d-G*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(X*X+ut*ut),this.ascaleX>1e-4){var ft=X*dt-nt*ut;this.ascaleY=ft/this.ascaleX,this.ashearY=Math.atan2(X*nt+ut*dt,ft)*L.MathUtils.radDeg,this.arotation=Math.atan2(ut,X)*L.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(nt*nt+dt*dt),this.ashearY=0,this.arotation=90-Math.atan2(dt,nt)*L.MathUtils.radDeg},e.prototype.worldToLocal=function(L){var D=this.a,P=this.b,N=this.c,F=this.d,B=1/(D*F-P*N),k=L.x-this.worldX,U=L.y-this.worldY;return L.x=k*F*B-U*P*B,L.y=U*D*B-k*N*B,L},e.prototype.localToWorld=function(L){var D=L.x,P=L.y;return L.x=D*this.a+P*this.b+this.worldX,L.y=D*this.c+P*this.d+this.worldY,L},e.prototype.worldToLocalRotation=function(D){var P=L.MathUtils.sinDeg(D),N=L.MathUtils.cosDeg(D);return Math.atan2(this.a*P-this.c*N,this.d*N-this.b*P)*L.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(D){D-=this.rotation-this.shearX;var P=L.MathUtils.sinDeg(D),N=L.MathUtils.cosDeg(D);return Math.atan2(N*this.c+P*this.d,N*this.a+P*this.b)*L.MathUtils.radDeg},e.prototype.rotateWorld=function(D){var P=this.a,N=this.b,F=this.c,B=this.d,k=L.MathUtils.cosDeg(D),U=L.MathUtils.sinDeg(D);this.a=k*P-U*F,this.b=k*N-U*B,this.c=U*P+k*F,this.d=U*N+k*B,this.appliedValid=!1},e}();L.Bone=D}(N||(N={})),function(L){var D,i=function(P,N,F){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=D.Normal,this.skinRequired=!1,this.color=new L.Color,P<0)throw new Error("index must be >= 0.");if(null==N)throw new Error("name cannot be null.");this.index=P,this.name=N,this.parent=F};L.BoneData=i,function(L){L[L.Normal=0]="Normal",L[L.OnlyTranslation=1]="OnlyTranslation",L[L.NoRotationOrReflection=2]="NoRotationOrReflection",L[L.NoScale=3]="NoScale",L[L.NoScaleOrReflection=4]="NoScaleOrReflection"}(D=L.TransformMode||(L.TransformMode={}))}(N||(N={})),function(L){var e=function(L,D,P){this.name=L,this.order=D,this.skinRequired=P};L.ConstraintData=e}(N||(N={})),function(L){var e=function(L,D){if(null==D)throw new Error("data cannot be null.");this.time=L,this.data=D};L.Event=e}(N||(N={})),function(L){var e=function(L){this.name=L};L.EventData=e}(N||(N={})),function(L){var D=function(){function e(L,D){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==L)throw new Error("data cannot be null.");if(null==D)throw new Error("skeleton cannot be null.");this.data=L,this.mix=L.mix,this.softness=L.softness,this.bendDirection=L.bendDirection,this.compress=L.compress,this.stretch=L.stretch,this.bones=new Array;for(var P=0;P<L.bones.length;P++)this.bones.push(D.findBone(L.bones[P].name));this.target=D.findBone(L.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var L=this.target,D=this.bones;switch(D.length){case 1:this.apply1(D[0],L.worldX,L.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(D[0],D[1],L.worldX,L.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(D,P,N,F,B,k,U){D.appliedValid||D.updateAppliedTransform();var V=D.parent,z=1/(V.a*V.d-V.b*V.c),W=P-V.worldX,H=N-V.worldY,G=(W*V.d-H*V.b)*z-D.ax,X=(H*V.a-W*V.c)*z-D.ay,nt=Math.atan2(X,G)*L.MathUtils.radDeg-D.ashearX-D.arotation;D.ascaleX<0&&(nt+=180),nt>180?nt-=360:nt<-180&&(nt+=360);var ut=D.ascaleX,dt=D.ascaleY;if(F||B){var ft=D.data.length*ut,_t=Math.sqrt(G*G+X*X);if(F&&_t<ft||B&&_t>ft&&ft>1e-4){var pt=(_t/ft-1)*U+1;ut*=pt,k&&(dt*=pt)}}D.updateWorldTransformWith(D.ax,D.ay,D.arotation+nt*U,ut,dt,D.ashearX,D.ashearY)},e.prototype.apply2=function(D,P,N,F,B,k,U,V){if(0!=V){D.appliedValid||D.updateAppliedTransform(),P.appliedValid||P.updateAppliedTransform();var z=D.ax,W=D.ay,H=D.ascaleX,G=H,X=D.ascaleY,nt=P.ascaleX,ut=0,dt=0,ft=0;H<0?(H=-H,ut=180,ft=-1):(ut=0,ft=1),X<0&&(X=-X,ft=-ft),nt<0?(nt=-nt,dt=180):dt=0;var _t=P.ax,pt=0,vt=0,gt=0,mt=D.a,yt=D.b,Tt=D.c,xt=D.d,St=Math.abs(H-X)<=1e-4;St?(vt=mt*_t+yt*(pt=P.ay)+D.worldX,gt=Tt*_t+xt*pt+D.worldY):(pt=0,vt=mt*_t+D.worldX,gt=Tt*_t+D.worldY);var bt=D.parent;mt=bt.a,yt=bt.b,Tt=bt.c;var wt,Rt,It=1/(mt*(xt=bt.d)-yt*Tt),Mt=vt-bt.worldX,Ot=gt-bt.worldY,Lt=(Mt*xt-Ot*yt)*It-z,Dt=(Ot*mt-Mt*Tt)*It-W,Pt=Math.sqrt(Lt*Lt+Dt*Dt),Nt=P.data.length*nt;if(Pt<1e-4)return this.apply1(D,N,F,!1,k,!1,V),void P.updateWorldTransformWith(_t,pt,0,P.ascaleX,P.ascaleY,P.ashearX,P.ashearY);var Ft=((Mt=N-bt.worldX)*xt-(Ot=F-bt.worldY)*yt)*It-z,Bt=(Ot*mt-Mt*Tt)*It-W,kt=Ft*Ft+Bt*Bt;if(0!=U){U*=H*(nt+1)/2;var Ut=Math.sqrt(kt),Vt=Ut-Pt-Nt*H+U;if(Vt>0){var zt=Math.min(1,Vt/(2*U))-1;kt=(Ft-=(zt=(Vt-U*(1-zt*zt))/Ut)*Ft)*Ft+(Bt-=zt*Bt)*Bt}}t:if(St){var Wt=(kt-Pt*Pt-(Nt*=H)*Nt)/(2*Pt*Nt);Wt<-1?Wt=-1:Wt>1&&(Wt=1,k&&(G*=(Math.sqrt(kt)/(Pt+Nt)-1)*V+1)),Rt=Math.acos(Wt)*B,mt=Pt+Nt*Wt,yt=Nt*Math.sin(Rt),wt=Math.atan2(Bt*mt-Ft*yt,Ft*mt+Bt*yt)}else{var Ht=(mt=H*Nt)*mt,Gt=(yt=X*Nt)*yt,Yt=Math.atan2(Bt,Ft),Xt=-2*Gt*Pt,jt=Gt-Ht;if((xt=Xt*Xt-4*jt*(Tt=Gt*Pt*Pt+Ht*kt-Ht*Gt))>=0){var qt=Math.sqrt(xt);Xt<0&&(qt=-qt);var Zt=(qt=-(Xt+qt)/2)/jt,Kt=Tt/qt,Qt=Math.abs(Zt)<Math.abs(Kt)?Zt:Kt;if(Qt*Qt<=kt){Ot=Math.sqrt(kt-Qt*Qt)*B,wt=Yt-Math.atan2(Ot,Qt),Rt=Math.atan2(Ot/X,(Qt-Pt)/H);break t}}var $t=L.MathUtils.PI,Jt=Pt-mt,te=Jt*Jt,ee=0,ie=0,ne=Pt+mt,re=ne*ne,se=0;(Tt=-mt*Pt/(Ht-Gt))>=-1&&Tt<=1&&(Tt=Math.acos(Tt),(xt=(Mt=mt*Math.cos(Tt)+Pt)*Mt+(Ot=yt*Math.sin(Tt))*Ot)<te&&($t=Tt,te=xt,Jt=Mt,ee=Ot),xt>re&&(ie=Tt,re=xt,ne=Mt,se=Ot)),kt<=(te+re)/2?(wt=Yt-Math.atan2(ee*B,Jt),Rt=$t*B):(wt=Yt-Math.atan2(se*B,ne),Rt=ie*B)}var ae=Math.atan2(pt,_t)*ft,oe=D.arotation;(wt=(wt-ae)*L.MathUtils.radDeg+ut-oe)>180?wt-=360:wt<-180&&(wt+=360),D.updateWorldTransformWith(z,W,oe+wt*V,G,D.ascaleY,0,0),oe=P.arotation,(Rt=((Rt+ae)*L.MathUtils.radDeg-P.ashearX)*ft+dt-oe)>180?Rt-=360:Rt<-180&&(Rt+=360),P.updateWorldTransformWith(_t,pt,oe+Rt*V,P.ascaleX,P.ascaleY,P.ashearX,P.ashearY)}else P.updateWorldTransform()},e}();L.IkConstraint=D}(N||(N={})),function(L){var D=function(L){function e(D){var P=L.call(this,D,0,!1)||this;return P.bones=new Array,P.bendDirection=1,P.compress=!1,P.stretch=!1,P.uniform=!1,P.mix=1,P.softness=0,P}return F(e,L),e}(L.ConstraintData);L.IkConstraintData=D}(N||(N={})),function(L){var D=function(){function e(L,D){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==L)throw new Error("data cannot be null.");if(null==D)throw new Error("skeleton cannot be null.");this.data=L,this.bones=new Array;for(var P=0,N=L.bones.length;P<N;P++)this.bones.push(D.findBone(L.bones[P].name));this.target=D.findSlot(L.target.name),this.position=L.position,this.spacing=L.spacing,this.rotateMix=L.rotateMix,this.translateMix=L.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var D=this.target.getAttachment();if(D instanceof L.PathAttachment){var P=this.rotateMix,N=this.translateMix,F=P>0;if(N>0||F){var B=this.data,k=B.spacingMode==L.SpacingMode.Percent,U=B.rotateMode,V=U==L.RotateMode.Tangent,z=U==L.RotateMode.ChainScale,W=this.bones.length,H=V?W:W+1,G=this.bones,X=L.Utils.setArraySize(this.spaces,H),nt=null,ut=this.spacing;if(z||!k){z&&(nt=L.Utils.setArraySize(this.lengths,W));for(var dt=B.spacingMode==L.SpacingMode.Length,ft=0,_t=H-1;ft<_t;){var pt=(It=G[ft]).data.length;if(pt<e.epsilon)z&&(nt[ft]=0),X[++ft]=0;else if(k){if(z){var vt=pt*It.a,gt=pt*It.c,mt=Math.sqrt(vt*vt+gt*gt);nt[ft]=mt}X[++ft]=ut}else{vt=pt*It.a,gt=pt*It.c;var yt=Math.sqrt(vt*vt+gt*gt);z&&(nt[ft]=yt),X[++ft]=(dt?pt+ut:ut)*yt/pt}}}else for(ft=1;ft<H;ft++)X[ft]=ut;var Tt=this.computeWorldPositions(D,H,V,B.positionMode==L.PositionMode.Percent,k),xt=Tt[0],St=Tt[1],bt=B.offsetRotation,wt=!1;0==bt?wt=U==L.RotateMode.Chain:(wt=!1,bt*=(Rt=this.target.bone).a*Rt.d-Rt.b*Rt.c>0?L.MathUtils.degRad:-L.MathUtils.degRad),ft=0;for(var Rt=3;ft<W;ft++,Rt+=3){var It;(It=G[ft]).worldX+=(xt-It.worldX)*N,It.worldY+=(St-It.worldY)*N;var Mt=(vt=Tt[Rt])-xt,Ot=(gt=Tt[Rt+1])-St;if(z){var Lt=nt[ft];if(0!=Lt){var Dt=(Math.sqrt(Mt*Mt+Ot*Ot)/Lt-1)*P+1;It.a*=Dt,It.c*=Dt}}if(xt=vt,St=gt,F){var Pt=It.a,Nt=It.b,Ft=It.c,Bt=It.d,kt=0,Ut=0,Vt=0;if(kt=V?Tt[Rt-1]:0==X[ft+1]?Tt[Rt+2]:Math.atan2(Ot,Mt),kt-=Math.atan2(Ft,Pt),wt){Ut=Math.cos(kt),Vt=Math.sin(kt);var zt=It.data.length;xt+=(zt*(Ut*Pt-Vt*Ft)-Mt)*P,St+=(zt*(Vt*Pt+Ut*Ft)-Ot)*P}else kt+=bt;kt>L.MathUtils.PI?kt-=L.MathUtils.PI2:kt<-L.MathUtils.PI&&(kt+=L.MathUtils.PI2),kt*=P,Ut=Math.cos(kt),Vt=Math.sin(kt),It.a=Ut*Pt-Vt*Ft,It.b=Ut*Nt-Vt*Bt,It.c=Vt*Pt+Ut*Ft,It.d=Vt*Nt+Ut*Bt}It.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(D,P,N,F,B){var k=this.target,U=this.position,V=this.spaces,z=L.Utils.setArraySize(this.positions,3*P+2),W=null,H=D.closed,G=D.worldVerticesLength,X=G/6,nt=e.NONE;if(!D.constantSpeed){var ut=D.lengths,dt=ut[X-=H?1:2];if(F&&(U*=dt),B)for(var ft=1;ft<P;ft++)V[ft]*=dt;W=L.Utils.setArraySize(this.world,8),ft=0;for(var _t=0,pt=0;ft<P;ft++,_t+=3){var vt=U+=Ht=V[ft];if(H)(vt%=dt)<0&&(vt+=dt),pt=0;else{if(vt<0){nt!=e.BEFORE&&(nt=e.BEFORE,D.computeWorldVertices(k,2,4,W,0,2)),this.addBeforePosition(vt,W,0,z,_t);continue}if(vt>dt){nt!=e.AFTER&&(nt=e.AFTER,D.computeWorldVertices(k,G-6,4,W,0,2)),this.addAfterPosition(vt-dt,W,0,z,_t);continue}}for(;;pt++){var gt=ut[pt];if(!(vt>gt)){0==pt?vt/=gt:vt=(vt-(jt=ut[pt-1]))/(gt-jt);break}}pt!=nt&&(nt=pt,H&&pt==X?(D.computeWorldVertices(k,G-4,4,W,0,2),D.computeWorldVertices(k,0,4,W,4,2)):D.computeWorldVertices(k,6*pt+2,8,W,0,2)),this.addCurvePosition(vt,W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],z,_t,N||ft>0&&0==Ht)}return z}H?(G+=2,W=L.Utils.setArraySize(this.world,G),D.computeWorldVertices(k,2,G-4,W,0,2),D.computeWorldVertices(k,0,2,W,G-4,2),W[G-2]=W[0],W[G-1]=W[1]):(X--,G-=4,W=L.Utils.setArraySize(this.world,G),D.computeWorldVertices(k,2,G,W,0,2));for(var mt=L.Utils.setArraySize(this.curves,X),yt=0,Tt=W[0],xt=W[1],St=0,bt=0,wt=0,Rt=0,It=0,Mt=0,Ot=0,Lt=0,Dt=0,Pt=0,Nt=0,Ft=0,Bt=0,kt=0,Ut=(ft=0,2);ft<X;ft++,Ut+=6)St=W[Ut],bt=W[Ut+1],wt=W[Ut+2],Rt=W[Ut+3],Nt=2*(Ot=.1875*(Tt-2*St+wt))+(Dt=.09375*(3*(St-wt)-Tt+(It=W[Ut+4]))),Ft=2*(Lt=.1875*(xt-2*bt+Rt))+(Pt=.09375*(3*(bt-Rt)-xt+(Mt=W[Ut+5]))),Bt=.75*(St-Tt)+Ot+.16666667*Dt,kt=.75*(bt-xt)+Lt+.16666667*Pt,yt+=Math.sqrt(Bt*Bt+kt*kt),Bt+=Nt,kt+=Ft,Nt+=Dt,Ft+=Pt,yt+=Math.sqrt(Bt*Bt+kt*kt),Bt+=Nt,kt+=Ft,yt+=Math.sqrt(Bt*Bt+kt*kt),Bt+=Nt+Dt,kt+=Ft+Pt,yt+=Math.sqrt(Bt*Bt+kt*kt),mt[ft]=yt,Tt=It,xt=Mt;if(U*=F?yt:yt/D.lengths[X-1],B)for(ft=1;ft<P;ft++)V[ft]*=yt;for(var Vt=this.segments,zt=0,Wt=(ft=0,_t=0,pt=0,0);ft<P;ft++,_t+=3){var Ht;if(vt=U+=Ht=V[ft],H)(vt%=yt)<0&&(vt+=yt),pt=0;else{if(vt<0){this.addBeforePosition(vt,W,0,z,_t);continue}if(vt>yt){this.addAfterPosition(vt-yt,W,G-4,z,_t);continue}}for(;;pt++){var Gt=mt[pt];if(!(vt>Gt)){0==pt?vt/=Gt:vt=(vt-(jt=mt[pt-1]))/(Gt-jt);break}}if(pt!=nt){nt=pt;var Yt=6*pt;for(Tt=W[Yt],xt=W[Yt+1],St=W[Yt+2],bt=W[Yt+3],wt=W[Yt+4],Rt=W[Yt+5],Nt=2*(Ot=.03*(Tt-2*St+wt))+(Dt=.006*(3*(St-wt)-Tt+(It=W[Yt+6]))),Ft=2*(Lt=.03*(xt-2*bt+Rt))+(Pt=.006*(3*(bt-Rt)-xt+(Mt=W[Yt+7]))),Bt=.3*(St-Tt)+Ot+.16666667*Dt,kt=.3*(bt-xt)+Lt+.16666667*Pt,zt=Math.sqrt(Bt*Bt+kt*kt),Vt[0]=zt,Yt=1;Yt<8;Yt++)Bt+=Nt,kt+=Ft,Nt+=Dt,Ft+=Pt,zt+=Math.sqrt(Bt*Bt+kt*kt),Vt[Yt]=zt;Bt+=Nt,kt+=Ft,zt+=Math.sqrt(Bt*Bt+kt*kt),Vt[8]=zt,Bt+=Nt+Dt,kt+=Ft+Pt,zt+=Math.sqrt(Bt*Bt+kt*kt),Vt[9]=zt,Wt=0}for(vt*=zt;;Wt++){var Xt=Vt[Wt];if(!(vt>Xt)){var jt;0==Wt?vt/=Xt:vt=Wt+(vt-(jt=Vt[Wt-1]))/(Xt-jt);break}}this.addCurvePosition(.1*vt,Tt,xt,St,bt,wt,Rt,It,Mt,z,_t,N||ft>0&&0==Ht)}return z},e.prototype.addBeforePosition=function(L,D,P,N,F){var B=D[P],k=D[P+1],U=D[P+2]-B,V=D[P+3]-k,z=Math.atan2(V,U);N[F]=B+L*Math.cos(z),N[F+1]=k+L*Math.sin(z),N[F+2]=z},e.prototype.addAfterPosition=function(L,D,P,N,F){var B=D[P+2],k=D[P+3],U=B-D[P],V=k-D[P+1],z=Math.atan2(V,U);N[F]=B+L*Math.cos(z),N[F+1]=k+L*Math.sin(z),N[F+2]=z},e.prototype.addCurvePosition=function(L,D,P,N,F,B,k,U,V,z,W,H){if(0==L||isNaN(L))return z[W]=D,z[W+1]=P,void(z[W+2]=Math.atan2(F-P,N-D));var G=L*L,X=G*L,nt=1-L,ut=nt*nt,dt=ut*nt,ft=nt*L,_t=3*ft,pt=nt*_t,vt=_t*L,gt=D*dt+N*pt+B*vt+U*X,mt=P*dt+F*pt+k*vt+V*X;z[W]=gt,z[W+1]=mt,H&&(z[W+2]=L<.001?Math.atan2(F-P,N-D):Math.atan2(mt-(P*ut+F*ft*2+k*G),gt-(D*ut+N*ft*2+B*G)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();L.PathConstraint=D}(N||(N={})),function(L){var D=function(L){function e(D){var P=L.call(this,D,0,!1)||this;return P.bones=new Array,P}return F(e,L),e}(L.ConstraintData);L.PathConstraintData=D,function(L){L[L.Fixed=0]="Fixed",L[L.Percent=1]="Percent"}(L.PositionMode||(L.PositionMode={})),function(L){L[L.Length=0]="Length",L[L.Fixed=1]="Fixed",L[L.Percent=2]="Percent"}(L.SpacingMode||(L.SpacingMode={})),function(L){L[L.Tangent=0]="Tangent",L[L.Chain=1]="Chain",L[L.ChainScale=2]="ChainScale"}(L.RotateMode||(L.RotateMode={}))}(N||(N={})),function(L){var D=function(){function t(L){this.toLoad=new Array,this.assets={},this.clientId=L}return t.prototype.loaded=function(){var L=0;for(var D in this.assets)L++;return L},t}(),P=function(){function t(L){void 0===L&&(L=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=L}return t.prototype.queueAsset=function(L,P,N){var F=this.clientAssets[L];return null!=F||(F=new D(L),this.clientAssets[L]=F),null!==P&&(F.textureLoader=P),F.toLoad.push(N),this.queuedAssets[N]!==N&&(this.queuedAssets[N]=N,!0)},t.prototype.loadText=function(L,D){var P=this;if(D=this.pathPrefix+D,this.queueAsset(L,null,D)){var N=new XMLHttpRequest;N.onreadystatechange=function(){N.readyState==XMLHttpRequest.DONE&&(N.status>=200&&N.status<300?P.rawAssets[D]=N.responseText:P.errors[D]="Couldn't load text "+D+": status "+N.status+", "+N.responseText)},N.open("GET",D,!0),N.send()}},t.prototype.loadJson=function(L,D){var P=this;if(D=this.pathPrefix+D,this.queueAsset(L,null,D)){var N=new XMLHttpRequest;N.onreadystatechange=function(){N.readyState==XMLHttpRequest.DONE&&(N.status>=200&&N.status<300?P.rawAssets[D]=JSON.parse(N.responseText):P.errors[D]="Couldn't load text "+D+": status "+N.status+", "+N.responseText)},N.open("GET",D,!0),N.send()}},t.prototype.loadTexture=function(L,D,P){var N=this;if(P=this.pathPrefix+P,this.queueAsset(L,D,P)){var F=new Image;F.src=P,F.crossOrigin="anonymous",F.onload=function(L){N.rawAssets[P]=F},F.onerror=function(L){N.errors[P]="Couldn't load image "+P}}},t.prototype.get=function(L,D){D=this.pathPrefix+D;var P=this.clientAssets[L];return null==P||P.assets[D]},t.prototype.updateClientAssets=function(L){for(var D=0;D<L.toLoad.length;D++){var P=L.toLoad[D],N=L.assets[P];if(null==N){var F=this.rawAssets[P];if(null==F)continue;F instanceof HTMLImageElement?L.assets[P]=L.textureLoader(F):L.assets[P]=F}}},t.prototype.isLoadingComplete=function(L){var D=this.clientAssets[L];return null==D||(this.updateClientAssets(D),D.toLoad.length==D.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();L.SharedAssetManager=P}(N||(N={})),function(L){var D=function(){function e(D){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==D)throw new Error("data cannot be null.");this.data=D,this.bones=new Array;for(var P=0;P<D.bones.length;P++){var N=D.bones[P],F=void 0;if(null==N.parent)F=new L.Bone(N,this,null);else{var B=this.bones[N.parent.index];F=new L.Bone(N,this,B),B.children.push(F)}this.bones.push(F)}for(this.slots=new Array,this.drawOrder=new Array,P=0;P<D.slots.length;P++){var k=D.slots[P],U=(F=this.bones[k.boneData.index],new L.Slot(k,F));this.slots.push(U),this.drawOrder.push(U)}for(this.ikConstraints=new Array,P=0;P<D.ikConstraints.length;P++){var V=D.ikConstraints[P];this.ikConstraints.push(new L.IkConstraint(V,this))}for(this.transformConstraints=new Array,P=0;P<D.transformConstraints.length;P++){var z=D.transformConstraints[P];this.transformConstraints.push(new L.TransformConstraint(z,this))}for(this.pathConstraints=new Array,P=0;P<D.pathConstraints.length;P++){var W=D.pathConstraints[P];this.pathConstraints.push(new L.PathConstraint(W,this))}this.color=new L.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var L=this.bones,D=0,P=L.length;D<P;D++)(F=L[D]).sorted=F.data.skinRequired,F.active=!F.sorted;if(null!=this.skin){var N=this.skin.bones;for(D=0,P=this.skin.bones.length;D<P;D++){var F=this.bones[N[D].index];do{F.sorted=!1,F.active=!0,F=F.parent}while(null!=F)}}var B=this.ikConstraints,k=this.transformConstraints,U=this.pathConstraints,V=B.length,z=k.length,W=U.length,H=V+z+W;t:for(D=0;D<H;D++){for(var G=0;G<V;G++)if((X=B[G]).data.order==D){this.sortIkConstraint(X);continue t}for(G=0;G<z;G++)if((X=k[G]).data.order==D){this.sortTransformConstraint(X);continue t}for(G=0;G<W;G++){var X;if((X=U[G]).data.order==D){this.sortPathConstraint(X);continue t}}}for(D=0,P=L.length;D<P;D++)this.sortBone(L[D])},e.prototype.sortIkConstraint=function(D){if(D.active=D.target.isActive()&&(!D.data.skinRequired||null!=this.skin&&L.Utils.contains(this.skin.constraints,D.data,!0)),D.active){var P=D.target;this.sortBone(P);var N=D.bones,F=N[0];if(this.sortBone(F),N.length>1){var B=N[N.length-1];this._updateCache.indexOf(B)>-1||this.updateCacheReset.push(B)}this._updateCache.push(D),this.sortReset(F.children),N[N.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(D){if(D.active=D.target.bone.isActive()&&(!D.data.skinRequired||null!=this.skin&&L.Utils.contains(this.skin.constraints,D.data,!0)),D.active){var P=D.target,N=P.data.index,F=P.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,N,F),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,N,F);for(var B=0,k=this.data.skins.length;B<k;B++)this.sortPathConstraintAttachment(this.data.skins[B],N,F);var U=P.getAttachment();U instanceof L.PathAttachment&&this.sortPathConstraintAttachmentWith(U,F);var V=D.bones,z=V.length;for(B=0;B<z;B++)this.sortBone(V[B]);for(this._updateCache.push(D),B=0;B<z;B++)this.sortReset(V[B].children);for(B=0;B<z;B++)V[B].sorted=!0}},e.prototype.sortTransformConstraint=function(D){if(D.active=D.target.isActive()&&(!D.data.skinRequired||null!=this.skin&&L.Utils.contains(this.skin.constraints,D.data,!0)),D.active){this.sortBone(D.target);var P=D.bones,N=P.length;if(D.data.local)for(var F=0;F<N;F++){var B=P[F];this.sortBone(B.parent),this._updateCache.indexOf(B)>-1||this.updateCacheReset.push(B)}else for(F=0;F<N;F++)this.sortBone(P[F]);this._updateCache.push(D);for(var k=0;k<N;k++)this.sortReset(P[k].children);for(k=0;k<N;k++)P[k].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(L,D,P){var N=L.attachments[D];if(N)for(var F in N)this.sortPathConstraintAttachmentWith(N[F],P)},e.prototype.sortPathConstraintAttachmentWith=function(D,P){if(D instanceof L.PathAttachment){var N=D.bones;if(null==N)this.sortBone(P);else for(var F=this.bones,B=0;B<N.length;)for(var k=N[B++],U=B+k;B<U;B++){var V=N[B];this.sortBone(F[V])}}},e.prototype.sortBone=function(L){if(!L.sorted){var D=L.parent;null!=D&&this.sortBone(D),L.sorted=!0,this._updateCache.push(L)}},e.prototype.sortReset=function(L){for(var D=0,P=L.length;D<P;D++){var N=L[D];N.active&&(N.sorted&&this.sortReset(N.children),N.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var L=this.updateCacheReset,D=0,P=L.length;D<P;D++){var N=L[D];N.ax=N.x,N.ay=N.y,N.arotation=N.rotation,N.ascaleX=N.scaleX,N.ascaleY=N.scaleY,N.ashearX=N.shearX,N.ashearY=N.shearY,N.appliedValid=!0}var F=this._updateCache;for(D=0,P=F.length;D<P;D++)F[D].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var L=this.bones,D=0,P=L.length;D<P;D++)L[D].setToSetupPose();var N=this.ikConstraints;for(D=0,P=N.length;D<P;D++)(U=N[D]).mix=U.data.mix,U.softness=U.data.softness,U.bendDirection=U.data.bendDirection,U.compress=U.data.compress,U.stretch=U.data.stretch;var F=this.transformConstraints;for(D=0,P=F.length;D<P;D++){var B=(U=F[D]).data;U.rotateMix=B.rotateMix,U.translateMix=B.translateMix,U.scaleMix=B.scaleMix,U.shearMix=B.shearMix}var k=this.pathConstraints;for(D=0,P=k.length;D<P;D++){var U;B=(U=k[D]).data,U.position=B.position,U.spacing=B.spacing,U.rotateMix=B.rotateMix,U.translateMix=B.translateMix}},e.prototype.setSlotsToSetupPose=function(){var D=this.slots;L.Utils.arrayCopy(D,0,this.drawOrder,0,D.length);for(var P=0,N=D.length;P<N;P++)D[P].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(L){if(null==L)throw new Error("boneName cannot be null.");for(var D=this.bones,P=0,N=D.length;P<N;P++){var F=D[P];if(F.data.name==L)return F}return null},e.prototype.findBoneIndex=function(L){if(null==L)throw new Error("boneName cannot be null.");for(var D=this.bones,P=0,N=D.length;P<N;P++)if(D[P].data.name==L)return P;return-1},e.prototype.findSlot=function(L){if(null==L)throw new Error("slotName cannot be null.");for(var D=this.slots,P=0,N=D.length;P<N;P++){var F=D[P];if(F.data.name==L)return F}return null},e.prototype.findSlotIndex=function(L){if(null==L)throw new Error("slotName cannot be null.");for(var D=this.slots,P=0,N=D.length;P<N;P++)if(D[P].data.name==L)return P;return-1},e.prototype.setSkinByName=function(L){var D=this.data.findSkin(L);if(null==D)throw new Error("Skin not found: "+L);this.setSkin(D)},e.prototype.setSkin=function(L){if(L!=this.skin){if(null!=L)if(null!=this.skin)L.attachAll(this,this.skin);else for(var D=this.slots,P=0,N=D.length;P<N;P++){var F=D[P],B=F.data.attachmentName;if(null!=B){var k=L.getAttachment(P,B);null!=k&&F.setAttachment(k)}}this.skin=L,this.updateCache()}},e.prototype.getAttachmentByName=function(L,D){return this.getAttachment(this.data.findSlotIndex(L),D)},e.prototype.getAttachment=function(L,D){if(null==D)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var P=this.skin.getAttachment(L,D);if(null!=P)return P}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(L,D):null},e.prototype.setAttachment=function(L,D){if(null==L)throw new Error("slotName cannot be null.");for(var P=this.slots,N=0,F=P.length;N<F;N++){var B=P[N];if(B.data.name==L){var k=null;if(null!=D&&null==(k=this.getAttachment(N,D)))throw new Error("Attachment not found: "+D+", for slot: "+L);return void B.setAttachment(k)}}throw new Error("Slot not found: "+L)},e.prototype.findIkConstraint=function(L){if(null==L)throw new Error("constraintName cannot be null.");for(var D=this.ikConstraints,P=0,N=D.length;P<N;P++){var F=D[P];if(F.data.name==L)return F}return null},e.prototype.findTransformConstraint=function(L){if(null==L)throw new Error("constraintName cannot be null.");for(var D=this.transformConstraints,P=0,N=D.length;P<N;P++){var F=D[P];if(F.data.name==L)return F}return null},e.prototype.findPathConstraint=function(L){if(null==L)throw new Error("constraintName cannot be null.");for(var D=this.pathConstraints,P=0,N=D.length;P<N;P++){var F=D[P];if(F.data.name==L)return F}return null},e.prototype.getBounds=function(D,P,N){if(void 0===N&&(N=new Array(2)),null==D)throw new Error("offset cannot be null.");if(null==P)throw new Error("size cannot be null.");for(var F=this.drawOrder,B=Number.POSITIVE_INFINITY,k=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY,z=0,W=F.length;z<W;z++){var H=F[z];if(H.bone.active){var G=0,X=null,nt=H.getAttachment();if(nt instanceof L.RegionAttachment)G=8,X=L.Utils.setArraySize(N,G,0),nt.computeWorldVertices(H.bone,X,0,2);else if(nt instanceof L.MeshAttachment){var ut=nt;G=ut.worldVerticesLength,X=L.Utils.setArraySize(N,G,0),ut.computeWorldVertices(H,0,G,X,0,2)}if(null!=X)for(var dt=0,ft=X.length;dt<ft;dt+=2){var _t=X[dt],pt=X[dt+1];B=Math.min(B,_t),k=Math.min(k,pt),U=Math.max(U,_t),V=Math.max(V,pt)}}}D.set(B,k),P.set(U-B,V-k)},e.prototype.update=function(L){this.time+=L},e}();L.Skeleton=D}(N||(N={})),function(L){var D=function(){function e(L){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=L}return e.prototype.readSkeletonData=function(D){var N=this.scale,F=new L.SkeletonData;F.name="";var B=new P(D);F.hash=B.readString(),F.version=B.readString(),F.x=B.readFloat(),F.y=B.readFloat(),F.width=B.readFloat(),F.height=B.readFloat();var k=B.readBoolean();k&&(F.fps=B.readFloat(),F.imagesPath=B.readString(),F.audioPath=B.readString());var U=0;U=B.readInt(!0);for(var V=0;V<U;V++)B.strings.push(B.readString());for(U=B.readInt(!0),V=0;V<U;V++){var z=B.readString(),W=0==V?null:F.bones[B.readInt(!0)];(X=new L.BoneData(V,z,W)).rotation=B.readFloat(),X.x=B.readFloat()*N,X.y=B.readFloat()*N,X.scaleX=B.readFloat(),X.scaleY=B.readFloat(),X.shearX=B.readFloat(),X.shearY=B.readFloat(),X.length=B.readFloat()*N,X.transformMode=e.TransformModeValues[B.readInt(!0)],X.skinRequired=B.readBoolean(),k&&L.Color.rgba8888ToColor(X.color,B.readInt32()),F.bones.push(X)}for(U=B.readInt(!0),V=0;V<U;V++){var H=B.readString(),G=F.bones[B.readInt(!0)],X=new L.SlotData(V,H,G);L.Color.rgba8888ToColor(X.color,B.readInt32());var nt=B.readInt32();-1!=nt&&L.Color.rgb888ToColor(X.darkColor=new L.Color,nt),X.attachmentName=B.readStringRef(),X.blendMode=e.BlendModeValues[B.readInt(!0)],F.slots.push(X)}U=B.readInt(!0),V=0;for(var ut=void 0;V<U;V++){(X=new L.IkConstraintData(B.readString())).order=B.readInt(!0),X.skinRequired=B.readBoolean(),ut=B.readInt(!0);for(var dt=0;dt<ut;dt++)X.bones.push(F.bones[B.readInt(!0)]);X.target=F.bones[B.readInt(!0)],X.mix=B.readFloat(),X.softness=B.readFloat()*N,X.bendDirection=B.readByte(),X.compress=B.readBoolean(),X.stretch=B.readBoolean(),X.uniform=B.readBoolean(),F.ikConstraints.push(X)}for(U=B.readInt(!0),V=0,ut=void 0;V<U;V++){for((X=new L.TransformConstraintData(B.readString())).order=B.readInt(!0),X.skinRequired=B.readBoolean(),ut=B.readInt(!0),dt=0;dt<ut;dt++)X.bones.push(F.bones[B.readInt(!0)]);X.target=F.bones[B.readInt(!0)],X.local=B.readBoolean(),X.relative=B.readBoolean(),X.offsetRotation=B.readFloat(),X.offsetX=B.readFloat()*N,X.offsetY=B.readFloat()*N,X.offsetScaleX=B.readFloat(),X.offsetScaleY=B.readFloat(),X.offsetShearY=B.readFloat(),X.rotateMix=B.readFloat(),X.translateMix=B.readFloat(),X.scaleMix=B.readFloat(),X.shearMix=B.readFloat(),F.transformConstraints.push(X)}for(U=B.readInt(!0),V=0,ut=void 0;V<U;V++){for((X=new L.PathConstraintData(B.readString())).order=B.readInt(!0),X.skinRequired=B.readBoolean(),ut=B.readInt(!0),dt=0;dt<ut;dt++)X.bones.push(F.bones[B.readInt(!0)]);X.target=F.slots[B.readInt(!0)],X.positionMode=e.PositionModeValues[B.readInt(!0)],X.spacingMode=e.SpacingModeValues[B.readInt(!0)],X.rotateMode=e.RotateModeValues[B.readInt(!0)],X.offsetRotation=B.readFloat(),X.position=B.readFloat(),X.positionMode==L.PositionMode.Fixed&&(X.position*=N),X.spacing=B.readFloat(),X.spacingMode!=L.SpacingMode.Length&&X.spacingMode!=L.SpacingMode.Fixed||(X.spacing*=N),X.rotateMix=B.readFloat(),X.translateMix=B.readFloat(),F.pathConstraints.push(X)}var ft=this.readSkin(B,F,!0,k);for(null!=ft&&(F.defaultSkin=ft,F.skins.push(ft)),V=F.skins.length,L.Utils.setArraySize(F.skins,U=V+B.readInt(!0));V<U;V++)F.skins[V]=this.readSkin(B,F,!1,k);for(U=this.linkedMeshes.length,V=0;V<U;V++){var _t=this.linkedMeshes[V],pt=null==_t.skin?F.defaultSkin:F.findSkin(_t.skin);if(null==pt)throw new Error("Skin not found: "+_t.skin);var vt=pt.getAttachment(_t.slotIndex,_t.parent);if(null==vt)throw new Error("Parent mesh not found: "+_t.parent);_t.mesh.deformAttachment=_t.inheritDeform?vt:_t.mesh,_t.mesh.setParentMesh(vt),_t.mesh.updateUVs()}for(this.linkedMeshes.length=0,U=B.readInt(!0),V=0;V<U;V++)(X=new L.EventData(B.readStringRef())).intValue=B.readInt(!1),X.floatValue=B.readFloat(),X.stringValue=B.readString(),X.audioPath=B.readString(),null!=X.audioPath&&(X.volume=B.readFloat(),X.balance=B.readFloat()),F.events.push(X);for(U=B.readInt(!0),V=0;V<U;V++)F.animations.push(this.readAnimation(B,B.readString(),F));return F},e.prototype.readSkin=function(D,P,N,F){var B=null,k=0;if(N){if(0==(k=D.readInt(!0)))return null;B=new L.Skin("default")}else{(B=new L.Skin(D.readStringRef())).bones.length=D.readInt(!0);for(var U=0,V=B.bones.length;U<V;U++)B.bones[U]=P.bones[D.readInt(!0)];for(U=0,V=D.readInt(!0);U<V;U++)B.constraints.push(P.ikConstraints[D.readInt(!0)]);for(U=0,V=D.readInt(!0);U<V;U++)B.constraints.push(P.transformConstraints[D.readInt(!0)]);for(U=0,V=D.readInt(!0);U<V;U++)B.constraints.push(P.pathConstraints[D.readInt(!0)]);k=D.readInt(!0)}for(U=0;U<k;U++)for(var z=D.readInt(!0),W=0,H=D.readInt(!0);W<H;W++){var G=D.readStringRef(),X=this.readAttachment(D,P,B,z,G,F);null!=X&&B.setAttachment(z,G,X)}return B},e.prototype.readAttachment=function(D,P,N,F,B,k){var U=this.scale,V=D.readStringRef();null==V&&(V=B);var z=D.readByte();switch(e.AttachmentTypeValues[z]){case L.AttachmentType.Region:var W=D.readStringRef(),H=D.readFloat(),G=D.readFloat(),X=D.readFloat(),nt=D.readFloat(),ut=D.readFloat(),dt=D.readFloat(),ft=D.readFloat(),_t=D.readInt32();null==W&&(W=V);var pt=this.attachmentLoader.newRegionAttachment(N,V,W);return null==pt?null:(pt.path=W,pt.x=G*U,pt.y=X*U,pt.scaleX=nt,pt.scaleY=ut,pt.rotation=H,pt.width=dt*U,pt.height=ft*U,L.Color.rgba8888ToColor(pt.color,_t),pt.updateOffset(),pt);case L.AttachmentType.BoundingBox:var vt=D.readInt(!0),gt=this.readVertices(D,vt),mt=(_t=k?D.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(N,V));return null==mt?null:(mt.worldVerticesLength=vt<<1,mt.vertices=gt.vertices,mt.bones=gt.bones,k&&L.Color.rgba8888ToColor(mt.color,_t),mt);case L.AttachmentType.Mesh:W=D.readStringRef(),_t=D.readInt32(),vt=D.readInt(!0);var yt=this.readFloatArray(D,vt<<1,1),Tt=this.readShortArray(D),xt=(gt=this.readVertices(D,vt),D.readInt(!0)),St=null;return dt=0,ft=0,k&&(St=this.readShortArray(D),dt=D.readFloat(),ft=D.readFloat()),null==W&&(W=V),null==(bt=this.attachmentLoader.newMeshAttachment(N,V,W))?null:(bt.path=W,L.Color.rgba8888ToColor(bt.color,_t),bt.bones=gt.bones,bt.vertices=gt.vertices,bt.worldVerticesLength=vt<<1,bt.triangles=Tt,bt.regionUVs=yt,bt.updateUVs(),bt.hullLength=xt<<1,k&&(bt.edges=St,bt.width=dt*U,bt.height=ft*U),bt);case L.AttachmentType.LinkedMesh:W=D.readStringRef(),_t=D.readInt32();var bt,wt=D.readStringRef(),Rt=D.readStringRef(),It=D.readBoolean();return dt=0,ft=0,k&&(dt=D.readFloat(),ft=D.readFloat()),null==W&&(W=V),null==(bt=this.attachmentLoader.newMeshAttachment(N,V,W))?null:(bt.path=W,L.Color.rgba8888ToColor(bt.color,_t),k&&(bt.width=dt*U,bt.height=ft*U),this.linkedMeshes.push(new n(bt,wt,F,Rt,It)),bt);case L.AttachmentType.Path:for(var Mt=D.readBoolean(),Ot=D.readBoolean(),Lt=(vt=D.readInt(!0),gt=this.readVertices(D,vt),L.Utils.newArray(vt/3,0)),Dt=0,Pt=Lt.length;Dt<Pt;Dt++)Lt[Dt]=D.readFloat()*U;return _t=k?D.readInt32():0,null==(W=this.attachmentLoader.newPathAttachment(N,V))?null:(W.closed=Mt,W.constantSpeed=Ot,W.worldVerticesLength=vt<<1,W.vertices=gt.vertices,W.bones=gt.bones,W.lengths=Lt,k&&L.Color.rgba8888ToColor(W.color,_t),W);case L.AttachmentType.Point:H=D.readFloat(),G=D.readFloat(),X=D.readFloat(),_t=k?D.readInt32():0;var Nt=this.attachmentLoader.newPointAttachment(N,V);return null==Nt?null:(Nt.x=G*U,Nt.y=X*U,Nt.rotation=H,k&&L.Color.rgba8888ToColor(Nt.color,_t),Nt);case L.AttachmentType.Clipping:var Ft=D.readInt(!0),Bt=(vt=D.readInt(!0),gt=this.readVertices(D,vt),_t=k?D.readInt32():0,this.attachmentLoader.newClippingAttachment(N,V));return null==Bt?null:(Bt.endSlot=P.slots[Ft],Bt.worldVerticesLength=vt<<1,Bt.vertices=gt.vertices,Bt.bones=gt.bones,k&&L.Color.rgba8888ToColor(Bt.color,_t),Bt)}return null},e.prototype.readVertices=function(D,P){var N=P<<1,F=new r,B=this.scale;if(!D.readBoolean())return F.vertices=this.readFloatArray(D,N,B),F;for(var k=new Array,U=new Array,V=0;V<P;V++){var z=D.readInt(!0);U.push(z);for(var W=0;W<z;W++)U.push(D.readInt(!0)),k.push(D.readFloat()*B),k.push(D.readFloat()*B),k.push(D.readFloat())}return F.vertices=L.Utils.toFloatArray(k),F.bones=U,F},e.prototype.readFloatArray=function(L,D,P){var N=new Array(D);if(1==P)for(var F=0;F<D;F++)N[F]=L.readFloat();else for(F=0;F<D;F++)N[F]=L.readFloat()*P;return N},e.prototype.readShortArray=function(L){for(var D=L.readInt(!0),P=new Array(D),N=0;N<D;N++)P[N]=L.readShort();return P},e.prototype.readAnimation=function(D,P,N){for(var F=new Array,B=this.scale,k=0,U=new L.Color,V=new L.Color,z=0,W=D.readInt(!0);z<W;z++)for(var H=D.readInt(!0),G=0,X=D.readInt(!0);G<X;G++){var nt=D.readByte(),ut=D.readInt(!0);switch(nt){case e.SLOT_ATTACHMENT:(pt=new L.AttachmentTimeline(ut)).slotIndex=H;for(var dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readStringRef());F.push(pt),k=Math.max(k,pt.frames[ut-1]);break;case e.SLOT_COLOR:for((pt=new L.ColorTimeline(ut)).slotIndex=H,dt=0;dt<ut;dt++){var ft=D.readFloat();L.Color.rgba8888ToColor(U,D.readInt32()),pt.setFrame(dt,ft,U.r,U.g,U.b,U.a),dt<ut-1&&this.readCurve(D,dt,pt)}F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((pt=new L.TwoColorTimeline(ut)).slotIndex=H,dt=0;dt<ut;dt++)ft=D.readFloat(),L.Color.rgba8888ToColor(U,D.readInt32()),L.Color.rgb888ToColor(V,D.readInt32()),pt.setFrame(dt,ft,U.r,U.g,U.b,U.a,V.r,V.g,V.b),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.TwoColorTimeline.ENTRIES])}}for(z=0,W=D.readInt(!0);z<W;z++){var _t=D.readInt(!0);for(G=0,X=D.readInt(!0);G<X;G++)switch(nt=D.readByte(),ut=D.readInt(!0),nt){case e.BONE_ROTATE:for((pt=new L.RotateTimeline(ut)).boneIndex=_t,dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readFloat()),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var pt=void 0,vt=1;for(nt==e.BONE_SCALE?pt=new L.ScaleTimeline(ut):nt==e.BONE_SHEAR?pt=new L.ShearTimeline(ut):(pt=new L.TranslateTimeline(ut),vt=B),pt.boneIndex=_t,dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readFloat()*vt,D.readFloat()*vt),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.TranslateTimeline.ENTRIES])}}for(z=0,W=D.readInt(!0);z<W;z++){var gt=D.readInt(!0);for(ut=D.readInt(!0),(pt=new L.IkConstraintTimeline(ut)).ikConstraintIndex=gt,dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readFloat(),D.readFloat()*B,D.readByte(),D.readBoolean(),D.readBoolean()),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.IkConstraintTimeline.ENTRIES])}for(z=0,W=D.readInt(!0);z<W;z++){for(gt=D.readInt(!0),ut=D.readInt(!0),(pt=new L.TransformConstraintTimeline(ut)).transformConstraintIndex=gt,dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readFloat(),D.readFloat(),D.readFloat(),D.readFloat()),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.TransformConstraintTimeline.ENTRIES])}for(z=0,W=D.readInt(!0);z<W;z++){gt=D.readInt(!0);var mt=N.pathConstraints[gt];for(G=0,X=D.readInt(!0);G<X;G++)switch(nt=D.readByte(),ut=D.readInt(!0),nt){case e.PATH_POSITION:case e.PATH_SPACING:for(pt=void 0,vt=1,nt==e.PATH_SPACING?(pt=new L.PathConstraintSpacingTimeline(ut),mt.spacingMode!=L.SpacingMode.Length&&mt.spacingMode!=L.SpacingMode.Fixed||(vt=B)):(pt=new L.PathConstraintPositionTimeline(ut),mt.positionMode==L.PositionMode.Fixed&&(vt=B)),pt.pathConstraintIndex=gt,dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readFloat()*vt),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((pt=new L.PathConstraintMixTimeline(ut)).pathConstraintIndex=gt,dt=0;dt<ut;dt++)pt.setFrame(dt,D.readFloat(),D.readFloat(),D.readFloat()),dt<ut-1&&this.readCurve(D,dt,pt);F.push(pt),k=Math.max(k,pt.frames[(ut-1)*L.PathConstraintMixTimeline.ENTRIES])}}for(z=0,W=D.readInt(!0);z<W;z++){var yt=N.skins[D.readInt(!0)];for(G=0,X=D.readInt(!0);G<X;G++){H=D.readInt(!0);for(var Tt=0,xt=D.readInt(!0);Tt<xt;Tt++){var St=yt.getAttachment(H,D.readStringRef()),bt=null!=St.bones,wt=St.vertices,Rt=bt?wt.length/3*2:wt.length;for(ut=D.readInt(!0),(pt=new L.DeformTimeline(ut)).slotIndex=H,pt.attachment=St,dt=0;dt<ut;dt++){ft=D.readFloat();var It=void 0,Mt=D.readInt(!0);if(0==Mt)It=bt?L.Utils.newFloatArray(Rt):wt;else{It=L.Utils.newFloatArray(Rt);var Ot=D.readInt(!0);if(Mt+=Ot,1==B)for(var Lt=Ot;Lt<Mt;Lt++)It[Lt]=D.readFloat();else for(Lt=Ot;Lt<Mt;Lt++)It[Lt]=D.readFloat()*B;if(!bt){Lt=0;for(var Dt=It.length;Lt<Dt;Lt++)It[Lt]+=wt[Lt]}}pt.setFrame(dt,ft,It),dt<ut-1&&this.readCurve(D,dt,pt)}F.push(pt),k=Math.max(k,pt.frames[ut-1])}}}var Pt=D.readInt(!0);if(Pt>0){pt=new L.DrawOrderTimeline(Pt);var Nt=N.slots.length;for(z=0;z<Pt;z++){ft=D.readFloat();var Ft=D.readInt(!0),Bt=L.Utils.newArray(Nt,0);for(G=Nt-1;G>=0;G--)Bt[G]=-1;var kt=L.Utils.newArray(Nt-Ft,0),Ut=0,Vt=0;for(G=0;G<Ft;G++){for(H=D.readInt(!0);Ut!=H;)kt[Vt++]=Ut++;Bt[Ut+D.readInt(!0)]=Ut++}for(;Ut<Nt;)kt[Vt++]=Ut++;for(G=Nt-1;G>=0;G--)-1==Bt[G]&&(Bt[G]=kt[--Vt]);pt.setFrame(z,ft,Bt)}F.push(pt),k=Math.max(k,pt.frames[Pt-1])}var zt=D.readInt(!0);if(zt>0){for(pt=new L.EventTimeline(zt),z=0;z<zt;z++){ft=D.readFloat();var Wt=N.events[D.readInt(!0)],Ht=new L.Event(ft,Wt);Ht.intValue=D.readInt(!1),Ht.floatValue=D.readFloat(),Ht.stringValue=D.readBoolean()?D.readString():Wt.stringValue,null!=Ht.data.audioPath&&(Ht.volume=D.readFloat(),Ht.balance=D.readFloat()),pt.setFrame(z,Ht)}F.push(pt),k=Math.max(k,pt.frames[zt-1])}return new L.Animation(P,F,k)},e.prototype.readCurve=function(L,D,P){switch(L.readByte()){case e.CURVE_STEPPED:P.setStepped(D);break;case e.CURVE_BEZIER:this.setCurve(P,D,L.readFloat(),L.readFloat(),L.readFloat(),L.readFloat())}},e.prototype.setCurve=function(L,D,P,N,F,B){L.setCurve(D,P,N,F,B)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[L.TransformMode.Normal,L.TransformMode.OnlyTranslation,L.TransformMode.NoRotationOrReflection,L.TransformMode.NoScale,L.TransformMode.NoScaleOrReflection],e.PositionModeValues=[L.PositionMode.Fixed,L.PositionMode.Percent],e.SpacingModeValues=[L.SpacingMode.Length,L.SpacingMode.Fixed,L.SpacingMode.Percent],e.RotateModeValues=[L.RotateMode.Tangent,L.RotateMode.Chain,L.RotateMode.ChainScale],e.BlendModeValues=[L.BlendMode.Normal,L.BlendMode.Additive,L.BlendMode.Multiply,L.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();L.SkeletonBinary=D;var P=function(){function t(L,D,P,N){void 0===D&&(D=new Array),void 0===P&&(P=0),void 0===N&&(N=new DataView(L.buffer)),this.strings=D,this.index=P,this.buffer=N}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var L=this.buffer.getInt16(this.index);return this.index+=2,L},t.prototype.readInt32=function(){var L=this.buffer.getInt32(this.index);return this.index+=4,L},t.prototype.readInt=function(L){var D=this.readByte(),P=127&D;return 0!=(128&D)&&(P|=(127&(D=this.readByte()))<<7,0!=(128&D)&&(P|=(127&(D=this.readByte()))<<14,0!=(128&D)&&(P|=(127&(D=this.readByte()))<<21,0!=(128&D)&&(P|=(127&(D=this.readByte()))<<28)))),L?P:P>>>1^-(1&P)},t.prototype.readStringRef=function(){var L=this.readInt(!0);return 0==L?null:this.strings[L-1]},t.prototype.readString=function(){var L=this.readInt(!0);switch(L){case 0:return null;case 1:return""}L--;for(var D="",P=0;P<L;){var N=this.readByte();switch(N>>4){case 12:case 13:D+=String.fromCharCode((31&N)<<6|63&this.readByte()),P+=2;break;case 14:D+=String.fromCharCode((15&N)<<12|(63&this.readByte())<<6|63&this.readByte()),P+=3;break;default:D+=String.fromCharCode(N),P++}}return D},t.prototype.readFloat=function(){var L=this.buffer.getFloat32(this.index);return this.index+=4,L},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),n=function(L,D,P,N,F){this.mesh=L,this.skin=D,this.slotIndex=P,this.parent=N,this.inheritDeform=F},r=function(L,D){void 0===L&&(L=null),void 0===D&&(D=null),this.bones=L,this.vertices=D}}(N||(N={})),function(L){var D=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new L.Pool((function(){return L.Utils.newFloatArray(16)}))}return e.prototype.update=function(D,P){if(null==D)throw new Error("skeleton cannot be null.");var N=this.boundingBoxes,F=this.polygons,B=this.polygonPool,k=D.slots,U=k.length;N.length=0,B.freeAll(F),F.length=0;for(var V=0;V<U;V++){var z=k[V];if(z.bone.active){var W=z.getAttachment();if(W instanceof L.BoundingBoxAttachment){var H=W;N.push(H);var G=B.obtain();G.length!=H.worldVerticesLength&&(G=L.Utils.newFloatArray(H.worldVerticesLength)),F.push(G),H.computeWorldVertices(z,0,H.worldVerticesLength,G,0,2)}}}P?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var L=Number.POSITIVE_INFINITY,D=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY,F=this.polygons,B=0,k=F.length;B<k;B++)for(var U=F[B],V=U,z=0,W=U.length;z<W;z+=2){var H=V[z],G=V[z+1];L=Math.min(L,H),D=Math.min(D,G),P=Math.max(P,H),N=Math.max(N,G)}this.minX=L,this.minY=D,this.maxX=P,this.maxY=N},e.prototype.aabbContainsPoint=function(L,D){return L>=this.minX&&L<=this.maxX&&D>=this.minY&&D<=this.maxY},e.prototype.aabbIntersectsSegment=function(L,D,P,N){var F=this.minX,B=this.minY,k=this.maxX,U=this.maxY;if(L<=F&&P<=F||D<=B&&N<=B||L>=k&&P>=k||D>=U&&N>=U)return!1;var V=(N-D)/(P-L),z=V*(F-L)+D;if(z>B&&z<U)return!0;if((z=V*(k-L)+D)>B&&z<U)return!0;var W=(B-D)/V+L;return W>F&&W<k||(W=(U-D)/V+L)>F&&W<k},e.prototype.aabbIntersectsSkeleton=function(L){return this.minX<L.maxX&&this.maxX>L.minX&&this.minY<L.maxY&&this.maxY>L.minY},e.prototype.containsPoint=function(L,D){for(var P=this.polygons,N=0,F=P.length;N<F;N++)if(this.containsPointPolygon(P[N],L,D))return this.boundingBoxes[N];return null},e.prototype.containsPointPolygon=function(L,D,P){for(var N=L,F=L.length,B=F-2,k=!1,U=0;U<F;U+=2){var V=N[U+1],z=N[B+1];if(V<P&&z>=P||z<P&&V>=P){var W=N[U];W+(P-V)/(z-V)*(N[B]-W)<D&&(k=!k)}B=U}return k},e.prototype.intersectsSegment=function(L,D,P,N){for(var F=this.polygons,B=0,k=F.length;B<k;B++)if(this.intersectsSegmentPolygon(F[B],L,D,P,N))return this.boundingBoxes[B];return null},e.prototype.intersectsSegmentPolygon=function(L,D,P,N,F){for(var B=L,k=L.length,U=D-N,V=P-F,z=D*F-P*N,W=B[k-2],H=B[k-1],G=0;G<k;G+=2){var X=B[G],nt=B[G+1],ut=W*nt-H*X,dt=W-X,ft=H-nt,_t=U*ft-V*dt,pt=(z*dt-U*ut)/_t;if((pt>=W&&pt<=X||pt>=X&&pt<=W)&&(pt>=D&&pt<=N||pt>=N&&pt<=D)){var vt=(z*ft-V*ut)/_t;if((vt>=H&&vt<=nt||vt>=nt&&vt<=H)&&(vt>=P&&vt<=F||vt>=F&&vt<=P))return!0}W=X,H=nt}return!1},e.prototype.getPolygon=function(L){if(null==L)throw new Error("boundingBox cannot be null.");var D=this.boundingBoxes.indexOf(L);return-1==D?null:this.polygons[D]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();L.SkeletonBounds=D}(N||(N={})),function(L){var D=function(){function e(){this.triangulator=new L.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(D,P){if(null!=this.clipAttachment)return 0;this.clipAttachment=P;var N=P.worldVerticesLength,F=L.Utils.setArraySize(this.clippingPolygon,N);P.computeWorldVertices(D,0,N,F,0,2);var B=this.clippingPolygon;e.makeClockwise(B);for(var k=this.clippingPolygons=this.triangulator.decompose(B,this.triangulator.triangulate(B)),U=0,V=k.length;U<V;U++){var z=k[U];e.makeClockwise(z),z.push(z[0]),z.push(z[1])}return k.length},e.prototype.clipEndWithSlot=function(L){null!=this.clipAttachment&&this.clipAttachment.endSlot==L.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(D,P,N,F,B,k,U,V,z,W,H,G){var X=this.clipOutput,nt=this.clippedVertices,ut=this.clippedTriangles,dt=this.clippingPolygons,ft=this.clippingPolygons.length,_t=V?12:8,pt=0;W=W||0,H=H||0,G=G||0,nt.length=0,ut.length=0;t:for(var vt=W,gt=W+F;vt<gt;vt+=3){var mt=N[vt]*z,yt=mt+H,Tt=mt+G,xt=D[yt],St=D[yt+1],bt=B[Tt],wt=B[Tt+1];Tt=(mt=N[vt+1]*z)+G;var Rt=D[yt=mt+H],It=D[yt+1],Mt=B[Tt],Ot=B[Tt+1];Tt=(mt=N[vt+2]*z)+G;for(var Lt=D[yt=mt+H],Dt=D[yt+1],Pt=B[Tt],Nt=B[Tt+1],Ft=0;Ft<ft;Ft++){var Bt=nt.length;if(!this.clip(xt,St,Rt,It,Lt,Dt,dt[Ft],X)){(Xt=L.Utils.setArraySize(nt,Bt+3*_t))[Bt]=xt,Xt[Bt+1]=St,Xt[Bt+2]=k.r,Xt[Bt+3]=k.g,Xt[Bt+4]=k.b,Xt[Bt+5]=k.a,V?(Xt[Bt+6]=bt,Xt[Bt+7]=wt,Xt[Bt+8]=U.r,Xt[Bt+9]=U.g,Xt[Bt+10]=U.b,Xt[Bt+11]=U.a,Xt[Bt+12]=Rt,Xt[Bt+13]=It,Xt[Bt+14]=k.r,Xt[Bt+15]=k.g,Xt[Bt+16]=k.b,Xt[Bt+17]=k.a,Xt[Bt+18]=Mt,Xt[Bt+19]=Ot,Xt[Bt+20]=U.r,Xt[Bt+21]=U.g,Xt[Bt+22]=U.b,Xt[Bt+23]=U.a,Xt[Bt+24]=Lt,Xt[Bt+25]=Dt,Xt[Bt+26]=k.r,Xt[Bt+27]=k.g,Xt[Bt+28]=k.b,Xt[Bt+29]=k.a,Xt[Bt+30]=Pt,Xt[Bt+31]=Nt,Xt[Bt+32]=U.r,Xt[Bt+33]=U.g,Xt[Bt+34]=U.b,Xt[Bt+35]=U.a):(Xt[Bt+6]=bt,Xt[Bt+7]=wt,Xt[Bt+8]=Rt,Xt[Bt+9]=It,Xt[Bt+10]=k.r,Xt[Bt+11]=k.g,Xt[Bt+12]=k.b,Xt[Bt+13]=k.a,Xt[Bt+14]=Mt,Xt[Bt+15]=Ot,Xt[Bt+16]=Lt,Xt[Bt+17]=Dt,Xt[Bt+18]=k.r,Xt[Bt+19]=k.g,Xt[Bt+20]=k.b,Xt[Bt+21]=k.a,Xt[Bt+22]=Pt,Xt[Bt+23]=Nt),Bt=ut.length,(ee=L.Utils.setArraySize(ut,Bt+3))[Bt]=pt,ee[Bt+1]=pt+1,ee[Bt+2]=pt+2,pt+=3;continue t}var kt=X.length;if(0!=kt){for(var Ut=It-Dt,Vt=Lt-Rt,zt=xt-Lt,Wt=Dt-St,Ht=1/(Ut*zt+Vt*(St-Dt)),Gt=kt>>1,Yt=this.clipOutput,Xt=L.Utils.setArraySize(nt,Bt+Gt*_t),jt=0;jt<kt;jt+=2){var qt=Yt[jt],Zt=Yt[jt+1];Xt[Bt]=qt,Xt[Bt+1]=Zt,Xt[Bt+2]=k.r,Xt[Bt+3]=k.g,Xt[Bt+4]=k.b,Xt[Bt+5]=k.a;var Kt=qt-Lt,Qt=Zt-Dt,$t=(Ut*Kt+Vt*Qt)*Ht,Jt=(Wt*Kt+zt*Qt)*Ht,te=1-$t-Jt;Xt[Bt+6]=bt*$t+Mt*Jt+Pt*te,Xt[Bt+7]=wt*$t+Ot*Jt+Nt*te,V&&(Xt[Bt+8]=U.r,Xt[Bt+9]=U.g,Xt[Bt+10]=U.b,Xt[Bt+11]=U.a),Bt+=_t}Bt=ut.length;var ee=L.Utils.setArraySize(ut,Bt+3*(Gt-2));for(Gt--,jt=1;jt<Gt;jt++)ee[Bt]=pt,ee[Bt+1]=pt+jt,ee[Bt+2]=pt+jt+1,Bt+=3;pt+=Gt+1}}}},e.prototype.clip=function(L,D,P,N,F,B,k,U){var V=U,z=!1,W=null;k.length%4>=2?(W=U,U=this.scratch):W=this.scratch,W.length=0,W.push(L),W.push(D),W.push(P),W.push(N),W.push(F),W.push(B),W.push(L),W.push(D),U.length=0;for(var H=k,G=k.length-4,X=0;;X+=2){for(var nt=H[X],ut=H[X+1],dt=H[X+2],ft=H[X+3],_t=nt-dt,pt=ut-ft,vt=W,gt=W.length-2,mt=U.length,yt=0;yt<gt;yt+=2){var Tt=vt[yt],xt=vt[yt+1],St=vt[yt+2],bt=vt[yt+3],wt=_t*(bt-ft)-pt*(St-dt)>0;if(_t*(xt-ft)-pt*(Tt-dt)>0){if(wt){U.push(St),U.push(bt);continue}var Rt=(Mt=bt-xt)*(dt-nt)-(Ot=St-Tt)*(ft-ut);if(Math.abs(Rt)>1e-6){var It=(Ot*(ut-xt)-Mt*(nt-Tt))/Rt;U.push(nt+(dt-nt)*It),U.push(ut+(ft-ut)*It)}else U.push(nt),U.push(ut)}else if(wt){var Mt,Ot;Rt=(Mt=bt-xt)*(dt-nt)-(Ot=St-Tt)*(ft-ut),Math.abs(Rt)>1e-6?(It=(Ot*(ut-xt)-Mt*(nt-Tt))/Rt,U.push(nt+(dt-nt)*It),U.push(ut+(ft-ut)*It)):(U.push(nt),U.push(ut)),U.push(St),U.push(bt)}z=!0}if(mt==U.length)return V.length=0,!0;if(U.push(U[0]),U.push(U[1]),X==G)break;var Lt=U;(U=W).length=0,W=Lt}if(V!=U){V.length=0,X=0;for(var Dt=U.length-2;X<Dt;X++)V[X]=U[X]}else V.length=V.length-2;return z},e.makeClockwise=function(L){for(var D=L,P=L.length,N=D[P-2]*D[1]-D[0]*D[P-1],F=0,B=0,k=0,U=0,V=P-3;U<V;U+=2)F=D[U],B=D[U+1],k=D[U+2],N+=F*D[U+3]-k*B;if(!(N<0)){U=0;var z=P-2;for(V=P>>1;U<V;U+=2){var W=D[U],H=D[U+1],G=z-U;D[U]=D[G],D[U+1]=D[G+1],D[G]=W,D[G+1]=H}}},e}();L.SkeletonClipping=D}(N||(N={})),function(L){var D=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(L){if(null==L)throw new Error("boneName cannot be null.");for(var D=this.bones,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findBoneIndex=function(L){if(null==L)throw new Error("boneName cannot be null.");for(var D=this.bones,P=0,N=D.length;P<N;P++)if(D[P].name==L)return P;return-1},t.prototype.findSlot=function(L){if(null==L)throw new Error("slotName cannot be null.");for(var D=this.slots,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findSlotIndex=function(L){if(null==L)throw new Error("slotName cannot be null.");for(var D=this.slots,P=0,N=D.length;P<N;P++)if(D[P].name==L)return P;return-1},t.prototype.findSkin=function(L){if(null==L)throw new Error("skinName cannot be null.");for(var D=this.skins,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findEvent=function(L){if(null==L)throw new Error("eventDataName cannot be null.");for(var D=this.events,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findAnimation=function(L){if(null==L)throw new Error("animationName cannot be null.");for(var D=this.animations,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findIkConstraint=function(L){if(null==L)throw new Error("constraintName cannot be null.");for(var D=this.ikConstraints,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findTransformConstraint=function(L){if(null==L)throw new Error("constraintName cannot be null.");for(var D=this.transformConstraints,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findPathConstraint=function(L){if(null==L)throw new Error("constraintName cannot be null.");for(var D=this.pathConstraints,P=0,N=D.length;P<N;P++){var F=D[P];if(F.name==L)return F}return null},t.prototype.findPathConstraintIndex=function(L){if(null==L)throw new Error("pathConstraintName cannot be null.");for(var D=this.pathConstraints,P=0,N=D.length;P<N;P++)if(D[P].name==L)return P;return-1},t}();L.SkeletonData=D}(N||(N={})),function(L){var D=function(){function e(L){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=L}return e.prototype.readSkeletonData=function(D){var P=this.scale,N=new L.SkeletonData,F="string"==typeof D?JSON.parse(D):D,B=F.skeleton;if(null!=B&&(N.hash=B.hash,N.version=B.spine,N.x=B.x,N.y=B.y,N.width=B.width,N.height=B.height,N.fps=B.fps,N.imagesPath=B.images),F.bones)for(var k=0;k<F.bones.length;k++){var U=F.bones[k],V=null,z=this.getValue(U,"parent",null);if(null!=z&&null==(V=N.findBone(z)))throw new Error("Parent bone not found: "+z);(X=new L.BoneData(N.bones.length,U.name,V)).length=this.getValue(U,"length",0)*P,X.x=this.getValue(U,"x",0)*P,X.y=this.getValue(U,"y",0)*P,X.rotation=this.getValue(U,"rotation",0),X.scaleX=this.getValue(U,"scaleX",1),X.scaleY=this.getValue(U,"scaleY",1),X.shearX=this.getValue(U,"shearX",0),X.shearY=this.getValue(U,"shearY",0),X.transformMode=e.transformModeFromString(this.getValue(U,"transform","normal")),X.skinRequired=this.getValue(U,"skin",!1),N.bones.push(X)}if(F.slots)for(k=0;k<F.slots.length;k++){var W=(wt=F.slots[k]).name,H=wt.bone,G=N.findBone(H);if(null==G)throw new Error("Slot bone not found: "+H);var X=new L.SlotData(N.slots.length,W,G),nt=this.getValue(wt,"color",null);null!=nt&&X.color.setFromString(nt);var ut=this.getValue(wt,"dark",null);null!=ut&&(X.darkColor=new L.Color(1,1,1,1),X.darkColor.setFromString(ut)),X.attachmentName=this.getValue(wt,"attachment",null),X.blendMode=e.blendModeFromString(this.getValue(wt,"blend","normal")),N.slots.push(X)}if(F.ik)for(k=0;k<F.ik.length;k++){var dt=F.ik[k];(X=new L.IkConstraintData(dt.name)).order=this.getValue(dt,"order",0),X.skinRequired=this.getValue(dt,"skin",!1);for(var ft=0;ft<dt.bones.length;ft++){if(H=dt.bones[ft],null==(xt=N.findBone(H)))throw new Error("IK bone not found: "+H);X.bones.push(xt)}var _t=dt.target;if(X.target=N.findBone(_t),null==X.target)throw new Error("IK target bone not found: "+_t);X.mix=this.getValue(dt,"mix",1),X.softness=this.getValue(dt,"softness",0)*P,X.bendDirection=this.getValue(dt,"bendPositive",!0)?1:-1,X.compress=this.getValue(dt,"compress",!1),X.stretch=this.getValue(dt,"stretch",!1),X.uniform=this.getValue(dt,"uniform",!1),N.ikConstraints.push(X)}if(F.transform)for(k=0;k<F.transform.length;k++){for(dt=F.transform[k],(X=new L.TransformConstraintData(dt.name)).order=this.getValue(dt,"order",0),X.skinRequired=this.getValue(dt,"skin",!1),ft=0;ft<dt.bones.length;ft++){if(H=dt.bones[ft],null==(xt=N.findBone(H)))throw new Error("Transform constraint bone not found: "+H);X.bones.push(xt)}if(_t=dt.target,X.target=N.findBone(_t),null==X.target)throw new Error("Transform constraint target bone not found: "+_t);X.local=this.getValue(dt,"local",!1),X.relative=this.getValue(dt,"relative",!1),X.offsetRotation=this.getValue(dt,"rotation",0),X.offsetX=this.getValue(dt,"x",0)*P,X.offsetY=this.getValue(dt,"y",0)*P,X.offsetScaleX=this.getValue(dt,"scaleX",0),X.offsetScaleY=this.getValue(dt,"scaleY",0),X.offsetShearY=this.getValue(dt,"shearY",0),X.rotateMix=this.getValue(dt,"rotateMix",1),X.translateMix=this.getValue(dt,"translateMix",1),X.scaleMix=this.getValue(dt,"scaleMix",1),X.shearMix=this.getValue(dt,"shearMix",1),N.transformConstraints.push(X)}if(F.path)for(k=0;k<F.path.length;k++){for(dt=F.path[k],(X=new L.PathConstraintData(dt.name)).order=this.getValue(dt,"order",0),X.skinRequired=this.getValue(dt,"skin",!1),ft=0;ft<dt.bones.length;ft++){if(H=dt.bones[ft],null==(xt=N.findBone(H)))throw new Error("Transform constraint bone not found: "+H);X.bones.push(xt)}if(_t=dt.target,X.target=N.findSlot(_t),null==X.target)throw new Error("Path target slot not found: "+_t);X.positionMode=e.positionModeFromString(this.getValue(dt,"positionMode","percent")),X.spacingMode=e.spacingModeFromString(this.getValue(dt,"spacingMode","length")),X.rotateMode=e.rotateModeFromString(this.getValue(dt,"rotateMode","tangent")),X.offsetRotation=this.getValue(dt,"rotation",0),X.position=this.getValue(dt,"position",0),X.positionMode==L.PositionMode.Fixed&&(X.position*=P),X.spacing=this.getValue(dt,"spacing",0),X.spacingMode!=L.SpacingMode.Length&&X.spacingMode!=L.SpacingMode.Fixed||(X.spacing*=P),X.rotateMix=this.getValue(dt,"rotateMix",1),X.translateMix=this.getValue(dt,"translateMix",1),N.pathConstraints.push(X)}if(F.skins){var pt=F.skins;if(!(pt instanceof Array)){var vt=[];for(var gt in pt)vt.push({name:gt,attachments:pt[gt]});pt=vt}for(k=0;k<pt.length;k++){var mt=pt[k],yt=new L.Skin(mt.name);if(mt.bones)for(var Tt=0;Tt<mt.bones.length;Tt++){var xt;if(null==(xt=N.findBone(mt.bones[Tt])))throw new Error("Skin bone not found: "+mt.bones[k]);yt.bones.push(xt)}if(mt.ik)for(Tt=0;Tt<mt.ik.length;Tt++){if(null==(St=N.findIkConstraint(mt.ik[Tt])))throw new Error("Skin IK constraint not found: "+mt.ik[k]);yt.constraints.push(St)}if(mt.transform)for(Tt=0;Tt<mt.transform.length;Tt++){if(null==(St=N.findTransformConstraint(mt.transform[Tt])))throw new Error("Skin transform constraint not found: "+mt.transform[k]);yt.constraints.push(St)}if(mt.path)for(Tt=0;Tt<mt.path.length;Tt++){var St;if(null==(St=N.findPathConstraint(mt.path[Tt])))throw new Error("Skin path constraint not found: "+mt.path[k]);yt.constraints.push(St)}for(var W in mt.attachments){var bt=N.findSlot(W);if(null==bt)throw new Error("Slot not found: "+W);var wt=mt.attachments[W];for(var Rt in wt){var It=this.readAttachment(wt[Rt],yt,bt.index,Rt,N);null!=It&&yt.setAttachment(bt.index,Rt,It)}}N.skins.push(yt),"default"==yt.name&&(N.defaultSkin=yt)}}k=0;for(var Mt=this.linkedMeshes.length;k<Mt;k++){var Ot=this.linkedMeshes[k];if(null==(yt=null==Ot.skin?N.defaultSkin:N.findSkin(Ot.skin)))throw new Error("Skin not found: "+Ot.skin);var Lt=yt.getAttachment(Ot.slotIndex,Ot.parent);if(null==Lt)throw new Error("Parent mesh not found: "+Ot.parent);Ot.mesh.deformAttachment=Ot.inheritDeform?Lt:Ot.mesh,Ot.mesh.setParentMesh(Lt),Ot.mesh.updateUVs()}if(this.linkedMeshes.length=0,F.events)for(var Dt in F.events){var Pt=F.events[Dt];(X=new L.EventData(Dt)).intValue=this.getValue(Pt,"int",0),X.floatValue=this.getValue(Pt,"float",0),X.stringValue=this.getValue(Pt,"string",""),X.audioPath=this.getValue(Pt,"audio",null),null!=X.audioPath&&(X.volume=this.getValue(Pt,"volume",1),X.balance=this.getValue(Pt,"balance",0)),N.events.push(X)}if(F.animations)for(var Nt in F.animations){var Ft=F.animations[Nt];this.readAnimation(Ft,Nt,N)}return N},e.prototype.readAttachment=function(D,P,N,F,B){var k=this.scale;switch(F=this.getValue(D,"name",F),this.getValue(D,"type","region")){case"region":var U=this.getValue(D,"path",F),V=this.attachmentLoader.newRegionAttachment(P,F,U);return null==V?null:(V.path=U,V.x=this.getValue(D,"x",0)*k,V.y=this.getValue(D,"y",0)*k,V.scaleX=this.getValue(D,"scaleX",1),V.scaleY=this.getValue(D,"scaleY",1),V.rotation=this.getValue(D,"rotation",0),V.width=D.width*k,V.height=D.height*k,null!=(_t=this.getValue(D,"color",null))&&V.color.setFromString(_t),V.updateOffset(),V);case"boundingbox":var z=this.attachmentLoader.newBoundingBoxAttachment(P,F);return null==z?null:(this.readVertices(D,z,D.vertexCount<<1),null!=(_t=this.getValue(D,"color",null))&&z.color.setFromString(_t),z);case"mesh":case"linkedmesh":U=this.getValue(D,"path",F);var W=this.attachmentLoader.newMeshAttachment(P,F,U);if(null==W)return null;W.path=U,null!=(_t=this.getValue(D,"color",null))&&W.color.setFromString(_t),W.width=this.getValue(D,"width",0)*k,W.height=this.getValue(D,"height",0)*k;var H=this.getValue(D,"parent",null);if(null!=H)return this.linkedMeshes.push(new i(W,this.getValue(D,"skin",null),N,H,this.getValue(D,"deform",!0))),W;var G=D.uvs;return this.readVertices(D,W,G.length),W.triangles=D.triangles,W.regionUVs=G,W.updateUVs(),W.edges=this.getValue(D,"edges",null),W.hullLength=2*this.getValue(D,"hull",0),W;case"path":if(null==(U=this.attachmentLoader.newPathAttachment(P,F)))return null;U.closed=this.getValue(D,"closed",!1),U.constantSpeed=this.getValue(D,"constantSpeed",!0);var X=D.vertexCount;this.readVertices(D,U,X<<1);for(var nt=L.Utils.newArray(X/3,0),ut=0;ut<D.lengths.length;ut++)nt[ut]=D.lengths[ut]*k;return U.lengths=nt,null!=(_t=this.getValue(D,"color",null))&&U.color.setFromString(_t),U;case"point":var dt=this.attachmentLoader.newPointAttachment(P,F);return null==dt?null:(dt.x=this.getValue(D,"x",0)*k,dt.y=this.getValue(D,"y",0)*k,dt.rotation=this.getValue(D,"rotation",0),null!=(_t=this.getValue(D,"color",null))&&dt.color.setFromString(_t),dt);case"clipping":var ft=this.attachmentLoader.newClippingAttachment(P,F);if(null==ft)return null;var _t,pt=this.getValue(D,"end",null);if(null!=pt){var vt=B.findSlot(pt);if(null==vt)throw new Error("Clipping end slot not found: "+pt);ft.endSlot=vt}return X=D.vertexCount,this.readVertices(D,ft,X<<1),null!=(_t=this.getValue(D,"color",null))&&ft.color.setFromString(_t),ft}return null},e.prototype.readVertices=function(D,P,N){var F=this.scale;P.worldVerticesLength=N;var B=D.vertices;if(N!=B.length){var k=new Array,U=new Array;for(H=0,G=B.length;H<G;){var V=B[H++];U.push(V);for(var z=H+4*V;H<z;H+=4)U.push(B[H]),k.push(B[H+1]*F),k.push(B[H+2]*F),k.push(B[H+3])}P.bones=U,P.vertices=L.Utils.toFloatArray(k)}else{var W=L.Utils.toFloatArray(B);if(1!=F)for(var H=0,G=B.length;H<G;H++)W[H]*=F;P.vertices=W}},e.prototype.readAnimation=function(D,P,N){var F=this.scale,B=new Array,k=0;if(D.slots)for(var U in D.slots){var V=D.slots[U];if(-1==(Kt=N.findSlotIndex(U)))throw new Error("Slot not found: "+U);for(var z in V){var W=V[z];if("attachment"==z){(vt=new L.AttachmentTimeline(W.length)).slotIndex=Kt;for(var H=0,G=0;G<W.length;G++){var X=W[G];vt.setFrame(H++,this.getValue(X,"time",0),X.name)}B.push(vt),k=Math.max(k,vt.frames[vt.getFrameCount()-1])}else if("color"==z){for((vt=new L.ColorTimeline(W.length)).slotIndex=Kt,H=0,G=0;G<W.length;G++){X=W[G];var nt=new L.Color;nt.setFromString(X.color),vt.setFrame(H,this.getValue(X,"time",0),nt.r,nt.g,nt.b,nt.a),this.readCurve(X,vt,H),H++}B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.ColorTimeline.ENTRIES])}else{if("twoColor"!=z)throw new Error("Invalid timeline type for a slot: "+z+" ("+U+")");for((vt=new L.TwoColorTimeline(W.length)).slotIndex=Kt,H=0,G=0;G<W.length;G++){X=W[G];var ut=new L.Color,dt=new L.Color;ut.setFromString(X.light),dt.setFromString(X.dark),vt.setFrame(H,this.getValue(X,"time",0),ut.r,ut.g,ut.b,ut.a,dt.r,dt.g,dt.b),this.readCurve(X,vt,H),H++}B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.TwoColorTimeline.ENTRIES])}}}if(D.bones)for(var ft in D.bones){var _t=D.bones[ft],pt=N.findBoneIndex(ft);if(-1==pt)throw new Error("Bone not found: "+ft);for(var z in _t)if(W=_t[z],"rotate"===z){for((vt=new L.RotateTimeline(W.length)).boneIndex=pt,H=0,G=0;G<W.length;G++)X=W[G],vt.setFrame(H,this.getValue(X,"time",0),this.getValue(X,"angle",0)),this.readCurve(X,vt,H),H++;B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.RotateTimeline.ENTRIES])}else{if("translate"!==z&&"scale"!==z&&"shear"!==z)throw new Error("Invalid timeline type for a bone: "+z+" ("+ft+")");var vt=null,gt=1,mt=0;for("scale"===z?(vt=new L.ScaleTimeline(W.length),mt=1):"shear"===z?vt=new L.ShearTimeline(W.length):(vt=new L.TranslateTimeline(W.length),gt=F),vt.boneIndex=pt,H=0,G=0;G<W.length;G++){X=W[G];var yt=this.getValue(X,"x",mt),Tt=this.getValue(X,"y",mt);vt.setFrame(H,this.getValue(X,"time",0),yt*gt,Tt*gt),this.readCurve(X,vt,H),H++}B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.TranslateTimeline.ENTRIES])}}if(D.ik)for(var xt in D.ik){var St=D.ik[xt],bt=N.findIkConstraint(xt);for((vt=new L.IkConstraintTimeline(St.length)).ikConstraintIndex=N.ikConstraints.indexOf(bt),H=0,G=0;G<St.length;G++)X=St[G],vt.setFrame(H,this.getValue(X,"time",0),this.getValue(X,"mix",1),this.getValue(X,"softness",0)*F,this.getValue(X,"bendPositive",!0)?1:-1,this.getValue(X,"compress",!1),this.getValue(X,"stretch",!1)),this.readCurve(X,vt,H),H++;B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.IkConstraintTimeline.ENTRIES])}if(D.transform)for(var xt in D.transform){for(St=D.transform[xt],bt=N.findTransformConstraint(xt),(vt=new L.TransformConstraintTimeline(St.length)).transformConstraintIndex=N.transformConstraints.indexOf(bt),H=0,G=0;G<St.length;G++)X=St[G],vt.setFrame(H,this.getValue(X,"time",0),this.getValue(X,"rotateMix",1),this.getValue(X,"translateMix",1),this.getValue(X,"scaleMix",1),this.getValue(X,"shearMix",1)),this.readCurve(X,vt,H),H++;B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.TransformConstraintTimeline.ENTRIES])}var wt=D.path||D.paths;if(wt)for(var xt in wt){St=wt[xt];var Rt=N.findPathConstraintIndex(xt);if(-1==Rt)throw new Error("Path constraint not found: "+xt);var It=N.pathConstraints[Rt];for(var z in St)if(W=St[z],"position"===z||"spacing"===z){for(vt=null,gt=1,"spacing"===z?(vt=new L.PathConstraintSpacingTimeline(W.length),It.spacingMode!=L.SpacingMode.Length&&It.spacingMode!=L.SpacingMode.Fixed||(gt=F)):(vt=new L.PathConstraintPositionTimeline(W.length),It.positionMode==L.PositionMode.Fixed&&(gt=F)),vt.pathConstraintIndex=Rt,H=0,G=0;G<W.length;G++)X=W[G],vt.setFrame(H,this.getValue(X,"time",0),this.getValue(X,z,0)*gt),this.readCurve(X,vt,H),H++;B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===z){for((vt=new L.PathConstraintMixTimeline(W.length)).pathConstraintIndex=Rt,H=0,G=0;G<W.length;G++)X=W[G],vt.setFrame(H,this.getValue(X,"time",0),this.getValue(X,"rotateMix",1),this.getValue(X,"translateMix",1)),this.readCurve(X,vt,H),H++;B.push(vt),k=Math.max(k,vt.frames[(vt.getFrameCount()-1)*L.PathConstraintMixTimeline.ENTRIES])}}if(D.deform)for(var Mt in D.deform){var Ot=D.deform[Mt],Lt=N.findSkin(Mt);if(null==Lt)throw new Error("Skin not found: "+Mt);for(var U in Ot){if(V=Ot[U],-1==(Kt=N.findSlotIndex(U)))throw new Error("Slot not found: "+V.name);for(var z in V){W=V[z];var Dt=Lt.getAttachment(Kt,z);if(null!=Dt){var Pt=null!=Dt.bones,Nt=Dt.vertices,Ft=Pt?Nt.length/3*2:Nt.length;(vt=new L.DeformTimeline(W.length)).slotIndex=Kt,vt.attachment=Dt,H=0;for(var Bt=0;Bt<W.length;Bt++){X=W[Bt];var kt=void 0,Ut=this.getValue(X,"vertices",null);if(null==Ut)kt=Pt?L.Utils.newFloatArray(Ft):Nt;else{kt=L.Utils.newFloatArray(Ft);var Vt=this.getValue(X,"offset",0);if(L.Utils.arrayCopy(Ut,0,kt,Vt,Ut.length),1!=F)for(var zt=(G=Vt)+Ut.length;G<zt;G++)kt[G]*=F;if(!Pt)for(G=0;G<Ft;G++)kt[G]+=Nt[G]}vt.setFrame(H,this.getValue(X,"time",0),kt),this.readCurve(X,vt,H),H++}B.push(vt),k=Math.max(k,vt.frames[vt.getFrameCount()-1])}}}}var Wt=D.drawOrder;if(null==Wt&&(Wt=D.draworder),null!=Wt){vt=new L.DrawOrderTimeline(Wt.length);var Ht=N.slots.length;for(H=0,Bt=0;Bt<Wt.length;Bt++){var Gt=Wt[Bt],Yt=null,Xt=this.getValue(Gt,"offsets",null);if(null!=Xt){Yt=L.Utils.newArray(Ht,-1);var jt=L.Utils.newArray(Ht-Xt.length,0),qt=0,Zt=0;for(G=0;G<Xt.length;G++){var Kt,Qt=Xt[G];if(-1==(Kt=N.findSlotIndex(Qt.slot)))throw new Error("Slot not found: "+Qt.slot);for(;qt!=Kt;)jt[Zt++]=qt++;Yt[qt+Qt.offset]=qt++}for(;qt<Ht;)jt[Zt++]=qt++;for(G=Ht-1;G>=0;G--)-1==Yt[G]&&(Yt[G]=jt[--Zt])}vt.setFrame(H++,this.getValue(Gt,"time",0),Yt)}B.push(vt),k=Math.max(k,vt.frames[vt.getFrameCount()-1])}if(D.events){for(vt=new L.EventTimeline(D.events.length),H=0,G=0;G<D.events.length;G++){var $t=D.events[G],Jt=N.findEvent($t.name);if(null==Jt)throw new Error("Event not found: "+$t.name);var te=new L.Event(L.Utils.toSinglePrecision(this.getValue($t,"time",0)),Jt);te.intValue=this.getValue($t,"int",Jt.intValue),te.floatValue=this.getValue($t,"float",Jt.floatValue),te.stringValue=this.getValue($t,"string",Jt.stringValue),null!=te.data.audioPath&&(te.volume=this.getValue($t,"volume",1),te.balance=this.getValue($t,"balance",0)),vt.setFrame(H++,te)}B.push(vt),k=Math.max(k,vt.frames[vt.getFrameCount()-1])}if(isNaN(k))throw new Error("Error while parsing animation, duration is NaN");N.animations.push(new L.Animation(P,B,k))},e.prototype.readCurve=function(L,D,P){var N=L.curve;N&&("stepped"==N?D.setStepped(P):"[object Array]"===Object.prototype.toString.call(N)?D.setCurve(P,N[0],N[1],N[2],N[3]):D.setCurve(P,N,this.getValue(L,"c2",0),this.getValue(L,"c3",1),this.getValue(L,"c4",1)))},e.prototype.getValue=function(L,D,P){return void 0!==L[D]?L[D]:P},e.blendModeFromString=function(D){if("normal"==(D=D.toLowerCase()))return L.BlendMode.Normal;if("additive"==D)return L.BlendMode.Additive;if("multiply"==D)return L.BlendMode.Multiply;if("screen"==D)return L.BlendMode.Screen;throw new Error("Unknown blend mode: "+D)},e.positionModeFromString=function(D){if("fixed"==(D=D.toLowerCase()))return L.PositionMode.Fixed;if("percent"==D)return L.PositionMode.Percent;throw new Error("Unknown position mode: "+D)},e.spacingModeFromString=function(D){if("length"==(D=D.toLowerCase()))return L.SpacingMode.Length;if("fixed"==D)return L.SpacingMode.Fixed;if("percent"==D)return L.SpacingMode.Percent;throw new Error("Unknown position mode: "+D)},e.rotateModeFromString=function(D){if("tangent"==(D=D.toLowerCase()))return L.RotateMode.Tangent;if("chain"==D)return L.RotateMode.Chain;if("chainscale"==D)return L.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+D)},e.transformModeFromString=function(D){if("normal"==(D=D.toLowerCase()))return L.TransformMode.Normal;if("onlytranslation"==D)return L.TransformMode.OnlyTranslation;if("norotationorreflection"==D)return L.TransformMode.NoRotationOrReflection;if("noscale"==D)return L.TransformMode.NoScale;if("noscaleorreflection"==D)return L.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+D)},e}();L.SkeletonJson=D;var i=function(L,D,P,N,F){this.mesh=L,this.skin=D,this.slotIndex=P,this.parent=N,this.inheritDeform=F}}(N||(N={})),function(L){var e=function(L,D,P){this.slotIndex=L,this.name=D,this.attachment=P};L.SkinEntry=e;var D=function(){function i(L){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==L)throw new Error("name cannot be null.");this.name=L}return i.prototype.setAttachment=function(L,D,P){if(null==P)throw new Error("attachment cannot be null.");var N=this.attachments;L>=N.length&&(N.length=L+1),N[L]||(N[L]={}),N[L][D]=P},i.prototype.addSkin=function(L){for(var D=0;D<L.bones.length;D++){for(var P=L.bones[D],N=!1,F=0;F<this.bones.length;F++)if(this.bones[F]==P){N=!0;break}N||this.bones.push(P)}for(D=0;D<L.constraints.length;D++){var B=L.constraints[D];for(N=!1,F=0;F<this.constraints.length;F++)if(this.constraints[F]==B){N=!0;break}N||this.constraints.push(B)}var k=L.getAttachments();for(D=0;D<k.length;D++){var U=k[D];this.setAttachment(U.slotIndex,U.name,U.attachment)}},i.prototype.copySkin=function(D){for(var P=0;P<D.bones.length;P++){for(var N=D.bones[P],F=!1,B=0;B<this.bones.length;B++)if(this.bones[B]==N){F=!0;break}F||this.bones.push(N)}for(P=0;P<D.constraints.length;P++){var k=D.constraints[P];for(F=!1,B=0;B<this.constraints.length;B++)if(this.constraints[B]==k){F=!0;break}F||this.constraints.push(k)}var U=D.getAttachments();for(P=0;P<U.length;P++){var V=U[P];null!=V.attachment&&(V.attachment instanceof L.MeshAttachment?(V.attachment=V.attachment.newLinkedMesh(),this.setAttachment(V.slotIndex,V.name,V.attachment)):(V.attachment=V.attachment.copy(),this.setAttachment(V.slotIndex,V.name,V.attachment)))}},i.prototype.getAttachment=function(L,D){var P=this.attachments[L];return P?P[D]:null},i.prototype.removeAttachment=function(L,D){var P=this.attachments[L];P&&(P[D]=null)},i.prototype.getAttachments=function(){for(var L=new Array,D=0;D<this.attachments.length;D++){var P=this.attachments[D];if(P)for(var N in P){var F=P[N];F&&L.push(new e(D,N,F))}}return L},i.prototype.getAttachmentsForSlot=function(L,D){var P=this.attachments[L];if(P)for(var N in P){var F=P[N];F&&D.push(new e(L,N,F))}},i.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},i.prototype.attachAll=function(L,D){for(var P=0,N=0;N<L.slots.length;N++){var F=L.slots[N],B=F.getAttachment();if(B&&P<D.attachments.length){var k=D.attachments[P];for(var U in k)if(B==k[U]){var V=this.getAttachment(P,U);null!=V&&F.setAttachment(V);break}}P++}},i}();L.Skin=D}(N||(N={})),function(L){var D=function(){function e(D,P){if(this.deform=new Array,null==D)throw new Error("data cannot be null.");if(null==P)throw new Error("bone cannot be null.");this.data=D,this.bone=P,this.color=new L.Color,this.darkColor=null==D.darkColor?null:new L.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(L){this.attachment!=L&&(this.attachment=L,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(L){this.attachmentTime=this.bone.skeleton.time-L},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();L.Slot=D}(N||(N={})),function(L){var e=function(D,P,N){if(this.color=new L.Color(1,1,1,1),D<0)throw new Error("index must be >= 0.");if(null==P)throw new Error("name cannot be null.");if(null==N)throw new Error("boneData cannot be null.");this.index=D,this.name=P,this.boneData=N};L.SlotData=e}(N||(N={})),function(L){var D,P,N=function(){function t(L){this._image=L}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(L){switch(L.toLowerCase()){case"nearest":return D.Nearest;case"linear":return D.Linear;case"mipmap":return D.MipMap;case"mipmapnearestnearest":return D.MipMapNearestNearest;case"mipmaplinearnearest":return D.MipMapLinearNearest;case"mipmapnearestlinear":return D.MipMapNearestLinear;case"mipmaplinearlinear":return D.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+L)}},t.wrapFromString=function(L){switch(L.toLowerCase()){case"mirroredtepeat":return P.MirroredRepeat;case"clamptoedge":return P.ClampToEdge;case"repeat":return P.Repeat;default:throw new Error("Unknown texture wrap "+L)}},t}();L.Texture=N,function(L){L[L.Nearest=9728]="Nearest",L[L.Linear=9729]="Linear",L[L.MipMap=9987]="MipMap",L[L.MipMapNearestNearest=9984]="MipMapNearestNearest",L[L.MipMapLinearNearest=9985]="MipMapLinearNearest",L[L.MipMapNearestLinear=9986]="MipMapNearestLinear",L[L.MipMapLinearLinear=9987]="MipMapLinearLinear"}(D=L.TextureFilter||(L.TextureFilter={})),function(L){L[L.MirroredRepeat=33648]="MirroredRepeat",L[L.ClampToEdge=33071]="ClampToEdge",L[L.Repeat=10497]="Repeat"}(P=L.TextureWrap||(L.TextureWrap={}));var s=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};L.TextureRegion=s;var B=function(L){function e(){return null!==L&&L.apply(this,arguments)||this}return F(e,L),e.prototype.setFilters=function(L,D){},e.prototype.setWraps=function(L,D){},e.prototype.dispose=function(){},e}(N);L.FakeTexture=B}(N||(N={})),function(L){var D=function(){function e(L,D){this.pages=new Array,this.regions=new Array,this.load(L,D)}return e.prototype.load=function(D,F){if(null==F)throw new Error("textureLoader cannot be null.");for(var B=new P(D),k=new Array(4),U=null;;){var V=B.readLine();if(null==V)break;if(0==(V=V.trim()).length)U=null;else if(U){var z=new N;z.name=V,z.page=U;var W=B.readValue();"true"==W.toLocaleLowerCase()?z.degrees=90:"false"==W.toLocaleLowerCase()?z.degrees=0:z.degrees=parseFloat(W),z.rotate=90==z.degrees,B.readTuple(k);var H=parseInt(k[0]),G=parseInt(k[1]);B.readTuple(k);var X=parseInt(k[0]),nt=parseInt(k[1]);z.u=H/U.width,z.v=G/U.height,z.rotate?(z.u2=(H+nt)/U.width,z.v2=(G+X)/U.height):(z.u2=(H+X)/U.width,z.v2=(G+nt)/U.height),z.x=H,z.y=G,z.width=Math.abs(X),z.height=Math.abs(nt),4==B.readTuple(k)&&4==B.readTuple(k)&&B.readTuple(k),z.originalWidth=parseInt(k[0]),z.originalHeight=parseInt(k[1]),B.readTuple(k),z.offsetX=parseInt(k[0]),z.offsetY=parseInt(k[1]),z.index=parseInt(B.readValue()),z.texture=U.texture,this.regions.push(z)}else{(U=new n).name=V,2==B.readTuple(k)&&(U.width=parseInt(k[0]),U.height=parseInt(k[1]),B.readTuple(k)),B.readTuple(k),U.minFilter=L.Texture.filterFromString(k[0]),U.magFilter=L.Texture.filterFromString(k[1]);var ut=B.readValue();U.uWrap=L.TextureWrap.ClampToEdge,U.vWrap=L.TextureWrap.ClampToEdge,"x"==ut?U.uWrap=L.TextureWrap.Repeat:"y"==ut?U.vWrap=L.TextureWrap.Repeat:"xy"==ut&&(U.uWrap=U.vWrap=L.TextureWrap.Repeat),U.texture=F(V),U.texture.setFilters(U.minFilter,U.magFilter),U.texture.setWraps(U.uWrap,U.vWrap),U.width=U.texture.getImage().width,U.height=U.texture.getImage().height,this.pages.push(U)}}},e.prototype.findRegion=function(L){for(var D=0;D<this.regions.length;D++)if(this.regions[D].name==L)return this.regions[D];return null},e.prototype.dispose=function(){for(var L=0;L<this.pages.length;L++)this.pages[L].texture.dispose()},e}();L.TextureAtlas=D;var P=function(){function t(L){this.index=0,this.lines=L.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var L=this.readLine(),D=L.indexOf(":");if(-1==D)throw new Error("Invalid line: "+L);return L.substring(D+1).trim()},t.prototype.readTuple=function(L){var D=this.readLine(),P=D.indexOf(":");if(-1==P)throw new Error("Invalid line: "+D);for(var N=0,F=P+1;N<3;N++){var B=D.indexOf(",",F);if(-1==B)break;L[N]=D.substr(F,B-F).trim(),F=B+1}return L[N]=D.substring(F).trim(),N+1},t}(),n=function(){};L.TextureAtlasPage=n;var N=function(L){function e(){return null!==L&&L.apply(this,arguments)||this}return F(e,L),e}(L.TextureRegion);L.TextureAtlasRegion=N}(N||(N={})),function(L){var D=function(){function e(D,P){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new L.Vector2,this.active=!1,null==D)throw new Error("data cannot be null.");if(null==P)throw new Error("skeleton cannot be null.");this.data=D,this.rotateMix=D.rotateMix,this.translateMix=D.translateMix,this.scaleMix=D.scaleMix,this.shearMix=D.shearMix,this.bones=new Array;for(var N=0;N<D.bones.length;N++)this.bones.push(P.findBone(D.bones[N].name));this.target=P.findBone(D.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var D=this.rotateMix,P=this.translateMix,N=this.scaleMix,F=this.shearMix,B=this.target,k=B.a,U=B.b,V=B.c,z=B.d,W=k*z-U*V>0?L.MathUtils.degRad:-L.MathUtils.degRad,H=this.data.offsetRotation*W,G=this.data.offsetShearY*W,X=this.bones,nt=0,ut=X.length;nt<ut;nt++){var dt=X[nt],ft=!1;if(0!=D){var _t=dt.a,pt=dt.b,vt=dt.c,gt=dt.d;(bt=Math.atan2(V,k)-Math.atan2(vt,_t)+H)>L.MathUtils.PI?bt-=L.MathUtils.PI2:bt<-L.MathUtils.PI&&(bt+=L.MathUtils.PI2),bt*=D;var mt=Math.cos(bt),yt=Math.sin(bt);dt.a=mt*_t-yt*vt,dt.b=mt*pt-yt*gt,dt.c=yt*_t+mt*vt,dt.d=yt*pt+mt*gt,ft=!0}if(0!=P){var Tt=this.temp;B.localToWorld(Tt.set(this.data.offsetX,this.data.offsetY)),dt.worldX+=(Tt.x-dt.worldX)*P,dt.worldY+=(Tt.y-dt.worldY)*P,ft=!0}if(N>0){var xt=Math.sqrt(dt.a*dt.a+dt.c*dt.c),St=Math.sqrt(k*k+V*V);xt>1e-5&&(xt=(xt+(St-xt+this.data.offsetScaleX)*N)/xt),dt.a*=xt,dt.c*=xt,xt=Math.sqrt(dt.b*dt.b+dt.d*dt.d),St=Math.sqrt(U*U+z*z),xt>1e-5&&(xt=(xt+(St-xt+this.data.offsetScaleY)*N)/xt),dt.b*=xt,dt.d*=xt,ft=!0}if(F>0){pt=dt.b,gt=dt.d;var bt,wt=Math.atan2(gt,pt);(bt=Math.atan2(z,U)-Math.atan2(V,k)-(wt-Math.atan2(dt.c,dt.a)))>L.MathUtils.PI?bt-=L.MathUtils.PI2:bt<-L.MathUtils.PI&&(bt+=L.MathUtils.PI2),bt=wt+(bt+G)*F,xt=Math.sqrt(pt*pt+gt*gt),dt.b=Math.cos(bt)*xt,dt.d=Math.sin(bt)*xt,ft=!0}ft&&(dt.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var D=this.rotateMix,P=this.translateMix,N=this.scaleMix,F=this.shearMix,B=this.target,k=B.a,U=B.b,V=B.c,z=B.d,W=k*z-U*V>0?L.MathUtils.degRad:-L.MathUtils.degRad,H=this.data.offsetRotation*W,G=this.data.offsetShearY*W,X=this.bones,nt=0,ut=X.length;nt<ut;nt++){var dt,ft=X[nt],_t=!1;if(0!=D){var pt=ft.a,vt=ft.b,gt=ft.c,mt=ft.d;(dt=Math.atan2(V,k)+H)>L.MathUtils.PI?dt-=L.MathUtils.PI2:dt<-L.MathUtils.PI&&(dt+=L.MathUtils.PI2),dt*=D;var yt=Math.cos(dt),Tt=Math.sin(dt);ft.a=yt*pt-Tt*gt,ft.b=yt*vt-Tt*mt,ft.c=Tt*pt+yt*gt,ft.d=Tt*vt+yt*mt,_t=!0}if(0!=P){var xt=this.temp;B.localToWorld(xt.set(this.data.offsetX,this.data.offsetY)),ft.worldX+=xt.x*P,ft.worldY+=xt.y*P,_t=!0}if(N>0){var St=(Math.sqrt(k*k+V*V)-1+this.data.offsetScaleX)*N+1;ft.a*=St,ft.c*=St,St=(Math.sqrt(U*U+z*z)-1+this.data.offsetScaleY)*N+1,ft.b*=St,ft.d*=St,_t=!0}if(F>0)(dt=Math.atan2(z,U)-Math.atan2(V,k))>L.MathUtils.PI?dt-=L.MathUtils.PI2:dt<-L.MathUtils.PI&&(dt+=L.MathUtils.PI2),vt=ft.b,mt=ft.d,dt=Math.atan2(mt,vt)+(dt-L.MathUtils.PI/2+G)*F,St=Math.sqrt(vt*vt+mt*mt),ft.b=Math.cos(dt)*St,ft.d=Math.sin(dt)*St,_t=!0;_t&&(ft.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var L=this.rotateMix,D=this.translateMix,P=this.scaleMix,N=this.shearMix,F=this.target;F.appliedValid||F.updateAppliedTransform();for(var B=this.bones,k=0,U=B.length;k<U;k++){var V=B[k];V.appliedValid||V.updateAppliedTransform();var z=V.arotation;if(0!=L){var W=F.arotation-z+this.data.offsetRotation;z+=(W-=360*(16384-(16384.499999999996-W/360|0)))*L}var H=V.ax,G=V.ay;0!=D&&(H+=(F.ax-H+this.data.offsetX)*D,G+=(F.ay-G+this.data.offsetY)*D);var X=V.ascaleX,nt=V.ascaleY;0!=P&&(X>1e-5&&(X=(X+(F.ascaleX-X+this.data.offsetScaleX)*P)/X),nt>1e-5&&(nt=(nt+(F.ascaleY-nt+this.data.offsetScaleY)*P)/nt));var ut=V.ashearY;0!=N&&(W=F.ashearY-ut+this.data.offsetShearY,W-=360*(16384-(16384.499999999996-W/360|0)),V.shearY+=W*N),V.updateWorldTransformWith(H,G,z,X,nt,V.ashearX,ut)}},e.prototype.applyRelativeLocal=function(){var L=this.rotateMix,D=this.translateMix,P=this.scaleMix,N=this.shearMix,F=this.target;F.appliedValid||F.updateAppliedTransform();for(var B=this.bones,k=0,U=B.length;k<U;k++){var V=B[k];V.appliedValid||V.updateAppliedTransform();var z=V.arotation;0!=L&&(z+=(F.arotation+this.data.offsetRotation)*L);var W=V.ax,H=V.ay;0!=D&&(W+=(F.ax+this.data.offsetX)*D,H+=(F.ay+this.data.offsetY)*D);var G=V.ascaleX,X=V.ascaleY;0!=P&&(G>1e-5&&(G*=(F.ascaleX-1+this.data.offsetScaleX)*P+1),X>1e-5&&(X*=(F.ascaleY-1+this.data.offsetScaleY)*P+1));var nt=V.ashearY;0!=N&&(nt+=(F.ashearY+this.data.offsetShearY)*N),V.updateWorldTransformWith(W,H,z,G,X,V.ashearX,nt)}},e}();L.TransformConstraint=D}(N||(N={})),function(L){var D=function(L){function e(D){var P=L.call(this,D,0,!1)||this;return P.bones=new Array,P.rotateMix=0,P.translateMix=0,P.scaleMix=0,P.shearMix=0,P.offsetRotation=0,P.offsetX=0,P.offsetY=0,P.offsetScaleX=0,P.offsetScaleY=0,P.offsetShearY=0,P.relative=!1,P.local=!1,P}return F(e,L),e}(L.ConstraintData);L.TransformConstraintData=D}(N||(N={})),function(L){var D=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new L.Pool((function(){return new Array})),this.polygonIndicesPool=new L.Pool((function(){return new Array}))}return e.prototype.triangulate=function(L){var D=L,P=L.length>>1,N=this.indicesArray;N.length=0;for(var F=0;F<P;F++)N[F]=F;var B=this.isConcaveArray;B.length=0,F=0;for(var k=P;F<k;++F)B[F]=e.isConcave(F,P,D,N);var U=this.triangles;for(U.length=0;P>3;){for(var V=P-1,z=(F=0,1);;){t:if(!B[F]){for(var W=N[V]<<1,H=N[F]<<1,G=N[z]<<1,X=D[W],nt=D[W+1],ut=D[H],dt=D[H+1],ft=D[G],_t=D[G+1],pt=(z+1)%P;pt!=V;pt=(pt+1)%P)if(B[pt]){var vt=N[pt]<<1,gt=D[vt],mt=D[vt+1];if(e.positiveArea(ft,_t,X,nt,gt,mt)&&e.positiveArea(X,nt,ut,dt,gt,mt)&&e.positiveArea(ut,dt,ft,_t,gt,mt))break t}break}if(0==z){do{if(!B[F])break;F--}while(F>0);break}V=F,F=z,z=(z+1)%P}U.push(N[(P+F-1)%P]),U.push(N[F]),U.push(N[(F+1)%P]),N.splice(F,1),B.splice(F,1);var yt=(--P+F-1)%P,Tt=F==P?0:F;B[yt]=e.isConcave(yt,P,D,N),B[Tt]=e.isConcave(Tt,P,D,N)}return 3==P&&(U.push(N[2]),U.push(N[0]),U.push(N[1])),U},e.prototype.decompose=function(L,D){var P=L,N=this.convexPolygons;this.polygonPool.freeAll(N),N.length=0;var F=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(F),F.length=0;var B=this.polygonIndicesPool.obtain();B.length=0;var k=this.polygonPool.obtain();k.length=0;for(var U=-1,V=0,z=0,W=D.length;z<W;z+=3){var H=D[z]<<1,G=D[z+1]<<1,X=D[z+2]<<1,nt=P[H],ut=P[H+1],dt=P[G],ft=P[G+1],_t=P[X],pt=P[X+1],vt=!1;if(U==H){var gt=k.length-4,mt=e.winding(k[gt],k[gt+1],k[gt+2],k[gt+3],_t,pt),yt=e.winding(_t,pt,k[0],k[1],k[2],k[3]);mt==V&&yt==V&&(k.push(_t),k.push(pt),B.push(X),vt=!0)}vt||(k.length>0?(N.push(k),F.push(B)):(this.polygonPool.free(k),this.polygonIndicesPool.free(B)),(k=this.polygonPool.obtain()).length=0,k.push(nt),k.push(ut),k.push(dt),k.push(ft),k.push(_t),k.push(pt),(B=this.polygonIndicesPool.obtain()).length=0,B.push(H),B.push(G),B.push(X),V=e.winding(nt,ut,dt,ft,_t,pt),U=H)}for(k.length>0&&(N.push(k),F.push(B)),z=0,W=N.length;z<W;z++)if(0!=(B=F[z]).length)for(var Tt=B[0],xt=B[B.length-1],St=(k=N[z])[gt=k.length-4],bt=k[gt+1],wt=k[gt+2],Rt=k[gt+3],It=k[0],Mt=k[1],Ot=k[2],Lt=k[3],Dt=e.winding(St,bt,wt,Rt,It,Mt),Pt=0;Pt<W;Pt++)if(Pt!=z){var Nt=F[Pt];if(3==Nt.length){var Ft=Nt[0],Bt=Nt[1],kt=Nt[2],Ut=N[Pt];_t=Ut[Ut.length-2],pt=Ut[Ut.length-1],Ft==Tt&&Bt==xt&&(mt=e.winding(St,bt,wt,Rt,_t,pt),yt=e.winding(_t,pt,It,Mt,Ot,Lt),mt==Dt&&yt==Dt&&(Ut.length=0,Nt.length=0,k.push(_t),k.push(pt),B.push(kt),St=wt,bt=Rt,wt=_t,Rt=pt,Pt=0))}}for(z=N.length-1;z>=0;z--)0==(k=N[z]).length&&(N.splice(z,1),this.polygonPool.free(k),B=F[z],F.splice(z,1),this.polygonIndicesPool.free(B));return N},e.isConcave=function(L,D,P,N){var F=N[(D+L-1)%D]<<1,B=N[L]<<1,k=N[(L+1)%D]<<1;return!this.positiveArea(P[F],P[F+1],P[B],P[B+1],P[k],P[k+1])},e.positiveArea=function(L,D,P,N,F,B){return L*(B-N)+P*(D-B)+F*(N-D)>=0},e.winding=function(L,D,P,N,F,B){var k=P-L,U=N-D;return F*U-B*k+k*D-L*U>=0?1:-1},e}();L.Triangulator=D}(N||(N={})),function(L){var D=function(){function t(){this.array=new Array}return t.prototype.add=function(L){var D=this.contains(L);return this.array[0|L]=0|L,!D},t.prototype.contains=function(L){return null!=this.array[0|L]},t.prototype.remove=function(L){this.array[0|L]=void 0},t.prototype.clear=function(){this.array.length=0},t}();L.IntSet=D;var P=function(){function t(L,D,P,N){void 0===L&&(L=0),void 0===D&&(D=0),void 0===P&&(P=0),void 0===N&&(N=0),this.r=L,this.g=D,this.b=P,this.a=N}return t.prototype.set=function(L,D,P,N){return this.r=L,this.g=D,this.b=P,this.a=N,this.clamp(),this},t.prototype.setFromColor=function(L){return this.r=L.r,this.g=L.g,this.b=L.b,this.a=L.a,this},t.prototype.setFromString=function(L){return L="#"==L.charAt(0)?L.substr(1):L,this.r=parseInt(L.substr(0,2),16)/255,this.g=parseInt(L.substr(2,2),16)/255,this.b=parseInt(L.substr(4,2),16)/255,this.a=(8!=L.length?255:parseInt(L.substr(6,2),16))/255,this},t.prototype.add=function(L,D,P,N){return this.r+=L,this.g+=D,this.b+=P,this.a+=N,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(L,D){L.r=((4278190080&D)>>>24)/255,L.g=((16711680&D)>>>16)/255,L.b=((65280&D)>>>8)/255,L.a=(255&D)/255},t.rgb888ToColor=function(L,D){L.r=((16711680&D)>>>16)/255,L.g=((65280&D)>>>8)/255,L.b=(255&D)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();L.Color=P;var N=function(){function t(){}return t.clamp=function(L,D,P){return L<D?D:L>P?P:L},t.cosDeg=function(L){return Math.cos(L*t.degRad)},t.sinDeg=function(L){return Math.sin(L*t.degRad)},t.signum=function(L){return L>0?1:L<0?-1:0},t.toInt=function(L){return L>0?Math.floor(L):Math.ceil(L)},t.cbrt=function(L){var D=Math.pow(Math.abs(L),1/3);return L<0?-D:D},t.randomTriangular=function(L,D){return t.randomTriangularWith(L,D,.5*(L+D))},t.randomTriangularWith=function(L,D,P){var N=Math.random(),F=D-L;return N<=(P-L)/F?L+Math.sqrt(N*F*(P-L)):D-Math.sqrt((1-N)*F*(D-P))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();L.MathUtils=N;var B=function(){function t(){}return t.prototype.apply=function(L,D,P){return L+(D-L)*this.applyInternal(P)},t}();L.Interpolation=B;var k=function(L){function e(D){var P=L.call(this)||this;return P.power=2,P.power=D,P}return F(e,L),e.prototype.applyInternal=function(L){return L<=.5?Math.pow(2*L,this.power)/2:Math.pow(2*(L-1),this.power)/(this.power%2==0?-2:2)+1},e}(B);L.Pow=k;var U=function(L){function e(D){return L.call(this,D)||this}return F(e,L),e.prototype.applyInternal=function(L){return Math.pow(L-1,this.power)*(this.power%2==0?-1:1)+1},e}(k);L.PowOut=U;var V=function(){function t(){}return t.arrayCopy=function(L,D,P,N,F){for(var B=D,k=N;B<D+F;B++,k++)P[k]=L[B]},t.setArraySize=function(L,D,P){void 0===P&&(P=0);var N=L.length;if(N==D)return L;if(L.length=D,N<D)for(var F=N;F<D;F++)L[F]=P;return L},t.ensureArrayCapacity=function(L,D,P){return void 0===P&&(P=0),L.length>=D?L:t.setArraySize(L,D,P)},t.newArray=function(L,D){for(var P=new Array(L),N=0;N<L;N++)P[N]=D;return P},t.newFloatArray=function(L){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(L);for(var D=new Array(L),P=0;P<D.length;P++)D[P]=0;return D},t.newShortArray=function(L){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(L);for(var D=new Array(L),P=0;P<D.length;P++)D[P]=0;return D},t.toFloatArray=function(L){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(L):L},t.toSinglePrecision=function(L){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(L):L},t.webkit602BugfixHelper=function(L,D){},t.contains=function(L,D,P){void 0===P&&(P=!0);for(var N=0;N<L.length;N++)if(L[N]==D)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();L.Utils=V;var z=function(){function t(){}return t.logBones=function(L){for(var D=0;D<L.bones.length;D++){var P=L.bones[D];console.log(P.data.name+", "+P.a+", "+P.b+", "+P.c+", "+P.d+", "+P.worldX+", "+P.worldY)}},t}();L.DebugUtils=z;var W=function(){function t(L){this.items=new Array,this.instantiator=L}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(L){L.reset&&L.reset(),this.items.push(L)},t.prototype.freeAll=function(L){for(var D=0;D<L.length;D++)L[D].reset&&L[D].reset(),this.items[D]=L[D]},t.prototype.clear=function(){this.items.length=0},t}();L.Pool=W;var H=function(){function t(L,D){void 0===L&&(L=0),void 0===D&&(D=0),this.x=L,this.y=D}return t.prototype.set=function(L,D){return this.x=L,this.y=D,this},t.prototype.length=function(){var L=this.x,D=this.y;return Math.sqrt(L*L+D*D)},t.prototype.normalize=function(){var L=this.length();return 0!=L&&(this.x/=L,this.y/=L),this},t}();L.Vector2=H;var G=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var L=Date.now()/1e3;this.delta=L-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=L,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();L.TimeKeeper=G;var X=function(){function t(L){void 0===L&&(L=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(L)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(L){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=L,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var L=0,D=0;D<this.values.length;D++)L+=this.values[D];this.mean=L/this.values.length,this.dirty=!1}return this.mean}return 0},t}();L.WindowedMean=X}(N||(N={})),Math.fround||(Math.fround=function(L){return function(D){return L[0]=D,L[0]}}(new Float32Array(1))),function(L){var e=function(L){if(null==L)throw new Error("name cannot be null.");this.name=L};L.Attachment=e;var D=function(D){function i(L){var P=D.call(this,L)||this;return P.id=(65535&i.nextID++)<<11,P.worldVerticesLength=0,P.deformAttachment=P,P}return F(i,D),i.prototype.computeWorldVertices=function(L,D,P,N,F,B){P=F+(P>>1)*B;var k=L.bone.skeleton,U=L.deform,V=this.vertices,z=this.bones;if(null!=z){for(var W=0,H=0,G=0;G<D;G+=2)W+=(dt=z[W])+1,H+=dt;var X=k.bones;if(0==U.length)for(wt=F,Tt=3*H;wt<P;wt+=B){var nt=0,ut=0,dt=z[W++];for(dt+=W;W<dt;W++,Tt+=3){vt=X[z[W]],Rt=V[Tt],It=V[Tt+1];var ft=V[Tt+2];nt+=(Rt*vt.a+It*vt.b+vt.worldX)*ft,ut+=(Rt*vt.c+It*vt.d+vt.worldY)*ft}N[wt]=nt,N[wt+1]=ut}else for(var _t=U,pt=(wt=F,Tt=3*H,H<<1);wt<P;wt+=B){for(nt=0,ut=0,dt=z[W++],dt+=W;W<dt;W++,Tt+=3,pt+=2)vt=X[z[W]],Rt=V[Tt]+_t[pt],It=V[Tt+1]+_t[pt+1],ft=V[Tt+2],nt+=(Rt*vt.a+It*vt.b+vt.worldX)*ft,ut+=(Rt*vt.c+It*vt.d+vt.worldY)*ft;N[wt]=nt,N[wt+1]=ut}}else{U.length>0&&(V=U);for(var vt,gt=(vt=L.bone).worldX,mt=vt.worldY,yt=vt.a,Tt=vt.b,xt=vt.c,St=vt.d,bt=D,wt=F;wt<P;bt+=2,wt+=B){var Rt=V[bt],It=V[bt+1];N[wt]=Rt*yt+It*Tt+gt,N[wt+1]=Rt*xt+It*St+mt}}},i.prototype.copyTo=function(D){null!=this.bones?(D.bones=new Array(this.bones.length),L.Utils.arrayCopy(this.bones,0,D.bones,0,this.bones.length)):D.bones=null,null!=this.vertices?(D.vertices=L.Utils.newFloatArray(this.vertices.length),L.Utils.arrayCopy(this.vertices,0,D.vertices,0,this.vertices.length)):D.vertices=null,D.worldVerticesLength=this.worldVerticesLength,D.deformAttachment=this.deformAttachment},i.nextID=0,i}(e);L.VertexAttachment=D}(N||(N={})),function(L){!function(L){L[L.Region=0]="Region",L[L.BoundingBox=1]="BoundingBox",L[L.Mesh=2]="Mesh",L[L.LinkedMesh=3]="LinkedMesh",L[L.Path=4]="Path",L[L.Point=5]="Point",L[L.Clipping=6]="Clipping"}(L.AttachmentType||(L.AttachmentType={}))}(N||(N={})),function(L){var D=function(D){function i(P){var N=D.call(this,P)||this;return N.color=new L.Color(1,1,1,1),N}return F(i,D),i.prototype.copy=function(){var L=new i(name);return this.copyTo(L),L.color.setFromColor(this.color),L},i}(L.VertexAttachment);L.BoundingBoxAttachment=D}(N||(N={})),function(L){var D=function(D){function i(P){var N=D.call(this,P)||this;return N.color=new L.Color(.2275,.2275,.8078,1),N}return F(i,D),i.prototype.copy=function(){var L=new i(name);return this.copyTo(L),L.endSlot=this.endSlot,L.color.setFromColor(this.color),L},i}(L.VertexAttachment);L.ClippingAttachment=D}(N||(N={})),function(L){var D=function(D){function i(P){var N=D.call(this,P)||this;return N.color=new L.Color(1,1,1,1),N.tempColor=new L.Color(0,0,0,0),N}return F(i,D),i.prototype.updateUVs=function(){var D=this.regionUVs;null!=this.uvs&&this.uvs.length==D.length||(this.uvs=L.Utils.newFloatArray(D.length));var P=this.uvs,N=this.uvs.length,F=this.region.u,B=this.region.v,k=0,U=0;if(this.region instanceof L.TextureAtlasRegion){var V=this.region,z=V.texture.getImage().width,W=V.texture.getImage().height;switch(V.degrees){case 90:F-=(V.originalHeight-V.offsetY-V.height)/z,B-=(V.originalWidth-V.offsetX-V.width)/W,k=V.originalHeight/z,U=V.originalWidth/W;for(var H=0;H<N;H+=2)P[H]=F+D[H+1]*k,P[H+1]=B+(1-D[H])*U;return;case 180:for(F-=(V.originalWidth-V.offsetX-V.width)/z,B-=V.offsetY/W,k=V.originalWidth/z,U=V.originalHeight/W,H=0;H<N;H+=2)P[H]=F+(1-D[H])*k,P[H+1]=B+(1-D[H+1])*U;return;case 270:for(F-=V.offsetY/z,B-=V.offsetX/W,k=V.originalHeight/z,U=V.originalWidth/W,H=0;H<N;H+=2)P[H]=F+(1-D[H+1])*k,P[H+1]=B+D[H]*U;return}F-=V.offsetX/z,B-=(V.originalHeight-V.offsetY-V.height)/W,k=V.originalWidth/z,U=V.originalHeight/W}else null==this.region?(F=B=0,k=U=1):(k=this.region.u2-F,U=this.region.v2-B);for(H=0;H<N;H+=2)P[H]=F+D[H]*k,P[H+1]=B+D[H+1]*U},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(L){this.parentMesh=L,null!=L&&(this.bones=L.bones,this.vertices=L.vertices,this.worldVerticesLength=L.worldVerticesLength,this.regionUVs=L.regionUVs,this.triangles=L.triangles,this.hullLength=L.hullLength,this.worldVerticesLength=L.worldVerticesLength)},i.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var D=new i(this.name);return D.region=this.region,D.path=this.path,D.color.setFromColor(this.color),this.copyTo(D),D.regionUVs=new Array(this.regionUVs.length),L.Utils.arrayCopy(this.regionUVs,0,D.regionUVs,0,this.regionUVs.length),D.uvs=new Array(this.uvs.length),L.Utils.arrayCopy(this.uvs,0,D.uvs,0,this.uvs.length),D.triangles=new Array(this.triangles.length),L.Utils.arrayCopy(this.triangles,0,D.triangles,0,this.triangles.length),D.hullLength=this.hullLength,null!=this.edges&&(D.edges=new Array(this.edges.length),L.Utils.arrayCopy(this.edges,0,D.edges,0,this.edges.length)),D.width=this.width,D.height=this.height,D},i.prototype.newLinkedMesh=function(){var L=new i(this.name);return L.region=this.region,L.path=this.path,L.color.setFromColor(this.color),L.deformAttachment=this.deformAttachment,L.setParentMesh(null!=this.parentMesh?this.parentMesh:this),L.updateUVs(),L},i}(L.VertexAttachment);L.MeshAttachment=D}(N||(N={})),function(L){var D=function(D){function i(P){var N=D.call(this,P)||this;return N.closed=!1,N.constantSpeed=!1,N.color=new L.Color(1,1,1,1),N}return F(i,D),i.prototype.copy=function(){var D=new i(name);return this.copyTo(D),D.lengths=new Array(this.lengths.length),L.Utils.arrayCopy(this.lengths,0,D.lengths,0,this.lengths.length),D.closed=closed,D.constantSpeed=this.constantSpeed,D.color.setFromColor(this.color),D},i}(L.VertexAttachment);L.PathAttachment=D}(N||(N={})),function(L){var D=function(D){function i(P){var N=D.call(this,P)||this;return N.color=new L.Color(.38,.94,0,1),N}return F(i,D),i.prototype.computeWorldPosition=function(L,D){return D.x=this.x*L.a+this.y*L.b+L.worldX,D.y=this.x*L.c+this.y*L.d+L.worldY,D},i.prototype.computeWorldRotation=function(D){var P=L.MathUtils.cosDeg(this.rotation),N=L.MathUtils.sinDeg(this.rotation),F=P*D.a+N*D.b,B=P*D.c+N*D.d;return Math.atan2(B,F)*L.MathUtils.radDeg},i.prototype.copy=function(){var L=new i(name);return L.x=this.x,L.y=this.y,L.rotation=this.rotation,L.color.setFromColor(this.color),L},i}(L.VertexAttachment);L.PointAttachment=D}(N||(N={})),function(L){var D=function(D){function i(P){var N=D.call(this,P)||this;return N.x=0,N.y=0,N.scaleX=1,N.scaleY=1,N.rotation=0,N.width=0,N.height=0,N.color=new L.Color(1,1,1,1),N.offset=L.Utils.newFloatArray(8),N.uvs=L.Utils.newFloatArray(8),N.tempColor=new L.Color(1,1,1,1),N}return F(i,D),i.prototype.updateOffset=function(){var L=this.width/this.region.originalWidth*this.scaleX,D=this.height/this.region.originalHeight*this.scaleY,P=-this.width/2*this.scaleX+this.region.offsetX*L,N=-this.height/2*this.scaleY+this.region.offsetY*D,F=P+this.region.width*L,B=N+this.region.height*D,k=this.rotation*Math.PI/180,U=Math.cos(k),V=Math.sin(k),z=P*U+this.x,W=P*V,H=N*U+this.y,G=N*V,X=F*U+this.x,nt=F*V,ut=B*U+this.y,dt=B*V,ft=this.offset;ft[i.OX1]=z-G,ft[i.OY1]=H+W,ft[i.OX2]=z-dt,ft[i.OY2]=ut+W,ft[i.OX3]=X-dt,ft[i.OY3]=ut+nt,ft[i.OX4]=X-G,ft[i.OY4]=H+nt},i.prototype.setRegion=function(L){this.region=L;var D=this.uvs;L.rotate?(D[2]=L.u,D[3]=L.v2,D[4]=L.u,D[5]=L.v,D[6]=L.u2,D[7]=L.v,D[0]=L.u2,D[1]=L.v2):(D[0]=L.u,D[1]=L.v2,D[2]=L.u,D[3]=L.v,D[4]=L.u2,D[5]=L.v,D[6]=L.u2,D[7]=L.v2)},i.prototype.computeWorldVertices=function(L,D,P,N){var F=this.offset,B=L.worldX,k=L.worldY,U=L.a,V=L.b,z=L.c,W=L.d,H=0,G=0;H=F[i.OX1],G=F[i.OY1],D[P]=H*U+G*V+B,D[P+1]=H*z+G*W+k,P+=N,H=F[i.OX2],G=F[i.OY2],D[P]=H*U+G*V+B,D[P+1]=H*z+G*W+k,P+=N,H=F[i.OX3],G=F[i.OY3],D[P]=H*U+G*V+B,D[P+1]=H*z+G*W+k,P+=N,H=F[i.OX4],G=F[i.OY4],D[P]=H*U+G*V+B,D[P+1]=H*z+G*W+k},i.prototype.copy=function(){var D=new i(name);return D.region=this.region,D.rendererObject=this.rendererObject,D.path=this.path,D.x=this.x,D.y=this.y,D.scaleX=this.scaleX,D.scaleY=this.scaleY,D.rotation=this.rotation,D.width=this.width,D.height=this.height,L.Utils.arrayCopy(this.uvs,0,D.uvs,0,8),L.Utils.arrayCopy(this.offset,0,D.offset,0,8),D.color.setFromColor(this.color),D},i.OX1=0,i.OY1=1,i.OX2=2,i.OY2=3,i.OX3=4,i.OY3=5,i.OX4=6,i.OY4=7,i.X1=0,i.Y1=1,i.C1R=2,i.C1G=3,i.C1B=4,i.C1A=5,i.U1=6,i.V1=7,i.X2=8,i.Y2=9,i.C2R=10,i.C2G=11,i.C2B=12,i.C2A=13,i.U2=14,i.V2=15,i.X3=16,i.Y3=17,i.C3R=18,i.C3G=19,i.C3B=20,i.C3A=21,i.U3=22,i.V3=23,i.X4=24,i.Y4=25,i.C4R=26,i.C4G=27,i.C4B=28,i.C4A=29,i.U4=30,i.V4=31,i}(L.Attachment);L.RegionAttachment=D}(N||(N={})),function(L){var D=function(){function e(L,D){this.jitterX=0,this.jitterY=0,this.jitterX=L,this.jitterY=D}return e.prototype.begin=function(L){},e.prototype.transform=function(D,P,N,F){D.x+=L.MathUtils.randomTriangular(-this.jitterX,this.jitterY),D.y+=L.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();L.JitterEffect=D}(N||(N={})),function(L){var D=function(){function e(L,D){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=L,this.interpolation=D}return e.prototype.begin=function(L){this.worldX=L.x+this.centerX,this.worldY=L.y+this.centerY},e.prototype.transform=function(D,P,N,F){var B=this.angle*L.MathUtils.degreesToRadians,k=D.x-this.worldX,U=D.y-this.worldY,V=Math.sqrt(k*k+U*U);if(V<this.radius){var z=this.interpolation.apply(0,B,(this.radius-V)/this.radius),W=Math.cos(z),H=Math.sin(z);D.x=W*k-H*U+this.worldX,D.y=H*k+W*U+this.worldY}},e.prototype.end=function(){},e.interpolation=new L.PowOut(2),e}();L.SwirlEffect=D}(N||(N={})),D.exports=N},{}],283:[function(L,D,P){"use strict";var N,F,B,k,U,V,z=L("./track-entry-listeners"),W=L("./lib/spine"),H=[],G=[],X=0,nt=0,ut=0,dt=null,ft=null,_t=0,pt=0,vt=0,gt=0,mt=null,yt=null,Tt=0,xt=0,St=new W.Color(1,1,1,1),bt=new W.Color(1,1,1,1),wt=[0,1,2,2,3,0],Rt=cc.Class({ctor:function(){this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null},init:function(L,D){this._inited=!0,this._animationName=D,this._skeletonInfo=L},clear:function(){this._inited=!1;for(var L=0,D=this.frames.length;L<D;L++)this.frames[L].segments.length=0;this.invalidAllFrame()},bind:function(L){var D=function(L){L&&L.animation.name===this._animationName&&(this.isCompleted=!0)}.bind(this);L.complete=D},unbind:function(L){L.complete=null},begin:function(){if(this._invalid){var L=this._skeletonInfo,D=L.curAnimationCache;D&&D!==this&&(this._privateMode?D.invalidAllFrame():D.updateToFrame());var P=L.skeleton,N=L.listener,F=L.state,B=P.data.findAnimation(this._animationName);F.setAnimationWith(0,B,!1),this.bind(N),L.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},end:function(){this._needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},_needToUpdate:function(L){return!this.isCompleted&&this.totalTime<30&&(null==L||this._frameIdx<L)},updateToFrame:function(L){if(this._inited&&(this.begin(),this._needToUpdate(L))){var D=this._skeletonInfo,P=D.skeleton,N=D.clipper,F=D.state;do{P.update(1/60),F.update(1/60),F.apply(P),P.updateWorldTransform(),this._frameIdx++,this._updateFrame(P,N,this._frameIdx),this.totalTime+=1/60}while(this._needToUpdate(L));this.end()}},isInited:function(){return this._inited},isInvalid:function(){return this._invalid},invalidAllFrame:function(){this.isCompleted=!1,this._invalid=!0},updateAllFrame:function(){this.invalidAllFrame(),this.updateToFrame()},enableCacheAttachedInfo:function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},_updateFrame:function(L,D,P){ut=0,X=0,nt=0,dt=null,ft=null,_t=0,pt=0,vt=0,gt=0,mt=null,yt=null,this.frames[P]=this.frames[P]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var N=this.frames[P],F=this._tempSegments=N.segments,B=this._tempColors=N.colors,k=this._tempBoneInfos=N.boneInfos;this._traverseSkeleton(L,D),gt>0&&(B[gt-1].vfOffset=ut),B.length=gt,k.length=X;var U=vt-1;if(U>=0)if(pt>0){var V=F[U];V.indexCount=pt,V.vfCount=6*_t,V.vertexCount=_t,F.length=vt}else F.length=vt-1;if(0!=F.length){var z=N.vertices,W=N.uintVert;(!z||z.length<ut)&&(z=N.vertices=new Float32Array(ut),W=N.uintVert=new Uint32Array(z.buffer));for(var Tt=0,xt=0;Tt<ut;)z[Tt++]=H[xt++],z[Tt++]=H[xt++],z[Tt++]=H[xt++],z[Tt++]=H[xt++],W[Tt++]=H[xt++],W[Tt++]=H[xt++];var St=N.indices;(!St||St.length<nt)&&(St=N.indices=new Uint16Array(nt));for(var bt=0;bt<nt;bt++)St[bt]=G[bt];N.vertices=z,N.uintVert=W,N.indices=St}},fillVertices:function(L,D,P,z,W){if(k=P.a*D.a*L.a*255,N=D.r*L.r*255,F=D.g*L.g*255,B=D.b*L.b*255,St.r=N*P.r,St.g=F*P.g,St.b=B*P.b,St.a=k,null==W.darkColor?bt.set(0,0,0,1):(bt.r=W.darkColor.r*N,bt.g=W.darkColor.g*F,bt.b=W.darkColor.b*B),bt.a=0,U=(St.a<<24>>>0)+(St.b<<16)+(St.g<<8)+St.r,V=(bt.a<<24>>>0)+(bt.b<<16)+(bt.g<<8)+bt.r,mt!==U||yt!==V){var X=this._tempColors;mt=U,yt=V,gt>0&&(X[gt-1].vfOffset=ut),X[gt++]={fr:St.r,fg:St.g,fb:St.b,fa:St.a,dr:bt.r,dg:bt.g,db:bt.b,da:bt.a,vfOffset:0}}if(z.isClipping()){z.clipTriangles(H,Tt,G,xt,H,St,bt,!0,6,nt,ut,ut+2);var dt=z.clippedVertices,ft=z.clippedTriangles;xt=ft.length,Tt=dt.length/12*6;for(var _t=0,pt=nt,vt=ft.length;_t<vt;)G[pt++]=ft[_t++];for(var wt=0,Rt=dt.length,It=ut;wt<Rt;wt+=12,It+=6)H[It]=dt[wt],H[It+1]=dt[wt+1],H[It+2]=dt[wt+6],H[It+3]=dt[wt+7],H[It+4]=U,H[It+5]=V}else for(var Mt=ut,Ot=ut+Tt;Mt<Ot;Mt+=6)H[Mt+4]=U,H[Mt+5]=V},_traverseSkeleton:function(L,D){var P,N,F,B,k,U,V,z,gt,mt,yt,St,bt=this._tempSegments,Rt=this._tempBoneInfos,It=L.color,Mt=L.bones;if(this._enableCacheAttachedInfo)for(var Ot=0,Lt=Mt.length;Ot<Lt;Ot++,X++){var Dt=Mt[Ot],Pt=Rt[X];Pt||(Pt=Rt[X]={}),Pt.a=Dt.a,Pt.b=Dt.b,Pt.c=Dt.c,Pt.d=Dt.d,Pt.worldX=Dt.worldX,Pt.worldY=Dt.worldY}for(var Nt=0,Ft=L.drawOrder.length;Nt<Ft;Nt++)if(St=L.drawOrder[Nt],Tt=0,xt=0,P=St.getAttachment())if(U=P instanceof W.RegionAttachment,V=P instanceof W.MeshAttachment,P instanceof W.ClippingAttachment)D.clipStart(St,P);else if(U||V)if(z=P.region.texture._texture)if(yt=St.data.blendMode,dt===z.url&&ft===yt||(dt=z.url,ft=yt,(gt=vt-1)>=0&&(pt>0?((mt=bt[gt]).indexCount=pt,mt.vertexCount=_t,mt.vfCount=6*_t):vt--),bt[vt]={tex:z,blendMode:yt,indexCount:0,vertexCount:0,vfCount:0},vt++,pt=0,_t=0),U?(k=wt,Tt=24,xt=6,P.computeWorldVertices(St.bone,H,ut,6)):V&&(k=P.triangles,Tt=6*(P.worldVerticesLength>>1),xt=k.length,P.computeWorldVertices(St,0,P.worldVerticesLength,H,ut,6)),0!=Tt&&0!=xt){for(var Bt=0,kt=nt,Ut=k.length;Bt<Ut;)G[kt++]=k[Bt++];B=P.uvs;for(var Vt=ut,zt=ut+Tt,Wt=0;Vt<zt;Vt+=6,Wt+=2)H[Vt+2]=B[Wt],H[Vt+3]=B[Wt+1];if(N=P.color,F=St.color,this.fillVertices(It,N,F,D,St),xt>0){for(var Ht=nt,Gt=nt+xt;Ht<Gt;Ht++)G[Ht]+=_t;nt+=xt,ut+=Tt,pt+=xt,_t+=Tt/6}D.clipEndWithSlot(St)}else D.clipEndWithSlot(St);else D.clipEndWithSlot(St);else D.clipEndWithSlot(St);else D.clipEndWithSlot(St);D.clipEnd()}}),It=cc.Class({ctor:function(){this._privateMode=!1,this._animationPool={},this._skeletonCache={}},enablePrivateMode:function(){this._privateMode=!0},clear:function(){this._animationPool={},this._skeletonCache={}},removeSkeleton:function(L){var D=this._skeletonCache[L];if(D){var P=D.animationsCache;for(var N in P){var F=P[N];F&&(this._animationPool[L+"#"+N]=F,F.clear())}delete this._skeletonCache[L]}},getSkeletonCache:function(L,D){var P=this._skeletonCache[L];if(!P){var N=new W.Skeleton(D),F=new W.SkeletonClipping,B=new W.AnimationStateData(N.data),k=new W.AnimationState(B),U=new z;k.addListener(U),this._skeletonCache[L]=P={skeleton:N,clipper:F,state:k,listener:U,animationsCache:{},curAnimationCache:null}}return P},getAnimationCache:function(L,D){var P=this._skeletonCache[L];return P?P.animationsCache[D]:null},invalidAnimationCache:function(L){var D=this._skeletonCache[L];if(D&&D.skeleton){var P=D.animationsCache;for(var N in P)P[N].invalidAllFrame()}},initAnimationCache:function(L,D){if(!D)return null;var P=this._skeletonCache[L],N=P&&P.skeleton;if(!N)return null;if(!N.data.findAnimation(D))return null;var F=P.animationsCache,B=F[D];if(!B){var k=L+"#"+D;(B=this._animationPool[k])?delete this._animationPool[k]:(B=new Rt)._privateMode=this._privateMode,B.init(P,D),F[D]=B}return B},updateAnimationCache:function(L,D){if(D){var P=this.initAnimationCache(L,D);if(!P)return null;P.updateAllFrame()}else{var N=this._skeletonCache[L];if(!N||!N.skeleton)return;var F=N.animationsCache;for(var B in F)F[B].updateAllFrame()}}});It.FrameTime=1/60,It.sharedCache=new It,D.exports=It},{"./lib/spine":282,"./track-entry-listeners":287}],284:[function(L,D,P){"use strict";var N=L("./skeleton-cache").sharedCache,F=cc.Class({name:"sp.SkeletonData",extends:cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJsonStr:{get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},skeletonJson:{get:function(){return this._skeletonJson},set:function(L){this.reset(),this._skeletonJson="string"==typeof L?JSON.parse(L):L,!this._uuid&&L.skeleton&&(this._uuid=L.skeleton.hash)}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(L){this._atlasText=L,this.reset()}},textures:{default:[],type:[cc.Texture2D]},textureNames:{default:[],type:[cc.String]},scale:1,_nativeAsset:{get:function(){return this._buffer},set:function(L){this._buffer=L.buffer||L,this.reset()},override:!0}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){this._skeletonCache=null,this._atlasCache=null},ensureTexturesLoaded:function(L,D){var P=this.textures,N=P.length;if(0!=N)for(var F=0,s=function(){++F>=N&&(L&&L.call(D,!0),L=null)},B=0;B<N;B++){var k=P[B];k.loaded?s():k.once("load",s)}else L.call(D,!1)},isTexturesLoaded:function(){for(var L=this.textures,D=L.length,P=0;P<D;P++)if(!L[P].loaded)return!1;return!0},getRuntimeData:function(L){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return L||cc.errorID(7507,this.name),null;var D=this._getAtlas(L);if(!D)return null;var P=new sp.spine.AtlasAttachmentLoader(D),N=null,F=null;return this.skeletonJson?(F=new sp.spine.SkeletonJson(P),N=this.skeletonJson):(F=new sp.spine.SkeletonBinary(P),N=new Uint8Array(this._nativeAsset)),F.scale=this.scale,this._skeletonCache=F.readSkeletonData(N),D.dispose(),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getTexture:function(L){for(var D=this.textureNames,P=0;P<D.length;P++)if(D[P]===L){var N=this.textures[P],F=new sp.SkeletonTexture({width:N.width,height:N.height});return F.setRealTexture(N),F}return cc.errorID(7506,L),null},_getAtlas:function(L){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new sp.spine.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(L||cc.errorID(7508,this.name),null)},destroy:function(){N.removeSkeleton(this._uuid),this._super()}});sp.SkeletonData=D.exports=F},{"./skeleton-cache":283}],285:[function(L,D,P){"use strict";sp.SkeletonTexture=cc.Class({name:"sp.SkeletonTexture",extends:sp.spine.Texture,_texture:null,_material:null,setRealTexture:function(L){this._texture=L},getRealTexture:function(){return this._texture},setFilters:function(L,D){this._texture&&this._texture.setFilters(L,D)},setWraps:function(L,D){this._texture&&this._texture.setWrapMode(L,D)},dispose:function(){}})},{}],286:[function(L,D,P){"use strict";P.__esModule=!0,P.default=void 0;var N=function(L){return L&&L.__esModule?L:{default:L}}(L("../../cocos2d/core/renderer/assembler"));var F,B,k,U,V,z,W,H,G,X,nt,ut,dt,ft,_t,pt,vt,gt=L("./Skeleton"),mt=L("./lib/spine"),yt=L("../../cocos2d/core/renderer/render-flow"),Tt=L("../../cocos2d/core/renderer/webgl/vertex-format"),xt=Tt.vfmtPosUvColor,St=Tt.vfmtPosUvTwoColor,bt=cc.gfx,wt=0,Rt=[0,1,2,2,3,0],It=cc.color(0,0,255,255),Mt=cc.color(255,0,0,255),Ot=cc.color(0,255,0,255),Lt=cc.color(255,255,0,255),Dt=null,Pt=null,Nt=null,Ft=null;Dt=new mt.Color(1,1,1,1),Pt=new mt.Color(1,1,1,1),Nt=new mt.Vector2,Ft=new mt.Vector2;var Bt,kt,Ut,Vt,zt,Wt,Ht,Gt,Yt,Xt,jt,qt,Zt,Kt,Qt,$t,Jt,te,ee,ie,ne,re,se,ae,oe,ce,le,he,ue,de=0,fe=0,_e=0,pe=0,ve=0,ge=0,me=0;function Et(L,D){var P,N;switch(D){case mt.BlendMode.Additive:P=F?cc.macro.ONE:cc.macro.SRC_ALPHA,N=cc.macro.ONE;break;case mt.BlendMode.Multiply:P=cc.macro.DST_COLOR,N=cc.macro.ONE_MINUS_SRC_ALPHA;break;case mt.BlendMode.Screen:P=cc.macro.ONE,N=cc.macro.ONE_MINUS_SRC_COLOR;break;case mt.BlendMode.Normal:default:P=F?cc.macro.ONE:cc.macro.SRC_ALPHA,N=cc.macro.ONE_MINUS_SRC_ALPHA}var B=!ae.enableBatch,k=ae._materials[0];if(!k)return null;var U=L.getId()+P+N+V+B,z=ae._materialCache,W=z[U];return W||(z.baseMaterial?W=cc.MaterialVariant.create(k):(W=k,z.baseMaterial=k),W.define("CC_USE_MODEL",B),W.define("USE_TINT",V),W.setProperty("texture",L),W.setBlend(!0,bt.BLEND_FUNC_ADD,P,N,bt.BLEND_FUNC_ADD,P,N),z[U]=W),W}function At(L){ie=L.fa*ut,Kt=G*(B=F?ie/255:1),Qt=X*B,$t=nt*B,Jt=L.fr*Kt,te=L.fg*Qt,ee=L.fb*$t,dt=(ie<<24>>>0)+(ee<<16)+(te<<8)+Jt,ne=L.dr*Kt,re=L.dg*Qt,se=L.db*$t,ft=((F?255:0)<<24>>>0)+(se<<16)+(re<<8)+ne}function Ct(L){return(L.a<<24>>>0)+(L.b<<16)+(L.g<<8)+L.r}var ye=function(L){function e(){return L.apply(this,arguments)||this}!function(L,D){L.prototype=Object.create(D.prototype),L.prototype.constructor=L,L.__proto__=D}(e,L);var D=e.prototype;return D.updateRenderData=function(L){if(!L.isAnimationCached()){var D=L._skeleton;D&&D.updateWorldTransform()}},D.fillVertices=function(L,D,P,N,k){var U,z=oe._vData,W=oe._iData,H=oe._uintVData;if(Dt.a=P.a*D.a*L.a*ut*255,B=F?Dt.a:255,Bt=G*D.r*L.r*B,kt=X*D.g*L.g*B,Ut=nt*D.b*L.b*B,Dt.r=Bt*P.r,Dt.g=kt*P.g,Dt.b=Ut*P.b,null==k.darkColor?Pt.set(0,0,0,1):(Pt.r=k.darkColor.r*Bt,Pt.g=k.darkColor.g*kt,Pt.b=k.darkColor.b*Ut),Pt.a=F?255:0,N.isClipping()){var _t=z.subarray(_e+2);N.clipTriangles(z.subarray(_e),de,W.subarray(ge),ve,_t,Dt,Pt,V,pt);var gt=new Float32Array(N.clippedVertices),mt=N.clippedTriangles;if(ve=mt.length,de=gt.length/vt*pt,U=oe.request(de/pt,ve),ge=U.indiceOffset,pe=U.vertexOffset,_e=U.byteOffset>>2,z=oe._vData,W=oe._iData,H=oe._uintVData,W.set(mt,ge),ue)for(var yt=0,Tt=gt.length,xt=_e;yt<Tt;yt+=vt,xt+=pt)Nt.x=gt[yt],Nt.y=gt[yt+1],Dt.set(gt[yt+2],gt[yt+3],gt[yt+4],gt[yt+5]),Ft.x=gt[yt+6],Ft.y=gt[yt+7],V?Pt.set(gt[yt+8],gt[yt+9],gt[yt+10],gt[yt+11]):Pt.set(0,0,0,0),ue.transform(Nt,Ft,Dt,Pt),z[xt]=Nt.x,z[xt+1]=Nt.y,z[xt+2]=Ft.x,z[xt+3]=Ft.y,H[xt+4]=Ct(Dt),V&&(H[xt+5]=Ct(Pt));else for(var St=0,bt=gt.length,wt=_e;St<bt;St+=vt,wt+=pt)z[wt]=gt[St],z[wt+1]=gt[St+1],z[wt+2]=gt[St+6],z[wt+3]=gt[St+7],dt=(gt[St+5]<<24>>>0)+(gt[St+4]<<16)+(gt[St+3]<<8)+gt[St+2],H[wt+4]=dt,V&&(ft=(gt[St+11]<<24>>>0)+(gt[St+10]<<16)+(gt[St+9]<<8)+gt[St+8],H[wt+5]=ft)}else if(ue)for(var Rt=_e,It=_e+de;Rt<It;Rt+=pt)Nt.x=z[Rt],Nt.y=z[Rt+1],Ft.x=z[Rt+2],Ft.y=z[Rt+3],ue.transform(Nt,Ft,Dt,Pt),z[Rt]=Nt.x,z[Rt+1]=Nt.y,z[Rt+2]=Ft.x,z[Rt+3]=Ft.y,H[Rt+4]=Ct(Dt),V&&(H[Rt+5]=Ct(Pt));else{dt=Ct(Dt),ft=Ct(Pt);for(var Mt=_e,Ot=_e+de;Mt<Ot;Mt+=pt)H[Mt+4]=dt,V&&(H[Mt+5]=ft)}},D.realTimeTraverse=function(L){var D,P,N,F,B,G,X,nt,ut,dt,ft,_t,gt=ae._skeleton,yt=gt.color,Tt=ae._debugRenderer,xt=ae._clipper,St=null;k=ae._startSlotIndex,U=ae._endSlotIndex,Vt=!1,-1==k&&(Vt=!0),z=ae.debugSlots,W=ae.debugBones,H=ae.debugMesh,Tt&&(W||z||H)&&(Tt.clear(),Tt.lineWidth=2),vt=V?12:8,de=0,_e=0,pe=0,ve=0,ge=0;for(var bt=0,wt=gt.drawOrder.length;bt<wt;bt++)if(ft=gt.drawOrder[bt],k>=0&&k==ft.data.index&&(Vt=!0),Vt)if(U>=0&&U==ft.data.index&&(Vt=!1),de=0,ve=0,N=ft.getAttachment())if(nt=N instanceof mt.RegionAttachment,ut=N instanceof mt.MeshAttachment,N instanceof mt.ClippingAttachment)xt.clipStart(ft,N);else if(nt||ut)if(St=Et(N.region.texture._texture,ft.data.blendMode)){if((zt||St.getHash()!==ce.material.getHash())&&(zt=!1,ce._flush(),ce.node=le,ce.material=St),nt){if(X=Rt,de=4*pt,ve=6,dt=oe.request(4,6),ge=dt.indiceOffset,pe=dt.vertexOffset,_e=dt.byteOffset>>2,D=oe._vData,P=oe._iData,N.computeWorldVertices(ft.bone,D,_e,pt),Tt&&z){Tt.strokeColor=It,Tt.moveTo(D[_e],D[_e+1]);for(var Dt=_e+pt,Pt=_e+de;Dt<Pt;Dt+=pt)Tt.lineTo(D[Dt],D[Dt+1]);Tt.close(),Tt.stroke()}}else if(ut&&(X=N.triangles,de=(N.worldVerticesLength>>1)*pt,ve=X.length,dt=oe.request(de/pt,ve),ge=dt.indiceOffset,pe=dt.vertexOffset,_e=dt.byteOffset>>2,D=oe._vData,P=oe._iData,N.computeWorldVertices(ft,0,N.worldVerticesLength,D,_e,pt),Tt&&H)){Tt.strokeColor=Lt;for(var Nt=0,Ft=X.length;Nt<Ft;Nt+=3){var Bt=X[Nt]*pt+_e,kt=X[Nt+1]*pt+_e,Ut=X[Nt+2]*pt+_e;Tt.moveTo(D[Bt],D[Bt+1]),Tt.lineTo(D[kt],D[kt+1]),Tt.lineTo(D[Ut],D[Ut+1]),Tt.close(),Tt.stroke()}}if(0!=de&&0!=ve){P.set(X,ge),G=N.uvs;for(var Kt=_e,Qt=_e+de,$t=0;Kt<Qt;Kt+=pt,$t+=2)D[Kt+2]=G[$t],D[Kt+3]=G[$t+1];if(F=N.color,B=ft.color,this.fillVertices(yt,F,B,xt,ft),ve>0){for(var Jt=ge,te=ge+ve;Jt<te;Jt++)P[Jt]+=pe;if(L){_t=L.m,Gt=_t[0],Yt=_t[4],Xt=_t[12],jt=_t[1],qt=_t[5],Zt=_t[13];for(var ee=_e,ie=_e+de;ee<ie;ee+=pt)Wt=D[ee],Ht=D[ee+1],D[ee]=Wt*Gt+Ht*Yt+Xt,D[ee+1]=Wt*jt+Ht*qt+Zt}oe.adjust(de/pt,ve)}xt.clipEndWithSlot(ft)}else xt.clipEndWithSlot(ft)}else xt.clipEndWithSlot(ft);else xt.clipEndWithSlot(ft);else xt.clipEndWithSlot(ft);else xt.clipEndWithSlot(ft);if(xt.clipEnd(),Tt&&W){var ne;Tt.strokeColor=Mt,Tt.fillColor=It;for(var re=0,se=gt.bones.length;re<se;re++){var he=(ne=gt.bones[re]).data.length*ne.a+ne.worldX,ue=ne.data.length*ne.c+ne.worldY;Tt.moveTo(ne.worldX,ne.worldY),Tt.lineTo(he,ue),Tt.stroke(),Tt.circle(ne.worldX,ne.worldY,1.5*Math.PI),Tt.fill(),0===re&&(Tt.fillColor=Ot)}}},D.cacheTraverse=function(L){var D=ae._curFrame;if(D){var P=D.segments;if(0!=P.length){var N,F,B,k,U,V,z=D.vertices,W=D.indices,H=0,G=0,X=0;L&&(V=L.m,Gt=V[0],jt=V[1],Yt=V[4],qt=V[5],Xt=V[12],Zt=V[13]);var nt=16&wt,ut=nt&&1===Gt&&0===jt&&0===Yt&&1===qt,_t=0,pt=D.colors,vt=pt[_t++],gt=vt.vfOffset;At(vt);for(var mt=0,yt=P.length;mt<yt;mt++){var Tt=P[mt];if(k=Et(Tt.tex,Tt.blendMode)){(zt||k.getHash()!==ce.material.getHash())&&(zt=!1,ce._flush(),ce.node=le,ce.material=k),fe=Tt.vertexCount,ve=Tt.indexCount,U=oe.request(fe,ve),ge=U.indiceOffset,pe=U.vertexOffset,me=U.byteOffset>>2,N=oe._vData,F=oe._iData,B=oe._uintVData;for(var xt=ge,St=ge+ve;xt<St;xt++)F[xt]=pe+W[G++];if(X=Tt.vfCount,N.set(z.subarray(H,H+X),me),H+=X,ut)for(var bt=me,Rt=me+X;bt<Rt;bt+=6)N[bt]+=Xt,N[bt+1]+=Zt;else if(nt)for(var It=me,Mt=me+X;It<Mt;It+=6)Wt=N[It],Ht=N[It+1],N[It]=Wt*Gt+Ht*Yt+Xt,N[It+1]=Wt*jt+Ht*qt+Zt;if(oe.adjust(fe,ve),he)for(var Ot=H-X,Lt=me+4,Dt=me+4+X;Lt<Dt;Lt+=6,Ot+=6)Ot>=gt&&(At(vt=pt[_t++]),gt=vt.vfOffset),B[Lt]=dt,B[Lt+1]=ft}}}}},D.fillBuffers=function(L,D){var P=L.node;if(P._renderFlag|=yt.FLAG_UPDATE_RENDER_DATA,L._skeleton){var N=P._color;G=N.r/255,X=N.g/255,nt=N.b/255,ut=N.a/255,V=L.useTint||L.isAnimationCached(),_t=V?St:xt,pt=V?6:5,le=L.node,oe=D.getBuffer("spine",_t),ce=D,ae=L,zt=!0,F=L.premultipliedAlpha,B=1,wt=0,he=!1,ue=L._effectDelegate&&L._effectDelegate._vertexEffect,(4294967295!==N._val||F)&&(he=!0),V&&(wt|=1);var k=void 0;ae.enableBatch&&(k=le._worldMatrix,zt=!1,wt|=16),L.isAnimationCached()?this.cacheTraverse(k):(ue&&ue.begin(L._skeleton),this.realTimeTraverse(k),ue&&ue.end()),D.worldMatDirty++,L.attachUtil._syncAttachedNode(),le=void 0,oe=void 0,ce=void 0,ae=void 0,ue=null}},D.postFillBuffers=function(L,D){D.worldMatDirty--},e}(N.default);P.default=ye,N.default.register(gt,ye),D.exports=P.default},{"../../cocos2d/core/renderer/assembler":165,"../../cocos2d/core/renderer/render-flow":169,"../../cocos2d/core/renderer/webgl/vertex-format":200,"./Skeleton":280,"./lib/spine":282}],287:[function(L,D,P){"use strict";var n=function(){this.start=null,this.end=null,this.complete=null,this.event=null,this.interrupt=null,this.dispose=null};n.getListeners=function(L){return L.listener||(L.listener=new n),L.listener},D.exports=n},{}],288:[function(L,D,P){"use strict";var N=L("./lib/spine");sp.VertexEffectDelegate=cc.Class({name:"sp.VertexEffectDelegate",ctor:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},clear:function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},initJitter:function(L,D){return this._effectType="jitter",this._vertexEffect=new N.JitterEffect(L,D),this._vertexEffect},initSwirlWithPow:function(L,D){return this._interpolation=new N.Pow(D),this._vertexEffect=new N.SwirlEffect(L,this._interpolation),this._vertexEffect},initSwirlWithPowOut:function(L,D){return this._interpolation=new N.PowOut(D),this._vertexEffect=new N.SwirlEffect(L,this._interpolation),this._vertexEffect},getJitterVertexEffect:function(){return this._vertexEffect},getSwirlVertexEffect:function(){return this._vertexEffect},getVertexEffect:function(){return this._vertexEffect},getEffectType:function(){return this._effectType}}),D.exports=sp.VertexEffectDelegate},{"./lib/spine":282}],289:[function(L,D,P){"use strict";var N="undefined"==typeof window?global:window;N.cc=N.cc||{},cc.internal=cc.internal||{},L("./predefine"),L("./polyfill/string"),L("./polyfill/misc"),L("./polyfill/array"),L("./polyfill/object"),L("./polyfill/array-buffer"),L("./polyfill/number"),L("./polyfill/typescript"),L("./cocos2d/core/predefine"),L("./cocos2d"),L("./extends"),D.exports=N.cc},{"./cocos2d":238,"./cocos2d/core/predefine":162,"./extends":277,"./package":void 0,"./polyfill/array":291,"./polyfill/array-buffer":290,"./polyfill/misc":292,"./polyfill/number":293,"./polyfill/object":294,"./polyfill/string":295,"./polyfill/typescript":296,"./predefine":297}],290:[function(L,D,P){"use strict";if(!ArrayBuffer.isView){var N=Object.getPrototypeOf(Int8Array);ArrayBuffer.isView="function"==typeof N?function(L){return L instanceof N}:function(L){if("object"!=typeof L)return!1;var D=L.constructor;return D===Float32Array||D===Uint8Array||D===Uint32Array||D===Int8Array}}},{}],291:[function(L,D,P){"use strict";Array.isArray||(Array.isArray=function(L){return"[object Array]"===Object.prototype.toString.call(L)}),Array.prototype.find||(Array.prototype.find=function(L){for(var D=this.length,P=0;P<D;P++){var N=this[P];if(L.call(this,N,P,this))return N}}),Array.prototype.includes||(Array.prototype.includes=function(L){return-1!==this.indexOf(L)})},{}],292:[function(L,D,P){"use strict";if(Math.sign||(Math.sign=function(L){return 0==(L=+L)||isNaN(L)?L:L>0?1:-1}),Math.log2||(Math.log2=function(L){return Math.log(L)*Math.LOG2E}),Number.isInteger||(Number.isInteger=function(L){return"number"==typeof L&&isFinite(L)&&Math.floor(L)===L}),!console.time){var N=window.performance||Date,F=Object.create(null);console.time=function(L){F[L]=N.now()},console.timeEnd=function(L){var D=F[L],P=N.now()-D;console.log(L+": "+P+"ms")}}},{}],293:[function(L,D,P){"use strict";Number.parseFloat=Number.parseFloat||parseFloat,Number.parseInt=Number.parseInt||parseInt},{}],294:[function(L,D,P){"use strict";Object.assign||(Object.assign=function(L,D){return cc.js.mixin(L,D)}),Object.getOwnPropertyDescriptors||(Object.getOwnPropertyDescriptors=function(L){var D={},P=Object.getOwnPropertyNames(L);Object.getOwnPropertySymbols&&(P=P.concat(Object.getOwnPropertySymbols(L)));for(var N=0;N<P.length;++N){var F=P[N];D[F]=Object.getOwnPropertyDescriptor(L,F)}return D})},{}],295:[function(L,D,P){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(L,D){return D=D||0,this.lastIndexOf(L,D)===D}),String.prototype.endsWith||(String.prototype.endsWith=function(L,D){(void 0===D||D>this.length)&&(D=this.length),D-=L.length;var P=this.indexOf(L,D);return-1!==P&&P===D}),String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")})},{}],296:[function(L,D,P){"use strict";var N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,D){L.__proto__=D}||function(L,D){for(var P in D)D.hasOwnProperty(P)&&(L[P]=D[P])};window.__extends=function(L,D){function i(){this.constructor=L}N(L,D),L.prototype=null===D?Object.create(D):(i.prototype=D.prototype,new i)},window.__assign=Object.assign||function(L){for(var D,P=1,N=arguments.length;P<N;P++)for(var F in D=arguments[P])Object.prototype.hasOwnProperty.call(D,F)&&(L[F]=D[F]);return L},window.__rest=function(L,D){var P={};for(var N in L)Object.prototype.hasOwnProperty.call(L,N)&&D.indexOf(N)<0&&(P[N]=L[N]);if(null!=L&&"function"==typeof Object.getOwnPropertySymbols){var F=0;for(N=Object.getOwnPropertySymbols(L);F<N.length;F++)D.indexOf(N[F])<0&&(P[N[F]]=L[N[F]])}return P},window.__decorate=function(L,D,P,N){var F,B=arguments.length,k=B<3?D:null===N?N=Object.getOwnPropertyDescriptor(D,P):N;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)k=Reflect.decorate(L,D,P,N);else for(var U=L.length-1;U>=0;U--)(F=L[U])&&(k=(B<3?F(k):B>3?F(D,P,k):F(D,P))||k);return B>3&&k&&Object.defineProperty(D,P,k),k},window.__param=function(L,D){return function(P,N){D(P,N,L)}},window.__metadata=function(L,D){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(L,D)},window.__awaiter=function(L,D,P,N){return new(P||(P=Promise))((function(F,B){function a(L){try{c(N.next(L))}catch(L){B(L)}}function o(L){try{c(N.throw(L))}catch(L){B(L)}}function c(L){L.done?F(L.value):new P((function(D){D(L.value)})).then(a,o)}c((N=N.apply(L,D||[])).next())}))},window.__generator=function(L,D){var P,N,F,B,k={label:0,sent:function(){if(1&F[0])throw F[1];return F[1]},trys:[],ops:[]};return B={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(B[Symbol.iterator]=function(){return this}),B;function o(L){return function(D){return c([L,D])}}function c(B){if(P)throw new TypeError("Generator is already executing.");for(;k;)try{if(P=1,N&&(F=2&B[0]?N.return:B[0]?N.throw||((F=N.return)&&F.call(N),0):N.next)&&!(F=F.call(N,B[1])).done)return F;switch(N=0,F&&(B=[2&B[0],F.value]),B[0]){case 0:case 1:F=B;break;case 4:return k.label++,{value:B[1],done:!1};case 5:k.label++,N=B[1],B=[0];continue;case 7:B=k.ops.pop(),k.trys.pop();continue;default:if(!(F=(F=k.trys).length>0&&F[F.length-1])&&(6===B[0]||2===B[0])){k=0;continue}if(3===B[0]&&(!F||B[1]>F[0]&&B[1]<F[3])){k.label=B[1];break}if(6===B[0]&&k.label<F[1]){k.label=F[1],F=B;break}if(F&&k.label<F[2]){k.label=F[2],k.ops.push(B);break}F[2]&&k.ops.pop(),k.trys.pop();continue}B=D.call(L,k)}catch(L){B=[6,L],N=0}finally{P=F=0}if(5&B[0])throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}},window.__exportStar=function(L,D){for(var P in L)D.hasOwnProperty(P)||(D[P]=L[P])},window.__values=function(L){var D="function"==typeof Symbol&&L[Symbol.iterator],P=0;return D?D.call(L):{next:function(){return L&&P>=L.length&&(L=void 0),{value:L&&L[P++],done:!L}}}},window.__read=function(L,D){var P="function"==typeof Symbol&&L[Symbol.iterator];if(!P)return L;var N,F,B=P.call(L),k=[];try{for(;(void 0===D||D-- >0)&&!(N=B.next()).done;)k.push(N.value)}catch(L){F={error:L}}finally{try{N&&!N.done&&(P=B.return)&&P.call(B)}finally{if(F)throw F.error}}return k},window.__spread=function(){for(var L=[],D=0;D<arguments.length;D++)L=L.concat(__read(arguments[D]));return L},window.__await=function(L){return this instanceof __await?(this.v=L,this):new __await(L)},window.__asyncGenerator=function(L,D,P){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var N,F=P.apply(L,D||[]),B=[];return N={},a("next"),a("throw"),a("return"),N[Symbol.asyncIterator]=function(){return this},N;function a(L){F[L]&&(N[L]=function(D){return new Promise((function(P,N){B.push([L,D,P,N])>1||o(L,D)}))})}function o(L,D){try{!function(L){L.value instanceof __await?Promise.resolve(L.value.v).then(l,h):u(B[0][2],L)}(F[L](D))}catch(L){u(B[0][3],L)}}function l(L){o("next",L)}function h(L){o("throw",L)}function u(L,D){L(D),B.shift(),B.length&&o(B[0][0],B[0][1])}},window.__asyncDelegator=function(L){var D,P;return D={},n("next"),n("throw",(function(L){throw L})),n("return"),D[Symbol.iterator]=function(){return this},D;function n(N,F){D[N]=L[N]?function(D){return(P=!P)?{value:__await(L[N](D)),done:"return"===N}:F?F(D):D}:F}},window.__asyncValues=function(L){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D,P=L[Symbol.asyncIterator];return P?P.call(L):(L="function"==typeof __values?__values(L):L[Symbol.iterator](),D={},n("next"),n("throw"),n("return"),D[Symbol.asyncIterator]=function(){return this},D);function n(P){D[P]=L[P]&&function(D){return new Promise((function(N,F){!function(L,D,P,N){Promise.resolve(N).then((function(D){L({value:D,done:P})}),D)}(N,F,(D=L[P](D)).done,D.value)}))}}},window.__makeTemplateObject=function(L,D){return Object.defineProperty?Object.defineProperty(L,"raw",{value:D}):L.raw=D,L},window.__importStar=function(L){if(L&&L.__esModule)return L;var D={};if(null!=L)for(var P in L)Object.hasOwnProperty.call(L,P)&&(D[P]=L[P]);return D.default=L,D},window.__importDefault=function(L){return L&&L.__esModule?L:{default:L}}},{}],297:[function(L,D,P){"use strict";var N="undefined"==typeof window?global:window;function s(L,D){void 0===N[L]&&Object.defineProperty(N,L,{get:function(){var P;return"CC_WECHATGAMESUB"===L?P="cc.sys.platform === cc.sys.WECHAT_GAME_SUB":"CC_WECHATGAME"===L?P="cc.sys.platform === cc.sys.WECHAT_GAME":"CC_QQPLAY"===L&&(P="cc.sys.platform === cc.sys.QQ_PLAY"),cc.warnID(1400,L,P),D}})}function a(L){return"object"==typeof N[L]}(function(L,D){void 0===N[L]&&(N[L]=D)})("CC_BUILD",!1),N.CC_BUILD=!0,N.CC_DEV=!1,N.CC_DEBUG=!1,N.CC_JSB=!1,N.CC_NATIVERENDERER=!1,N.CC_SUPPORT_JIT=!0,N.CC_PHYSICS_BUILTIN=!1,N.CC_PHYSICS_CANNON=!1,N.CC_EDITOR=!1,N.CC_PREVIEW=!1,N.CC_TEST=!1,N.CC_RUNTIME=!1,N.CC_JSB=!1;var F=!(!a("wx")||!wx.getSharedCanvas),B=!(!a("wx")||!wx.getSystemInfoSync&&!wx.getSharedCanvas),k=a("bk");s("CC_WECHATGAMESUB",F),s("CC_WECHATGAME",B),s("CC_QQPLAY",k),N.CocosEngine=cc.ENGINE_VERSION="2.3.2"},{}]},{},[289]);